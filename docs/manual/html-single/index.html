<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Hazelcast IMDG Reference Manual</title>
<style>
@import url(https://fonts.googleapis.com/css?family=Cousine);
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 16px; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.4; color: #444444; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #FF5F00; text-decoration: none; line-height: inherit; }
a:hover, a:focus { color: #4183c4; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: helvetica, arial, freesans, clean, sans-serif; font-weight: normal; font-size: 1em; line-height: 1.5; margin-bottom: 0.9375em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: helvetica, arial, freesans, clean, sans-serif; font-weight: bold; font-style: normal; color: #333333; text-rendering: optimizeLegibility; margin-top: 0.2em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: gray; line-height: 0; }

h1 { font-size: 1.25em; }

h2 { font-size: 0.875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 0.8125em; }

h4 { font-size: 0.6875em; }

h5 { font-size: 1em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: Cousine, Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #c83b41; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.5; margin-bottom: 0.9375em; list-style-position: outside; font-family: helvetica, arial, freesans, clean, sans-serif; }

ul, ol { margin-left: 0.65625em; }
ul.no-bullet, ol.no-bullet { margin-left: 0.65625em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #333333; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 0.9375em; padding: 0; border-left: none; }
blockquote cite { display: block; font-size: 0.8125em; color: #666666; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #666666; }

blockquote, blockquote p { line-height: 1.5; color: #666666; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.2em; }
  h2 { font-size: 2.1em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.525em; }
  h4 { font-size: 1.3em; } 
  h5 { font-size: 1.2em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: 0.875em; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: 0.9375em; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.5; }

body { -moz-osx-font-smoothing: grayscale; -webkit-font-smoothing: antialiased; tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }

a:hover, a:focus { text-decoration: underline; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.8em; font-style: normal !important; letter-spacing: 0; padding: 1px 5px 1px 5px; background-color: #f7f7f7; border: 1px solid #dddddd; -webkit-border-radius: 3px; border-radius: 3px; line-height: inherit; word-wrap: break-word; }
*:not(pre) > code.nobreak { word-wrap: normal; }
*:not(pre) > code.nowrap { white-space: nowrap; }

pre, pre > code { line-height: 1.45; color: #333333; font-family: Cousine, Consolas, "Liberation Mono", Courier, monospace; font-size: 0.8em; font-weight: normal; }

em em { font-style: normal; }

strong strong { font-weight: normal; }

.keyseq { color: #666666; }

kbd { font-family: Cousine, Consolas, "Liberation Mono", Courier, monospace; display: inline-block; color: #333333; font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menuref { color: #000; }

.menuseq b:not(.caret), .menuref { font-weight: inherit; }

.menuseq { word-spacing: -0.02em; }
.menuseq b.caret { font-size: 1.25em; line-height: 0.8; }
.menuseq i.caret { font-weight: bold; text-align: center; width: 0.45em; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 70.5em; *zoom: 1; position: relative; padding-left: 0.8375em; padding-right: 0.8375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: #333333; font-weight: 300; margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #dddddd; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #dddddd; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #dddddd; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: #666666; display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: #666666; }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: #666666; }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: #333333; font-weight: 300; border-bottom: 1px solid #dddddd; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 0 solid #dddddd; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: helvetica, arial, freesans, clean, sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #444444; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f7f7f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 0.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 0.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #dedede; margin-bottom: 1.25em; padding: 1.25em; background: #f7f7f7; -webkit-border-radius: 3px; border-radius: 3px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: whitesmoke; padding: 1.25em; }

#footer-text { color: #333333; line-height: 1.35; }

#content { margin-bottom: 0.625em; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { #content { margin-bottom: 1.25em; }
  .sect1 { padding-bottom: 1.25em; } }
.sect1:last-child { padding-bottom: 0; }

.sect1 + .sect1 { border-top: 0 solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #333333; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #262626; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-size: 1rem; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: #333333; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: helvetica, arial, freesans, clean, sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #666666; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 3px; border-radius: 3px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #dedede; margin-bottom: 1.25em; padding: 1.25em; background: #f7f7f7; -webkit-border-radius: 3px; border-radius: 3px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #444444; margin-top: 0; border-width: 0 0 1px 0; border-style: solid; border-color: #cacaca; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f9f9f9; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border: 2px solid #d4d4d4; -webkit-border-radius: 3px; border-radius: 3px; word-wrap: break-word; padding: 0.75em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f9f9f9; background-color: #333333; }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 0.75em; -webkit-border-radius: 3px; border-radius: 3px; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 0.9375em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: #666666; font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #444444; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid #666666; }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 0.9375em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: #666666; font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.8125em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: #666666; }

.quoteblock.abstract { margin: 0 0 0.9375em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dddddd; }

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock { border-width: 0 1px 1px 0; }

table.grid-all > tfoot > tr > .tableblock { border-width: 1px 1px 0 0; }

table.grid-cols > * > tr > .tableblock { border-width: 0 1px 0 0; }

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock { border-width: 0 0 1px 0; }

table.grid-rows > tfoot > tr > .tableblock { border-width: 1px 0 0 0; }

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock { border-bottom-width: 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.5; background: whitesmoke; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 0.90625em; }

ul li ol { margin-left: 0.65625em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.46875em; }

ul.checklist, ul.none, ol.none, ul.no-bullet, ol.no-bullet, ol.unnumbered, ul.unstyled, ol.unstyled { list-style-type: none; }

ul.no-bullet, ol.no-bullet, ol.unnumbered { margin-left: 0.625em; }

ul.unstyled, ol.unstyled { margin-left: 0; }

ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1.25em; font-size: 0.8em; position: relative; bottom: 0.125em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.inline { display: -ms-flexbox; display: -webkit-box; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; list-style: none; margin: 0 0 0.46875em -0.9375em; }

ul.inline > li { margin-left: 0.9375em; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 0.9375em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist td:not([class]):first-child { padding: 0.4em 0.75em 0 0.75em; line-height: 1; vertical-align: top; }
.colist td:not([class]):first-child img { max-width: none; }
.colist td:not([class]):last-child { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; margin-left: -1.05em; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }
a span.icon > .fa { cursor: inherit; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #2e6295; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: #333333; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1em; color: #666666; }

h2 { color: #325D72; border-bottom: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { color: #333333; }

#header, #content, #footnotes { max-width: 700px; padding-left: 0; padding-right: 0; }

body.toc2.toc-left #toc.toc2 #toctitle { font-size: 0.9375em; }

.olist.procedure > ol { counter-reset: li; list-style: none; position: relative; }
.olist.procedure > ol > li { position: relative; padding: 5px 0 5px 55px; margin-bottom: 5px; }
.olist.procedure > ol > li:before { content: counter(li); counter-increment: li; position: absolute; top: 0; left: 0; height: 100%; width: 30px; padding: 0 10px 0 0; color: #999; font-size: 1.375em; font-weight: bold; line-height: 1.6; text-align: right; border-right: 1px solid #ddd; }

.quoteblock blockquote { padding-left: 1em; }

.sidebarblock > .content > .title { margin-top: -20px; margin-right: -20px; margin-left: -20px; margin-bottom: 20px; padding: 1em; font-size: 0.75em; background: #eaeaea; }

.literalblock pre, .listingblock pre { background: #f9f9f9; font-size: 0.9375em; }

#scrollUp {
  bottom: 20px;
  right: 150px;
  padding: 10px 20px;
  background: #FF5F00;
  color: #fff;
}

#toc #toctree .jstree-anchor {
white-space: normal;
height: inherit;
hyphens: auto;
font-size:14px;
}


input#search {
        border: 1px solid #ccc;
        border-radius: 4px;
        -moz-border-radius: 4px;
        font-size: 16px;
        margin-bottom: 20px;
        padding: 4px 0;
        width: 100%;
    }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<meta name="keywords" content="open source, documentation, imdg">
<meta name="description" content="Hazelcast Reference Manual explains all in-memory data grid features provided by Hazelcast in detail with code samples and configuration options.">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/themes/default/style.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.1/jstree.min.js"></script>
 <script src="https://unpkg.com/lunr/lunr.js"></script>
<link rel="shortcut icon" href="https://hazelcast.org/favicon.png">

<script>
$(document).ready(function(){var e="3.11";$.ajax({type:"GET",dataType:"xml",url:"../../../versions123.xml",success:function(t){$("#toctitle").before('<select id="vchooser"></select>'),$("#vchooser").append("<option>Choose IMDG Release</option>"),$(t).find("version").each(function(){var t=$(this).attr("name"),o=0==t.indexOf(e)?"selected":"";$("#vchooser").append('<option value="'+$(this).attr("path")+'" '+o+">"+t+"</option>")}),$("#vchooser").change(function(){""!==this.value&&(window.location.href="../../../"+this.value+"/index.html")})}}),$("ul.sectlevel1").wrap('<div id="toctree"></div>'),$("#toctree").jstree({core:{themes:{variant:"small",icons:!1}},plugins:["search","state","wholerow"]}).on("activate_node.jstree",function(e,t){location.href=t.node.a_attr.href}),$("#toctree").before('<input placeholder="Search in TOC" id="tocsearch" type="text">');var t=!1;$("#tocsearch").keyup(function(){t&&clearTimeout(t),t=setTimeout(function(){var e=$("#tocsearch").val();$("#toctree").jstree(!0).search(e)},250)}),$("#tocsearch").after('<a href="#" id="toctreeexpand" title="Expand"><i class="fa fa-plus-square-o" aria-hidden="true"></i></a><a href="#" id="toctreecollapse" title="Collapse"><i class="fa fa-minus-square-o" aria-hidden="true"></i></a>'),$("#toctreeexpand").click(function(){$("#toctree").jstree("open_all")}),$("#toctreecollapse").click(function(){$("#toctree").jstree("close_all")})});
</script>

<script>
!function(l,o,e){"use strict";l.fn.scrollUp=function(o){l.data(e.body,"scrollUp")||(l.data(e.body,"scrollUp",!0),l.fn.scrollUp.init(o))},l.fn.scrollUp.init=function(r){var s,t,c,i,n,a,d,p=l.fn.scrollUp.settings=l.extend({},l.fn.scrollUp.defaults,r),f=!1;switch(d=p.scrollTrigger?l(p.scrollTrigger):l("<a/>",{id:p.scrollName,href:"#top"}),p.scrollTitle&&d.attr("title",p.scrollTitle),d.appendTo("body"),p.scrollImg||p.scrollTrigger||d.html(p.scrollText),d.css({display:"none",position:"fixed",zIndex:p.zIndex}),p.activeOverlay&&l("<div/>",{id:p.scrollName+"-active"}).css({position:"absolute",top:p.scrollDistance+"px",width:"100%",borderTop:"1px dotted"+p.activeOverlay,zIndex:p.zIndex}).appendTo("body"),p.animation){case"fade":s="fadeIn",t="fadeOut",c=p.animationSpeed;break;case"slide":s="slideDown",t="slideUp",c=p.animationSpeed;break;default:s="show",t="hide",c=0}i="top"===p.scrollFrom?p.scrollDistance:l(e).height()-l(o).height()-p.scrollDistance,n=l(o).scroll(function(){l(o).scrollTop()>i?f||(d[s](c),f=!0):f&&(d[t](c),f=!1)}),p.scrollTarget?"number"==typeof p.scrollTarget?a=p.scrollTarget:"string"==typeof p.scrollTarget&&(a=Math.floor(l(p.scrollTarget).offset().top)):a=0,d.click(function(o){o.preventDefault(),l("html, body").animate({scrollTop:a},p.scrollSpeed,p.easingType)})},l.fn.scrollUp.defaults={scrollName:"scrollUp",scrollDistance:300,scrollFrom:"top",scrollSpeed:300,easingType:"linear",animation:"fade",animationSpeed:200,scrollTrigger:!1,scrollTarget:!1,scrollText:"Scroll to top",scrollTitle:!1,scrollImg:!1,activeOverlay:!1,zIndex:2147483647},l.fn.scrollUp.destroy=function(r){l.removeData(e.body,"scrollUp"),l("#"+l.fn.scrollUp.settings.scrollName).remove(),l("#"+l.fn.scrollUp.settings.scrollName+"-active").remove(),l.fn.jquery.split(".")[1]>=7?l(o).off("scroll",r):l(o).unbind("scroll",r)},l.scrollUp=l.fn.scrollUp}(jQuery,window,document);
</script>

<script>
$(function () {
		$.scrollUp({
			scrollName: 'scrollUp',
			topDistance: '300',
			topSpeed: 100,
			animation: 'fade',
			animationInSpeed: 100,
			animationOutSpeed: 100,
			scrollText: 'Back to Top',
			activeOverlay: false,
		});
});
</script>

<script>
(function(){$("a[href^=#]").on("click",function(t){var a=$(this).attr("href");$("html, body").animate({scrollTop:$(a).offset().top},"fast"),t.preventDefault()})}).call(this);
</script>
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Hazelcast IMDG 3.11 Reference Manual</div>
<ul class="sectlevel1">
<li><a href="#hazelcast-imdg-reference-manual">Hazelcast IMDG Reference Manual</a></li>
<li><a href="#preface">Preface</a>
<ul class="sectlevel2">
<li><a href="#hazelcast-imdg-editions">Hazelcast IMDG Editions</a></li>
<li><a href="#hazelcast-imdg-architecture">Hazelcast IMDG Architecture</a></li>
<li><a href="#hazelcast-imdg-plugins">Hazelcast IMDG Plugins</a></li>
<li><a href="#licensing">Licensing</a></li>
<li><a href="#trademarks">Trademarks</a></li>
<li><a href="#customer-support">Customer Support</a></li>
<li><a href="#release-notes">Release Notes</a></li>
<li><a href="#contributing-to-hazelcast-imdg">Contributing to Hazelcast IMDG</a></li>
<li><a href="#partners">Partners</a></li>
<li><a href="#phone-home">Phone Home</a></li>
</ul>
</li>
<li><a href="#document-revision-history">1. Document Revision History</a></li>
<li><a href="#getting-started">2. Getting Started</a>
<ul class="sectlevel2">
<li><a href="#installation">2.1. Installation</a>
<ul class="sectlevel3">
<li><a href="#installing-hazelcast-imdg">2.1.1. Installing Hazelcast IMDG</a></li>
<li><a href="#installing-hazelcast-imdg-enterprise">2.1.2. Installing Hazelcast IMDG Enterprise</a></li>
<li><a href="#setting-the-license-key">2.1.3. Setting the License Key</a>
<ul class="sectlevel4">
<li><a href="#license-key-format">License Key Format</a></li>
</ul>
</li>
<li><a href="#license-info">2.1.4. License Information</a>
<ul class="sectlevel4">
<li><a href="#jmx">JMX</a></li>
<li><a href="#rest">REST</a></li>
<li><a href="#logs">Logs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#supported-jvms">2.2. Supported Java Virtual Machines</a></li>
<li><a href="#running-in-modular-java">2.3. Running in Modular Java</a></li>
<li><a href="#upgrading-from-3x">2.4. Upgrading from 3.x</a></li>
<li><a href="#upgrading-from-2x">2.5. Upgrading from 2.x</a></li>
<li><a href="#starting-the-member-and-client">2.6. Starting the Member and Client</a></li>
<li><a href="#using-the-scripts-in-the-package">2.7. Using the Scripts In The Package</a></li>
<li><a href="#deploying-on-amazon-ec2">2.8. Deploying On Amazon EC2</a></li>
<li><a href="#deploying-on-microsoft-azure">2.9. Deploying On Microsoft Azure</a></li>
<li><a href="#deploying-on-pivotal-cloud-foundry">2.10. Deploying On Pivotal Cloud Foundry</a></li>
<li><a href="#deploying-using-docker">2.11. Deploying using Docker</a></li>
</ul>
</li>
<li><a href="#hazelcast-overview">3. Hazelcast Overview</a>
<ul class="sectlevel2">
<li><a href="#sharding-in-hazelcast">3.1. Sharding in Hazelcast</a></li>
<li><a href="#hazelcast-topology">3.2. Hazelcast Topology</a></li>
<li><a href="#why-hazelcast">3.3. Why Hazelcast?</a></li>
<li><a href="#data-partitioning">3.4. Data Partitioning</a>
<ul class="sectlevel3">
<li><a href="#how-the-data-is-partitioned">3.4.1. How the Data is Partitioned</a></li>
<li><a href="#partition-table">3.4.2. Partition Table</a></li>
<li><a href="#repartitioning">3.4.3. Repartitioning</a></li>
</ul>
</li>
<li><a href="#use-cases">3.5. Use Cases</a></li>
<li><a href="#resources">3.6. Resources</a></li>
</ul>
</li>
<li><a href="#understanding-configuration">4. Understanding Configuration</a>
<ul class="sectlevel2">
<li><a href="#configuring-declaratively">4.1. Configuring Declaratively</a>
<ul class="sectlevel3">
<li><a href="#composing-declarative-configuration">4.1.1. Composing Declarative Configuration</a></li>
</ul>
</li>
<li><a href="#configuring-programmatically">4.2. Configuring Programmatically</a></li>
<li><a href="#configuring-with-system-properties">4.3. Configuring with System Properties</a></li>
<li><a href="#configuring-within-spring-context">4.4. Configuring within Spring Context</a></li>
<li><a href="#dynamically-adding-data-structure-configuration-on-a-cluster">4.5. Dynamically Adding Data Structure Configuration on a Cluster</a>
<ul class="sectlevel3">
<li><a href="#handling-configuration-conflicts">4.5.1. Handling Configuration Conflicts</a></li>
</ul>
</li>
<li><a href="#checking-configuration">4.6. Checking Configuration</a></li>
<li><a href="#configuration-pattern-matcher">4.7. Configuration Pattern Matcher</a></li>
<li><a href="#using-wildcards">4.8. Using Wildcards</a></li>
<li><a href="#using-variables">4.9. Using Variables</a></li>
<li><a href="#variable-replacers">4.10. Variable Replacers</a>
<ul class="sectlevel3">
<li><a href="#encryptionreplacer">4.10.1. EncryptionReplacer</a></li>
<li><a href="#propertyreplacer">4.10.2. PropertyReplacer</a></li>
<li><a href="#implementing-custom-replacers">4.10.3. Implementing Custom Replacers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#setting-up-clusters">5. Setting Up Clusters</a>
<ul class="sectlevel2">
<li><a href="#discovery-mechanisms">5.1. Discovery Mechanisms</a>
<ul class="sectlevel3">
<li><a href="#tcp">5.1.1. TCP</a></li>
<li><a href="#multicast">5.1.2. Multicast</a></li>
<li><a href="#aws-cloud-discovery">5.1.3. AWS Cloud Discovery</a></li>
<li><a href="#gcp-cloud-discovery">5.1.4. GCP Cloud Discovery</a></li>
<li><a href="#apache-jclous-cloud-discovery">5.1.5. Apache jclouds Cloud Discovery</a></li>
<li><a href="#azure-cloud-discovery">5.1.6. Azure Cloud Discovery</a></li>
<li><a href="#zookeeper-cloud-discovery">5.1.7. Zookeeper Cloud Discovery</a></li>
<li><a href="#condul-cloud-discovery">5.1.8. Consul Cloud Discovery</a></li>
<li><a href="#etcd-cloud-discovery">5.1.9. etcd Cloud Discovery</a></li>
<li><a href="#hazelcast-for-pcf">5.1.10. Hazelcast for PCF</a></li>
<li><a href="#hazelcast-openshift-integration">5.1.11. Hazelcast OpenShift Integration</a></li>
<li><a href="#eureka-cloud-discovery">5.1.12. Eureka Cloud Discovery</a></li>
<li><a href="#heroku-cloud-discovery">5.1.13. Heroku Cloud Discovery</a></li>
<li><a href="#kubernetes-cloud-discovery">5.1.14. Kubernetes Cloud Discovery</a></li>
</ul>
</li>
<li><a href="#discovering-members-by-tcp">5.2. Discovering Members by TCP</a></li>
<li><a href="#discovering-members-by-multicast">5.3. Discovering Members by Multicast</a></li>
<li><a href="#discovering-native-clients">5.4. Discovering Native Clients</a></li>
<li><a href="#creating-cluster-groups">5.5. Creating Cluster Groups</a>
<ul class="sectlevel3">
<li><a href="#cluster-groups-before-hazelcast-382">5.5.1. Cluster Groups before Hazelcast 3.8.2</a></li>
</ul>
</li>
<li><a href="#member-user-code-deployment-beta">5.6. Member User Code Deployment - BETA</a>
<ul class="sectlevel3">
<li><a href="#configuring-user-code-deployment">5.6.1. Configuring User Code Deployment</a></li>
<li><a href="#example-for-filtering-members">5.6.2. Example for Filtering Members</a></li>
</ul>
</li>
<li><a href="#client-user-code-deployment-beta">5.7. Client User Code Deployment - BETA</a>
<ul class="sectlevel3">
<li><a href="#configuring-client-user-code-deployment">5.7.1. Configuring Client User Code Deployment</a>
<ul class="sectlevel4">
<li><a href="#client-user-code-deployment-note">Important to Know</a></li>
</ul>
</li>
<li><a href="#adding-user-library-to-classpath">5.7.2. Adding User Library to CLASSPATH</a></li>
</ul>
</li>
<li><a href="#partition-group-configuration">5.8. Partition Group Configuration</a>
<ul class="sectlevel3">
<li><a href="#grouping-types">5.8.1. Grouping Types</a>
<ul class="sectlevel4">
<li><a href="#host_aware">HOST_AWARE</a></li>
<li><a href="#custom">CUSTOM</a></li>
<li><a href="#per_member">PER_MEMBER</a></li>
<li><a href="#zone_aware">ZONE_AWARE</a></li>
<li><a href="#spi">SPI</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#logging-configuration">5.9. Logging Configuration</a>
<ul class="sectlevel3">
<li><a href="#example-log4j2-configuration">5.9.1. Example Log4j2 Configuration</a></li>
<li><a href="#example-log4j-configuration">5.9.2. Example Log4j Configuration</a></li>
</ul>
</li>
<li><a href="#other-network-configurations">5.10. Other Network Configurations</a>
<ul class="sectlevel3">
<li><a href="#public-address">5.10.1. Public Address</a></li>
<li><a href="#port">5.10.2. Port</a></li>
<li><a href="#outbound-ports">5.10.3. Outbound Ports</a></li>
<li><a href="#reuse-address">5.10.4. Reuse Address</a></li>
<li><a href="#join">5.10.5. Join</a>
<ul class="sectlevel4">
<li><a href="#multicast-element">multicast element</a></li>
<li><a href="#tcp-ip-element">tcp-ip element</a></li>
<li><a href="#aws-element">aws element</a></li>
<li><a href="#discovery-strategies-element">discovery-strategies element</a></li>
</ul>
</li>
<li><a href="#awsclient-configuration">5.10.6. AWSClient Configuration</a></li>
<li><a href="#interfaces">5.10.7. Interfaces</a></li>
<li><a href="#ipv6-support">5.10.8. IPv6 Support</a></li>
<li><a href="#member-address-provides-spi">5.10.9. Member Address Provider SPI</a></li>
</ul>
</li>
<li><a href="#failure-detector-configuration">5.11. Failure Detector Configuration</a>
<ul class="sectlevel3">
<li><a href="#deadline-failure-detector">5.11.1. Deadline Failure Detector</a></li>
<li><a href="#phi-accrual-failure-detector">5.11.2. Phi Accrual Failure Detector</a></li>
<li><a href="#ping-failure-detector">5.11.3. Ping Failure Detector</a>
<ul class="sectlevel4">
<li><a href="#requirements-and-linuxunix-configuration">Requirements and Linux/Unix Configuration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#rolling-member-upgrades">6. Rolling Member Upgrades</a>
<ul class="sectlevel2">
<li><a href="#terminology">6.1. Terminology</a></li>
<li><a href="#hazelcast-members-compatibility-guarantees">6.2. Hazelcast Members Compatibility Guarantees</a></li>
<li><a href="#rolling-upgrade-procedure">6.3. Rolling Upgrade Procedure</a></li>
<li><a href="#network-partitions-and-rolling-upgrades">6.4. Network Partitions and Rolling Upgrades</a></li>
<li><a href="#rolling-upgrade-faq">6.5. Rolling Upgrade FAQ</a></li>
</ul>
</li>
<li><a href="#distributed-data-structures">7. Distributed Data Structures</a>
<ul class="sectlevel2">
<li><a href="#overview-of-hazelcast-distributed-objects">7.1. Overview of Hazelcast Distributed Objects</a>
<ul class="sectlevel3">
<li><a href="#loading-and-destroying-a-distributed-object">7.1.1. Loading and Destroying a Distributed Object</a></li>
<li><a href="#controlling-partitions">7.1.2. Controlling Partitions</a></li>
<li><a href="#common-features-of-all-hazelcast-data-structures">7.1.3. Common Features of all Hazelcast Data Structures</a></li>
<li><a href="#example-distributed-object-code">7.1.4. Example Distributed Object Code</a></li>
</ul>
</li>
<li><a href="#map">7.2. Map</a>
<ul class="sectlevel3">
<li><a href="#getting-a-map-and-putting-an-entry">7.2.1. Getting a Map and Putting an Entry</a></li>
<li><a href="#creating-a-member-for-map-backup">7.2.2. Creating A Member for Map Backup</a></li>
<li><a href="#backing-up-maps">7.2.3. Backing Up Maps</a>
<ul class="sectlevel4">
<li><a href="#creating-sync-backups">Creating Sync Backups</a></li>
<li><a href="#creating-async-backups">Creating Async Backups</a></li>
<li><a href="#enabling-backup-reads">Enabling Backup Reads</a></li>
</ul>
</li>
<li><a href="#map-eviction">7.2.4. Map Eviction</a>
<ul class="sectlevel4">
<li><a href="#understanding-map-eviction">Understanding Map Eviction</a></li>
<li><a href="#configuring-map-eviction">Configuring Map Eviction</a></li>
<li><a href="#example-eviction-configurations">Example Eviction Configurations</a></li>
<li><a href="#evicting-specific-entries">Evicting Specific Entries</a></li>
<li><a href="#evicting-all-entries">Evicting All Entries</a></li>
<li><a href="#forced-eviction">Forced Eviction</a></li>
<li><a href="#custom-eviction-policy">Custom Eviction Policy</a></li>
</ul>
</li>
<li><a href="#setting-in-memory-format">7.2.5. Setting In-Memory Format</a></li>
<li><a href="#using-high-density-memory-store-with-map">7.2.6. Using High-Density Memory Store with Map</a>
<ul class="sectlevel4">
<li><a href="#required-configuration-changes-when-using-native">Required configuration changes when using NATIVE</a></li>
</ul>
</li>
<li><a href="#loading-and-storing-persistent-data">7.2.7. Loading and Storing Persistent Data</a>
<ul class="sectlevel4">
<li><a href="#using-read-through-persistence">Using Read-Through Persistence</a></li>
<li><a href="#setting-write-through-persistence">Setting Write-Through Persistence</a></li>
<li><a href="#setting-write-behind-persistence">Setting Write-Behind Persistence</a></li>
<li><a href="#storing-entries-to-multiple-maps">Storing Entries to Multiple Maps</a></li>
<li><a href="#initializing-map-on-startup">Initializing Map on Startup</a></li>
<li><a href="#loading-keys-incrementally">Loading Keys Incrementally</a></li>
<li><a href="#forcing-all-keys-to-be-loaded">Forcing All Keys To Be Loaded</a></li>
<li><a href="#post-processing-objects-in-map-store">Post-Processing Objects in Map Store</a></li>
<li><a href="#accessing-a-database-using-properties">Accessing a Database Using <code>Properties</code></a></li>
</ul>
</li>
<li><a href="#creating-near-cache-for-map">7.2.8. Creating Near Cache for Map</a></li>
<li><a href="#locking-maps">7.2.9. Locking Maps</a>
<ul class="sectlevel4">
<li><a href="#pessimistic-looking">Pessimistic Locking</a></li>
<li><a href="#optimistic-locking">Optimistic Locking</a></li>
<li><a href="#pessimistic-vs-optimistic-locking">Pessimistic vs. Optimistic Locking</a></li>
<li><a href="#solving-the-aba-problem">Solving the ABA Problem</a></li>
<li><a href="#lock-split-brain-protection-with-pessimistic-locking">Lock Split-Brain Protection with Pessimistic Locking</a></li>
</ul>
</li>
<li><a href="#accessing-entry-statistics">7.2.10. Accessing Entry Statistics</a></li>
<li><a href="#map-listener">7.2.11. Map Listener</a></li>
<li><a href="#listening-to-map-entries-with-predicates">7.2.12. Listening to Map Entries with Predicates</a></li>
<li><a href="#removing-map-entries-in-bulk-with-predicates">7.2.13. Removing Map Entries in Bulk with Predicates</a></li>
<li><a href="#adding-interceptors">7.2.14. Adding Interceptors</a></li>
<li><a href="#preventing-out-of-memory-exceptions">7.2.15. Preventing Out of Memory Exceptions</a>
<ul class="sectlevel4">
<li><a href="#setting-query-result-size-limit">Setting Query Result Size Limit</a></li>
<li><a href="#local-pre-check">Local Pre-check</a></li>
<li><a href="#scope-of-result-size-limit">Scope of Result Size Limit</a></li>
<li><a href="#configuring-query-result-size">Configuring Query Result Size</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#queue">7.3. Queue</a>
<ul class="sectlevel3">
<li><a href="#getting-a-queue-and-putting-items">7.3.1. Getting a Queue and Putting Items</a></li>
<li><a href="#creating-an-example-queue">7.3.2. Creating an Example Queue</a>
<ul class="sectlevel4">
<li><a href="#putting-items-on-the-queue">Putting Items on the Queue</a></li>
<li><a href="#taking-items-off-the-queue">Taking Items off the Queue</a></li>
<li><a href="#balancing-the-queue-operations">Balancing the Queue Operations</a></li>
<li><a href="#itemids-when-offering-items">ItemIDs When Offering Items</a></li>
</ul>
</li>
<li><a href="#setting-a-bounded-queue">7.3.3. Setting a Bounded Queue</a></li>
<li><a href="#queueing-with-persistent-datastore">7.3.4. Queueing with Persistent Datastore</a></li>
<li><a href="#split-brain-protection-for-queue">7.3.5. Split-Brain Protection for Queue</a></li>
<li><a href="#configuring-queue">7.3.6. Configuring Queue</a></li>
</ul>
</li>
<li><a href="#multimap">7.4. MultiMap</a>
<ul class="sectlevel3">
<li><a href="#getting-a-multimap-and-putting-an-entry">7.4.1. Getting a MultiMap and Putting an Entry</a></li>
<li><a href="#configuring-multimap">7.4.2. Configuring MultiMap</a></li>
<li><a href="#split-brain-protection-for-multimap-and-transactionalmultimap">7.4.3. Split-Brain Protection for MultiMap and TransactionalMultiMap</a></li>
</ul>
</li>
<li><a href="#set">7.5. Set</a>
<ul class="sectlevel3">
<li><a href="#getting-a-set-and-putting-items">7.5.1. Getting a Set and Putting Items</a></li>
<li><a href="#configuring-set">7.5.2. Configuring Set</a></li>
<li><a href="#split-brain-protection-for-iset-and-transactionalset">7.5.3. Split-Brain Protection for ISet and TransactionalSet</a></li>
</ul>
</li>
<li><a href="#list">7.6. List</a>
<ul class="sectlevel3">
<li><a href="#getting-a-list-and-putting-items">7.6.1. Getting a List and Putting Items</a></li>
<li><a href="#configuring-list">7.6.2. Configuring List</a></li>
<li><a href="#split-brain-protection-for-ilist-and-transactionallist">7.6.3. Split-Brain Protection for IList and TransactionalList</a></li>
</ul>
</li>
<li><a href="#ringbuffer">7.7. Ringbuffer</a>
<ul class="sectlevel3">
<li><a href="#getting-a-ringbuffer-and-reading-items">7.7.1. Getting a Ringbuffer and Reading Items</a></li>
<li><a href="#adding-items-to-a-ringbuffer">7.7.2. Adding Items to a Ringbuffer</a></li>
<li><a href="#iqueue-vs-ringbuffer">7.7.3. IQueue vs. Ringbuffer</a></li>
<li><a href="#configuring-ringbuffer-capacity">7.7.4. Configuring Ringbuffer Capacity</a></li>
<li><a href="#backing-up-ringbuffer">7.7.5. Backing Up Ringbuffer</a></li>
<li><a href="#configuring-ringbuffer-time-to-live">7.7.6. Configuring Ringbuffer Time-To-Live</a></li>
<li><a href="#setting-ringbuffer-overflow-policy">7.7.7. Setting Ringbuffer Overflow Policy</a></li>
<li><a href="#ringbuffer-with-persistent-datastore">7.7.8. Ringbuffer with Persistent Datastore</a></li>
<li><a href="#configuring-ringbuffer-in-memory-format">7.7.9. Configuring Ringbuffer In-Memory Format</a></li>
<li><a href="#configuring-split-brain-protection-for-ringbuffer">7.7.10. Configuring Split-Brain Protection for Ringbuffer</a></li>
<li><a href="#adding-batched-items">7.7.11. Adding Batched Items</a></li>
<li><a href="#reading-batched-items">7.7.12. Reading Batched Items</a></li>
<li><a href="#using-async-methods">7.7.13. Using Async Methods</a></li>
<li><a href="#ringbuffer-configuration-examples">7.7.14. Ringbuffer Configuration Examples</a></li>
</ul>
</li>
<li><a href="#topic">7.8. Topic</a>
<ul class="sectlevel3">
<li><a href="#getting-a-topic-and-publishing-messages">7.8.1. Getting a Topic and Publishing Messages</a></li>
<li><a href="#getting-topic-statistics">7.8.2. Getting Topic Statistics</a></li>
<li><a href="#understanding-topic-behavior">7.8.3. Understanding Topic Behavior</a>
<ul class="sectlevel4">
<li><a href="#ordering-messages-as-published">Ordering Messages as Published</a></li>
<li><a href="#ordering-messages-for-members">Ordering Messages for Members</a></li>
<li><a href="#keeping-generated-and-published-order-the-same">Keeping Generated and Published Order the Same</a></li>
</ul>
</li>
<li><a href="#configuring-topic">7.8.4. Configuring Topic</a></li>
</ul>
</li>
<li><a href="#reliable-topic">7.9. Reliable Topic</a>
<ul class="sectlevel3">
<li><a href="#slow-consumers">7.9.1. Slow Consumers</a></li>
<li><a href="#configuring-reliable-topic">7.9.2. Configuring Reliable Topic</a></li>
</ul>
</li>
<li><a href="#lock">7.10. Lock</a>
<ul class="sectlevel3">
<li><a href="#using-try-catch-blocks-with-locks">7.10.1. Using Try-Catch Blocks with Locks</a></li>
<li><a href="#releasing-locks-with-trylock-timeout">7.10.2. Releasing Locks with tryLock Timeout</a></li>
<li><a href="#avoiding-waiting-threads-with-lease-time">7.10.3. Avoiding Waiting Threads with Lease Time</a></li>
<li><a href="#understanding-lock-behavior">7.10.4. Understanding Lock Behavior</a>
<ul class="sectlevel4">
<li><a href="#ilock-vs-imaplock">ILock vs. IMap.lock</a></li>
</ul>
</li>
<li><a href="#synchronizing-threads-with-icondition">7.10.5. Synchronizing Threads with ICondition</a></li>
<li><a href="#split-brain-protection-for-lock">7.10.6. Split-Brain Protection for Lock</a></li>
<li><a href="#lock-configuration">7.10.7. Lock Configuration</a></li>
</ul>
</li>
<li><a href="#iatomiclong">7.11. IAtomicLong</a>
<ul class="sectlevel3">
<li><a href="#sending-functions-to-iatomiclong">7.11.1. Sending Functions to IAtomicLong</a></li>
<li><a href="#executing-functions-on-iatomiclong">7.11.2. Executing Functions on IAtomicLong</a></li>
<li><a href="#reasons-to-use-functions-with-iatomic">7.11.3. Reasons to Use Functions with IAtomic</a></li>
<li><a href="#split-brain-protection-for-iatomiclong">7.11.4. Split-Brain Protection for IAtomicLong</a></li>
</ul>
</li>
<li><a href="#isemaphore">7.12. ISemaphore</a>
<ul class="sectlevel3">
<li><a href="#controlling-thread-counts-with-permits">7.12.1. Controlling Thread Counts with Permits</a></li>
<li><a href="#example-semaphore-code">7.12.2. Example Semaphore Code</a></li>
<li><a href="#configuring-semaphore">7.12.3. Configuring Semaphore</a></li>
<li><a href="#split-brain-protection-for-isemaphore">7.12.4. Split-Brain Protection for ISemaphore</a></li>
</ul>
</li>
<li><a href="#iatomicreference">7.13. IAtomicReference</a>
<ul class="sectlevel3">
<li><a href="#sending-functions-to-iatomicreference">7.13.1. Sending Functions to IAtomicReference</a></li>
<li><a href="#using-iatomicreference">7.13.2. Using IAtomicReference</a></li>
<li><a href="#split-brain-protection-for-iatomicreference">7.13.3. Split-Brain Protection for IAtomicReference</a></li>
</ul>
</li>
<li><a href="#icountdownlatch">7.14. ICountDownLatch</a>
<ul class="sectlevel3">
<li><a href="#gate-keeping-concurrent-activities">7.14.1. Gate-Keeping Concurrent Activities</a></li>
<li><a href="#recovering-from-failure">7.14.2. Recovering From Failure</a></li>
<li><a href="#using-icountdownlatch">7.14.3. Using ICountDownLatch</a></li>
<li><a href="#split-brain-protection-for-icountdownlatch">7.14.4. Split-Brain Protection for ICountDownLatch</a></li>
</ul>
</li>
<li><a href="#pn-counter">7.15. PN Counter</a>
<ul class="sectlevel3">
<li><a href="#configuring-pn-counter">7.15.1. Configuring PN Counter</a></li>
<li><a href="#configuring-the-crdt-replication-mechanism">7.15.2. Configuring the CRDT replication mechanism</a></li>
</ul>
</li>
<li><a href="#idgenerator">7.16. IdGenerator</a>
<ul class="sectlevel3">
<li><a href="#generating-cluster-wide-ids">7.16.1. Generating Cluster-Wide IDs</a></li>
<li><a href="#unique-ids-and-duplicate-ids">7.16.2. Unique IDs and Duplicate IDs</a></li>
<li><a href="#migrating-to-flakeidgenerator">7.16.3. Migrating to FlakeIdGenerator</a></li>
</ul>
</li>
<li><a href="#flakeidgenerator">7.17. FlakeIdGenerator</a>
<ul class="sectlevel3">
<li><a href="#generating-cluster-wide-flake-ids">7.17.1. Generating Cluster-Wide IDs</a></li>
<li><a href="#flakeidgenerator-performance">7.17.2. Performance</a></li>
<li><a href="#flakeidgenerator-example">7.17.3. Example</a></li>
<li><a href="#node-id-assignment">7.17.4. Node ID Assignment</a>
<ul class="sectlevel4">
<li><a href="#node-id-overflow">Node ID Overflow</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#replicated-map">7.18. Replicated Map</a>
<ul class="sectlevel3">
<li><a href="#replicating-instead-of-partitioning">7.18.1. Replicating Instead of Partitioning</a></li>
<li><a href="#example-replicated-map-code">7.18.2. Example Replicated Map Code</a></li>
<li><a href="#considerations-for-replicated-map">7.18.3. Considerations for Replicated Map</a></li>
<li><a href="#configuration-design-for-replicated-map">7.18.4. Configuration Design for Replicated Map</a></li>
<li><a href="#configuring-replicated-map">7.18.5. Configuring Replicated Map</a>
<ul class="sectlevel4">
<li><a href="#in-memory-format-on-replicated-map">In-Memory Format on Replicated Map</a></li>
</ul>
</li>
<li><a href="#using-entrylistener-on-replicated-map">7.18.6. Using EntryListener on Replicated Map</a>
<ul class="sectlevel4">
<li><a href="#difference-in-entrylistener-on-replicated-map">Difference in EntryListener on Replicated Map</a></li>
<li><a href="#example-of-replicated-map-entrylistener">Example of Replicated Map EntryListener</a></li>
</ul>
</li>
<li><a href="#split-brain-protection-for-replicated-map">7.18.7. Split-Brain Protection for Replicated Map</a></li>
</ul>
</li>
<li><a href="#cardinality-estimator">7.19. Cardinality Estimator Service</a>
<ul class="sectlevel3">
<li><a href="#split-brain-protection-for-cardinality-estimator">7.19.1. Split-Brain Protection for Cardinality Estimator</a></li>
</ul>
</li>
<li><a href="#event-journal">7.20. Event Journal</a>
<ul class="sectlevel3">
<li><a href="#interaction-with-evictions-and-expiration-for-imap">7.20.1. Interaction with Evictions and Expiration for IMap</a></li>
<li><a href="#configuring-event-journal-capacity">7.20.2. Configuring Event Journal Capacity</a></li>
<li><a href="#event-journal-partitioning">7.20.3. Event Journal Partitioning</a></li>
<li><a href="#configuring-event-journal-ttl">7.20.4. Configuring Event Journal time-to-live</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#distributed-events">8. Distributed Events</a>
<ul class="sectlevel2">
<li><a href="#cluster-events">8.1. Cluster Events</a>
<ul class="sectlevel3">
<li><a href="#listening-for-member-events">8.1.1. Listening for Member Events</a>
<ul class="sectlevel4">
<li><a href="#registering-membership-listeners">Registering Membership Listeners</a></li>
</ul>
</li>
<li><a href="#listening-for-distributed-object-events">8.1.2. Listening for Distributed Object Events</a>
<ul class="sectlevel4">
<li><a href="#registering-distributed-object-listeners">Registering Distributed Object Listeners</a></li>
</ul>
</li>
<li><a href="#listening-for-migration-events">8.1.3. Listening for Migration Events</a>
<ul class="sectlevel4">
<li><a href="#registering-migration-listeners">Registering Migration Listeners</a></li>
</ul>
</li>
<li><a href="#listening-for-partition-lost-events">8.1.4. Listening for Partition Lost Events</a>
<ul class="sectlevel4">
<li><a href="#writing-a-partition-lost-listener-class">Writing a Partition Lost Listener Class</a></li>
<li><a href="#registering-partition-lost-listeners">Registering Partition Lost Listeners</a></li>
</ul>
</li>
<li><a href="#listening-for-lifecycle-events">8.1.5. Listening for Lifecycle Events</a>
<ul class="sectlevel4">
<li><a href="#registering-lifecycle-listeners">Registering Lifecycle Listeners</a></li>
</ul>
</li>
<li><a href="#listening-for-clients">8.1.6. Listening for Clients</a></li>
</ul>
</li>
<li><a href="#distributed-object-events">8.2. Distributed Object Events</a>
<ul class="sectlevel3">
<li><a href="#listening-for-map-events">8.2.1. Listening for Map Events</a>
<ul class="sectlevel4">
<li><a href="#catching-a-map-event">Catching a Map Event</a></li>
</ul>
</li>
<li><a href="#listening-for-lost-map-partitions">8.2.2. Listening for Lost Map Partitions</a>
<ul class="sectlevel4">
<li><a href="#registering-map-listeners">Registering Map Listeners</a></li>
<li><a href="#map-listener-attributes">Map Listener Attributes</a></li>
</ul>
</li>
<li><a href="#listening-for-multimap-events">8.2.3. Listening for MultiMap Events</a>
<ul class="sectlevel4">
<li><a href="#registering-multimap-listeners">Registering MultiMap Listeners</a></li>
<li><a href="#multimap-listener-attributes">MultiMap Listener Attributes</a></li>
</ul>
</li>
<li><a href="#listening-for-item-events">8.2.4. Listening for Item Events</a>
<ul class="sectlevel4">
<li><a href="#registering-item-listeners">Registering Item Listeners</a></li>
<li><a href="#item-listener-attributes">Item Listener Attributes</a></li>
</ul>
</li>
<li><a href="#listening-for-topic-messages">8.2.5. Listening for Topic Messages</a>
<ul class="sectlevel4">
<li><a href="#registering-message-listeners">Registering Message Listeners</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#event-listeners-for-hazelcast-clients">8.3. Event Listeners for Hazelcast Clients</a></li>
<li><a href="#global-event-configuration">8.4. Global Event Configuration</a></li>
</ul>
</li>
<li><a href="#hazelcast-jet">9. Hazelcast Jet</a>
<ul class="sectlevel2">
<li><a href="#jet-overview">9.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#how-you-can-use-it">9.1.1. How You Can Use It</a></li>
<li><a href="#where-you-can-use-it">9.1.2. Where You Can Use It</a></li>
<li><a href="#data-processing-styles">9.1.3. Data Processing Styles</a></li>
</ul>
</li>
<li><a href="#relationship-with-hazelcast-imdg">9.2. Relationship with Hazelcast IMDG</a></li>
<li><a href="#hazelcast-imdg-computing-vs-hazelcast-jet">9.3. Hazelcast IMDG Computing vs. Hazelcast Jet</a></li>
</ul>
</li>
<li><a href="#distributed-computing">10. Distributed Computing</a>
<ul class="sectlevel2">
<li><a href="#executor-service">10.1. Executor Service</a>
<ul class="sectlevel3">
<li><a href="#implementing-a-callable-task">10.1.1. Implementing a Callable Task</a>
<ul class="sectlevel4">
<li><a href="#executing-a-callable-task">Executing a Callable Task</a></li>
</ul>
</li>
<li><a href="#implementing-a-runnable-task">10.1.2. Implementing a Runnable Task</a>
<ul class="sectlevel4">
<li><a href="#executing-a-runnable-task">Executing a Runnable Task</a></li>
</ul>
</li>
<li><a href="#scaling-the-executor-service">10.1.3. Scaling The Executor Service</a></li>
<li><a href="#executing-code-in-the-cluster">10.1.4. Executing Code in the Cluster</a></li>
<li><a href="#canceling-an-executing-task">10.1.5. Canceling an Executing Task</a>
<ul class="sectlevel4">
<li><a href="#example-task-to-cancel">Example Task to Cancel</a></li>
<li><a href="#example-method-to-execute-and-cancel-the-task">Example Method to Execute and Cancel the Task</a></li>
</ul>
</li>
<li><a href="#callback-when-task-completes">10.1.6. Callback When Task Completes</a>
<ul class="sectlevel4">
<li><a href="#example-task-to-callback">Example Task to Callback</a></li>
<li><a href="#example-method-to-callback-the-task">Example Method to Callback the Task</a></li>
</ul>
</li>
<li><a href="#selecting-members-for-task-execution">10.1.7. Selecting Members for Task Execution</a></li>
<li><a href="#configuring-executor-service">10.1.8. Configuring Executor Service</a></li>
<li><a href="#split-brain-protection-for-iexecutorservice">10.1.9. Split-Brain Protection for IExecutorService</a></li>
</ul>
</li>
<li><a href="#durable-executor-service">10.2. Durable Executor Service</a>
<ul class="sectlevel3">
<li><a href="#configuring-durable-executor-service">10.2.1. Configuring Durable Executor Service</a></li>
<li><a href="#split-brain-protection-for-durable-executor-service">10.2.2. Split-Brain Protection for Durable Executor Service</a></li>
</ul>
</li>
<li><a href="#scheduled-executor-service">10.3. Scheduled Executor Service</a>
<ul class="sectlevel3">
<li><a href="#configuring-scheduled-executor-service">10.3.1. Configuring Scheduled Executor Service</a></li>
<li><a href="#scheduled-exec-srv-examples">10.3.2. Examples</a></li>
<li><a href="#split-brain-protection-for-ischeduled-executor-service">10.3.3. Split-Brain Protection for IScheduled Executor Service</a></li>
</ul>
</li>
<li><a href="#entry-processor">10.4. Entry Processor</a>
<ul class="sectlevel3">
<li><a href="#performing-fast-in-memory-map-operations">10.4.1. Performing Fast In-Memory Map Operations</a>
<ul class="sectlevel4">
<li><a href="#using-indexes">Using Indexes</a></li>
<li><a href="#using-object-in-memory-format">Using OBJECT In-Memory Format</a></li>
<li><a href="#processing-entries">Processing Entries</a></li>
<li><a href="#respecting-locks-on-single-keys">Respecting Locks on Single Keys</a></li>
<li><a href="#processing-backup-entries">Processing Backup Entries</a></li>
</ul>
</li>
<li><a href="#creating-an-entry-processor">10.4.2. Creating an Entry Processor</a></li>
<li><a href="#abstract-entry-processor">10.4.3. Abstract Entry Processor</a></li>
<li><a href="#entry-processor-performance-optimizations">10.4.4. Entry Processor Performance Optimizations</a>
<ul class="sectlevel4">
<li><a href="#offloadable-entry-processor">Offloadable Entry Processor</a></li>
<li><a href="#readonly-entry-processor">ReadOnly Entry Processor</a></li>
<li><a href="#readonly-and-offloadable-entry-processor">ReadOnly and Offloadable Entry Processor</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#distributed-query">11. Distributed Query</a>
<ul class="sectlevel2">
<li><a href="#how-distributed-query-works">11.1. How Distributed Query Works</a>
<ul class="sectlevel3">
<li><a href="#employee-map-query-example">11.1.1. Employee Map Query Example</a></li>
<li><a href="#querying-with-criteria-api">11.1.2. Querying with Criteria API</a>
<ul class="sectlevel4">
<li><a href="#predicates-class-operators">Predicates Class Operators</a></li>
<li><a href="#combining-predicates-with-and-or-not">Combining Predicates with AND, OR, NOT</a></li>
<li><a href="#simplifying-with-predicatebuilder">Simplifying with PredicateBuilder</a></li>
</ul>
</li>
<li><a href="#querying-with-sql">11.1.3. Querying with SQL</a>
<ul class="sectlevel4">
<li><a href="#supported-sql-syntax">Supported SQL Syntax</a></li>
<li><a href="#querying-entry-keys-with-predicates">Querying Entry Keys with Predicates</a></li>
</ul>
</li>
<li><a href="#filtering-with-paging-predicates">11.1.4. Filtering with Paging Predicates</a></li>
<li><a href="#filtering-with-partition-predicate">11.1.5. Filtering with Partition Predicate</a></li>
<li><a href="#indexing-queries">11.1.6. Indexing Queries</a>
<ul class="sectlevel4">
<li><a href="#indexing-ranged-queries">Indexing Ranged Queries</a></li>
<li><a href="#configuring-imap-indexes">Configuring IMap Indexes</a></li>
<li><a href="#copying-indexes">Copying Indexes</a></li>
<li><a href="#indexing-attributes-with-valueextractor">Indexing Attributes with ValueExtractor</a></li>
<li><a href="#using-this-as-an-attribute">Using "this" as an Attribute</a></li>
</ul>
</li>
<li><a href="#configuring-query-thread-pool">11.1.7. Configuring Query Thread Pool</a>
<ul class="sectlevel4">
<li><a href="#query-requests-from-clients">Query Requests from Clients</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#querying-in-collections-and-arrays">11.2. Querying in Collections and Arrays</a>
<ul class="sectlevel3">
<li><a href="#indexing-in-collections-and-arrays">11.2.1. Indexing in Collections and Arrays</a></li>
<li><a href="#corner-cases">11.2.2. Corner cases</a></li>
</ul>
</li>
<li><a href="#custom-attributes">11.3. Custom Attributes</a>
<ul class="sectlevel3">
<li><a href="#implementing-a-valueextractor">11.3.1. Implementing a ValueExtractor</a>
<ul class="sectlevel4">
<li><a href="#valueextractor-with-portable-serialization">ValueExtractor with Portable Serialization</a></li>
<li><a href="#returning-multiple-values-from-a-single-extraction">Returning Multiple Values from a Single Extraction</a></li>
</ul>
</li>
<li><a href="#extraction-arguments">11.3.2. Extraction Arguments</a></li>
<li><a href="#configuring-a-custom-attribute-programmatically">11.3.3. Configuring a Custom Attribute Programmatically</a></li>
<li><a href="#configuring-a-custom-attribute-declaratively">11.3.4. Configuring a Custom Attribute Declaratively</a></li>
<li><a href="#indexing-custom-attributes">11.3.5. Indexing Custom Attributes</a></li>
</ul>
</li>
<li><a href="#mapreduce">11.4. MapReduce</a>
<ul class="sectlevel3">
<li><a href="#understanding-mapreduce">11.4.1. Understanding MapReduce</a>
<ul class="sectlevel4">
<li><a href="#mapreduce-workflow-example">MapReduce Workflow Example</a></li>
<li><a href="#mapreduce-phases">MapReduce Phases</a></li>
<li><a href="#additional-mapreduce-resources">Additional MapReduce Resources</a></li>
</ul>
</li>
<li><a href="#using-the-mapreduce-api">11.4.2. Using the MapReduce API</a>
<ul class="sectlevel4">
<li><a href="#retrieving-a-jobtracker-instance">Retrieving a JobTracker Instance</a></li>
<li><a href="#creating-a-job">Creating a Job</a></li>
<li><a href="#creating-key-value-input-sources-with-keyvaluesource">Creating Key-Value Input Sources with KeyValueSource</a></li>
<li><a href="#implementing-mapping-logic-with-mapper">Implementing Mapping Logic with Mapper</a></li>
<li><a href="#minimizing-cluster-traffic-with-combiner">Minimizing Cluster Traffic with Combiner</a></li>
<li><a href="#doing-algorithm-work-with-reducer">Doing Algorithm Work with Reducer</a></li>
<li><a href="#modifying-the-result-with-collator">Modifying the Result with Collator</a></li>
<li><a href="#preselecting-keys-with-keypredicate">Preselecting Keys with KeyPredicate</a></li>
<li><a href="#job-monitoring-with-trackablejob">Job Monitoring with TrackableJob</a></li>
<li><a href="#configuring-jobtracker">Configuring JobTracker</a></li>
</ul>
</li>
<li><a href="#hazelcast-mapreduce-architecture">11.4.3. Hazelcast MapReduce Architecture</a>
<ul class="sectlevel4">
<li><a href="#member-interoperation-example">Member Interoperation Example</a></li>
<li><a href="#internal-mapreduce-packages">Internal MapReduce Packages</a></li>
<li><a href="#mapreduce-job-walk-through">MapReduce Job Walk-Through</a></li>
</ul>
</li>
<li><a href="#mapreduce-deprecation">11.4.4. MapReduce Deprecation</a>
<ul class="sectlevel4">
<li><a href="#motivation">Motivation</a></li>
<li><a href="#built-in-aggregations">Built-In Aggregations</a></li>
<li><a href="#distributed-computation-with-jet">Distributed Computation with Jet</a></li>
<li><a href="#jet-compared-with-new-aggregations">Jet Compared with New Aggregations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#aggregators">11.5. Aggregators</a>
<ul class="sectlevel3">
<li><a href="#aggregations-basics">11.5.1. Aggregations Basics</a>
<ul class="sectlevel4">
<li><a href="#aggregations-and-map-interfaces">Aggregations and Map Interfaces</a></li>
<li><a href="#aggregations-and-java">Aggregations and Java</a></li>
<li><a href="#aggregations-and-java-6-or-java-7">Aggregations and Java 6 or Java 7</a></li>
<li><a href="#aggregations-and-java-8">Aggregations and Java 8</a></li>
<li><a href="#aggregations-and-the-mapreduce-framework">Aggregations and the MapReduce Framework</a></li>
</ul>
</li>
<li><a href="#using-the-aggregations-api">11.5.2. Using the Aggregations API</a>
<ul class="sectlevel4">
<li><a href="#supplier">Supplier</a></li>
<li><a href="#defining-the-aggregation-operation">Defining the Aggregation Operation</a></li>
<li><a href="#extracting-attribute-values-with-propertyextractor">Extracting Attribute Values with PropertyExtractor</a></li>
<li><a href="#configuring-aggregations">Configuring Aggregations</a></li>
</ul>
</li>
<li><a href="#aggregations-examples">11.5.3. Aggregations Examples</a>
<ul class="sectlevel4">
<li><a href="#setting-up-the-data-model">Setting up the Data Model</a></li>
<li><a href="#average-aggregation-example">Average Aggregation Example</a></li>
<li><a href="#map-join-example">Map Join Example</a></li>
<li><a href="#grouping-example">Grouping Example</a></li>
<li><a href="#simple-count-example">Simple Count Example</a></li>
</ul>
</li>
<li><a href="#implementing-aggregations">11.5.4. Implementing Aggregations</a>
<ul class="sectlevel4">
<li><a href="#aggregation-methods">Aggregation Methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#fast-aggregations">11.6. Fast-Aggregations</a>
<ul class="sectlevel3">
<li><a href="#aggregator-api">11.6.1. Aggregator API</a></li>
<li><a href="#fast-aggregations-and-map-interfaces">11.6.2. Fast-Aggregations and Map Interfaces</a></li>
<li><a href="#sample-implementation">11.6.3. Sample Implementation</a></li>
<li><a href="#built-in-aggregations-2">11.6.4. Built-In Aggregations</a></li>
<li><a href="#configuration-options">11.6.5. Configuration Options</a></li>
</ul>
</li>
<li><a href="#projections">11.7. Projections</a>
<ul class="sectlevel3">
<li><a href="#projection-api">11.7.1. Projection API</a>
<ul class="sectlevel4">
<li><a href="#projections-and-map-interfaces">Projections and Map Interfaces</a></li>
</ul>
</li>
<li><a href="#sample-implementation-2">11.7.2. Sample implementation</a></li>
<li><a href="#built-in-projections">11.7.3. Built-In Projections</a></li>
</ul>
</li>
<li><a href="#continuous-query-cache">11.8. Continuous Query Cache</a>
<ul class="sectlevel3">
<li><a href="#keeping-query-results-local-and-ready">11.8.1. Keeping Query Results Local and Ready</a></li>
<li><a href="#accessing-continuous-query-cache-from-member">11.8.2. Accessing Continuous Query Cache from Member</a></li>
<li><a href="#accessing-continuous-query-cache-from-client-side">11.8.3. Accessing Continuous Query Cache from Client Side</a></li>
<li><a href="#features-of-continuous-query-cache">11.8.4. Features of Continuous Query Cache</a></li>
<li><a href="#configuring-continuous-query-cache">11.8.5. Configuring Continuous Query Cache</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#transactions">12. Transactions</a>
<ul class="sectlevel2">
<li><a href="#creating-a-transaction-interface">12.1. Creating a Transaction Interface</a>
<ul class="sectlevel3">
<li><a href="#queue-set-list-vs-map-multimap">12.1.1. Queue/Set/List vs. Map/Multimap</a></li>
<li><a href="#one_phase-vs-two_phase">12.1.2. ONE_PHASE vs. TWO_PHASE</a></li>
</ul>
</li>
<li><a href="#providing-xa-transactions">12.2. Providing XA Transactions</a></li>
</ul>
</li>
<li><a href="#hazelcast-jcache">13. Hazelcast JCache</a>
<ul class="sectlevel2">
<li><a href="#jcache-overview">13.1. JCache Overview</a>
<ul class="sectlevel3">
<li><a href="#supported-jcache-versions">13.1.1. Supported JCache Versions</a></li>
<li><a href="#upgrading-from-jcache-1-0-0-to-1-1-0">13.1.2. Upgrading from JCache 1.0.0 to 1.1.0</a></li>
</ul>
</li>
<li><a href="#jcache-setup-and-configuration">13.2. JCache Setup and Configuration</a>
<ul class="sectlevel3">
<li><a href="#setting-up-your-application">13.2.1. Setting up Your Application</a>
<ul class="sectlevel4">
<li><a href="#activating-hazelcast-as-jcache-provider">Activating Hazelcast as JCache Provider</a></li>
<li><a href="#connecting-clients-to-remote-member">Connecting Clients to Remote Member</a></li>
</ul>
</li>
<li><a href="#example-jcache-application">13.2.2. Example JCache Application</a>
<ul class="sectlevel4">
<li><a href="#getting-the-hazelcast-jcache-implementation">Getting the Hazelcast JCache Implementation</a></li>
<li><a href="#setting-up-the-jcache-entry-point">Setting up the JCache Entry Point</a></li>
<li><a href="#configuring-the-cache-before-creating-it">Configuring the Cache Before Creating It</a></li>
<li><a href="#creating-the-cache">Creating the Cache</a></li>
<li><a href="#get-put-and-getandput">get, put and getAndPut</a></li>
</ul>
</li>
<li><a href="#configuring-for-jcache">13.2.3. Configuring for JCache</a>
<ul class="sectlevel4">
<li><a href="#jcache-declarative-configuration">JCache Declarative Configuration</a></li>
<li><a href="#jcache-programmatic-configuration">JCache Programmatic Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#jcache-providers">13.3. JCache Providers</a>
<ul class="sectlevel3">
<li><a href="#configuring-jcache-provider">13.3.1. Configuring JCache Provider</a></li>
<li><a href="#configuring-jcache-with-client-provider">13.3.2. Configuring JCache with Client Provider</a></li>
<li><a href="#configuring-jcache-with-server-provider">13.3.3. Configuring JCache with Server Provider</a></li>
</ul>
</li>
<li><a href="#jcache-api">13.4. JCache API</a>
<ul class="sectlevel3">
<li><a href="#jcache-api-application-example">13.4.1. JCache API Application Example</a>
<ul class="sectlevel4">
<li><a href="#creating-user-class-example">Creating User Class Example</a></li>
<li><a href="#creating-dao-interface-example">Creating DAO Interface Example</a></li>
<li><a href="#configuring-jcache-example">Configuring JCache Example</a></li>
</ul>
</li>
<li><a href="#jcache-base-classes">13.4.2. JCache Base Classes</a></li>
<li><a href="#implementing-factory-and-factorybuilder">13.4.3. Implementing Factory and FactoryBuilder</a></li>
<li><a href="#implementing-cacheloader">13.4.4. Implementing CacheLoader</a>
<ul class="sectlevel4">
<li><a href="#cache-read-through">Cache read-through</a></li>
<li><a href="#cacheloader-example">CacheLoader Example</a></li>
</ul>
</li>
<li><a href="#cachewriter">13.4.5. CacheWriter</a></li>
<li><a href="#implementing-entryprocessor">13.4.6. Implementing EntryProcessor</a></li>
<li><a href="#cacheentrylistener">13.4.7. CacheEntryListener</a></li>
<li><a href="#expirypolicy">13.4.8. ExpiryPolicy</a></li>
</ul>
</li>
<li><a href="#jcache-hazelcast-instance-integration">13.5. JCache - Hazelcast Instance Integration</a>
<ul class="sectlevel3">
<li><a href="#jcache-and-hazelcast-instance-awareness">13.5.1. JCache and Hazelcast Instance Awareness</a></li>
</ul>
</li>
<li><a href="#hazelcast-jcache-extension-icache">13.6. Hazelcast JCache Extension - ICache</a>
<ul class="sectlevel3">
<li><a href="#scoping-to-join-clusters">13.6.1. Scoping to Join Clusters</a>
<ul class="sectlevel4">
<li><a href="#examples">Examples</a></li>
<li><a href="#applying-configuration-scope">Applying Configuration Scope</a></li>
<li><a href="#binding-to-a-named-instance">Binding to a Named Instance</a></li>
<li><a href="#binding-to-an-existing-hazelcast-instance-object">Binding to an Existing Hazelcast Instance Object</a></li>
</ul>
</li>
<li><a href="#namespacing">13.6.2. Namespacing</a></li>
<li><a href="#retrieving-an-icache-instance">13.6.3. Retrieving an ICache Instance</a></li>
<li><a href="#icache-configuration">13.6.4. ICache Configuration</a></li>
<li><a href="#icache-async-methods">13.6.5. ICache Async Methods</a></li>
<li><a href="#defining-a-custom-expirypolicy">13.6.6. Defining a Custom ExpiryPolicy</a></li>
<li><a href="#jcache-eviction">13.6.7. JCache Eviction</a>
<ul class="sectlevel4">
<li><a href="#eviction-and-runtime">Eviction and Runtime</a></li>
<li><a href="#cache-types">Cache Types</a></li>
<li><a href="#configuring-eviction-policies">Configuring Eviction Policies</a></li>
<li><a href="#eviction-strategy">Eviction Strategy</a></li>
<li><a href="#eviction-algorithm">Eviction Algorithm</a></li>
</ul>
</li>
<li><a href="#jcache-near-cache">13.6.8. JCache Near Cache</a></li>
<li><a href="#icache-convenience-methods">13.6.9. ICache Convenience Methods</a></li>
<li><a href="#implementing-backupawareentryprocessor">13.6.10. Implementing BackupAwareEntryProcessor</a></li>
<li><a href="#icache-partition-lost-listener">13.6.11. ICache Partition Lost Listener</a></li>
</ul>
</li>
<li><a href="#testing-for-jcache-specification-compliance">13.7. Testing for JCache Specification Compliance</a></li>
</ul>
</li>
<li><a href="#integrated-clustering">14. Integrated Clustering</a>
<ul class="sectlevel2">
<li><a href="#integration-with-hibernate-second-level-cache">14.1. Integration with Hibernate Second Level Cache</a></li>
<li><a href="#web-session-replications">14.2. Web Session Replications</a></li>
<li><a href="#integration-with-java-ee">14.3. Integration with Java EE</a></li>
<li><a href="#integration-with-spring">14.4. Integration with Spring</a>
<ul class="sectlevel3">
<li><a href="#configuring-spring">14.4.1. Configuring Spring</a>
<ul class="sectlevel4">
<li><a href="#enabling-spring-integration">Enabling Spring Integration</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#declaring-beans-by-spring-strong-beans-strong-namespace">Declaring Beans by Spring <strong>beans</strong> Namespace</a></li>
<li><a href="#declaring-beans-by-strong-hazelcast-strong-namespace">Declaring Beans by <strong>hazelcast</strong> Namespace</a></li>
<li><a href="#supported-configurations-with-strong-hazelcast-strong-namespace">Supported Configurations with <strong>hazelcast</strong> Namespace</a></li>
</ul>
</li>
<li><a href="#enabling-springaware-objects">14.4.2. Enabling SpringAware Objects</a>
<ul class="sectlevel4">
<li><a href="#springaware-examples">SpringAware Examples</a></li>
</ul>
</li>
<li><a href="#adding-caching-to-spring">14.4.3. Adding Caching to Spring</a>
<ul class="sectlevel4">
<li><a href="#declarative-spring-cache-configuration">Declarative Spring Cache Configuration</a></li>
<li><a href="#defining-timeouts-for-cache-read-operation">Defining Timeouts for Cache Read Operation</a></li>
<li><a href="#declarative-hazelcast-jcache-based-caching-configuration">Declarative Hazelcast JCache Based Caching Configuration</a></li>
<li><a href="#annotation-based-spring-cache-configuration">Annotation-Based Spring Cache Configuration</a></li>
</ul>
</li>
<li><a href="#configuring-hibernate-second-level-cache">14.4.4. Configuring Hibernate Second Level Cache</a></li>
<li><a href="#configuring-hazelcast-transaction-manager">14.4.5. Configuring Hazelcast Transaction Manager</a>
<ul class="sectlevel4">
<li><a href="#sample-configuration-for-hazelcast-transaction-manager">Sample Configuration for Hazelcast Transaction Manager</a></li>
<li><a href="#sample-transactional-method">Sample Transactional Method</a></li>
</ul>
</li>
<li><a href="#best-practices">14.4.6. Best Practices</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#storage">15. Storage</a>
<ul class="sectlevel2">
<li><a href="#high-density-memory-store">15.1. High-Density Memory Store</a>
<ul class="sectlevel3">
<li><a href="#configuring-high-density-memory-store">15.1.1. Configuring High-Density Memory Store</a></li>
</ul>
</li>
<li><a href="#sizing-practices">15.2. Sizing Practices</a></li>
<li><a href="#hot-restart-persistence">15.3. Hot Restart Persistence</a>
<ul class="sectlevel3">
<li><a href="#hot-restart-persistence-overview">15.3.1. Hot Restart Persistence Overview</a></li>
<li><a href="#hot-restart-types">15.3.2. Hot Restart Types</a></li>
<li><a href="#restart-process">15.3.3. Restart Process</a>
<ul class="sectlevel4">
<li><a href="#restart-of-a-member-in-running-cluster">Restart of a Member in Running Cluster</a></li>
</ul>
</li>
<li><a href="#force-start">15.3.4. Force Start</a></li>
<li><a href="#partial-start">15.3.5. Partial Start</a></li>
<li><a href="#configuring-hot-restart">15.3.6. Configuring Hot Restart</a>
<ul class="sectlevel4">
<li><a href="#global-hot-restart-configuration">Global Hot Restart Configuration</a></li>
<li><a href="#per-data-structure-hot-restart-configuration">Per Data Structure Hot Restart Configuration</a></li>
<li><a href="#hot-restart-configuration-examples">Hot Restart Configuration Examples</a></li>
</ul>
</li>
<li><a href="#moving-copying-hot-restart-data">15.3.7. Moving/Copying Hot Restart Data</a></li>
<li><a href="#hot-restart-persistence-design-details">15.3.8. Hot Restart Persistence Design Details</a></li>
<li><a href="#concurrent-incremental-generational-gc">15.3.9. Concurrent, Incremental, Generational GC</a>
<ul class="sectlevel4">
<li><a href="#i-o-minimization-scheme">I/O Minimization Scheme</a></li>
<li><a href="#cost-benefit-factor">Cost-Benefit Factor</a></li>
</ul>
</li>
<li><a href="#hot-restart-performance-considerations">15.3.10. Hot Restart Performance Considerations</a>
<ul class="sectlevel4">
<li><a href="#performance-on-a-physical-server">Performance on a Physical Server</a></li>
<li><a href="#performance-on-aws-r3">Performance on AWS R3</a></li>
</ul>
</li>
<li><a href="#hot-backup">15.3.11. Hot Backup</a>
<ul class="sectlevel4">
<li><a href="#configuring-hot-backup">Configuring Hot Backup</a></li>
<li><a href="#using-hot-backup">Using Hot Backup</a></li>
<li><a href="#starting-the-cluster-from-a-hot-backup">Starting the Cluster From a Hot Backup</a></li>
<li><a href="#achieving-high-consistency-of-backup-data">Achieving High Consistency of Backup Data</a></li>
<li><a href="#achieving-high-performance-of-backup-process">Achieving High Performance of Backup Process</a></li>
<li><a href="#backup-process-progress-and-completion">Backup Process Progress and Completion</a></li>
<li><a href="#backup-task-interruption-and-cancellation">Backup Task Interruption and Cancellation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#hazelcast-striim-hot-cache">15.4. Hazelcast Striim Hot Cache</a></li>
</ul>
</li>
<li><a href="#hazelcast-clients">16. Hazelcast Clients</a>
<ul class="sectlevel2">
<li><a href="#java-client">16.1. Java Client</a>
<ul class="sectlevel3">
<li><a href="#getting-started-with-java-client">16.1.1. Getting Started with Java Client</a>
<ul class="sectlevel4">
<li><a href="#client-api">Client API</a></li>
<li><a href="#java-client-operation-modes">Java Client Operation Modes</a></li>
<li><a href="#handling-failures">Handling Failures</a></li>
<li><a href="#using-supported-distributed-data-structures">Using Supported Distributed Data Structures</a></li>
<li><a href="#using-client-services">Using Client Services</a></li>
<li><a href="#client-listeners">Client Listeners</a></li>
<li><a href="#client-transactions">Client Transactions</a></li>
<li><a href="#async-start-and-reconnect-modes">Async Start and Reconnect Modes</a></li>
</ul>
</li>
<li><a href="#configuring-java-client">16.1.2. Configuring Java Client</a>
<ul class="sectlevel4">
<li><a href="#client-network">Client Network</a></li>
<li><a href="#configuring-client-load-balancer">Configuring Client Load Balancer</a></li>
<li><a href="#configuring-client-listeners">Configuring Client Listeners</a></li>
<li><a href="#configuring-client-connection-strategy">Configuring Client Connection Strategy</a></li>
<li><a href="#configuring-client-connection-retry">Configuring Client Connection Retry</a></li>
<li><a href="#other-configurations">Other Configurations</a></li>
</ul>
</li>
<li><a href="#java-client-failure-detectors">16.1.3. Java Client Failure Detectors</a>
<ul class="sectlevel4">
<li><a href="#client-deadline-failure-detector">Client Deadline Failure Detector</a></li>
<li><a href="#client-ping-failure-detector">Client Ping Failure Detector</a></li>
</ul>
</li>
<li><a href="#client-system-properties">16.1.4. Client System Properties</a></li>
<li><a href="#using-high-density-memory-store-with-java-client">16.1.5. Using High-Density Memory Store with Java Client</a></li>
</ul>
</li>
<li><a href="#c-client">16.2. C++ Client</a></li>
<li><a href="#net-client">16.3. .NET Client</a></li>
<li><a href="#rest-client">16.4. REST Client</a>
<ul class="sectlevel3">
<li><a href="#rest-client-get-post-delete-examples">16.4.1. REST Client GET/POST/DELETE Examples</a>
<ul class="sectlevel4">
<li><a href="#creating-updating-entries-in-a-map-for-rest-client">Creating/Updating Entries in a Map for REST Client</a></li>
<li><a href="#retrieving-entries-from-a-map-for-rest-client">Retrieving Entries from a Map for REST Client</a></li>
<li><a href="#removing-entries-from-a-map-for-rest-client">Removing Entries from a Map for REST Client</a></li>
<li><a href="#offering-items-on-a-queue-for-rest-client">Offering Items on a Queue for REST Client</a></li>
<li><a href="#retrieving-items-from-a-queue-for-rest-client">Retrieving Items from a Queue for REST Client</a></li>
<li><a href="#getting-the-size-of-the-queue-for-rest-client">Getting the size of the queue for REST Client</a></li>
</ul>
</li>
<li><a href="#checking-the-status-of-the-cluster-for-rest-client">16.4.2. Checking the Status of the Cluster for REST Client</a></li>
</ul>
</li>
<li><a href="#memcache-client">16.5. Memcache Client</a>
<ul class="sectlevel3">
<li><a href="#memcache-client-code-examples">16.5.1. Memcache Client Code Examples</a></li>
<li><a href="#unsupported-operations-for-memcache">16.5.2. Unsupported Operations for Memcache</a></li>
</ul>
</li>
<li><a href="#other-client-and-language-implementations">16.6. Other Client and Language Implementations</a>
<ul class="sectlevel3">
<li><a href="#python-client">16.6.1. Python Client</a></li>
<li><a href="#node-js-client">16.6.2. Node.js Client</a></li>
<li><a href="#go-client">16.6.3. Go Client</a></li>
<li><a href="#scala">16.6.4. Scala</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#serialization">17. Serialization</a>
<ul class="sectlevel2">
<li><a href="#serialization-interface-types">17.1. Serialization Interface Types</a></li>
<li><a href="#comparing-serialization-interfaces">17.2. Comparing Serialization Interfaces</a></li>
<li><a href="#implementing-java-serializable-and-externalizable">17.3. Implementing Java Serializable and Externalizable</a>
<ul class="sectlevel3">
<li><a href="#implementing-java-externalizable">17.3.1. Implementing Java Externalizable</a></li>
</ul>
</li>
<li><a href="#implementing-dataserializable">17.4. Implementing DataSerializable</a>
<ul class="sectlevel3">
<li><a href="#reading-and-writing-and-dataserializable">17.4.1. Reading and Writing and DataSerializable</a></li>
<li><a href="#identifieddataserializable">17.4.2. IdentifiedDataSerializable</a>
<ul class="sectlevel4">
<li><a href="#getid-and-getfactoryid-methods">getID and getFactoryId Methods</a></li>
<li><a href="#implementing-identifieddataserializable">Implementing IdentifiedDataSerializable</a></li>
<li><a href="#registering-employeedataserializablefactory">Registering EmployeeDataSerializableFactory</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#implementing-portable-serialization">17.5. Implementing Portable Serialization</a>
<ul class="sectlevel3">
<li><a href="#portable-serialization-example-code">17.5.1. Portable Serialization Example Code</a></li>
<li><a href="#registering-the-portable-factory">17.5.2. Registering the Portable Factory</a></li>
<li><a href="#versioning-for-portable-serialization">17.5.3. Versioning for Portable Serialization</a>
<ul class="sectlevel4">
<li><a href="#example-portable-versioning-scenarios">Example Portable Versioning Scenarios</a></li>
</ul>
</li>
<li><a href="#ordering-consistency-for-code-writeportable-code">17.5.4. Ordering Consistency for <code>writePortable</code></a></li>
<li><a href="#null-portable-serialization">17.5.5. Null Portable Serialization</a></li>
<li><a href="#distributedobject-serialization">17.5.6. DistributedObject Serialization</a></li>
</ul>
</li>
<li><a href="#custom-serialization">17.6. Custom Serialization</a>
<ul class="sectlevel3">
<li><a href="#implementing-streamserializer">17.6.1. Implementing StreamSerializer</a>
<ul class="sectlevel4">
<li><a href="#streamserializer-example-code-1">StreamSerializer Example Code 1</a></li>
<li><a href="#streamserializer-example-code-2">StreamSerializer Example Code 2</a></li>
<li><a href="#configuring-streamserializer">Configuring StreamSerializer</a></li>
</ul>
</li>
<li><a href="#implementing-bytearrayserializer">17.6.2. Implementing ByteArraySerializer</a>
<ul class="sectlevel4">
<li><a href="#configuring-bytearrayserializer">Configuring ByteArraySerializer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#global-serializer">17.7. Global Serializer</a>
<ul class="sectlevel3">
<li><a href="#sample-global-serializer">17.7.1. Sample Global Serializer</a></li>
</ul>
</li>
<li><a href="#implementing-hazelcastinstanceaware">17.8. Implementing HazelcastInstanceAware</a></li>
<li><a href="#untrusted-deserialization-protection">17.9. Untrusted Deserialization Protection</a></li>
<li><a href="#serialization-configuration-wrap-up">17.10. Serialization Configuration Wrap-Up</a></li>
</ul>
</li>
<li><a href="#management">18. Management</a>
<ul class="sectlevel2">
<li><a href="#getting-member-statistics">18.1. Getting Member Statistics</a>
<ul class="sectlevel3">
<li><a href="#map-statistics">18.1.1. Map Statistics</a></li>
<li><a href="#map-index-statistics">18.1.2. Map Index Statistics</a></li>
<li><a href="#near-cache-statistics">18.1.3. Near Cache Statistics</a></li>
<li><a href="#multimap-statistics">18.1.4. Multimap Statistics</a></li>
<li><a href="#queue-statistics">18.1.5. Queue Statistics</a></li>
<li><a href="#topic-statistics">18.1.6. Topic Statistics</a></li>
<li><a href="#executor-statistics">18.1.7. Executor Statistics</a></li>
</ul>
</li>
<li><a href="#jmx-api-per-member">18.2. JMX API per Member</a></li>
<li><a href="#monitoring-with-jmx">18.3. Monitoring with JMX</a>
<ul class="sectlevel3">
<li><a href="#mbean-naming-for-hazelcast-data-structures">18.3.1. MBean Naming for Hazelcast Data Structures</a></li>
<li><a href="#connecting-to-jmx-agent">18.3.2. Connecting to JMX Agent</a></li>
</ul>
</li>
<li><a href="#cluster-utilities">18.4. Cluster Utilities</a>
<ul class="sectlevel3">
<li><a href="#getting-member-events-and-member-sets">18.4.1. Getting Member Events and Member Sets</a></li>
<li><a href="#managing-cluster-and-member-states">18.4.2. Managing Cluster and Member States</a>
<ul class="sectlevel4">
<li><a href="#cluster-states">Cluster States</a></li>
<li><a href="#cluster-member-states">Cluster Member States</a></li>
</ul>
</li>
<li><a href="#using-the-script-cluster-sh">18.4.3. Using the Script cluster.sh</a>
<ul class="sectlevel4">
<li><a href="#example-usages-for-cluster-sh">Example Usages for cluster.sh</a></li>
</ul>
</li>
<li><a href="#using-rest-api-for-cluster-management">18.4.4. Using REST API for Cluster Management</a></li>
<li><a href="#enabling-lite-members">18.4.5. Enabling Lite Members</a>
<ul class="sectlevel4">
<li><a href="#configuring-lite-members">Configuring Lite Members</a></li>
<li><a href="#promoting-lite-members-to-data-member">Promoting Lite Members to Data Member</a></li>
</ul>
</li>
<li><a href="#defining-member-attributes">18.4.6. Defining Member Attributes</a></li>
<li><a href="#safety-checking-cluster-members">18.4.7. Safety Checking Cluster Members</a>
<ul class="sectlevel4">
<li><a href="#ensuring-safe-state-with-partitionservice">Ensuring Safe State with PartitionService</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#diagnostics">18.5. Diagnostics</a>
<ul class="sectlevel3">
<li><a href="#enabling-diagnostics-logging">18.5.1. Enabling Diagnostics Logging</a></li>
<li><a href="#diagnostics-log-file">18.5.2. Diagnostics Log File</a></li>
<li><a href="#diagnostics-plugins">18.5.3. Diagnostics Plugins</a>
<ul class="sectlevel4">
<li><a href="#buildinfo">BuildInfo</a></li>
<li><a href="#systemproperties">SystemProperties</a></li>
<li><a href="#configproperties">ConfigProperties</a></li>
<li><a href="#metrics">Metrics</a></li>
<li><a href="#slowoperations">SlowOperations</a></li>
<li><a href="#invocations">Invocations</a></li>
<li><a href="#hazelcastinstance">HazelcastInstance</a></li>
<li><a href="#systemlog">SystemLog</a></li>
<li><a href="#storelatency">StoreLatency</a></li>
<li><a href="#operationheartbeats">OperationHeartbeats</a></li>
<li><a href="#memberheartbeats">MemberHeartbeats</a></li>
<li><a href="#operationthreadsamples">OperationThreadSamples</a></li>
<li><a href="#wandiagnostics">WanDiagnostics</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#health-check-and-monitoring">18.6. Health Check and Monitoring</a>
<ul class="sectlevel3">
<li><a href="#health-check">18.6.1. Health Check</a></li>
<li><a href="#health-check-script">18.6.2. Health Check Script</a></li>
<li><a href="#health-monitor">18.6.3. Health Monitor</a></li>
<li><a href="#using-health-check-on-f5-big-ip-ltm">18.6.4. Using Health Check on F5 BIG-IP LTM</a>
<ul class="sectlevel4">
<li><a href="#monitor-types">Monitor Types</a></li>
<li><a href="#configuration">Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#management-center">18.7. Management Center</a></li>
<li><a href="#clustered-jmx-and-rest-via-management-center">18.8. Clustered JMX and REST via Management Center</a></li>
</ul>
</li>
<li><a href="#security">19. Security</a>
<ul class="sectlevel2">
<li><a href="#enabling-jaas-security">19.1. Enabling JAAS Security</a></li>
<li><a href="#socket-interceptor">19.2. Socket Interceptor</a></li>
<li><a href="#security-interceptor">19.3. Security Interceptor</a></li>
<li><a href="#encryption">19.4. Encryption</a></li>
<li><a href="#tlsssl">19.5. TLS/SSL</a>
<ul class="sectlevel3">
<li><a href="#tls-ssl-for-hazelcast-members">19.5.1. TLS/SSL for Hazelcast Members</a>
<ul class="sectlevel4">
<li><a href="#other-property-configuration-options">Other Property Configuration Options</a></li>
</ul>
</li>
<li><a href="#tls-ssl-for-hazelcast-clients">19.5.2. TLS/SSL for Hazelcast Clients</a></li>
<li><a href="#mutual-authentication">19.5.3. Mutual Authentication</a></li>
<li><a href="#tls-ssl-performance-improvements-for-java">19.5.4. TLS/SSL Performance Improvements for Java</a></li>
<li><a href="#tls-ssl-debugging">19.5.5. TLS/SSL Debugging</a></li>
<li><a href="#tls-ssl-for-hazelcast-management-center">19.5.6. TLS/SSL for Hazelcast Management Center</a></li>
</ul>
</li>
<li><a href="#integrating-openssl-boringssl">19.6. Integrating OpenSSL / BoringSSL</a>
<ul class="sectlevel3">
<li><a href="#netty-libraries">19.6.1. Netty Libraries</a></li>
<li><a href="#using-boringssl">19.6.2. Using BoringSSL</a></li>
<li><a href="#using-openssl">19.6.3. Using OpenSSL</a></li>
<li><a href="#configuring-hazelcast-for-openssl">19.6.4. Configuring Hazelcast for OpenSSL</a></li>
<li><a href="#configuring-cipher-suites">19.6.5. Configuring Cipher Suites</a></li>
<li><a href="#other-ways-of-configuring-properties">19.6.6. Other Ways of Configuring Properties</a></li>
</ul>
</li>
<li><a href="#credentials">19.7. Credentials</a></li>
<li><a href="#validating-secrets-using-strength-policy">19.8. Validating Secrets Using Strength Policy</a>
<ul class="sectlevel3">
<li><a href="#using-a-custom-secret-strength-policy">19.8.1. Using a Custom Secret Strength Policy</a></li>
<li><a href="#enforcing-the-secret-strength-policy">19.8.2. Enforcing the Secret Strength Policy</a></li>
</ul>
</li>
<li><a href="#clusterloginmodule">19.9. ClusterLoginModule</a>
<ul class="sectlevel3">
<li><a href="#enterprise-integration">19.9.1. Enterprise Integration</a></li>
</ul>
</li>
<li><a href="#cluster-member-security">19.10. Cluster Member Security</a></li>
<li><a href="#native-client-security">19.11. Native Client Security</a>
<ul class="sectlevel3">
<li><a href="#authentication">19.11.1. Authentication</a></li>
<li><a href="#authorization">19.11.2. Authorization</a></li>
<li><a href="#permissions">19.11.3. Permissions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#performance">20. Performance</a>
<ul class="sectlevel2">
<li><a href="#data-affinity">20.1. Data Affinity</a>
<ul class="sectlevel3">
<li><a href="#partitionaware">20.1.1. PartitionAware</a></li>
<li><a href="#partitioningstrategy">20.1.2. PartitioningStrategy</a></li>
</ul>
</li>
<li><a href="#running-in-ec2">20.2. Running in EC2</a></li>
<li><a href="#back-pressure">20.3. Back Pressure</a>
<ul class="sectlevel3">
<li><a href="#member-side">20.3.1. Member Side</a></li>
<li><a href="#client-side">20.3.2. Client Side</a></li>
</ul>
</li>
<li><a href="#threading-model">20.4. Threading Model</a>
<ul class="sectlevel3">
<li><a href="#i-o-threading">20.4.1. I/O Threading</a></li>
<li><a href="#event-threading">20.4.2. Event Threading</a></li>
<li><a href="#iexecutor-threading">20.4.3. IExecutor Threading</a></li>
<li><a href="#operation-threading">20.4.4. Operation Threading</a>
<ul class="sectlevel4">
<li><a href="#partition-aware-operations">Partition-aware Operations</a></li>
<li><a href="#non-partition-aware-operations">Non-Partition-aware Operations</a></li>
<li><a href="#priority-operations">Priority Operations</a></li>
<li><a href="#operation-response-and-invocation-future">Operation-response and Invocation-future</a></li>
<li><a href="#local-calls">Local Calls</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#slowoperationdetector">20.5. SlowOperationDetector</a>
<ul class="sectlevel3">
<li><a href="#logging-of-slow-operations">20.5.1. Logging of Slow Operations</a></li>
<li><a href="#purging-of-slow-operation-logs">20.5.2. Purging of Slow Operation Logs</a></li>
</ul>
</li>
<li><a href="#near-cache">20.6. Near Cache</a>
<ul class="sectlevel3">
<li><a href="#hazelcast-data-structures-with-near-cache-support">20.6.1. Hazelcast Data Structures with Near Cache Support</a></li>
<li><a href="#configuring-near-cache">20.6.2. Configuring Near Cache</a></li>
<li><a href="#near-cache-configuration-examples">20.6.3. Near Cache Configuration Examples</a>
<ul class="sectlevel4">
<li><a href="#near-cache-example-for-imap">Near Cache Example for IMap</a></li>
<li><a href="#near-cache-example-for-jcache-clients">Near Cache Example for JCache Clients</a></li>
<li><a href="#example-for-near-cache-with-high-density-memory-store">Example for Near Cache with High-Density Memory Store</a></li>
</ul>
</li>
<li><a href="#near-cache-eviction">20.6.4. Near Cache Eviction</a></li>
<li><a href="#near-cache-expiration">20.6.5. Near Cache Expiration</a></li>
<li><a href="#near-cache-invalidation">20.6.6. Near Cache Invalidation</a></li>
<li><a href="#near-cache-consistency">20.6.7. Near Cache Consistency</a>
<ul class="sectlevel4">
<li><a href="#eventual-consistency">Eventual Consistency</a></li>
<li><a href="#locally-initiated-changes">Locally Initiated Changes</a></li>
</ul>
</li>
<li><a href="#near-cache-preloader">20.6.8. Near Cache Preloader</a></li>
</ul>
</li>
<li><a href="#caching-deserialized-values">20.7. Caching Deserialized Values</a></li>
</ul>
</li>
<li><a href="#hazelcast-simulator">21. Hazelcast Simulator</a></li>
<li><a href="#wan">22. WAN</a>
<ul class="sectlevel2">
<li><a href="#wan-replication">22.1. WAN Replication</a>
<ul class="sectlevel3">
<li><a href="#defining-wan-replication">22.1.1. Defining WAN Replication</a>
<ul class="sectlevel4">
<li><a href="#defining-wan-replication-using-static-endpoints">Defining WAN Replication Using Static Endpoints</a></li>
<li><a href="#defining-wan-replication-using-discovery-spi">Defining WAN Replication Using Discovery SPI</a></li>
</ul>
</li>
<li><a href="#wanbatchreplication-implementation">22.1.2. WanBatchReplication Implementation</a></li>
<li><a href="#configuring-wan-replication-for-imap-and-icache">22.1.3. Configuring WAN Replication for IMap and ICache</a></li>
<li><a href="#batch-size">22.1.4. Batch Size</a></li>
<li><a href="#batch-maximum-delay">22.1.5. Batch Maximum Delay</a></li>
<li><a href="#response-timeout">22.1.6. Response Timeout</a></li>
<li><a href="#queue-capacity">22.1.7. Queue Capacity</a></li>
<li><a href="#queue-full-behavior">22.1.8. Queue Full Behavior</a></li>
<li><a href="#event-filtering-api">22.1.9. Event Filtering API</a></li>
<li><a href="#acknowledgment-types">22.1.10. Acknowledgment Types</a></li>
<li><a href="#synchronizing-wan-target-cluster">22.1.11. Synchronizing WAN Target Cluster</a></li>
<li><a href="#wan-replication-failure-detection-and-recovery">22.1.12. WAN Replication Failure Detection and Recovery</a>
<ul class="sectlevel4">
<li><a href="#wan-target-endpoint-list">WAN Target Endpoint List</a></li>
<li><a href="#wan-failure-detection">WAN Failure Detection</a></li>
<li><a href="#wan-endpoint-recovery">WAN Endpoint Recovery</a></li>
</ul>
</li>
<li><a href="#wan-replication-additional-information">22.1.13. WAN Replication Additional Information</a></li>
</ul>
</li>
<li><a href="#delta-wan-synchronization">22.2. Delta WAN Synchronization</a>
<ul class="sectlevel3">
<li><a href="#requirements">22.2.1. Requirements</a></li>
<li><a href="#using-delta-wan-synchronization">22.2.2. Using Delta WAN Synchronization</a></li>
<li><a href="#configuring-delta-wan-synchronization">22.2.3. Configuring Delta WAN Synchronization</a></li>
<li><a href="#the-process">22.2.4. The Process</a></li>
<li><a href="#memory-consumption">22.2.5. Memory Consumption</a></li>
<li><a href="#defining-the-depth">22.2.6. Defining the Depth</a></li>
<li><a href="#rest-api">22.2.7. REST API</a></li>
<li><a href="#statistics">22.2.8. Statistics</a></li>
</ul>
</li>
<li><a href="#hazelcast-wan-replication-with-solace">22.3. Hazelcast WAN Replication with Solace</a>
<ul class="sectlevel3">
<li><a href="#enabling-integration">22.3.1. Enabling Integration</a></li>
<li><a href="#configuring-publisher">22.3.2. Configuring Publisher</a></li>
<li><a href="#configuring-consumer">22.3.3. Configuring Consumer</a></li>
<li><a href="#additional-information">22.3.4. Additional Information</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#osgi">23. OSGI</a>
<ul class="sectlevel2">
<li><a href="#osgi-support">23.1. OSGI Support</a></li>
<li><a href="#api">23.2. API</a></li>
<li><a href="#configuring-hazelcast-osgi-support">23.3. Configuring Hazelcast OSGI Support</a></li>
<li><a href="#design">23.4. Design</a></li>
<li><a href="#using-hazelcast-osgi-service">23.5. Using Hazelcast OSGI Service</a>
<ul class="sectlevel3">
<li><a href="#getting-hazelcast-osgi-service-instances">23.5.1. Getting Hazelcast OSGI Service Instances</a></li>
<li><a href="#managing-and-using-hazelcast-instances">23.5.2. Managing and Using Hazelcast instances</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#extending-hazelcast">24. Extending Hazelcast</a>
<ul class="sectlevel2">
<li><a href="#user-defined-services">24.1. User Defined Services</a>
<ul class="sectlevel3">
<li><a href="#creating-the-service-class">24.1.1. Creating the Service Class</a></li>
<li><a href="#enabling-the-service-class">24.1.2. Enabling the Service Class</a></li>
<li><a href="#adding-properties-to-the-service">24.1.3. Adding Properties to the Service</a></li>
<li><a href="#starting-the-service">24.1.4. Starting the Service</a></li>
<li><a href="#placing-a-remote-call-via-proxy">24.1.5. Placing a Remote Call via Proxy</a>
<ul class="sectlevel4">
<li><a href="#making-counter-a-distributed-object">Making Counter a Distributed Object</a></li>
<li><a href="#implementing-managedservice-and-remoteservice">Implementing ManagedService and RemoteService</a></li>
<li><a href="#implementing-counterproxy">Implementing CounterProxy</a></li>
<li><a href="#dealing-with-exceptions">Dealing with Exceptions</a></li>
<li><a href="#implementing-the-partitionawareoperation-interface">Implementing the PartitionAwareOperation Interface</a></li>
<li><a href="#running-the-code">Running the Code</a></li>
</ul>
</li>
<li><a href="#creating-containers">24.1.6. Creating Containers</a>
<ul class="sectlevel4">
<li><a href="#integrating-the-container-in-the-counterservice">Integrating the Container in the CounterService</a></li>
<li><a href="#connecting-the-incoperation-run-method-to-the-container">Connecting the IncOperation.run Method to the Container</a></li>
<li><a href="#running-the-sample-code">Running the Sample Code</a></li>
</ul>
</li>
<li><a href="#partition-migration">24.1.7. Partition Migration</a>
<ul class="sectlevel4">
<li><a href="#transferring-migrationdata">Transferring migrationData</a></li>
<li><a href="#letting-hazelcast-know-counterservice-can-do-partition-migrations">Letting Hazelcast Know CounterService Can Do Partition Migrations</a></li>
<li><a href="#running-the-sample-code-2">Running the Sample Code</a></li>
</ul>
</li>
<li><a href="#creating-backups">24.1.8. Creating Backups</a>
<ul class="sectlevel4">
<li><a href="#performing-the-backup-with-incbackupoperation">Performing the Backup with IncBackupOperation</a></li>
<li><a href="#running-the-sample-code-3">Running the Sample Code</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#operationparker">24.2. OperationParker</a></li>
<li><a href="#discovery-spi">24.3. Discovery SPI</a>
<ul class="sectlevel3">
<li><a href="#discovery-spi-interfaces-and-classes">24.3.1. Discovery SPI Interfaces and Classes</a>
<ul class="sectlevel4">
<li><a href="#discoverystrategy-implement">DiscoveryStrategy: Implement</a></li>
<li><a href="#abstractdiscoverystrategy-abstract-class">AbstractDiscoveryStrategy: Abstract Class</a></li>
<li><a href="#discoverystrategyfactory-factory-contract">DiscoveryStrategyFactory: Factory Contract</a></li>
<li><a href="#discoverynode-describe-a-member">DiscoveryNode: Describe a Member</a></li>
<li><a href="#simplediscoverynode-default-discoverynode">SimpleDiscoveryNode: Default DiscoveryNode</a></li>
<li><a href="#nodefilter-filter-members">NodeFilter: Filter Members</a></li>
<li><a href="#discoveryservice-support-in-integrator-systems">DiscoveryService: Support In Integrator Systems</a></li>
<li><a href="#discoveryserviceprovider-provide-a-discoveryservice">DiscoveryServiceProvider: Provide a DiscoveryService</a></li>
<li><a href="#discoveryservicesettings-configure-discoveryservice">DiscoveryServiceSettings: Configure DiscoveryService</a></li>
<li><a href="#discoverymode-member-or-client">DiscoveryMode: Member or Client</a></li>
</ul>
</li>
<li><a href="#discovery-strategy">24.3.2. Discovery Strategy</a>
<ul class="sectlevel4">
<li><a href="#discovery-strategy-example">Discovery Strategy Example</a></li>
<li><a href="#configuring-site-domain">Configuring Site Domain</a></li>
<li><a href="#creating-discovery">Creating Discovery</a></li>
<li><a href="#implementing-discovery-strategy">Implementing Discovery Strategy</a></li>
<li><a href="#extending-the-code-abstractdiscoverystrategy-code">Extending The <code>AbstractDiscoveryStrategy</code></a></li>
<li><a href="#overriding-discovery-configuration">Overriding Discovery Configuration</a></li>
<li><a href="#implementing-lookup">Implementing Lookup</a></li>
<li><a href="#mapping-to-discoverynode-s">Mapping to `DiscoveryNode`s</a></li>
<li><a href="#configuring-code-discoverystrategy-code">Configuring <code>DiscoveryStrategy</code></a></li>
</ul>
</li>
<li><a href="#discoveryservice-framework-integration">24.3.3. DiscoveryService (Framework integration)</a></li>
</ul>
</li>
<li><a href="#config-properties-spi">24.4. Config Properties SPI</a>
<ul class="sectlevel3">
<li><a href="#config-properties-spi-classes">24.4.1. Config Properties SPI Classes</a>
<ul class="sectlevel4">
<li><a href="#propertydefinition-define-a-single-property">PropertyDefinition: Define a Single Property</a></li>
<li><a href="#simplepropertydefinition-basic-propertydefinition">SimplePropertyDefinition: Basic PropertyDefinition</a></li>
<li><a href="#propertytypeconverter-set-of-typeconverters">PropertyTypeConverter: Set of TypeConverters</a></li>
<li><a href="#valuevalidator-and-validationexception">ValueValidator and ValidationException</a></li>
</ul>
</li>
<li><a href="#config-properties-spi-example">24.4.2. Config Properties SPI Example</a>
<ul class="sectlevel4">
<li><a href="#defining-a-config-propertydefinition">Defining a Config PropertyDefinition</a></li>
<li><a href="#providing-a-value-in-xml">Providing a value in XML</a></li>
<li><a href="#retrieving-a-propertydefinition-value">Retrieving a PropertyDefinition Value</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#hazelcast-plugins">25. Hazelcast Plugins</a>
<ul class="sectlevel2">
<li><a href="#cloud-discovery-plugins">25.1. Cloud Discovery Plugins</a>
<ul class="sectlevel3">
<li><a href="#hazelcast-jclouds">25.1.1. Hazelcast jclouds</a></li>
<li><a href="#hazelcast-aws">25.1.2. Hazelcast AWS</a></li>
<li><a href="#hazelcast-gcp">25.1.3. Hazelcast GCP</a></li>
<li><a href="#hazelcast-azure">25.1.4. Hazelcast Azure</a></li>
<li><a href="#hazelcast-consul">25.1.5. Hazelcast Consul</a></li>
<li><a href="#hazelcast-etcd">25.1.6. Hazelcast etcd</a></li>
<li><a href="#hazelcast-eureka">25.1.7. Hazelcast Eureka</a></li>
<li><a href="#hazelcast-imdg-and-jet-for-pcf">25.1.8. Hazelcast IMDG and Jet for PCF</a></li>
<li><a href="#hazelcast-openshift">25.1.9. Hazelcast OpenShift</a></li>
<li><a href="#hazelcast-heroku">25.1.10. Hazelcast Heroku</a></li>
<li><a href="#hazelcast-kubernetes">25.1.11. Hazelcast Kubernetes</a></li>
<li><a href="#hazelcast-zookeeper">25.1.12. Hazelcast Zookeeper</a></li>
</ul>
</li>
<li><a href="#integration-plugins">25.2. Integration Plugins</a>
<ul class="sectlevel3">
<li><a href="#spring-data-hazelcast">25.2.1. Spring Data Hazelcast</a></li>
<li><a href="#spring-integration-extension-for-hazelcast">25.2.2. Spring Integration Extension for Hazelcast</a></li>
<li><a href="#hazelcast-jca-resource-adapter">25.2.3. Hazelcast JCA Resource Adapter</a>
<ul class="sectlevel4">
<li><a href="#integrating-with-mulesoft">Integrating with MuleSoft</a></li>
</ul>
</li>
<li><a href="#hazelcast-grails">25.2.4. Hazelcast Grails</a></li>
<li><a href="#hazelcast-hibernate-2lc">25.2.5. Hazelcast Hibernate 2LC</a></li>
<li><a href="#hazelcast-dynacache">25.2.6. Hazelcast DynaCache</a></li>
<li><a href="#hazelcast-connector-for-kafka">25.2.7. Hazelcast Connector for Kafka</a></li>
<li><a href="#openfire">25.2.8. Openfire</a></li>
<li><a href="#subzero">25.2.9. SubZero</a></li>
</ul>
</li>
<li><a href="#web-sessions-clustering-plugins">25.3. Web Sessions Clustering Plugins</a>
<ul class="sectlevel3">
<li><a href="#filter-based-web-session-replication">25.3.1. Filter Based Web Session Replication</a></li>
<li><a href="#tomcat-based-web-session-replication">25.3.2. Tomcat Based Web Session Replication</a></li>
<li><a href="#jetty-based-web-session-replication">25.3.3. Jetty Based Web Session Replication</a></li>
</ul>
</li>
<li><a href="#big-data-plugins">25.4. Big Data Plugins</a></li>
</ul>
</li>
<li><a href="#consistency-and-replication-model">26. Consistency and Replication Model</a>
<ul class="sectlevel2">
<li><a href="#a-brief-overview-of-consistency-and-replication-in-distributed-systems">26.1. A Brief Overview of Consistency and Replication in Distributed Systems</a></li>
<li><a href="#hazelcast-s-replication-algorithm">26.2. Hazelcast&#8217;s Replication Algorithm</a>
<ul class="sectlevel3">
<li><a href="#best-effort-consistency">26.2.1. Best-Effort Consistency</a></li>
</ul>
</li>
<li><a href="#invocation-lifecycle">26.3. Invocation Lifecycle</a></li>
<li><a href="#exactly-once-at-least-once-or-at-most-once-execution">26.4. Exactly-once, At-least-once or At-most-once Execution</a></li>
<li><a href="#indeterminateoperationstateexception">26.5. IndeterminateOperationStateException</a></li>
</ul>
</li>
<li><a href="#network-partitioning">27. Network Partitioning</a>
<ul class="sectlevel2">
<li><a href="#split-brain-syndrome">27.1. Split-Brain Syndrome</a></li>
<li><a href="#dealing-with-network-partitions">27.2. Dealing with Network Partitions</a></li>
<li><a href="#split-brain-protection">27.3. Split-Brain Protection</a>
<ul class="sectlevel3">
<li><a href="#time-window-for-split-brain-protection">27.3.1. Time Window for Split-Brain Protection</a></li>
<li><a href="#configuring-split-brain-protection">27.3.2. Configuring Split-Brain Protection</a>
<ul class="sectlevel4">
<li><a href="#member-count-quorum">Member Count Quorum</a></li>
<li><a href="#probabilistic-quorum-function">Probabilistic Quorum Function</a></li>
<li><a href="#recently-active-quorum-function">Recently-Active Quorum Function</a></li>
<li><a href="#quorum-configuration-reference">Quorum Configuration Reference</a></li>
</ul>
</li>
<li><a href="#configuring-quorum-listeners">27.3.3. Configuring Quorum Listeners</a></li>
<li><a href="#querying-quorum-results">27.3.4. Querying Quorum Results</a></li>
</ul>
</li>
<li><a href="#split-brain-recovery">27.4. Split-Brain Recovery</a>
<ul class="sectlevel3">
<li><a href="#merge-policies">27.4.1. Merge Policies</a></li>
<li><a href="#supported-data-structures">27.4.2. Supported Data Structures</a></li>
<li><a href="#configuring-merge-policies">27.4.3. Configuring Merge Policies</a>
<ul class="sectlevel4">
<li><a href="#declarative-configuration">Declarative Configuration</a></li>
<li><a href="#programmatic-configuration">Programmatic Configuration</a></li>
</ul>
</li>
<li><a href="#custom-merge-policies">27.4.4. Custom Merge Policies</a>
<ul class="sectlevel4">
<li><a href="#merge-types">Merge Types</a></li>
<li><a href="#accessing-deserialized-values">Accessing Deserialized Values</a></li>
<li><a href="#accessing-hazelcast-usercontext">Accessing Hazelcast UserContext</a></li>
<li><a href="#merge-policies-with-multiple-merge-types">Merge Policies With Multiple Merge Types</a></li>
<li><a href="#merge-policies-for-specific-data-structures">Merge Policies For Specific Data Structures</a></li>
<li><a href="#best-practices-2">Best Practices</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#system-properties">Appendix A: System Properties</a></li>
<li><a href="#common-exception-types">Appendix B: Common Exception Types</a></li>
<li><a href="#license-questions">Appendix C: License Questions</a>
<ul class="sectlevel2">
<li><a href="#embedded-dependencies">C.1. Embedded Dependencies</a></li>
<li><a href="#runtime-dependencies">C.2. Runtime Dependencies</a></li>
</ul>
</li>
<li><a href="#frequently-asked-questions">Appendix D: Frequently Asked Questions</a></li>
<li><a href="#glossary">Glossary</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="imageblock">
<div class="content">
<img src="images/logo_dark.png" alt="logo dark">
</div>
</div>
<div class="sect1">
<h2 id="hazelcast-imdg-reference-manual"><a class="anchor" href="#hazelcast-imdg-reference-manual"></a><a class="link" href="#hazelcast-imdg-reference-manual">Hazelcast IMDG Reference Manual</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Version 3.11</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preface"><a class="anchor" href="#preface"></a><a class="link" href="#preface">Preface</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Welcome to the Hazelcast IMDG (In-Memory Data Grid) Reference Manual. This manual includes concepts, instructions and samples to guide you on how to use Hazelcast and build Hazelcast IMDG applications.</p>
</div>
<div class="paragraph">
<p>As the reader of this manual, you must be familiar with the Java programming language and you should have installed your preferred Integrated Development Environment (IDE).</p>
</div>
<div class="sect2">
<h3 id="hazelcast-imdg-editions"><a class="anchor" href="#hazelcast-imdg-editions"></a><a class="link" href="#hazelcast-imdg-editions">Hazelcast IMDG Editions</a></h3>
<div class="paragraph">
<p>This Reference Manual covers all editions of Hazelcast IMDG. Throughout this manual:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Hazelcast</strong> or <strong>Hazelcast IMDG</strong> refers to the open source edition of Hazelcast in-memory data grid middleware. <strong>Hazelcast</strong> is also the name of the company (Hazelcast, Inc.) providing the Hazelcast product.</p>
</li>
<li>
<p><strong class="blue">Hazelcast IMDG Enterprise</strong> is a commercially licensed edition of Hazelcast IMDG which provides high-value enterprise features in addition to Hazelcast IMDG.</p>
</li>
<li>
<p><strong class="navy">Hazelcast IMDG Enterprise HD</strong> is a commercially licensed edition of Hazelcast IMDG which provides High-Density (HD) Memory Store and Hot Restart Persistence features in addition to Hazelcast IMDG Enterprise.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hazelcast-imdg-architecture"><a class="anchor" href="#hazelcast-imdg-architecture"></a><a class="link" href="#hazelcast-imdg-architecture">Hazelcast IMDG Architecture</a></h3>
<div class="paragraph">
<p>You can see the features for all Hazelcast IMDG editions in the following architecture diagram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/HazelcastArchitecture.png" alt="Hazelcast Architecture">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can see small "HD" boxes for some features in the above diagram. Those features can use High-Density (HD) Memory Store when it is available. It means if you have Hazelcast IMDG Enterprise HD, you can use those features with HD Memory Store.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on Hazelcast IMDG&#8217;s Architecture, please see the white paper <a href="https://hazelcast.com/resources/architects-view-hazelcast/">An Architect&#8217;s View of Hazelcast</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="hazelcast-imdg-plugins"><a class="anchor" href="#hazelcast-imdg-plugins"></a><a class="link" href="#hazelcast-imdg-plugins">Hazelcast IMDG Plugins</a></h3>
<div class="paragraph">
<p>You can extend Hazelcast IMDG&#8217;s functionality by using its plugins. These plugins have their own lifecycles. Please see <a href="https://hazelcast.org/plugins/">Plugins page</a> to learn about Hazelcast plugins you can use. Hazelcast plugins are marked with <span class="image"><img src="images/Plugin_New.png" alt="Plugin" width="54" height="12"></span> label throughout this manual. See also the <a href="#hazelcast-plugins">Hazelcast Plugins chapter</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="licensing"><a class="anchor" href="#licensing"></a><a class="link" href="#licensing">Licensing</a></h3>
<div class="paragraph">
<p>Hazelcast IMDG and Hazelcast Reference Manual are free and provided under the Apache License, Version 2.0. Hazelcast IMDG Enterprise and Hazelcast IMDG Enterprise HD is commercially licensed by Hazelcast, Inc.</p>
</div>
<div class="paragraph">
<p>For more detailed information on licensing, please see the <a href="#license-questions">License Questions appendix</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="trademarks"><a class="anchor" href="#trademarks"></a><a class="link" href="#trademarks">Trademarks</a></h3>
<div class="paragraph">
<p>Hazelcast is a registered trademark of Hazelcast, Inc. All other trademarks in this manual are held by their respective owners.</p>
</div>
</div>
<div class="sect2">
<h3 id="customer-support"><a class="anchor" href="#customer-support"></a><a class="link" href="#customer-support">Customer Support</a></h3>
<div class="paragraph">
<p>Support for Hazelcast is provided via <a href="https://github.com/hazelcast/hazelcast/issues">GitHub</a>, <a href="https://groups.google.com/forum/#!forum/hazelcast">Mail Group</a> and <a href="http://www.stackoverflow.com">StackOverflow</a>.</p>
</div>
<div class="paragraph">
<p>For information on the commercial support for Hazelcast IMDG and Hazelcast IMDG Enterprise, please see
<a href="https://hazelcast.com/pricing/">hazelcast.com</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="release-notes"><a class="anchor" href="#release-notes"></a><a class="link" href="#release-notes">Release Notes</a></h3>
<div class="paragraph">
<p>Please refer to the <a href="https://docs.hazelcast.org/docs/release-notes/">Release Notes document</a> for the new features, enhancements and fixes performed for each Hazelcast IMDG release.</p>
</div>
</div>
<div class="sect2">
<h3 id="contributing-to-hazelcast-imdg"><a class="anchor" href="#contributing-to-hazelcast-imdg"></a><a class="link" href="#contributing-to-hazelcast-imdg">Contributing to Hazelcast IMDG</a></h3>
<div class="paragraph">
<p>You can contribute to the Hazelcast IMDG code, report a bug, or request an enhancement. Please see the following resources.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://hazelcast.atlassian.net/wiki/display/COM/Developing+with+Git">Developing with Git</a>: Document that explains the branch mechanism of Hazelcast and how to request changes.</p>
</li>
<li>
<p><a href="https://hazelcast.atlassian.net/wiki/display/COM/Hazelcast+Contributor+Agreement">Hazelcast Contributor Agreement form</a>: Form that each contributing developer needs to fill and send back to Hazelcast.</p>
</li>
<li>
<p><a href="https://github.com/hazelcast/hazelcast">Hazelcast on GitHub</a>: Hazelcast repository where the code is developed, issues and pull requests are managed.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="partners"><a class="anchor" href="#partners"></a><a class="link" href="#partners">Partners</a></h3>
<div class="paragraph">
<p>Hazelcast partners with leading hardware and software technologies, system integrators, resellers and OEMs including Amazon Web Services, Vert.x, Azul Systems, C2B2. Please see the <a href="https://hazelcast.com/partners/">Partners</a> page for the full list of and information on our partners.</p>
</div>
</div>
<div class="sect2">
<h3 id="phone-home"><a class="anchor" href="#phone-home"></a><a class="link" href="#phone-home">Phone Home</a></h3>
<div class="paragraph">
<p>Hazelcast uses phone home data to learn about usage of Hazelcast IMDG.</p>
</div>
<div class="paragraph">
<p>Hazelcast IMDG member instances call our phone home server initially when they are started and then every 24 hours. This applies to all the instances joined to the cluster.</p>
</div>
<div class="paragraph">
<p><strong>What is sent in?</strong></p>
</div>
<div class="paragraph">
<p>The following information is sent in a phone home:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hazelcast IMDG version</p>
</li>
<li>
<p>Local Hazelcast IMDG member UUID</p>
</li>
<li>
<p>Download ID</p>
</li>
<li>
<p>A hash value of the cluster ID</p>
</li>
<li>
<p>Cluster size bands for 5, 10, 20, 40, 60, 100, 150, 300, 600 and &gt; 600</p>
</li>
<li>
<p>Number of connected clients bands of 5, 10, 20, 40, 60, 100, 150, 300, 600 and &gt; 600</p>
</li>
<li>
<p>Cluster uptime</p>
</li>
<li>
<p>Member uptime</p>
</li>
<li>
<p>Environment Information:</p>
<div class="ulist">
<ul>
<li>
<p>Name of operating system</p>
</li>
<li>
<p>Kernel architecture (32-bit or 64-bit)</p>
</li>
<li>
<p>Version of operating system</p>
</li>
<li>
<p>Version of installed Java</p>
</li>
<li>
<p>Name of Java Virtual Machine</p>
</li>
</ul>
</div>
</li>
<li>
<p>Hazelcast IMDG Enterprise specific:</p>
<div class="ulist">
<ul>
<li>
<p>Number of clients by language (Java, C++, C#)</p>
</li>
<li>
<p>Flag for Hazelcast Enterprise</p>
</li>
<li>
<p>Hash value of license key</p>
</li>
<li>
<p>Native memory usage</p>
</li>
</ul>
</div>
</li>
<li>
<p>Hazelcast Management Center specific:</p>
<div class="ulist">
<ul>
<li>
<p>Hazelcast Management Center version</p>
</li>
<li>
<p>Hash value of Hazelcast Management Center license key</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Phone Home Code</strong></p>
</div>
<div class="paragraph">
<p>The phone home code itself is open source. Please see <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/util/PhoneHome.html">here</a>.</p>
</div>
<div class="paragraph">
<p><strong>Disabling Phone Homes</strong></p>
</div>
<div class="paragraph">
<p>Set the <code>hazelcast.phone.home.enabled</code> system property to false either in the config or on the Java command line. Please see the <a href="#system-properties">System Properties section</a> for information on how to set a property.</p>
</div>
<div class="paragraph">
<p>You can also disable the phone home using the environment variable <code>HZ_PHONE_HOME_ENABLED</code>. Simply add the following line to your <code>.bash_profile</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">export</span> HZ_PHONE_HOME_ENABLED=<span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Phone Home URLs</strong></p>
</div>
<div class="paragraph">
<p>For versions 1.x and 2.x: <a href="http://www.hazelcast.com/version.jsp" class="bare">http://www.hazelcast.com/version.jsp</a>.</p>
</div>
<div class="paragraph">
<p>For versions 3.x up to 3.6: <a href="http://versioncheck.hazelcast.com/version.jsp" class="bare">http://versioncheck.hazelcast.com/version.jsp</a>.</p>
</div>
<div class="paragraph">
<p>For versions after 3.6: <a href="http://phonehome.hazelcast.com/ping" class="bare">http://phonehome.hazelcast.com/ping</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="document-revision-history"><a class="anchor" href="#document-revision-history"></a><a class="link" href="#document-revision-history">1. Document Revision History</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter lists the changes made to this document from the previous release.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="https://docs.hazelcast.org/docs/rn/">Release Notes</a> for the new features, enhancements and fixes performed for each Hazelcast release.*
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Revision History</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chapter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Section</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#getting-started">Getting Started</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <a href="#running-in-modular-java">Running in Modular Java</a> as a new section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <a href="#supported-jvms">Supported Java Virtual Machines</a> as a new section to summarize the compatibility between Hazelcast IMDG and various JVMs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <a href="#license-info">License Information</a> as a new section to explain how you can retrieve your Hazelcast IMDG license details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#setting-up-clusters">Setting Up Clusters</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#partition-group-configuration">Partition Group Configuration</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added a note to the ZONE_AWARE type content suggesting to have equal number of members in each Availability Zone.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <a href="#adding-user-library-to-classpath">Adding User Library to CLASSPATH</a> as a new section to explain how you can deploy your codes from a non-Java client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#distributed-data-structures">Distributed Data Structures</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#reliable-topic">Reliable Topic</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enhanced the content to clarify the relation between Reliable Topic and Ringbuffer data structures.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#map">Map</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added content for the newly introduced <code>maxIdle</code> parameter for the put operation. See the <a href="#evicting-specific-entries">Evicting Specific Entries section</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#distributed-query">Distributed Query</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <a href="#using-this-as-an-attribute">Using "this" as an Attribute</a> as a new section to explain how you can use the keyword "this" in your queries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hazelcast-jcache">Hazelcast JCache</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#defining-a-custom-expirypolicy">Defining a Custom ExpiryPolicy</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updated the content to mention about the method <code>setExpiryPolicy</code> which associates certain keys with custom expiry policies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#jcache-api">JCache API</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added content related to eager expiration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#storage">Storage</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hot-backup">Hot Backup</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <a href="#starting-the-cluster-from-a-hot-backup">Starting the Cluster From a Hot Backup</a> as a new section to explain how you can start your cluster with data from a hot backup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hazelcast-clients">Hazelcast Clients</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#java-client">Java Client</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <a href="#configuring-client-connection-retry">Configuring Client Connection Retry</a> as a new section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#serialization">Serialization</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <a href="#untrusted-deserialization-protection">Untrusted Deserialization Protection</a> as a new section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#management">Management</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <a href="#map-index-statistics">Map Index Statistics</a> as a new section describing how to access map index statistics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#diagnostics">Diagnostics</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added content for the new <a href="#operationthreadsamples">OperationThreadSamples</a> plugin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#security">Security</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#tlsssl">TLS/SSL</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performed a full review and updated the content to include the new properties <code>keyStoreType</code> and <code>trustStoreType</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <a href="#using-boringssl">Using BoringSSL</a> as a new section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#wan">WAN</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added URL information to synchronize all the maps in source and target clusters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <a href="#delta-wan-synchronization">Delta WAN Synchronization</a> as a new section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#configuring-consumer">Configuring Consumer</a> and <a href="#event-filtering-api">Event Filtering API</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added content related to the new event type <code>LOADED</code> and configuration element <code>persist-wan-replicated-data</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added the REST URL for clearing the event queues. See the <a href="#queue-capacity">Queue Capacity section</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#hazelcast-plugins">Hazelcast Plugins</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added as a new chapter to describe the plugins using which you can extend Hazelcast IMDGs functionalities.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#system-properties">System Properties</a></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added definitions for the following system properties:</p>
<p class="tableblock">* hazelcast.socket.buffer.direct</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a><a class="link" href="#getting-started">2. Getting Started</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to install Hazelcast and start a Hazelcast member and client. It describes the executable files in the download package and also provides the fundamentals for configuring Hazelcast and its deployment options.</p>
</div>
<div class="sect2">
<h3 id="installation"><a class="anchor" href="#installation"></a><a class="link" href="#installation">2.1. Installation</a></h3>
<div class="paragraph">
<p>The following sections explain the installation of Hazelcast IMDG and Hazelcast IMDG Enterprise. It also includes notes and changes to consider when upgrading Hazelcast.</p>
</div>
<div class="sect3">
<h4 id="installing-hazelcast-imdg"><a class="anchor" href="#installing-hazelcast-imdg"></a><a class="link" href="#installing-hazelcast-imdg">2.1.1. Installing Hazelcast IMDG</a></h4>
<div class="paragraph">
<p>You can find Hazelcast in standard Maven repositories. If your project uses Maven, you do not need to add
additional repositories to your <code>pom.xml</code> or add <code>hazelcast-&lt;version&gt;.jar</code> file into your
classpath (Maven does that for you). Just add the following lines to your <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
   <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>com.hazelcast<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>hazelcast<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;version&gt;</span>Hazelcast IMDG Version To Be Installed<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative, you can download and install Hazelcast IMDG yourself. You only need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download the package <code>hazelcast-&lt;version&gt;.zip</code> or <code>hazelcast-&lt;version&gt;.tar.gz</code> from <a href="https://hazelcast.org/download">hazelcast.org</a>.</p>
</li>
<li>
<p>Extract the downloaded <code>hazelcast-&lt;version&gt;.zip</code> or <code>hazelcast-&lt;version&gt;.tar.gz</code>.</p>
</li>
<li>
<p>Add the file <code>hazelcast-&lt;version&gt;.jar</code> to your classpath.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="installing-hazelcast-imdg-enterprise"><a class="anchor" href="#installing-hazelcast-imdg-enterprise"></a><a class="link" href="#installing-hazelcast-imdg-enterprise">2.1.2. Installing Hazelcast IMDG Enterprise</a></h4>
<div class="paragraph">
<p>There are two Maven repositories defined for Hazelcast IMDG Enterprise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;repository&gt;
   &lt;id&gt;Hazelcast Private Snapshot Repository&lt;/id&gt;
   &lt;url&gt;https:<span class="comment">//repository-hazelcast-l337.forge.cloudbees.com/snapshot/&lt;/url&gt;</span>
&lt;/repository&gt;
&lt;repository&gt;
   &lt;id&gt;Hazelcast Private Release Repository&lt;/id&gt;
   &lt;url&gt;https:<span class="comment">//repository-hazelcast-l337.forge.cloudbees.com/release/&lt;/url&gt;</span>
&lt;/repository&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hazelcast IMDG Enterprise customers may also define dependencies, a sample of which is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;dependency&gt;
   &lt;groupId&gt;com.hazelcast&lt;/groupId&gt;
   &lt;artifactId&gt;hazelcast-enterprise&lt;/artifactId&gt;
   &lt;version&gt;Hazelcast IMDG Enterprise Version To Be Installed&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
   &lt;groupId&gt;com.hazelcast&lt;/groupId&gt;
   &lt;artifactId&gt;hazelcast-enterprise-all&lt;/artifactId&gt;
   &lt;version&gt;Hazelcast IMDG Enterprise Version To Be Installed&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="setting-the-license-key"><a class="anchor" href="#setting-the-license-key"></a><a class="link" href="#setting-the-license-key">2.1.3. Setting the License Key</a></h4>
<div class="paragraph">
<p>Hazelcast IMDG Enterprise offers you two types of licenses: <strong>Enterprise</strong> and <strong>Enterprise HD</strong>. The supported features differ in your Hazelcast setup according to the license type you own.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Enterprise license</strong>: In addition to the open source edition of Hazelcast, Enterprise features are the following:</p>
<div class="ulist">
<ul>
<li>
<p>Security</p>
</li>
<li>
<p>WAN Replication</p>
</li>
<li>
<p>Clustered REST</p>
</li>
<li>
<p>Clustered JMX</p>
</li>
<li>
<p>Striim Hot Cache</p>
</li>
<li>
<p>Rolling Upgrades</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Enterprise HD license</strong>: In addition to the Enterprise features, Enterprise HD features are the following:</p>
<div class="ulist">
<ul>
<li>
<p>High-Density Memory Store</p>
</li>
<li>
<p>Hot Restart Persistence</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use Hazelcast IMDG Enterprise, you need to set the provided license key using one of the configuration methods shown below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hazelcast IMDG Enterprise license keys are required only for members. You do not need to set a license key for your Java clients for which you want to use IMDG Enterprise features.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration:</strong></p>
</div>
<div class="paragraph">
<p>Add the below line to any place you like in the file <code>hazelcast.xml</code>. This XML file offers you a declarative way to configure your Hazelcast. It is included in the Hazelcast download package. When you extract the downloaded package, you will see the file <code>hazelcast.xml</code> under the <code>/bin</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  ...
  <span class="tag">&lt;license-key&gt;</span>Your Enterprise License Key<span class="tag">&lt;/license-key&gt;</span>
  ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration:</strong></p>
</div>
<div class="paragraph">
<p>Alternatively, you can set your license key programmatically as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
config.setLicenseKey( <span class="string"><span class="delimiter">&quot;</span><span class="content">Your Enterprise License Key</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Spring XML Configuration:</strong></p>
</div>
<div class="paragraph">
<p>If you are using Spring with Hazelcast, then you can set the license key using the Spring XML schema, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:config&gt;</span>
  ...
  <span class="tag">&lt;hz:license-key&gt;</span>Your Enterprise License Key<span class="tag">&lt;/hz:license-key&gt;</span>
  ...
<span class="tag">&lt;/hz:config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>JVM System Property:</strong></p>
</div>
<div class="paragraph">
<p>As another option, you can set your license key using the below command (the "-D" command line option).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.enterprise.license.key=Your Enterprise License <span class="predefined-type">Key</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="license-key-format"><a class="anchor" href="#license-key-format"></a><a class="link" href="#license-key-format">License Key Format</a></h5>
<div class="paragraph">
<p>License keys have the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;<span class="predefined-type">Name</span> of the Hazelcast edition&gt;<span class="error">#</span>&lt;Count of the Members&gt;<span class="error">#</span>&lt;License key&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The strings before the <code>&lt;License key&gt;</code> is the human readable part. You can use your license key with or without this human readable part. So, both the following example license keys are valid:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastEnterpriseHD<span class="error">#</span><span class="integer">2</span>Nodes<span class="error">#</span><span class="integer">1</span>q2w3e4r5t</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="integer">1</span>q2w3e4r5t</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="license-info"><a class="anchor" href="#license-info"></a><a class="link" href="#license-info">2.1.4. License Information</a></h4>
<div class="paragraph">
<p>License information is available through the following Hazelcast APIs.</p>
</div>
<div class="sect4">
<h5 id="jmx"><a class="anchor" href="#jmx"></a><a class="link" href="#jmx">JMX</a></h5>
<div class="paragraph">
<p>The MBean <code>HazelcastInstance.LicenseInfo</code> holds all the relative license details and can be accessed through Hazelcast&#8217;s JMX port (if enabled).</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>maxNodeCountAllowed</code>: Maximum members allowed to form a cluster under the current license.</p>
</li>
<li>
<p><code>expiryDate</code>: Expiration date of the current license.</p>
</li>
<li>
<p><code>typeCode</code>: Type code of the current license.</p>
</li>
<li>
<p><code>type</code>: Type of the current license.</p>
</li>
<li>
<p><code>ownerEmail</code>: Email of the current licence&#8217;s owner.</p>
</li>
<li>
<p><code>companyName</code>: Company name on the current license.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following is the list of license `type`s and `typeCode`s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MANAGEMENT_CENTER(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Management Center</span><span class="delimiter">&quot;</span></span>),
ENTERPRISE(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Enterprise</span><span class="delimiter">&quot;</span></span>),
ENTERPRISE_SECURITY_ONLY(<span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Enterprise only with security</span><span class="delimiter">&quot;</span></span>),
ENTERPRISE_HD(<span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Enterprise HD</span><span class="delimiter">&quot;</span></span>),
CUSTOM(<span class="integer">4</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Custom</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="rest"><a class="anchor" href="#rest"></a><a class="link" href="#rest">REST</a></h5>
<div class="paragraph">
<p>You can access the license details by issuing a <code>GET</code> request through the REST API (if enabled) on the <code>/license</code> resource, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">curl -v -X GET -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type: text/plain</span><span class="delimiter">&quot;</span></span> http:<span class="comment">//localhost:5701/hazelcast/licence</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Its output is similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Note: Unnecessary use of -X or --request, GET is already inferred.
*   Trying <span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>...
* TCP_NODELAY set
* Connected to localhost (<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>) port <span class="integer">5701</span> (<span class="error">#</span><span class="integer">0</span>)
&gt; GET /hazelcast/licence HTTP/<span class="float">1.1</span>
&gt; Host: localhost:<span class="integer">5701</span>
&gt; User-Agent: curl/<span class="float">7.58</span><span class="float">.0</span>
&gt; Accept: *<span class="comment">/*
&gt; Content-Type: text/plain
&gt;
&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/plain
&lt; Content-Length: 105
&lt;

licenseInfo{&quot;expiryDate&quot;:1560380399161,&quot;maxNodeCount&quot;:10,&quot;type&quot;:-1,&quot;companyName&quot;:&quot;ExampleCompany&quot;,&quot;ownerEmail&quot;:&quot;ExampleOwner&quot;}
</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="logs"><a class="anchor" href="#logs"></a><a class="link" href="#logs">Logs</a></h5>
<div class="paragraph">
<p>Besides the above approaches (JMX and REST) to access the license details, Hazelcast also starts to log a license information banner into the log files when the license expiration is approaching.</p>
</div>
<div class="paragraph">
<p>During the last two months prior to the expiration, this license information banner is logged daily, as a reminder to renew your license to avoid any interruptions. Once the expiration is due to a month, the frequency of logging this banner becomes hourly (instead of daily). Lastly, when the expiration is due in a week, this banner will be printed every 30 minutes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Similar alerts are also present on the Hazelcast Management Center.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The banner has the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span> WARNING <span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span>
HAZELCAST LICENSE WILL EXPIRE IN <span class="integer">29</span> DAYS.
Your Hazelcast cluster will stop working after <span class="local-variable">this</span> time.

Your license holder is customer<span class="annotation">@example</span>-company.com, you should have them contact
our license renewal department, urgently on info<span class="annotation">@hazelcast</span>.com
or call us on +<span class="integer">1</span> (<span class="integer">650</span>) <span class="integer">521</span>-<span class="integer">5453</span>

Please quote license id CUSTOM_TEST_KEY

<span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please pay attention to the license warnings to prevent any possible interruptions in the operation of your Hazelcast applications.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="supported-jvms"><a class="anchor" href="#supported-jvms"></a><a class="link" href="#supported-jvms">2.2. Supported Java Virtual Machines</a></h3>
<div class="paragraph">
<p>Following table summarizes the version compatibility between Hazelcast IMDG and various vendors' Java Virtual Machines (JVMs).</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Supported JVMs</caption>
<colgroup>
<col style="width: 35%;">
<col style="width: 10%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 15%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hazelcast IMDG Version</th>
<th class="tableblock halign-left valign-top">JDK Version</th>
<th class="tableblock halign-left valign-top">Oracle JDK</th>
<th class="tableblock halign-left valign-top">IBM SDK, Java Technology Edition</th>
<th class="tableblock halign-left valign-top">Azul Zing JDK</th>
<th class="tableblock halign-left valign-top">Azul Zulu OpenJDK</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Up to 4.0</p>
<p class="tableblock">(<em>JDK 6 support will be dropped with the release of Hazelcast IMDG 4.0</em>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Up to current</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Up to current</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>3.11 and newer:  Fully supported.</p>
</li>
<li>
<p>3.10 and older: Partially supported.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p>
<p class="tableblock">(JDK not available yet)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p>
<p class="tableblock">(JDK not available yet)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>3.11 and newer:  Fully supported.</p>
</li>
<li>
<p>3.10 and older: Partially supported.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p>
<p class="tableblock">(JDK not available yet)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p>
<p class="tableblock">(JDK not available yet)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="ulist">
<ul>
<li>
<p>3.11 and newer:  Fully supported.</p>
</li>
<li>
<p>3.10 and older: Partially supported.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p>
<p class="tableblock">(JDK not available yet)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p>
<p class="tableblock">(JDK not available yet)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-times"></i></span></p>
<p class="tableblock">(JDK not available yet)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hazelcast IMDG 3.10 and older releases are not fully tested on JDK 9 and newer, so there may be some features that are not working properly.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See the following sections for the details of Hazelcast IMDG supporting JDK 9 and newer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#running-in-modular-java">Running in Modular Java</a>: Talks about the new module system present in Java 9 and newer and how you can run a Hazelcast application on it.</p>
</li>
<li>
<p><a href="#tls-ssl-for-hazelcast-members">TLS/SSL for Hazelcast Members</a>: Lists <code>TLSv1.3</code>, which comes with Java 11, as a supported TLS version.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="running-in-modular-java"><a class="anchor" href="#running-in-modular-java"></a><a class="link" href="#running-in-modular-java">2.3. Running in Modular Java</a></h3>
<div class="paragraph">
<p>Java <a href="http://openjdk.java.net/projects/jigsaw/">project Jigsaw</a> brought a new Module System into Java 9 and newer. Hazelcast supports running in the modular environment. If you want to run your application with Hazelcast libraries on the modulepath, use following module names:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.hazelcast.core</code> for <code>hazelcast-&lt;version&gt;.jar</code> and <code>hazelcast-enterprise-&lt;version&gt;.jar</code></p>
</li>
<li>
<p><code>com.hazelcast.client</code> for <code>hazelcast-client-&lt;version&gt;.jar</code> and <code>hazelcast-enterprise-client-&lt;version&gt;.jar</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Don&#8217;t use <code>hazelcast-all-&lt;version&gt;.jar</code> or <code>hazelcast-enterprise-all-&lt;version&gt;.jar</code> on the modulepath as it could lead to problems in module dependencies for your application. You can still use them on the classpath.</p>
</div>
<div class="paragraph">
<p>The Java Module System comes with stricter visibility rules. It affects Hazelcast which uses internal Java API to reach the best performance results.</p>
</div>
<div class="paragraph">
<p>Hazelcast needs <code>java.se</code> module and access to the following Java packages for a proper work:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.base/jdk.internal.ref</code></p>
</li>
<li>
<p><code>java.base/java.nio</code> <em>(reflective access)</em></p>
</li>
<li>
<p><code>java.base/sun.nio.ch</code> <em>(reflective access)</em></p>
</li>
<li>
<p><code>java.base/java.lang</code> <em>(reflective access)</em></p>
</li>
<li>
<p><code>jdk.management/com.sun.management.internal</code> <em>(reflective access)</em></p>
</li>
<li>
<p><code>java.management/sun.management</code> <em>(reflective access)</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can provide the access to the above mentioned packages by using <code>--add-exports</code> and <code>--add-opens</code> (for the reflective access) Java arguments.</p>
</div>
<div class="paragraph">
<p><strong>Example: Running a member on the classpath</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java --add-modules java.se \
  --add-exports java.base/jdk.internal.ref=ALL-UNNAMED \
  --add-opens java.base/java.lang=ALL-UNNAMED \
  --add-opens java.base/java.nio=ALL-UNNAMED \
  --add-opens java.base/sun.nio.ch=ALL-UNNAMED \
  --add-opens java.management/sun.management=ALL-UNNAMED \
  --add-opens jdk.management/com.sun.management.internal=ALL-UNNAMED \
  -jar hazelcast-&lt;version&gt;.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example: Running a member on the modulepath</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java --add-modules java.se \
  --add-exports java.base/jdk.internal.ref=com.hazelcast.core \
  --add-opens java.base/java.lang=com.hazelcast.core \
  --add-opens java.base/java.nio=com.hazelcast.core \
  --add-opens java.base/sun.nio.ch=com.hazelcast.core \
  --add-opens java.management/sun.management=com.hazelcast.core \
  --add-opens jdk.management/com.sun.management.internal=com.hazelcast.core \
  --module-path lib \
  --module com.hazelcast.core/com.hazelcast.core.server.StartServer</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>This example expects <code>hazelcast-&lt;version&gt;.jar</code> placed in the <code>lib</code> directory.</em></p>
</div>
</div>
<div class="sect2">
<h3 id="upgrading-from-3x"><a class="anchor" href="#upgrading-from-3x"></a><a class="link" href="#upgrading-from-3x">2.4. Upgrading from 3.x</a></h3>
<div class="ulist">
<ul>
<li>
<p><strong>Upgrading from 3.6.x to 3.7.x when using <code>JCache</code>:</strong> Hazelcast 3.7 introduced changes in <code>JCache</code> implementation which broke compatibility of 3.6.x clients to 3.7-3.7.2 cluster members and vice versa, so 3.7-3.7.2 clients are also incompatible with 3.6.x cluster members. This issue only affects Java clients which use <code>JCache</code> functionality.</p>
<div class="paragraph">
<p>Starting with Hazelcast 3.7.3, a compatibility option is provided which can be used to ensure backwards compatibility with 3.6.x clients.</p>
</div>
<div class="paragraph">
<p>In order to upgrade a 3.6.x cluster and clients to 3.7.3 (or later), you will need to use this compatibility option on either the member or the client side, depending on which one is upgraded first:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first upgrade your cluster members to 3.7.3, adding property <code>hazelcast.compatibility.3.6.client=true</code> to your configuration; when started with this property, cluster members are compatible with 3.6.x and 3.7.3+ clients but not with 3.7-3.7.2 clients. Once your cluster is upgraded, you may upgrade your applications to use client version 3.7.3+.</p>
</li>
<li>
<p>upgrade your clients from 3.6.x to 3.7.3, adding property <code>hazelcast.compatibility.3.6.server=true</code> to your Hazelcast client configuration. A 3.7.3 client started with this compatibility option is compatible with 3.6.x and 3.7.3+ cluster members but incompatible with 3.7-3.7.2 cluster members. Once your clients are upgraded, you may then proceed to upgrade your cluster members to version 3.7.3 or later.</p>
<div class="paragraph">
<p>You may use any of the supported ways as described in the <a href="#system-properties">System Properties section</a> to configure the compatibility option. When done upgrading your cluster and clients, you may remove the compatibility property from your Hazelcast member configuration.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Upgrading from 3.6.x to 3.8.x EE when using <code>JCache</code>:</strong> Due to a compatibility problem CacheConfig serialization may not work if your member is 3.8.x where x &lt; 5. Hence, you will need to use the 3.8.5 or higher version where the problem is being fixed.</p>
</li>
<li>
<p><strong>Introducing the <code>spring-aware</code> element:</strong> Before the release 3.5, Hazelcast uses <code>SpringManagedContext</code> to scan <code>SpringAware</code> annotations by default. This may cause some performance overhead for the users who do not use <code>SpringAware</code>.
This behavior has been changed with the release of Hazelcast 3.5. <code>SpringAware</code> annotations are disabled by default. By introducing the <code>spring-aware</code> element, now it is possible to enable it by adding the <code>&lt;hz:spring-aware /&gt;</code> tag to the configuration. Please see the <a href="#spring-integration">Spring Integration section</a>.</p>
</li>
<li>
<p><strong>Introducing new configuration options for WAN replication:</strong> Starting with Hazelcast 3.6, WAN replication related system properties, which are configured on a per member basis, can now be configured per target cluster. The 4 system properties below are no longer valid.</p>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.enterprise.wanrep.batch.size</code>, please see the <a href="#batch-size">WAN Replication Batch Size</a>.</p>
</li>
<li>
<p><code>hazelcast.enterprise.wanrep.batchfrequency.seconds</code>, please see the <a href="#batch-maximum-delay">WAN Replication Batch Maximum Delay</a>.</p>
</li>
<li>
<p><code>hazelcast.enterprise.wanrep.optimeout.millis</code>, please see the <a href="#response-timeout">WAN Replication Response Timeout</a>.</p>
</li>
<li>
<p><code>hazelcast.enterprise.wanrep.queue.capacity</code>, please see the <a href="#queue-capacity">WAN Replication Queue Capacity</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Removal of deprecated getId() method</strong>: The method <code>getId()</code> in the interface <code>DistributedObject</code> has been removed. Please use the method <code>getName()</code> instead.</p>
</li>
<li>
<p><strong>Change in the Custom Serialization in the C++ Client Distribution</strong>: Before, the method <code>getTypeId()</code> was used to retrieve the ID of the object to be serialized. Now, the method <code>getHazelcastTypeId()</code> is used and you give your object as a parameter to this new method. Also, <code>getTypeId()</code> was used in your custom serializer class, now it has been renamed to <code>getHazelcastTypeId()</code> too. Note that, these changes also apply when you want to switch from Hazelcast 3.6.1 to 3.6.2 too.</p>
</li>
<li>
<p><strong>Important note about Hazelcast System Properties:</strong> Even Hazelcast has not been recommending the usage of <code>GroupProperties.java</code> class while benefiting from System Properties, there has been a change to inform to the users who have been using this class. Starting with Hazelcast 3.7, the class <code>GroupProperties.java</code> has been replaced by <code>GroupProperty.java</code>.
In this new class, system properties are instances of the newly introduced <code>HazelcastProperty</code> object. You can access the names of these properties by calling <code>getName()</code> method of <code>HazelcastProperty</code>.</p>
</li>
<li>
<p><strong>Removal of WanNoDelayReplication</strong>: <code>WanNoDelayReplication</code> implementation of Hazelcast&#8217;s WAN Replication has been removed starting with Hazelcast 3.7. You can still achieve this behavior by setting the batch size to <code>1</code> while configuring the WanBatchReplication. Please refer to the <a href="#defining-wan-replication">Defining WAN Replication section</a> for more information.</p>
</li>
<li>
<p><strong>Introducing &lt;wan-publisher&gt; element</strong>: Starting with Hazelcast 3.8, the configuration element <code>&lt;target-cluster&gt;</code> is replaced with the element <code>&lt;wan-publisher&gt;</code> in WAN replication configuration.</p>
</li>
<li>
<p><strong>WaitNotifyService</strong> interface has been renamed as <strong>OperationParker</strong>.</p>
</li>
<li>
<p><strong>Synchronizing WAN Target Cluster</strong>: Starting with Hazelcast 3.8 release, the URL for the REST call has been changed from
<code><a href="http://member_ip:port/hazelcast/rest/wan/sync/map" class="bare">http://member_ip:port/hazelcast/rest/wan/sync/map</a></code> to <code><a href="http://member_ip:port/hazelcast/rest/mancenter/wan/sync/map" class="bare">http://member_ip:port/hazelcast/rest/mancenter/wan/sync/map</a></code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="upgrading-from-2x"><a class="anchor" href="#upgrading-from-2x"></a><a class="link" href="#upgrading-from-2x">2.5. Upgrading from 2.x</a></h3>
<div class="ulist">
<ul>
<li>
<p><strong>Removal of deprecated static methods:</strong> The static methods of Hazelcast class reaching Hazelcast data components have been removed. The functionality of these methods can be reached from the HazelcastInstance interface. You should replace the following:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; customers = Hazelcast.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
<span class="comment">// or if you already started an instance named &quot;instance1&quot;</span>
<span class="comment">// HazelcastInstance hazelcastInstance = Hazelcast.getHazelcastInstanceByName( &quot;instance1&quot; );</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; customers = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Renaming "instance" to "distributed object":</strong> Before 3.0 there was confusion about the term "instance": it was used for both the cluster members and the distributed objects (map, queue, topic, etc. instances). Starting with Hazelcast 3.0, the term instance will be only used for Hazelcast instances, namely cluster members. We will use the term "distributed object" for map, queue, etc. instances. You should replace the related methods with the new renamed ones. 3.0 clients are smart clients in that they know in which cluster member the data is located, so you can replace your lite members with native clients.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main( <span class="predefined-type">String</span><span class="type">[]</span> args ) <span class="directive">throws</span> <span class="exception">InterruptedException</span> {
  HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
  IMap map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span> );
  <span class="predefined-type">Collection</span>&lt;Instance&gt; instances = hazelcastInstance.getInstances();
  <span class="keyword">for</span> ( Instance instance : instances ) {
    <span class="keyword">if</span> ( instance.getInstanceType() == Instance.InstanceType.MAP ) {
      <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">There is a map with name: </span><span class="delimiter">&quot;</span></span> + instance.getId() );
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main( <span class="predefined-type">String</span><span class="type">[]</span> args ) <span class="directive">throws</span> <span class="exception">InterruptedException</span> {
  HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
  IMap map = hz.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span> );
  <span class="predefined-type">Collection</span>&lt;DistributedObject&gt; objects = hazelcastInstance.getDistributedObjects();
  <span class="keyword">for</span> ( DistributedObject distributedObject : objects ) {
    <span class="keyword">if</span> ( distributedObject <span class="keyword">instanceof</span> IMap ) {
      <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">There is a map with name: </span><span class="delimiter">&quot;</span></span> + distributedObject.getName() );
    }
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Package structure change:</strong>
PartitionService has been moved to package <code>com.hazelcast.core</code> from <code>com.hazelcast.partition</code>.</p>
</li>
<li>
<p><strong>Listener API change:</strong> Before 3.0, <code>removeListener</code> methods were taking the Listener object as a parameter. But this caused confusion because same listener object may be used as a parameter for different listener registrations. So we have changed the listener API. <code>addListener</code> methods returns a unique ID and you can remove a listener by using this ID. So you should do the following replacement if needed:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span> );
map.addEntryListener( listener, <span class="predefined-constant">true</span> );
map.removeEntryListener( listener );</code></pre>
</div>
</div>
<div class="paragraph">
<p>with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span> );
<span class="predefined-type">String</span> listenerId = map.addEntryListener( listener, <span class="predefined-constant">true</span> );
map.removeEntryListener( listenerId );</code></pre>
</div>
</div>
</li>
<li>
<p><strong>IMap changes:</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>tryRemove(K key, long timeout, TimeUnit timeunit)</code> returns boolean indicating whether operation is successful.</p>
</li>
<li>
<p><code>tryLockAndGet(K key, long time, TimeUnit timeunit)</code> is removed.</p>
</li>
<li>
<p><code>putAndUnlock(K key, V value)</code> is removed.</p>
</li>
<li>
<p><code>lockMap(long time, TimeUnit timeunit)</code> and <code>unlockMap()</code> are removed.</p>
</li>
<li>
<p><code>getMapEntry(K key)</code> is renamed as <code>getEntryView(K key)</code>. The returned object&#8217;s type, MapEntry class is renamed as EntryView.</p>
</li>
<li>
<p>There is no predefined names for merge policies. You just give the full class name of the merge policy implementation:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;merge-policy&gt;com.hazelcast.map.merge.PassThroughMergePolicy&lt;/merge-policy&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also MergePolicy interface has been renamed to MapMergePolicy and also returning null from the implemented <code>merge()</code> method causes the existing entry to be removed.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>IQueue changes:</strong> There is no change on IQueue API but there are changes on how <code>IQueue</code> is configured. With Hazelcast 3.0 there will be no backing map configuration for queue. Settings like backup count will be directly configured on queue config. For queue configuration details, please see the <a href="#queue">Queue section</a>.</p>
</li>
<li>
<p><strong>Transaction API change:</strong> In Hazelcast 3.0, transaction API is completely different. Please see the <a href="#transactions">Transactions chapter</a>.</p>
</li>
<li>
<p><strong>ExecutorService API change:</strong> Classes MultiTask and DistributedTask have been removed. All the functionality is supported by the newly presented interface IExecutorService. Please see the <a href="#executor-service">Executor Service section</a>.</p>
</li>
<li>
<p><strong>LifeCycleService API:</strong> The lifecycle has been simplified. <code>pause()</code>, <code>resume()</code>, <code>restart()</code> methods have been removed.</p>
</li>
<li>
<p><strong>AtomicNumber:</strong> <code>AtomicNumber</code> class has been renamed to <code>IAtomicLong</code>.</p>
</li>
<li>
<p><strong>ICountDownLatch:</strong> <code>await()</code> operation has been removed. We expect users to use <code>await()</code> method with timeout parameters.</p>
</li>
<li>
<p><strong>ISemaphore API:</strong> The <code>ISemaphore</code> has been substantially changed. <code>attach()</code>, <code>detach()</code> methods have been removed.</p>
<div class="ulist">
<ul>
<li>
<p>In 2.x releases, the default value for <code>max-size</code> eviction policy was <strong>cluster_wide_map_size</strong>. In 3.x releases, default is <strong>PER_NODE</strong>. After upgrading, the <code>max-size</code> should be set according to this new default, if it is not changed. Otherwise, it is likely that OutOfMemory exception may be thrown.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="starting-the-member-and-client"><a class="anchor" href="#starting-the-member-and-client"></a><a class="link" href="#starting-the-member-and-client">2.6. Starting the Member and Client</a></h3>
<div class="paragraph">
<p>Having installed Hazelcast, you can get started.</p>
</div>
<div class="paragraph">
<p>In this short tutorial, you perform the following activities.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a simple Java application using the Hazelcast distributed map and queue.</p>
</li>
<li>
<p>Run our application twice to have a cluster with two members (JVMs).</p>
</li>
<li>
<p>Connect to our cluster from another Java application by using the Hazelcast Native Java Client API.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let&#8217;s begin.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The following code starts the first Hazelcast member and creates and uses the <code>customers</code> map and queue.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in getting_started.adoc - include::{javasource}/GettingStartedMember.java[tag=startmember]</code></pre>
</div>
</div>
</li>
<li>
<p>Run this <code>GettingStarted</code> class a second time to get the second member
started. The members form a cluster and the output is similar to the following.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Members {size:<span class="integer">2</span>, ver:<span class="integer">2</span>} [
    <span class="predefined-type">Member</span> [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5701</span> - e40081de-<span class="octal">056</span>a-<span class="integer">4</span>ae5-<span class="float">8f</span>fe-<span class="integer">632</span>caf8a6cf1 <span class="local-variable">this</span>
    <span class="predefined-type">Member</span> [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5702</span> - <span class="float">93e82109</span>-<span class="integer">16</span>bf-<span class="integer">4</span>b16-<span class="integer">9</span>c87-f4a6d0873080
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, you can see the size of your cluster (<code>size</code>) and member list version (<code>ver</code>). The member list version will be incremented when changes happen to the cluster, e.g., a member leaving from or joining to the cluster.</p>
</div>
<div class="paragraph">
<p>The above member list format is introduced with Hazelcast 3.9. You can enable the legacy member list format,  which was used for the releases before Hazelcast 3.9, using the system property <code>hazelcast.legacy.memberlist.format.enabled</code>. Please see the <a href="#system-properties">System Properties appendix</a>. The following is an example for the legacy member list format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Members [<span class="integer">2</span>] {
    <span class="predefined-type">Member</span> [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5701</span> - c1ccc8d4-a549-<span class="integer">4</span>bff-bf46-<span class="float">9213e14</span>a9fd2 <span class="local-variable">this</span>
    <span class="predefined-type">Member</span> [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5702</span> - <span class="integer">33</span>a82dbf-<span class="float">85d</span><span class="integer">6</span>-<span class="integer">4780</span>-b9cf-e47d42fb89d4
}</code></pre>
</div>
</div>
</li>
<li>
<p>Now, add the <code>hazelcast-client-</code><strong><code>&lt;version&gt;</code></strong><code>.jar</code> library to your classpath.
This is required to use a Hazelcast client.</p>
</li>
<li>
<p>The following code starts a Hazelcast Client, connects to our cluster,
and prints the size of the <code>customers</code> map.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">GettingStartedClient</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main( <span class="predefined-type">String</span><span class="type">[]</span> args ) {
        ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
        HazelcastInstance client = HazelcastClient.newHazelcastClient( clientConfig );
        IMap map = client.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span> );
        <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">Map Size:</span><span class="delimiter">&quot;</span></span> + map.size() );
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>When you run it, you see the client properly connecting to the cluster
and printing the map size as <strong>3</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hazelcast also offers a tool, <strong>Management Center</strong>, that enables you to monitor your cluster.
You can download it from Hazelcast website&#8217;s <a href="https://hazelcast.org/download/#management-center">download page</a>.
You can use it to monitor your maps, queues and other distributed data structures and members. Please
see the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html">Hazelcast Management Center Reference Manual</a> for usage explanations.</p>
</div>
<div class="paragraph">
<p>By default, Hazelcast uses multicast to discover other members that can form a cluster.  If you are
working with other Hazelcast developers on the same network, you may find yourself joining their
clusters under the default settings.  Hazelcast provides a way to segregate clusters within the same
network when using multicast. Please see the <a href="#creating-cluster-groups">Creating Cluster Groups</a>
for more information.  Alternatively, if you do not wish to use the default multicast mechanism,
you can provide a fixed list of IP addresses that are allowed to join. Please see
the <a href="#join">Join configuration section</a> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Multicast mechanism is not recommended for production since UDP is often blocked in production environments and other discovery mechanisms are more definite. Please see the <a href="#discovery-mechanisms">Discovery Mechanisms section</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also check the video tutorials <a href="https://hazelcast.org/getting-started-with-hazelcast">here</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="using-the-scripts-in-the-package"><a class="anchor" href="#using-the-scripts-in-the-package"></a><a class="link" href="#using-the-scripts-in-the-package">2.7. Using the Scripts In The Package</a></h3>
<div class="paragraph">
<p>When you download and extract the Hazelcast ZIP or TAR.GZ package, you will see the following scripts under the <code>/bin</code> folder that provide basic functionalities for member and cluster management.</p>
</div>
<div class="paragraph">
<p>The following are the names and descriptions of each script:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>start.sh</code> / <code>start.bat</code>: Starts a Hazelcast member with default configuration in the working directory.</p>
</li>
<li>
<p><code>stop.sh</code> / <code>stop.bat</code>: Stops the Hazelcast member that was started in the current working directory.</p>
</li>
<li>
<p><code>cluster.sh</code>: Provides basic functionalities for cluster management, such as getting and changing the cluster state, shutting down the cluster or forcing the cluster to clean its persisted data and make a fresh start. Please refer to the <a href="#using-the-script-cluster-sh">Using the Script cluster.sh section</a> to learn the usage of this script.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>start.sh</code> / <code>start.bat</code> scripts lets you start one Hazelcast instance per folder. To start a new instance, please unzip Hazelcast ZIP or TAR.GZ package in a new folder.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also use the start scripts to deploy your own library to a Hazelcast member from a non-Java client. See the <a href="#adding-user-library-to-classpath">Adding User Library to CLASSPATH section</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="deploying-on-amazon-ec2"><a class="anchor" href="#deploying-on-amazon-ec2"></a><a class="link" href="#deploying-on-amazon-ec2">2.8. Deploying On Amazon EC2</a></h3>
<div class="paragraph">
<p>You can deploy your Hazelcast project onto an Amazon EC2 environment using Third Party tools such as <a href="https://www.vagrantup.com">Vagrant</a> and <a href="https://www.chef.io/chef/">Chef</a>.</p>
</div>
<div class="paragraph">
<p>You can find a sample deployment project (<code>amazon-ec2-vagrant-chef</code>) with step-by-step instructions in the <code>hazelcast-integration</code> folder of the <strong>hazelcast-code-samples</strong> package, which you can download at <a href="https://hazelcast.org/download/">hazelcast.org</a>. Please refer to this sample project for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="deploying-on-microsoft-azure"><a class="anchor" href="#deploying-on-microsoft-azure"></a><a class="link" href="#deploying-on-microsoft-azure">2.9. Deploying On Microsoft Azure</a></h3>
<div class="imageblock">
<div class="content">
<img src="images/Plugin_New.png" alt="Azure Plugin" width="84" height="22">
</div>
</div>
<div class="paragraph">
<p>You can deploy your Hazelcast cluster onto a Microsoft Azure environment. For this, your cluster should make use of Hazelcast Discovery Plugin for Microsoft Azure. You can find information about this plugin on its GitHub repository at <a href="https://github.com/hazelcast/hazelcast-azure">Hazelcast Azure</a>.</p>
</div>
<div class="paragraph">
<p>For information on how to automatically deploy your cluster onto Azure, please see the <a href="https://github.com/hazelcast/hazelcast-azure/blob/master/README.md#automated-deployment">Deployment</a> section of <a href="https://github.com/hazelcast/hazelcast-azure">Hazelcast Azure</a> plugin repository.</p>
</div>
</div>
<div class="sect2">
<h3 id="deploying-on-pivotal-cloud-foundry"><a class="anchor" href="#deploying-on-pivotal-cloud-foundry"></a><a class="link" href="#deploying-on-pivotal-cloud-foundry">2.10. Deploying On Pivotal Cloud Foundry</a></h3>
<div class="imageblock">
<div class="content">
<img src="images/Plugin_New.png" alt="CloudFoundry" width="84" height="22">
</div>
</div>
<div class="paragraph">
<p>Starting with Hazelcast 3.7, you can deploy your Hazelcast cluster onto Pivotal Cloud Foundry. It is available as a Pivotal Cloud Foundry Tile which you can download at <a href="https://network.pivotal.io/products/hazelcast-pcf/">here</a>. You can find the installation and usage instructions and the release notes documents at <a href="https://docs.pivotal.io/partners/hazelcast/index.html">https://docs.pivotal.io/partners/hazelcast/index.html</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="deploying-using-docker"><a class="anchor" href="#deploying-using-docker"></a><a class="link" href="#deploying-using-docker">2.11. Deploying using Docker</a></h3>
<div class="imageblock">
<div class="content">
<img src="images/Plugin_New.png" alt="Docker Plugin" width="84" height="22">
</div>
</div>
<div class="paragraph">
<p>You can deploy your Hazelcast projects using the Docker containers. Hazelcast has the following images on Docker:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hazelcast IMDG</p>
</li>
<li>
<p>Hazelcast IMDG Enterprise</p>
</li>
<li>
<p>Hazelcast Management Center</p>
</li>
<li>
<p>Hazelcast OpenShift</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you pull an image from the Docker registry, you can run your image to start the Management Center or a Hazelcast instance with Hazelcast&#8217;s default configuration. All repositories provide the latest stable releases but you can pull a specific release too. You can also specify environment variables when running the image.</p>
</div>
<div class="paragraph">
<p>If you want to start a customized Hazelcast instance, you can extend the Hazelcast image by providing your own configuration file.</p>
</div>
<div class="paragraph">
<p>This feature is provided as a Hazelcast plugin. Please see its own GitHub repo at <a href="https://github.com/hazelcast/hazelcast-docker">Hazelcast Docker</a> for details on configurations and usages.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hazelcast-overview"><a class="anchor" href="#hazelcast-overview"></a><a class="link" href="#hazelcast-overview">3. Hazelcast Overview</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast is an open source In-Memory Data Grid (IMDG).
It provides elastically scalable distributed In-Memory computing, widely recognized as the fastest and most scalable
approach to application performance. Hazelcast does this in open source.
More importantly, Hazelcast makes distributed computing simple by offering distributed implementations of many
developer-friendly interfaces from Java such as Map, Queue, ExecutorService, Lock and JCache. For example, the Map
interface provides an In-Memory Key Value store which confers many of the advantages of NoSQL in terms of developer
friendliness and developer productivity.</p>
</div>
<div class="paragraph">
<p>In addition to distributing data In-Memory, Hazelcast provides a convenient set of APIs to access the CPUs in your
cluster for maximum processing speed.
Hazelcast is designed to be lightweight and easy to use. Since Hazelcast is delivered as a compact library (JAR) and
since it has no external dependencies other than Java, it easily plugs into your software solution and provides
distributed data structures and distributed computing utilities.</p>
</div>
<div class="paragraph">
<p>Hazelcast is highly scalable and available. Distributed applications can use
Hazelcast for distributed caching, synchronization, clustering, processing, pub/sub messaging, etc. Hazelcast is
implemented in Java and has clients for Java, C/C++, .NET, REST, Python, Go and Node.js. Hazelcast also speaks Memcached protocol. It plugs into Hibernate and can easily be used with any existing database system.</p>
</div>
<div class="paragraph">
<p>If you are looking for in-memory speed, elastic scalability and the developer friendliness of NoSQL, Hazelcast is a
great choice.</p>
</div>
<div class="paragraph">
<p><strong>Hazelcast is Simple</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast is written in Java with no other dependencies. It exposes the same API from the familiar Java util package,
exposing the same interfaces. Just add <code>hazelcast.jar</code> to your classpath and you can quickly enjoy JVMs clustering
and start building scalable applications.</p>
</div>
<div class="paragraph">
<p><strong>Hazelcast is Peer-to-Peer</strong></p>
</div>
<div class="paragraph">
<p>Unlike many NoSQL solutions, Hazelcast is peer-to-peer. There is no master and slave; there is no single point of
failure. All members store equal amounts of data and do equal amounts of processing. You can embed Hazelcast in your
existing application or use it in client and server mode where your application is a client to Hazelcast members.</p>
</div>
<div class="paragraph">
<p><strong>Hazelcast is Scalable</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast is designed to scale up to hundreds and thousands of members. Simply add new members and they will
automatically discover the cluster and will linearly increase both memory and processing capacity. The members maintain
a TCP connection between each other and all communication is performed through this layer.</p>
</div>
<div class="paragraph">
<p><strong>Hazelcast is Fast</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast stores everything in-memory. It is designed to perform very fast reads and updates.</p>
</div>
<div class="paragraph">
<p><strong>Hazelcast is Redundant</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast keeps the backup of each data entry on multiple members. On a member failure, the data is restored from the
backup and the cluster will continue to operate without downtime.</p>
</div>
<div class="sect2">
<h3 id="sharding-in-hazelcast"><a class="anchor" href="#sharding-in-hazelcast"></a><a class="link" href="#sharding-in-hazelcast">3.1. Sharding in Hazelcast</a></h3>
<div class="paragraph">
<p>Hazelcast shards are called Partitions. By default, Hazelcast has 271 partitions. Given a key, we serialize, hash
and mod it with the number of partitions to find the partition which the key belongs to. The partitions themselves are
distributed equally among the members of the cluster. Hazelcast also creates the backups of partitions and distributes
them among members for redundancy.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="#data-partitioning">Data Partitioning section</a> for more information on how Hazelcast partitions
your data.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="hazelcast-topology"><a class="anchor" href="#hazelcast-topology"></a><a class="link" href="#hazelcast-topology">3.2. Hazelcast Topology</a></h3>
<div class="paragraph">
<p>You can deploy a Hazelcast cluster in two ways: Embedded or Client/Server.</p>
</div>
<div class="paragraph">
<p>If you have an application whose main focal point is asynchronous or high performance computing and lots of task
executions, then Embedded deployment is the preferred way. In Embedded deployment, members include both the application and Hazelcast data and services. The advantage of the Embedded deployment is having a low-latency data access.</p>
</div>
<div class="paragraph">
<p>See the below illustration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Embedded.png" alt="Embedded Deployment">
</div>
</div>
<div class="paragraph">
<p>In the Client/Server deployment, Hazelcast data and services are centralized in one or more server members and they are accessed by the application through clients.
You can have a cluster of server members that can be independently created and scaled. Your clients communicate with
these members to reach to Hazelcast data and services on them.</p>
</div>
<div class="paragraph">
<p>See the below illustration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ClientServer.png" alt="Client/Server Deployment">
</div>
</div>
<div class="paragraph">
<p>Hazelcast provides native clients (Java, .NET and C++), Memcache and REST clients, Scala, Python and Node.js client implementations.</p>
</div>
<div class="paragraph">
<p>Client/Server deployment has advantages including more predictable and reliable Hazelcast performance, easier identification of problem causes and, most importantly, better scalability.
When you need to scale in this deployment type, just add more Hazelcast server members. You can address client and server scalability concerns separately.</p>
</div>
<div class="paragraph">
<p>If you want low-latency data access, as in the Embedded deployment, and you also want the scalability advantages of the Client/Server deployment, you can consider defining Near Caches for your clients. This enables the frequently used data to be kept in the client&#8217;s local memory. Please refer to the <a href="#configuring-client-near-cache">Configuring Client Near Cache section</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="why-hazelcast"><a class="anchor" href="#why-hazelcast"></a><a class="link" href="#why-hazelcast">3.3. Why Hazelcast?</a></h3>
<div class="paragraph">
<p><strong>A Glance at Traditional Data Persistence</strong></p>
</div>
<div class="paragraph">
<p>Data is at the core of software systems. In conventional architectures, a relational database persists and provides access to data. Applications are talking directly with a database which has its backup as another machine. To increase performance, tuning or a faster machine is required. This can cost a large amount of money or effort.</p>
</div>
<div class="paragraph">
<p>There is also the idea of keeping copies of data next to the database, which is performed using technologies like external key-value stores or second level caching that help offload the database. However, when the database is saturated or the applications perform mostly "put" operations (writes), this approach is of no use because it insulates the database only from the "get" loads (reads). Even if the applications are read-intensive there can be consistency problems - when data changes, what happens to the cache and how are the changes handled? This is when concepts like time-to-live (TTL) or write-through come in.</p>
</div>
<div class="paragraph">
<p>In the case of TTL, if the access is less frequent than the TTL, the result will always be a cache miss. On the other hand, in the case of write-through caches, if there are more than one of these caches in a cluster, we again will have consistency issues. This can be avoided by having the nodes communicate with each other so that entry invalidations can be propagated.</p>
</div>
<div class="paragraph">
<p>We can conclude that an ideal cache would combine TTL and write-through features. There are several cache servers and in-memory database solutions in this field. However, these are stand-alone single instances with a distribution mechanism that is provided by other technologies to an extent. So, we are back to square one; we experience saturation or capacity issues if the product is a single instance or if consistency is not provided by the distribution.</p>
</div>
<div class="paragraph">
<p><strong>And, there is Hazelcast</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast, a brand new approach to data, is designed around the concept of distribution. Hazelcast shares data around the cluster for flexibility and performance. It is an in-memory data grid for clustering and highly scalable data distribution.</p>
</div>
<div class="paragraph">
<p>One of the main features of Hazelcast is that it does not have a master member. Each cluster member is configured to be the same in terms of functionality. The oldest member (the first member created in the cluster) automatically performs the data assignment to cluster members. If the oldest member dies, the second oldest member takes over.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can come across with the term "master" or "master member" in some sections of this manual. They are used for contextual clarification purposes; please remember that they refer to the "oldest member" which is explained in the above paragraph.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another main feature of Hazelcast is that the data is held entirely in-memory. This is fast. In the case of a failure, such as a member crash, no data will be lost since Hazelcast distributes copies of the data across all the cluster members.</p>
</div>
<div class="paragraph">
<p>As shown in the feature list in the <a href="#distributed-data-structures">Distributed Data Structures chapter</a>, Hazelcast supports a number of distributed data structures and distributed computing utilities. These provide powerful ways of accessing distributed clustered memory and accessing CPUs for true distributed computing.</p>
</div>
<div class="paragraph">
<p><strong>Hazelcast&#8217;s Distinctive Strengths</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hazelcast is open source.</p>
</li>
<li>
<p>Hazelcast is only a JAR file. You do not need to install software.</p>
</li>
<li>
<p>Hazelcast is a library, it does not impose an architecture on Hazelcast users.</p>
</li>
<li>
<p>Hazelcast provides out-of-the-box distributed data structures, such as Map, Queue, MultiMap, Topic, Lock and Executor.</p>
</li>
<li>
<p>There is no "master," meaning no single point of failure in a Hazelcast cluster; each member in the cluster is configured to be functionally the same.</p>
</li>
<li>
<p>When the size of your memory and compute requirements increase, new members can be dynamically joined to the Hazelcast cluster to scale elastically.</p>
</li>
<li>
<p>Data is resilient to member failure. Data backups are distributed across the cluster. This is a big benefit when a member in the cluster crashes as data will not be lost.</p>
</li>
<li>
<p>Members are always aware of each other unlike in traditional key-value caching solutions.</p>
</li>
<li>
<p>You can build your own custom-distributed data structures using the Service Programming Interface (SPI) if you are not happy with the data structures provided.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, Hazelcast has a vibrant open source community enabling it to be continuously developed.</p>
</div>
<div class="paragraph">
<p>Hazelcast is a fit when you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>analytic applications requiring big data processing by partitioning the data.</p>
</li>
<li>
<p>to retain frequently accessed data in the grid.</p>
</li>
<li>
<p>a cache, particularly an open source JCache provider with elastic distributed scalability.</p>
</li>
<li>
<p>a primary data store for applications with utmost performance, scalability and low-latency requirements.</p>
</li>
<li>
<p>an In-Memory NoSQL Key Value Store.</p>
</li>
<li>
<p>publish/subscribe communication at highest speed and scalability between applications.</p>
</li>
<li>
<p>applications that need to scale elastically in distributed and cloud environments.</p>
</li>
<li>
<p>a highly available distributed cache for applications.</p>
</li>
<li>
<p>an alternative to Coherence and Terracotta.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="data-partitioning"><a class="anchor" href="#data-partitioning"></a><a class="link" href="#data-partitioning">3.4. Data Partitioning</a></h3>
<div class="paragraph">
<p>As you read in the <a href="#sharding-in-hazelcast">Sharding in Hazelcast section</a>, Hazelcast shards are called Partitions. Partitions are memory segments that can contain hundreds or thousands of data entries each, depending on the memory capacity of your system. Each Hazelcast partition can have multiple replicas, which are distributed among the cluster members. One of the replicas becomes the <code>primary</code> and other replicas are called <code>backups</code>. Cluster member which owns <code>primary</code> replica of a partition is called <code>partition owner</code>. When you read or write a particular data entry, you transparently talk to the owner of the partition that contains the data entry.</p>
</div>
<div class="paragraph">
<p>By default, Hazelcast offers 271 partitions. When you start a cluster with a single member, it owns all of 271 partitions (i.e., it keeps primary replicas for 271 partitions). The following illustration shows the partitions in a Hazelcast cluster with single member.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/NodePartition.jpg" alt="Single Member with Partitions">
</div>
</div>
<div class="paragraph">
<p>When you start a second member on that cluster (creating a Hazelcast cluster with two members), the partition replicas are distributed as shown in the illustration here.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Partition distributions in the below illustrations are shown for the sake of simplicity and for descriptive purposes. Normally, the partitions are not distributed in any order, as they are shown in these illustrations, but are distributed randomly (they do not have to be sequentially distributed to each member). The important point here is that Hazelcast equally distributes the partition primaries and their backup replicas among the members.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/BackupPartitions.jpg" alt="Cluster with Two Members - Backups are Created">
</div>
</div>
<div class="paragraph">
<p>In the illustration, the partition replicas with black text are primaries and the partition replicas with blue text are backups. The first member has primary replicas of 135 partitions (black) and each of these partitions are backed up in the second member (i.e., the second member owns the backup replicas) (blue). At the same time, the first member also has the backup replicas of the second member&#8217;s primary partition replicas.</p>
</div>
<div class="paragraph">
<p>As you add more members, Hazelcast moves some of the primary and backup partition replicas to the new members one by one, making all members equal and redundant. Thanks to the consistent hashing algorithm, only the minimum amount of partitions will be moved to scale out Hazelcast. The following is an illustration of the partition replica distributions in a Hazelcast cluster with four members.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/4NodeCluster.jpg" alt="Cluster with Four Members">
</div>
</div>
<div class="paragraph">
<p>Hazelcast distributes partitions' primary and backup replicas equally among the members of the cluster. Backup replicas of the partitions are maintained for redundancy.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Your data can have multiple copies on partition primaries and backups, depending on your backup count. Please see the <a href="#backing-up-maps">Backing Up Maps section</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Starting with Hazelcast 3.6, lite members are introduced. Lite members are a new type of members that do not own any partition. Lite members are intended for use in computationally-heavy task executions and listener registrations. Although they do not own any partitions,
they can access partitions that are owned by other members in the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="#enabling-lite-members">Enabling Lite Members section</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="how-the-data-is-partitioned"><a class="anchor" href="#how-the-data-is-partitioned"></a><a class="link" href="#how-the-data-is-partitioned">3.4.1. How the Data is Partitioned</a></h4>
<div class="paragraph">
<p>Hazelcast distributes data entries into the partitions using a hashing algorithm. Given an object key (for example, for a map) or an object name (for example, for a topic or list):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the key or name is serialized (converted into a byte array)</p>
</li>
<li>
<p>this byte array is hashed</p>
</li>
<li>
<p>the result of the hash is mod by the number of partitions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The result of this modulo - <strong>MOD(hash result, partition count)</strong> -  is the partition in which the data will be stored, that is the <strong>partition ID</strong>. For ALL members you have in your cluster, the partition ID for a given key will always be the same.</p>
</div>
</div>
<div class="sect3">
<h4 id="partition-table"><a class="anchor" href="#partition-table"></a><a class="link" href="#partition-table">3.4.2. Partition Table</a></h4>
<div class="paragraph">
<p>When you start a member, a partition table is created within it. This table stores the partition IDs and the cluster members to which they belong. The purpose of this table is to make all members (including lite members) in the cluster aware of this information, making sure that each member knows where the data is.</p>
</div>
<div class="paragraph">
<p>The oldest member in the cluster (the one that started first) periodically sends the partition table to all members. In this way each member in the cluster is informed about any changes to partition ownership. The ownerships may be changed when, for example, a new member joins the cluster, or when a member leaves the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the oldest member of the cluster goes down, the next oldest member sends the partition table information to the other ones.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can configure the frequency (how often) that the member sends the partition table the information by using the <code>hazelcast.partition.table.send.interval</code> system property. The property is set to every 15 seconds by default.</p>
</div>
</div>
<div class="sect3">
<h4 id="repartitioning"><a class="anchor" href="#repartitioning"></a><a class="link" href="#repartitioning">3.4.3. Repartitioning</a></h4>
<div class="paragraph">
<p>Repartitioning is the process of redistribution of partition ownerships. Hazelcast performs the repartitioning in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a member joins to the cluster.</p>
</li>
<li>
<p>When a member leaves the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In these cases, the partition table in the oldest member is updated with the new partition ownerships. Note that if a lite member joins or leaves a cluster, repartitioning is not triggered since lite members do not own any partitions.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="use-cases"><a class="anchor" href="#use-cases"></a><a class="link" href="#use-cases">3.5. Use Cases</a></h3>
<div class="paragraph">
<p>Hazelcast can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to share server configuration/information to see how a cluster performs.</p>
</li>
<li>
<p>to cluster highly changing data with event notifications, e.g., user based events, and to queue and distribute background tasks.</p>
</li>
<li>
<p>as a simple Memcache with Near Cache.</p>
</li>
<li>
<p>as a cloud-wide scheduler of certain processes that need to be performed on some members.</p>
</li>
<li>
<p>to share information (user information, queues, maps, etc.) on the fly with multiple members in different installations under OSGI environments.</p>
</li>
<li>
<p>to share thousands of keys in a cluster where there is a web service interface on an application server and some validation.</p>
</li>
<li>
<p>as a distributed topic (publish/subscribe server) to build scalable chat servers for smartphones.</p>
</li>
<li>
<p>as a front layer for a Cassandra back-end.</p>
</li>
<li>
<p>to distribute user object states across the cluster, to pass messages between objects and to share system data structures (static initialization state, mirrored objects, object identity generators).</p>
</li>
<li>
<p>as a multi-tenancy cache where each tenant has its own map.</p>
</li>
<li>
<p>to share datasets, e.g., table-like data structure, to be used by applications.</p>
</li>
<li>
<p>to distribute the load and collect status from Amazon EC2 servers where the front-end is developed using, for example, Spring framework.</p>
</li>
<li>
<p>as a real-time streamer for performance detection.</p>
</li>
<li>
<p>as storage for session data in web applications (enables horizontal scalability of the web application).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="resources"><a class="anchor" href="#resources"></a><a class="link" href="#resources">3.6. Resources</a></h3>
<div class="ulist">
<ul>
<li>
<p>Hazelcast source code can be found at <a href="https://github.com/hazelcast/hazelcast">Github/Hazelcast</a>.</p>
</li>
<li>
<p>Hazelcast API can be found at <a href="https://www.hazelcast.org/docs/latest-dev/javadoc/">Hazelcast.org/docs/Javadoc</a>.</p>
</li>
<li>
<p>Code samples can be downloaded from <a href="https://hazelcast.org/download/">Hazelcast.org/download</a>.</p>
</li>
<li>
<p>More use cases and resources can be found at <a href="http://www.hazelcast.com">Hazelcast.com</a>.</p>
</li>
<li>
<p>Questions and discussions can be posted at the <a href="https://groups.google.com/forum/#!forum/hazelcast">Hazelcast mail group</a>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="understanding-configuration"><a class="anchor" href="#understanding-configuration"></a><a class="link" href="#understanding-configuration">4. Understanding Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the options to configure your Hazelcast applications and explains the utilities which you can make use of while configuring. You can configure Hazelcast using one or mix of the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declarative way</p>
</li>
<li>
<p>Programmatic way</p>
</li>
<li>
<p>Using Hazelcast system properties</p>
</li>
<li>
<p>Within the Spring context</p>
</li>
<li>
<p>Dynamically adding configuration on a running cluster (starting with Hazelcast 3.9)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="configuring-declaratively"><a class="anchor" href="#configuring-declaratively"></a><a class="link" href="#configuring-declaratively">4.1. Configuring Declaratively</a></h3>
<div class="paragraph">
<p>This is the configuration option where you use an XML configuration file. When you download and unzip <code>hazelcast-&lt;version&gt;.zip</code>, you will see the following files present in <code>/bin</code> folder, which are standard XML-formatted configuration files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.xml</code>: Default declarative configuration file for Hazelcast. The configuration in this XML file should be fine for most of the Hazelcast users. If not, you can tailor this XML file according to your needs by adding/removing/modifying properties.</p>
</li>
<li>
<p><code>hazelcast-full-example.xml</code>: Configuration file which includes all Hazelcast configuration elements and attributes with their descriptions. It is the "superset" of <code>hazelcast.xml</code>. You can use <code>hazelcast-full-example.xml</code> as a reference document to learn about any element or attribute, or you can change its name to <code>hazelcast.xml</code> and start to use it as your Hazelcast configuration file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A part of <code>hazelcast.xml</code> is shown as an example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;group&gt;</span>
    <span class="tag">&lt;name&gt;</span>dev<span class="tag">&lt;/name&gt;</span>
<span class="tag">&lt;/group&gt;</span>
<span class="tag">&lt;management-center</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://localhost:8080/mancenter<span class="tag">&lt;/management-center&gt;</span>
<span class="tag">&lt;network&gt;</span>
     <span class="tag">&lt;port</span> <span class="attribute-name">auto-increment</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>5701<span class="tag">&lt;/port&gt;</span>
     <span class="tag">&lt;outbound-ports&gt;</span>
     <span class="comment">&lt;!--
     Allowed port range when connecting to other members.
     0 or * means the port provided by the system.
     --&gt;</span>
         <span class="tag">&lt;ports&gt;</span>0<span class="tag">&lt;/ports&gt;</span>
     <span class="tag">&lt;/outbound-ports&gt;</span>
     <span class="tag">&lt;join&gt;</span>
         <span class="tag">&lt;multicast</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
             <span class="tag">&lt;multicast-group&gt;</span>224.2.2.3<span class="tag">&lt;/multicast-group&gt;</span>
             <span class="tag">&lt;multicast-port&gt;</span>54327<span class="tag">&lt;/multicast-port&gt;</span>
         <span class="tag">&lt;/multicast&gt;</span>
         <span class="tag">&lt;tcp-ip</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
             <span class="tag">&lt;interface&gt;</span>127.0.0.1<span class="tag">&lt;/interface&gt;</span>
             <span class="tag">&lt;member-list&gt;</span>
                 <span class="tag">&lt;member&gt;</span>127.0.0.1<span class="tag">&lt;/member&gt;</span>
             <span class="tag">&lt;/member-list&gt;</span>
         <span class="tag">&lt;/tcp-ip&gt;</span>
    <span class="tag">&lt;/join&gt;</span>
<span class="tag">&lt;/network&gt;</span>
<span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;time-to-live-seconds&gt;</span>0<span class="tag">&lt;/time-to-live-seconds&gt;</span>
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="composing-declarative-configuration"><a class="anchor" href="#composing-declarative-configuration"></a><a class="link" href="#composing-declarative-configuration">4.1.1. Composing Declarative Configuration</a></h4>
<div class="paragraph">
<p>You can compose the declarative configuration of your Hazelcast member or Hazelcast client from multiple declarative configuration snippets. In order to compose a declarative configuration, you can use the <code>&lt;import/&gt;</code> element to load different declarative configuration files.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you want to compose the declarative configuration for Hazelcast out of two configurations: <code>development-group-config.xml</code> and <code>development-network-config.xml</code>. These two configurations are shown below.</p>
</div>
<div class="paragraph">
<p><code>development-group-config.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;group&gt;</span>
      <span class="tag">&lt;name&gt;</span>dev<span class="tag">&lt;/name&gt;</span>
  <span class="tag">&lt;/group&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>development-network-config.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;network&gt;</span>
    <span class="tag">&lt;port</span> <span class="attribute-name">auto-increment</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port-count</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>5701<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;join&gt;</span>
        <span class="tag">&lt;multicast</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;multicast-group&gt;</span>224.2.2.3<span class="tag">&lt;/multicast-group&gt;</span>
            <span class="tag">&lt;multicast-port&gt;</span>54327<span class="tag">&lt;/multicast-port&gt;</span>
        <span class="tag">&lt;/multicast&gt;</span>
    <span class="tag">&lt;/join&gt;</span>
  <span class="tag">&lt;/network&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To get your example Hazelcast declarative configuration out of the above two, use the <code>&lt;import/&gt;</code> element as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">development-group-config.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">development-network-config.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This feature also applies to the declarative configuration of Hazelcast client. Please see the following examples.</p>
</div>
<div class="paragraph">
<p><code>client-group-config.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast-client&gt;</span>
  <span class="tag">&lt;group&gt;</span>
      <span class="tag">&lt;name&gt;</span>dev<span class="tag">&lt;/name&gt;</span>
  <span class="tag">&lt;/group&gt;</span>
<span class="tag">&lt;/hazelcast-client&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>client-network-config.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast-client&gt;</span>
    <span class="tag">&lt;network&gt;</span>
        <span class="tag">&lt;cluster-members&gt;</span>
            <span class="tag">&lt;address&gt;</span>127.0.0.1:7000<span class="tag">&lt;/address&gt;</span>
        <span class="tag">&lt;/cluster-members&gt;</span>
    <span class="tag">&lt;/network&gt;</span>
<span class="tag">&lt;/hazelcast-client&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To get a Hazelcast client declarative configuration from the above two examples, use the <code>&lt;import/&gt;</code> element as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast-client&gt;</span>
  <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">client-group-config.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">client-network-config.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use <code>&lt;import/&gt;</code> element on top level of the XML hierarchy.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using the element <code>&lt;import&gt;</code>, you can also load XML resources from classpath and file system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:///etc/hazelcast/development-group-config.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- loaded from filesystem --&gt;</span>
  <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:development-network-config.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>  <span class="comment">&lt;!-- loaded from classpath --&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The element <code>&lt;import&gt;</code> supports variables too. Please see the following example snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${environment}-group-config.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${environment}-network-config.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can refer to the <a href="#using-variables">Using Variables section</a> to learn how you can set the configuration elements with variables.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-programmatically"><a class="anchor" href="#configuring-programmatically"></a><a class="link" href="#configuring-programmatically">4.2. Configuring Programmatically</a></h3>
<div class="paragraph">
<p>Besides declarative configuration, you can configure your cluster programmatically. For this you can create a <code>Config</code> object, set/change its properties and attributes and use this <code>Config</code> object to create a new Hazelcast member. Following is an example code which configures some network and Hazelcast Map properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in understanding_configuration.adoc - include::{javasource}/ProgrammaticConfSample.java[tag=pcs]</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a Hazelcast member with the above example configuration, pass the configuration object as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcast = Hazelcast.newHazelcastInstance( config );</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>Config</code> must not be modified after the Hazelcast instance is started. In other words, all configuration must be completed before creating the <code>HazelcastInstance</code>. Certain additional configuration elements can be added at runtime as described in the <a href="#dynamically-adding-data-structure-configuration-on-a-cluster">Dynamically Adding Data Structure Configuration on a Cluster section</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also create a named Hazelcast member. In this case, you should set <code>instanceName</code> of <code>Config</code> object as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
config.setInstanceName( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-instance</span><span class="delimiter">&quot;</span></span> );
Hazelcast.newHazelcastInstance( config );</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve an existing Hazelcast member by its name, use the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Hazelcast.getHazelcastInstanceByName( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-instance</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve all existing Hazelcast members, use the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Hazelcast.getAllHazelcastInstances();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hazelcast performs schema validation through the file <code>hazelcast-config-&lt;version&gt;.xsd</code> which comes with your Hazelcast libraries. Hazelcast throws a meaningful exception if there is an error in the declarative or programmatic configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to specify your own configuration file to create <code>Config</code>, Hazelcast supports several ways including filesystem, classpath, InputStream and URL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Config cfg = new XmlConfigBuilder(xmlFileName).build();</code></p>
</li>
<li>
<p><code>Config cfg = new XmlConfigBuilder(inputStream).build();</code></p>
</li>
<li>
<p><code>Config cfg = new ClasspathXmlConfig(xmlFileName);</code></p>
</li>
<li>
<p><code>Config cfg = new FileSystemXmlConfig(configFilename);</code></p>
</li>
<li>
<p><code>Config cfg = new UrlXmlConfig(url);</code></p>
</li>
<li>
<p><code>Config cfg = new InMemoryXmlConfig(xml);</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-with-system-properties"><a class="anchor" href="#configuring-with-system-properties"></a><a class="link" href="#configuring-with-system-properties">4.3. Configuring with System Properties</a></h3>
<div class="paragraph">
<p>You can use system properties to configure some aspects of Hazelcast. You set these properties as name and value pairs through declarative configuration, programmatic configuration or JVM system property. Following are examples for each option.</p>
</div>
<div class="paragraph">
<p><strong>Declaratively:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  ....
  <span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.property.foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>value<span class="tag">&lt;/property&gt;</span>
    ....
  <span class="tag">&lt;/properties&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatically:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config() ;
config.setProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.property.foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Using JVM&#8217;s <code>System</code> class or <code>-D</code> argument:</strong></p>
</div>
<div class="paragraph">
<p><code>System.setProperty( "hazelcast.property.foo", "value" );</code></p>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="paragraph">
<p><code>java -Dhazelcast.property.foo=value</code></p>
</div>
<div class="paragraph">
<p>You will see Hazelcast system properties mentioned throughout this Reference Manual as required in some of the chapters and sections. All Hazelcast system properties are listed in the <a href="#system-properties">System Properties appendix</a> with their descriptions, default values and property types as a reference for you.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-within-spring-context"><a class="anchor" href="#configuring-within-spring-context"></a><a class="link" href="#configuring-within-spring-context">4.4. Configuring within Spring Context</a></h3>
<div class="paragraph">
<p>If you use Hazelcast with <a href="https://spring.io/">Spring</a> you can declare beans using the namespace <code>hazelcast</code>. When you add the namespace declaration to the element <code>beans</code> in the Spring context file, you can start to use the namespace shortcut <code>hz</code> to be used as a bean declaration. Following is an example Hazelcast configuration when integrated with Spring:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hz:hazelcast id=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;hz:config&gt;
    &lt;hz:group name=<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;hz:network port=<span class="string"><span class="delimiter">&quot;</span><span class="content">5701</span><span class="delimiter">&quot;</span></span> port-auto-increment=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;hz:join&gt;
        &lt;hz:multicast enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;hz:tcp-ip enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
          &lt;hz:members&gt;<span class="float">10.10</span><span class="float">.1</span><span class="float">.2</span>, <span class="float">10.10</span><span class="float">.1</span><span class="float">.3</span>&lt;/hz:members&gt;
        &lt;/hz:tcp-ip&gt;
      &lt;/hz:join&gt;
    &lt;/hz:network&gt;
  &lt;/hz:config&gt;
&lt;/hz:hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please see the <a href="#integration-with-spring">Integration with Spring section</a> for more information on Hazelcast-Spring integration.</p>
</div>
</div>
<div class="sect2">
<h3 id="dynamically-adding-data-structure-configuration-on-a-cluster"><a class="anchor" href="#dynamically-adding-data-structure-configuration-on-a-cluster"></a><a class="link" href="#dynamically-adding-data-structure-configuration-on-a-cluster">4.5. Dynamically Adding Data Structure Configuration on a Cluster</a></h3>
<div class="paragraph">
<p>As described above, Hazelcast can be configured in a declarative or programmatic way; configuration must be completed before starting a Hazelcast member and this configuration cannot be altered at runtime, thus we refer to this as <em>static</em> configuration.</p>
</div>
<div class="paragraph">
<p>Starting with Hazelcast 3.9, it is possible to dynamically add configuration for certain data structures at runtime; these can be added by invoking one of the <code>Config.add*Config</code> methods on the <code>Config</code> object obtained from a running member&#8217;s <code>HazelcastInstance.getConfig()</code> method. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in understanding_configuration.adoc - include::{javasource}/DynamicConfiguration.java[tag=dynconf]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dynamic configuration elements must be fully configured before the invocation of <code>add*Config</code> method: at that point, the configuration object will be delivered to every member of the cluster and added to each member&#8217;s dynamic configuration, so mutating the configuration object after the <code>add*Config</code> invocation will have no effect.</p>
</div>
<div class="paragraph">
<p>As dynamically added data structure configuration is propagated across all cluster members, failures may occur due to conditions such as timeout and network partition. The configuration propagation mechanism internally retries adding the configuration whenever a membership change is detected. However if an exception is thrown from <code>add*Config</code> method, the configuration may have been partially propagated to some cluster members and adding the configuration should be retried by the user.</p>
</div>
<div class="paragraph">
<p>Adding new dynamic configuration is supported for all <code>add*Config</code> methods except:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>JobTracker</code> which has been deprecated since Hazelcast 3.8</p>
</li>
<li>
<p><code>QuorumConfig</code>: new quorum configuration cannot be dynamically added but other configuration can reference quorums configured in the existing static configuration</p>
</li>
<li>
<p><code>WanReplicationConfig</code>: new WAN replication configuration cannot be dynamically added, however existing static ones can be referenced from other configurations, e.g., a new dynamic <code>MapConfig</code> may include a <code>WanReplicationRef</code> to a statically configured WAN replication config.</p>
</li>
<li>
<p><code>ListenerConfig</code>: listeners can be instead added at runtime via other API such as <code>HazelcastInstance.getCluster().addMembershipListener</code> and <code>HazelcastInstance.getPartitionService().addMigrationListener</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="handling-configuration-conflicts"><a class="anchor" href="#handling-configuration-conflicts"></a><a class="link" href="#handling-configuration-conflicts">4.5.1. Handling Configuration Conflicts</a></h4>
<div class="paragraph">
<p>Attempting to add a dynamic configuration, when a static configuration for the same element already exists, will throw <code>ConfigurationException</code>. For example, assuming we start a member with the following fragment in <code>hazelcast.xml</code> configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessions</span><span class="delimiter">&quot;</span></span>&gt;
   ...
&lt;/map&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then adding a dynamic configuration for a map with the name <code>sessions</code> will throw a <code>ConfigurationException</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance instance = Hazelcast.newHazelcastInstance();

MapConfig sessionsMapConfig = <span class="keyword">new</span> MapConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">sessions</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// this will throw ConfigurationException:</span>
instance.getConfig().addMapConfig(sessionsMapConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When attempting to add dynamic configuration for an element for which dynamic configuration has already been added, then if a configuration conflict is detected a <code>ConfigurationException</code> will be thrown. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance instance = Hazelcast.newHazelcastInstance();

MapConfig sessionsMapConfig = <span class="keyword">new</span> MapConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">sessions</span><span class="delimiter">&quot;</span></span>).setBackupCount(<span class="integer">0</span>);
instance.getConfig().addMapConfig(sessionsMapConfig);

MapConfig sessionsWithBackup = <span class="keyword">new</span> MapConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">sessions</span><span class="delimiter">&quot;</span></span>).setBackupCount(<span class="integer">1</span>);
<span class="comment">// throws ConfigurationException because the new MapConfig conflicts with existing one</span>
instance.getConfig().addMapConfig(sessionsWithBackup);

MapConfig sessionsWithoutBackup = <span class="keyword">new</span> MapConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">sessions</span><span class="delimiter">&quot;</span></span>).setBackupCount(<span class="integer">0</span>);
<span class="comment">// does not throw exception: new dynamic config is equal to existing dynamic config of same name</span>
instance.getConfig().addMapConfig(sessionsWithoutBackup);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="checking-configuration"><a class="anchor" href="#checking-configuration"></a><a class="link" href="#checking-configuration">4.6. Checking Configuration</a></h3>
<div class="paragraph">
<p>When you start a Hazelcast member without passing a <code>Config</code> object, as explained in the <a href="#configuring-programmatically">Configuring Programmatically section</a>, Hazelcast checks the member&#8217;s configuration as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, it looks for the <code>hazelcast.config</code> system property. If it is set, its value is used as the path. This is useful if you want to be able to change your Hazelcast configuration; you can do this because it is not embedded within the application. You can set the <code>config</code> option with the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.config=<span class="error">`</span>*<span class="error">`</span>&lt;path to the hazelcast.xml&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path can be a regular one or a classpath reference with the prefix <code>classpath:</code>.</p>
</div>
</li>
<li>
<p>If the above system property is not set, Hazelcast then checks whether there is a <code>hazelcast.xml</code> file in the working directory.</p>
</li>
<li>
<p>If not, it then checks whether <code>hazelcast.xml</code> exists on the classpath.</p>
</li>
<li>
<p>If none of the above works, Hazelcast loads the default configuration (<code>hazelcast.xml</code>) that comes with your Hazelcast package.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before configuring Hazelcast, please try to work with the default configuration to see if it works for you. This default configuration should be fine for most of the users. If not, you can consider to modify the configuration to be more suitable for your environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration-pattern-matcher"><a class="anchor" href="#configuration-pattern-matcher"></a><a class="link" href="#configuration-pattern-matcher">4.7. Configuration Pattern Matcher</a></h3>
<div class="paragraph">
<p>You can give a custom strategy to match an item name to a configuration pattern. By default Hazelcast uses a simplified wildcard matching. See <a href="#using-wildcards">Using Wildcards section</a> for this.
A custom configuration pattern matcher can be given by using either member or client <code>config</code> objects, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Setting a custom config pattern matcher via member config object</span>
Config config = <span class="keyword">new</span> Config();
config.setConfigPatternMatcher(<span class="keyword">new</span> ExampleConfigPatternMatcher());</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following is an example pattern matcher:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in understanding_configuration.adoc - include::{javasource}/ExampleConfigPatternMatcher.java[tag=patternmatcher]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-wildcards"><a class="anchor" href="#using-wildcards"></a><a class="link" href="#using-wildcards">4.8. Using Wildcards</a></h3>
<div class="paragraph">
<p>Hazelcast supports wildcard configuration for all distributed data structures that can be configured using <code>Config</code>, that is, for all except <code>IAtomicLong</code>, <code>IAtomicReference</code>. Using an asterisk (*) character in the name, different instances of maps, queues, topics, semaphores, etc. can be configured by a single configuration.</p>
</div>
<div class="paragraph">
<p>A single asterisk (*) can be placed anywhere inside the configuration name.</p>
</div>
<div class="paragraph">
<p>For instance, a map named <code>com.hazelcast.test.mymap</code> can be configured using one of the following configurations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.test.*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazel*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*.test.mymap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.*test.mymap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or a queue <code>com.hazelcast.test.myqueue</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*hazelcast.test.myqueue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
<span class="tag">&lt;/queue&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.*.myqueue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
...
<span class="tag">&lt;/queue&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>You can use only a single asterisk as a wildcard for each data structure configuration.</p>
</li>
<li>
<p>If you have matching wildcard configurations for a data structure, the more specific (longest) one is used when configuring it. Let&#8217;s say you have a map named <code>mymap.customer.name</code> and you have map configurations <code>mymap.*</code> and <code>mymap.customer.*</code>. Hazelcast uses <code>mymap.customer.*</code> to configure this map.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="using-variables"><a class="anchor" href="#using-variables"></a><a class="link" href="#using-variables">4.9. Using Variables</a></h3>
<div class="paragraph">
<p>In your Hazelcast and/or Hazelcast Client declarative configuration, you can use variables to set the values of the elements. This is valid when you set a system property programmatically or you use the command line interface. You can use a variable in the declarative configuration to access the values of the system properties you set.</p>
</div>
<div class="paragraph">
<p>For example, see the following command that sets two system properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dgroup.name=dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s get the values of these system properties in the declarative configuration of Hazelcast, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;group&gt;</span>
    <span class="tag">&lt;name&gt;</span>${group.name}<span class="tag">&lt;/name&gt;</span>
  <span class="tag">&lt;/group&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This also applies to the declarative configuration of Hazelcast Client, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast-client&gt;</span>
  <span class="tag">&lt;group&gt;</span>
    <span class="tag">&lt;name&gt;</span>${group.name}<span class="tag">&lt;/name&gt;</span>
  <span class="tag">&lt;/group&gt;</span>
<span class="tag">&lt;/hazelcast-client&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you do not want to rely on the system properties, you can use the <code>XmlConfigBuilder</code> and explicitly set a <code>Properties</code> instance, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();

<span class="comment">// fill the properties, e.g., from database/LDAP, etc.</span>

XmlConfigBuilder builder = <span class="keyword">new</span> XmlConfigBuilder();
builder.setProperties(properties);
Config config = builder.build();
HazelcastInstance hz = Hazelcast.newHazelcastInstance(config);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="variable-replacers"><a class="anchor" href="#variable-replacers"></a><a class="link" href="#variable-replacers">4.10. Variable Replacers</a></h3>
<div class="paragraph">
<p>Variable replacers are used to replace custom strings during loading the configuration, e.g., they can be used to mask sensitive information such as usernames and passwords. Of course their usage is not limited to security related information.</p>
</div>
<div class="paragraph">
<p>Variable replacers implement the interface <code>com.hazelcast.config.replacer.spi.ConfigReplacer</code> and they are configured only declaratively: in the Hazelcast&#8217;s declarative configuration files, i.e., <code>hazelcast.xml</code> and <code>hazelcast-client.xml</code>. You can refer to <code>ConfigReplacer</code> s <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/config/replacer/spi/ConfigReplacer.html">Javadoc</a> for basic information on how a replacer works.</p>
</div>
<div class="paragraph">
<p>Variable replacers are configured within the element <code>&lt;config-replacers&gt;</code> under <code>&lt;hazelcast&gt;</code>, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
    ...
    &lt;config-replacers fail-<span class="keyword">if</span>-value-missing=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;replacer <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.acme.MyReplacer</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;properties&gt;
                &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">propName</span><span class="delimiter">&quot;</span></span>&gt;value&lt;/property&gt;
                ...
            &lt;/properties&gt;
        &lt;/replacer&gt;
        &lt;replacer <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">example.AnotherReplacer</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;/config-replacers&gt;
    ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, <code>&lt;config-replacers&gt;</code> is the parent element for your replacers, which are declared using the <code>&lt;replacer&gt;</code> sub-elements. You can define multiple replacers under the <code>&lt;config-replacers&gt;.</code> Here are the descriptions of elements and attributes used for the replacer configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fail-if-value-missing</code>: Specifies whether the loading configuration process stops when a replacement value is missing. It is an optional attribute and its default value is true.</p>
</li>
<li>
<p><code>class-name</code>: Full class name of the replacer.</p>
</li>
<li>
<p><code>&lt;properties&gt;</code>: Contains names and values of the properties used to configure a replacer. Each property is defined using the <code>&lt;property&gt;</code> sub-element. All of the properties are explained in the upcoming sections.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following replacer classes are provided by Hazelcast as example implementations of the <code>ConfigReplacer</code> interface. Note that you can also implement your own replacers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EncryptionReplacer</code></p>
</li>
<li>
<p><code>PropertyReplacer</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is also a <code>ExecReplacer</code> which runs an external command and uses its standard output as the value for the variable. Please refer to its <a href="https://github.com/hazelcast/hazelcast-code-samples/blob/master/variable-replacers/src/main/java/com/hazelcast/sample/replacer/ExecReplacer.java">code sample</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each example replacer is explained in the below sections.</p>
</div>
<div class="sect3">
<h4 id="encryptionreplacer"><a class="anchor" href="#encryptionreplacer"></a><a class="link" href="#encryptionreplacer">4.10.1. EncryptionReplacer</a></h4>
<div class="paragraph">
<p>This example <code>EncryptionReplacer</code> replaces encrypted variables by its plain form. The secret key for encryption/decryption is generated from a password which can be a value in a file and/or environment specific values, such as MAC address and actual user data.</p>
</div>
<div class="paragraph">
<p>Its full class name is <code>com.hazelcast.config.replacer.EncryptionReplacer</code> and the replacer prefix is <code>ENC</code>. Here are the properties used to configure this example replacer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cipherAlgorithm</code>: Cipher algorithm used for the encryption/decryption. Its default value is AES.</p>
</li>
<li>
<p><code>keyLengthBits</code>: Length of the secret key to be generated in bits. Its default value is 128 bits.</p>
</li>
<li>
<p><code>passwordFile</code>: Path to a file whose content should be used as a part of the encryption password. When the property is not provided no file is used as a part of the password. Its default value is null.</p>
</li>
<li>
<p><code>passwordNetworkInterface</code>: Name of network interface whose MAC address should be used as a part of the encryption password. When the property is not provided no network interface property is used as a part of the password. Its default value is null.</p>
</li>
<li>
<p><code>passwordUserProperties</code>: Specifies whether the current user properties (<code>user.name</code> and <code>user.home</code>) should be used as a part of the encryption password. Its default value is true.</p>
</li>
<li>
<p><code>saltLengthBytes</code>: Length of a random password salt in bytes. Its default value is 8 bytes.</p>
</li>
<li>
<p><code>secretKeyAlgorithm</code>:  Name of the secret-key algorithm to be associated with the generated secret key. Its default value is AES.</p>
</li>
<li>
<p><code>secretKeyFactoryAlgorithm</code>: Algorithm used to generate a secret key from a password. Its default value is PBKDF2WithHmacSHA256.</p>
</li>
<li>
<p><code>securityProvider</code>: Name of a Java Security Provider to be used for retrieving the configured secret key factory and the cipher. Its default value is null.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Older Java versions may not support all the algorithms used as defaults. Please use the property values supported your Java version.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a usage example, let&#8217;s create a password file and generate the encrypted strings out of this file.</p>
</div>
<div class="paragraph">
<p>1 -  Create the password file: <code>echo '/Za-uG3dDfpd,5.-' &gt; /opt/master-password</code></p>
</div>
<div class="paragraph">
<p>2 -  Define the encrypted variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java -cp hazelcast-*.jar \
    -DpasswordFile=/opt/master-password \
    -DpasswordUserProperties=<span class="predefined-constant">false</span> \
    com.hazelcast.config.replacer.EncryptionReplacer \
    <span class="string"><span class="delimiter">&quot;</span><span class="content">aGroup</span><span class="delimiter">&quot;</span></span>
<span class="error">$</span>ENC{Gw45stIlan0=:<span class="integer">531</span>:yVN9/xQpJ/Ww3EYkAPvHdA==}

java -cp hazelcast-*.jar \
    -DpasswordFile=/opt/master-password \
    -DpasswordUserProperties=<span class="predefined-constant">false</span> \
    com.hazelcast.config.replacer.EncryptionReplacer \
    <span class="string"><span class="delimiter">&quot;</span><span class="content">aPasswordToEncrypt</span><span class="delimiter">&quot;</span></span>
<span class="error">$</span>ENC{wJxe1vfHTgg=:<span class="integer">531</span>:WkAEdSi<span class="comment">//YWEbwvVNoU9mUyZ0DE49acJeaJmGalHHfA=}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>3 - Configure the replacer and put the encrypted variables into the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
    &lt;config-replacers&gt;
        &lt;replacer <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.config.replacer.EncryptionReplacer</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;properties&gt;
                &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">passwordFile</span><span class="delimiter">&quot;</span></span>&gt;/opt/master-password&lt;/property&gt;
                &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">passwordUserProperties</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">false</span>&lt;/property&gt;
            &lt;/properties&gt;
        &lt;/replacer&gt;
    &lt;/config-replacers&gt;
    &lt;group&gt;
        &lt;name&gt;<span class="error">$</span>ENC{Gw45stIlan0=:<span class="integer">531</span>:yVN9/xQpJ/Ww3EYkAPvHdA==}&lt;/name&gt;
        &lt;password&gt;<span class="error">$</span>ENC{wJxe1vfHTgg=:<span class="integer">531</span>:WkAEdSi/YWEbwvVNoU9mUyZ0DE49acJeaJmGalHHfA=}&lt;/password&gt;
    &lt;/group&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>4 - Check if the decryption works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">java -jar hazelcast-*.jar
Apr <span class="octal">06</span>, <span class="integer">2018</span> <span class="integer">10</span>:<span class="integer">15</span>:<span class="integer">43</span> AM com.hazelcast.config.XmlConfigLocator
INFO: Loading <span class="string"><span class="delimiter">'</span><span class="content">hazelcast.xml</span><span class="delimiter">'</span></span> from working directory.
Apr <span class="octal">06</span>, <span class="integer">2018</span> <span class="integer">10</span>:<span class="integer">15</span>:<span class="integer">44</span> AM com.hazelcast.instance.AddressPicker
INFO: [LOCAL] [aGroup] [<span class="float">3.10</span>-SNAPSHOT] Prefer IPv4 stack is <span class="predefined-constant">true</span>.</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the logs, the correctly decrypted group name value ("aGroup") is used.</p>
</div>
</div>
<div class="sect3">
<h4 id="propertyreplacer"><a class="anchor" href="#propertyreplacer"></a><a class="link" href="#propertyreplacer">4.10.2. PropertyReplacer</a></h4>
<div class="paragraph">
<p>The <code>PropertyReplacer</code> replaces variables by properties with the given name. Usually the system properties are used, e.g., <code>${user.name}</code>. There is no need to define it in the declarative configuration files.</p>
</div>
<div class="paragraph">
<p>Its full class name is <code>com.hazelcast.config.replacer.PropertyReplacer</code> and the replacer prefix is empty string ("").</p>
</div>
</div>
<div class="sect3">
<h4 id="implementing-custom-replacers"><a class="anchor" href="#implementing-custom-replacers"></a><a class="link" href="#implementing-custom-replacers">4.10.3. Implementing Custom Replacers</a></h4>
<div class="paragraph">
<p>You can also provide your own replacer implementations. All replacers have to implement the interface <code>com.hazelcast.config.replacer.spi.ConfigReplacer</code>. A simple snippet is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ConfigReplacer</span> {
    <span class="type">void</span> init(<span class="predefined-type">Properties</span> properties);
    <span class="predefined-type">String</span> getPrefix();
    <span class="predefined-type">String</span> getReplacement(<span class="predefined-type">String</span> maskedValue);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-clusters"><a class="anchor" href="#setting-up-clusters"></a><a class="link" href="#setting-up-clusters">5. Setting Up Clusters</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Hazelcast clusters and the methods cluster members and native clients use to form a Hazelcast cluster.</p>
</div>
<div class="sect2">
<h3 id="discovery-mechanisms"><a class="anchor" href="#discovery-mechanisms"></a><a class="link" href="#discovery-mechanisms">5.1. Discovery Mechanisms</a></h3>
<div class="paragraph">
<p>A Hazelcast cluster is a network of cluster members that run Hazelcast. Cluster members (also called nodes) automatically join together to form a cluster. This automatic joining takes place with various discovery mechanisms that the cluster members use to find each other.</p>
</div>
<div class="paragraph">
<p>Please note that, after a cluster is formed, communication between cluster members is always via TCP/IP, regardless of the discovery mechanism used.</p>
</div>
<div class="paragraph">
<p>Hazelcast uses the following discovery mechanisms.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can refer to the <a href="https://hazelcast.com/resources/hazelcast-deployment-operations-guide/">Hazelcast IMDG Deployment and Operations Guide</a> for advice on the best discovery mechanism to use.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="tcp"><a class="anchor" href="#tcp"></a><a class="link" href="#tcp">5.1.1. TCP</a></h4>
<div class="paragraph">
<p>You can configure Hazelcast to be a full TCP/IP cluster. Please see the <a href="#discovering-members-by-tcp">Discovering Members by TCP</a> section for configuration details.</p>
</div>
</div>
<div class="sect3">
<h4 id="multicast"><a class="anchor" href="#multicast"></a><a class="link" href="#multicast">5.1.2. Multicast</a></h4>
<div class="paragraph">
<p>Multicast mechanism is not recommended for production since UDP is often blocked in production environments and other discovery mechanisms are more definite.</p>
</div>
<div class="paragraph">
<p>With this mechanism, Hazelcast allows cluster members to find each other using multicast communication. Please see the <a href="#discovering-members-by-multicast">Discovering Members by Multicast</a> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="aws-cloud-discovery"><a class="anchor" href="#aws-cloud-discovery"></a><a class="link" href="#aws-cloud-discovery">5.1.3. AWS Cloud Discovery</a></h4>
<div class="paragraph">
<p>Hazelcast supports EC2 auto-discovery. It is useful when you do not want to provide or you cannot provide the list of possible IP addresses. This discovery feature is provided as a Hazelcast plugin. Please see its <a href="https://github.com/hazelcast/hazelcast-aws/blob/master/README.md">documentation</a> for information on configuring and using it.</p>
</div>
</div>
<div class="sect3">
<h4 id="gcp-cloud-discovery"><a class="anchor" href="#gcp-cloud-discovery"></a><a class="link" href="#gcp-cloud-discovery">5.1.4. GCP Cloud Discovery</a></h4>
<div class="paragraph">
<p>Hazelcast supports discovering members in the <a href="https://cloud.google.com/compute/">GCP Compute Engine</a> environment. You can easily configure Hazelcast members discovery, WAN replication, and Hazelcast Client to work seamlessly on the native GCP VM Instances. This discovery feature is provided as a Hazelcast plugin. Please see its <a href="https://github.com/hazelcast/hazelcast-gcp/blob/master/README.md">documentation</a> for information on configuring and using it.</p>
</div>
</div>
<div class="sect3">
<h4 id="apache-jclous-cloud-discovery"><a class="anchor" href="#apache-jclous-cloud-discovery"></a><a class="link" href="#apache-jclous-cloud-discovery">5.1.5. Apache jclouds Cloud Discovery</a></h4>
<div class="paragraph">
<p>Hazelcast members and native clients support jclouds for discovery. This mechanism allows applications to be deployed in various cloud infrastructure ecosystems in an infrastructure-agnostic way. This discovery feature is provided as a Hazelcast plugin. Please see its <a href="https://github.com/hazelcast/hazelcast-jclouds/blob/master/README.md">documentation</a> for information on configuring and using it.</p>
</div>
</div>
<div class="sect3">
<h4 id="azure-cloud-discovery"><a class="anchor" href="#azure-cloud-discovery"></a><a class="link" href="#azure-cloud-discovery">5.1.6. Azure Cloud Discovery</a></h4>
<div class="paragraph">
<p>Hazelcast offers a discovery strategy for your Hazelcast applications running on Azure. This strategy provides all of your Hazelcast instances by returning the virtual machines within your Azure resource group that are tagged with a specified value. This discovery feature is provided as a Hazelcast plugin. Please see its <a href="https://github.com/hazelcast/hazelcast-azure/blob/master/README.md">documentation</a> for information on configuring and using it.</p>
</div>
</div>
<div class="sect3">
<h4 id="zookeeper-cloud-discovery"><a class="anchor" href="#zookeeper-cloud-discovery"></a><a class="link" href="#zookeeper-cloud-discovery">5.1.7. Zookeeper Cloud Discovery</a></h4>
<div class="paragraph">
<p>This discovery mechanism provides a service based discovery strategy by using Apache Curator to communicate with your Zookeeper server. You can use this plugin with <a href="#discovery-spi">Discovery SPI</a> enabled Hazelcast 3.6.1 and higher applications. This is provided as a Hazelcast plugin. Please see its <a href="https://github.com/hazelcast/hazelcast-zookeeper/blob/master/README.md">documentation</a> for information on configuring and using it.</p>
</div>
</div>
<div class="sect3">
<h4 id="condul-cloud-discovery"><a class="anchor" href="#condul-cloud-discovery"></a><a class="link" href="#condul-cloud-discovery">5.1.8. Consul Cloud Discovery</a></h4>
<div class="paragraph">
<p>Consul is a highly available and distributed service discovery and key-value store designed with support for the modern data center to make distributed systems and configuration easy. This mechanism provides a Consul based discovery strategy for Hazelcast enabled applications (Hazelcast 3.6 and higher) and enables Hazelcast members to dynamically discover one another via Consul. This discovery feature is provided as a Hazelcast plugin. Please see its <a href="https://github.com/bitsofinfo/hazelcast-consul-discovery-spi">documentation</a> for information on configuring and using it.</p>
</div>
</div>
<div class="sect3">
<h4 id="etcd-cloud-discovery"><a class="anchor" href="#etcd-cloud-discovery"></a><a class="link" href="#etcd-cloud-discovery">5.1.9. etcd Cloud Discovery</a></h4>
<div class="paragraph">
<p>This mechanism provides an <a href="https://coreos.com/etcd/">etcd</a> based discovery strategy for Hazelcast enabled applications (Hazelcast 3.6 and higher). This is an easy to configure plug-and-play Hazelcast discovery strategy that will optionally register each of your Hazelcast members with etcd and enable Hazelcast members to dynamically discover one another via etcd. This discovery feature is provided as a Hazelcast plugin. Please see its <a href="https://github.com/bitsofinfo/hazelcast-etcd-discovery-spi/blob/master/README.md">documentation</a> for information on configuring and using it.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-for-pcf"><a class="anchor" href="#hazelcast-for-pcf"></a><a class="link" href="#hazelcast-for-pcf">5.1.10. Hazelcast for PCF</a></h4>
<div class="paragraph">
<p>Using a clickable Hazelcast Tile for Pivotal Cloud Foundry (PCF), you can deploy your Hazelcast cluster on PCF. This feature is provided as a Hazelcast plugin. Please see its <a href="https://docs.pivotal.io/partners/hazelcast/index.html">documentation</a> on how to install, configure and use the plugin Hazelcast for PCF.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-openshift-integration"><a class="anchor" href="#hazelcast-openshift-integration"></a><a class="link" href="#hazelcast-openshift-integration">5.1.11. Hazelcast OpenShift Integration</a></h4>
<div class="paragraph">
<p>Hazelcast can run inside OpenShift benefiting from its cluster management software Kubernetes for discovery of members. Using Hazelcast Docker images, templates and default configuration files, you can deploy Hazelcast IMDG, Hazelcast IMDG Enterprise and Management Center onto OpenShift. Please see the documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/hazelcast/hazelcast-openshift">Hazelcast IMDG and Hazelcast IMDG Enterprise</a></p>
</li>
<li>
<p><a href="https://github.com/hazelcast/management-center-openshift">Management Center</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please also see the <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/hazelcast-integration/openshift">Hazelcast for OpenShift</a> guide, which presents how to set up local OpenShift environment, start Hazelcast cluster, configure Management Center and finally run a sample client application.</p>
</div>
</div>
<div class="sect3">
<h4 id="eureka-cloud-discovery"><a class="anchor" href="#eureka-cloud-discovery"></a><a class="link" href="#eureka-cloud-discovery">5.1.12. Eureka Cloud Discovery</a></h4>
<div class="paragraph">
<p>Eureka is a REST based service that is primarily used in the AWS cloud for locating services for the purpose of load balancing and failover of middle-tier servers. Hazelcast supports Eureka V1 discovery; Hazelcast members within EC2 Virtual Private Cloud can discover each other using this mechanism. This discovery feature is provided as a Hazelcast plugin. Please see its <a href="https://github.com/hazelcast/hazelcast-eureka">documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="heroku-cloud-discovery"><a class="anchor" href="#heroku-cloud-discovery"></a><a class="link" href="#heroku-cloud-discovery">5.1.13. Heroku Cloud Discovery</a></h4>
<div class="paragraph">
<p>Heroku is a platform as a service (PaaS) with which you can build, run and operate applications entirely in the cloud. It is a cloud platform based on a managed container system, with integrated data services and a powerful ecosystem. Hazelcast offers a discovery plugin that looks for IP addresses of other members by resolving service names against the Heroku DNS Discovery in Heroku Private Spaces. This discovery feature is provided as a Hazelcast plugin. Please see its <a href="https://github.com/jkutner/hazelcast-heroku-discovery/blob/master/README.md">documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="kubernetes-cloud-discovery"><a class="anchor" href="#kubernetes-cloud-discovery"></a><a class="link" href="#kubernetes-cloud-discovery">5.1.14. Kubernetes Cloud Discovery</a></h4>
<div class="paragraph">
<p>Kubernetes is an open source system for automating deployment, scaling and management of containerized applications. Hazelcast provides Kubernetes discovery mechanism that looks for IP addresses of other members by resolving the requests against a Kubernetes Service Discovery system. It supports two different options of resolving against the discovery registry: (i) a request to the REST API, (ii) DNS Lookup against a given DNS service name. This discovery feature is provided as a Hazelcast plugin. Please see its <a href="https://github.com/hazelcast/hazelcast-kubernetes">documentation</a> for information on configuring and using it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="discovering-members-by-tcp"><a class="anchor" href="#discovering-members-by-tcp"></a><a class="link" href="#discovering-members-by-tcp">5.2. Discovering Members by TCP</a></h3>
<div class="paragraph">
<p>If multicast is not the preferred way of discovery for your environment, then you can configure Hazelcast to be a full TCP/IP cluster. When you configure Hazelcast to discover members by TCP/IP, you must list all or a subset of the members' hostnames and/or IP addresses as cluster members. You do not have to list all of these cluster members, but at least one of the listed members has to be active in the cluster when a new member joins.</p>
</div>
<div class="paragraph">
<p>To set your Hazelcast to be a full TCP/IP cluster, set the following configuration elements. Please refer to the <a href="#tcp-ip-element">tcp-ip element section</a> for the full description of the TCP/IP discovery configuration elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>enabled</code> attribute of the <code>multicast</code> element to "false".</p>
</li>
<li>
<p>Set the <code>enabled</code> attribute of the <code>aws</code> element to "false".</p>
</li>
<li>
<p>Set the <code>enabled</code> attribute of the <code>tcp-ip</code> element to "true".</p>
</li>
<li>
<p>Set your <code>member</code> elements within the <code>tcp-ip</code> element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
   ...
  <span class="tag">&lt;network&gt;</span>
    ...
    <span class="tag">&lt;join&gt;</span>
      <span class="tag">&lt;multicast</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;/multicast&gt;</span>
      <span class="tag">&lt;tcp-ip</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;member&gt;</span>machine1<span class="tag">&lt;/member&gt;</span>
        <span class="tag">&lt;member&gt;</span>machine2<span class="tag">&lt;/member&gt;</span>
        <span class="tag">&lt;member&gt;</span>machine3:5799<span class="tag">&lt;/member&gt;</span>
        <span class="tag">&lt;member&gt;</span>192.168.1.0-7<span class="tag">&lt;/member&gt;</span>
        <span class="tag">&lt;member&gt;</span>192.168.1.21<span class="tag">&lt;/member&gt;</span>
      <span class="tag">&lt;/tcp-ip&gt;</span>
      ...
    <span class="tag">&lt;/join&gt;</span>
    ...
  <span class="tag">&lt;/network&gt;</span>
  ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown above, you can provide IP addresses or hostnames for <code>member</code> elements. You can also give a range of IP addresses, such as <code>192.168.1.0-7</code>.</p>
</div>
<div class="paragraph">
<p>Instead of providing members line-by-line as shown above, you also have the option to use the <code>members</code> element and write comma-separated IP addresses, as shown below.</p>
</div>
<div class="paragraph">
<p><code>&lt;members&gt;192.168.1.0-7,192.168.1.21&lt;/members&gt;</code></p>
</div>
<div class="paragraph">
<p>If you do not provide ports for the members, Hazelcast automatically tries the ports 5701, 5702 and so on.</p>
</div>
<div class="paragraph">
<p>By default, Hazelcast binds to all local network interfaces to accept incoming traffic. You can change this behavior using the system property <code>hazelcast.socket.bind.any</code>. If you set this property to <code>false</code>, Hazelcast uses the interfaces specified in the <code>interfaces</code> element (please refer to the <a href="#interfaces">Interfaces Configuration section</a>). If no interfaces are provided, then it will try to resolve one interface to bind from the <code>member</code> elements.</p>
</div>
</div>
<div class="sect2">
<h3 id="discovering-members-by-multicast"><a class="anchor" href="#discovering-members-by-multicast"></a><a class="link" href="#discovering-members-by-multicast">5.3. Discovering Members by Multicast</a></h3>
<div class="paragraph">
<p>With the multicast auto-discovery mechanism, Hazelcast allows cluster members to find each other using multicast communication. The cluster members do not need to know the concrete addresses of the other members, as they just multicast to all the other members for listening. Whether multicast is possible or allowed depends on your environment.</p>
</div>
<div class="paragraph">
<p>To set your Hazelcast to multicast auto-discovery, set the following configuration elements. Please refer to the <a href="#multicast-element">multicast element section</a> for the full description of the multicast discovery configuration elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>enabled</code> attribute of the <code>multicast</code> element to "true".</p>
</li>
<li>
<p>Set <code>multicast-group</code>, <code>multicast-port</code>, <code>multicast-time-to-live</code>, etc. to your multicast values.</p>
</li>
<li>
<p>Set the <code>enabled</code> attribute of both <code>tcp-ip</code> and <code>aws</code> elements to "false".</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
   ...
  <span class="tag">&lt;network&gt;</span>
    ...
        <span class="tag">&lt;join&gt;</span>
            <span class="tag">&lt;multicast</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;multicast-group&gt;</span>224.2.2.3<span class="tag">&lt;/multicast-group&gt;</span>
                <span class="tag">&lt;multicast-port&gt;</span>54327<span class="tag">&lt;/multicast-port&gt;</span>
                <span class="tag">&lt;multicast-time-to-live&gt;</span>32<span class="tag">&lt;/multicast-time-to-live&gt;</span>
                <span class="tag">&lt;multicast-timeout-seconds&gt;</span>2<span class="tag">&lt;/multicast-timeout-seconds&gt;</span>
                <span class="tag">&lt;trusted-interfaces&gt;</span>
                   <span class="tag">&lt;interface&gt;</span>192.168.1.102<span class="tag">&lt;/interface&gt;</span>
                <span class="tag">&lt;/trusted-interfaces&gt;</span>
            <span class="tag">&lt;/multicast&gt;</span>
            <span class="tag">&lt;tcp-ip</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;/tcp-ip&gt;</span>
            <span class="tag">&lt;aws</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;/aws&gt;</span>
        <span class="tag">&lt;/join&gt;</span>
  <span class="tag">&lt;/network&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pay attention to the <code>multicast-timeout-seconds</code> element. <code>multicast-timeout-seconds</code> specifies the time in seconds that a member should wait for a valid multicast response from another member running in the network before declaring itself the leader member (the first member joined to the cluster) and creating its own cluster. This only applies to the startup of members where no leader has been assigned yet. If you specify a high value to <code>multicast-timeout-seconds</code>, such as 60 seconds, it means that until a leader is selected, each member will wait 60 seconds before moving on. Be careful when providing a high value. Also, be careful not to set the value too low, or the members might give up too early and create their own cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Multicast auto-discovery is not supported for Hazelcast native clients yet. However, we offer Multicast Discovery Plugin for this purpose. Please refer to the <a href="#discovering-native-clients">Discovering Native Clients section</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="discovering-native-clients"><a class="anchor" href="#discovering-native-clients"></a><a class="link" href="#discovering-native-clients">5.4. Discovering Native Clients</a></h3>
<div class="paragraph">
<p>Hazelcast members and native Java clients can find each other with multicast discovery plugin. This plugin is implemented using <a href="#discovery-spi">Hazelcast Discovery SPI</a>. You should configure the plugin both at Hazelcast members and Java clients in order to use multicast discovery.</p>
</div>
<div class="paragraph">
<p>To configure your cluster to have the multicast discovery plugin, follow these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Disable the multicast and TCP/IP join mechanisms. To do this, set the <code>enabled</code> attributes of the <code>multicast</code> and <code>tcp-ip</code> elements to <code>false</code> in your <code>hazelcast.xml</code> configuration file</p>
</li>
<li>
<p>Set the <code>enabled</code> attribute of the <code>hazelcast.discovery.enabled</code> property to <code>true</code>.</p>
</li>
<li>
<p>Add multicast discovery strategy configuration to your XML file, i.e., <code>&lt;discovery-strategies&gt;</code> element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"> ...
  <span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.discovery.enabled</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/properties&gt;</span>
   ....
 <span class="tag">&lt;join&gt;</span>
    <span class="tag">&lt;multicast</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/multicast&gt;</span>
    <span class="tag">&lt;tcp-ip</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;/tcp-ip&gt;</span>
    <span class="tag">&lt;discovery-strategies&gt;</span>
        <span class="tag">&lt;discovery-strategy</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.spi.discovery.multicast.MulticastDiscoveryStrategy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;properties&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">group</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>224.2.2.3<span class="tag">&lt;/property&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>54327<span class="tag">&lt;/property&gt;</span>
          <span class="tag">&lt;/properties&gt;</span>
        <span class="tag">&lt;/discovery-strategy&gt;</span>
    <span class="tag">&lt;/discovery-strategies&gt;</span>
<span class="tag">&lt;/join&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are the multicast discovery plugin configuration properties with their descriptions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group</code>: String value that is used to set the multicast group, so that you can isolate your clusters.</p>
</li>
<li>
<p><code>port</code>: Integer value that is used to set the multicast port.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-cluster-groups"><a class="anchor" href="#creating-cluster-groups"></a><a class="link" href="#creating-cluster-groups">5.5. Creating Cluster Groups</a></h3>
<div class="paragraph">
<p>You can create cluster groups. To do this, use the <code>group</code> configuration element.</p>
</div>
<div class="paragraph">
<p>You can separate your clusters in a simple way by specifying group names. Example groupings can be by <strong>development</strong>, <strong>production</strong>, <strong>test</strong>, <strong>app</strong>, etc. The following is an example declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;group&gt;</span>
    <span class="tag">&lt;name&gt;</span>production<span class="tag">&lt;/name&gt;</span>
  <span class="tag">&lt;/group&gt;</span>
  ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define the cluster groups using the programmatic configuration. A JVM can host multiple Hazelcast instances. Each Hazelcast instance can only participate in one group. Each Hazelcast instance only joins to its own group and does not interact with other groups. The following code example creates three separate Hazelcast instances--<code>h1</code> belongs to the <code>production</code> cluster, while <code>h2</code> and <code>h3</code> belong to the <code>development</code> cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in setting_up_clusters.adoc - include::{javasource}/GroupingClusters.java[tag=groupingclusters]</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="cluster-groups-before-hazelcast-382"><a class="anchor" href="#cluster-groups-before-hazelcast-382"></a><a class="link" href="#cluster-groups-before-hazelcast-382">5.5.1. Cluster Groups before Hazelcast 3.8.2</a></h4>
<div class="paragraph">
<p>If you have a Hazelcast release older than 3.8.2, you need to provide also a group password along with the group name. The following are the configuration examples with the password element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;group&gt;</span>
    <span class="tag">&lt;name&gt;</span>production<span class="tag">&lt;/name&gt;</span>
    <span class="tag">&lt;password&gt;</span>prod-pass<span class="tag">&lt;/password&gt;</span>
  <span class="tag">&lt;/group&gt;</span>
  ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in setting_up_clusters.adoc - include::{javasource}/GroupingClusters2.java[tag=groupingclusters]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Starting with 3.8.2, there is no need for a group password, both on member and client sides.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="member-user-code-deployment-beta"><a class="anchor" href="#member-user-code-deployment-beta"></a><a class="link" href="#member-user-code-deployment-beta">5.6. Member User Code Deployment - BETA</a></h3>
<div class="paragraph">
<p>Hazelcast can dynamically load your custom classes or domain classes from a remote class repository, which typically includes <a href="#enabling-lite-members">lite members</a>. For this purpose Hazelcast offers a distributed  dynamic class loader.</p>
</div>
<div class="paragraph">
<p>Using this dynamic class loader, you can control the local caching of the classes loaded from other members,
control the classes to be served to other members and create blacklists or whitelists of classes and packages. When you enable this feature, you will not have to deploy your classes to all cluster members.</p>
</div>
<div class="paragraph">
<p>The following is the brief working mechanism of the User Code Deployment feature:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dynamic class loader first checks the local classes, i.e., your classpath, for your custom class. If it is there, Hazelcast does not try to load it from the remote class repository.</p>
</li>
<li>
<p>Then, it checks the cache of classes loaded from the remote class repository (for this, caching should have been enabled in your local, please refer to <a href="#configuring-user-code-deployment">Configuring User Code Deployment section</a>). If your class is found here, again, Hazelcast does not try to load it from the remote class repository.</p>
</li>
<li>
<p>Finally, dynamic class loader checks the remote class repository. If a member in this repository returns the class, it means your class is found and will be used. You can also put this class into your local class cache as mentioned in the previous step.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="configuring-user-code-deployment"><a class="anchor" href="#configuring-user-code-deployment"></a><a class="link" href="#configuring-user-code-deployment">5.6.1. Configuring User Code Deployment</a></h4>
<div class="paragraph">
<p>User Code Deployment feature is not enabled by default. You can configure this feature declaratively or programmatically. Following are example configuration snippets:</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user-code-deployment</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;class-cache-mode&gt;</span>ETERNAL<span class="tag">&lt;/class-cache-mode&gt;</span>
        <span class="tag">&lt;provider-mode&gt;</span>LOCAL_CLASSES_ONLY<span class="tag">&lt;/provider-mode&gt;</span>
        <span class="tag">&lt;blacklist-prefixes&gt;</span>com.foo<span class="tag">&lt;/blacklist-prefixes&gt;</span>
        <span class="tag">&lt;whitelist-prefixes&gt;</span>com.bar.MyClass<span class="tag">&lt;/whitelist-prefixes&gt;</span>
        <span class="tag">&lt;provider-filter&gt;</span>HAS_ATTRIBUTE:lite<span class="tag">&lt;/provider-filter&gt;</span>
<span class="tag">&lt;/user-code-deployment&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in setting_up_clusters.adoc - include::{javasource}/MemberUCD.java[tag=ucd]</code></pre>
</div>
</div>
<div class="paragraph">
<p>User Code Deployment has the following configuration elements and attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Specifies whether dynamic class loading is enabled or not. Its default value is "true" and it is a mandatory attribute.</p>
</li>
<li>
<p><code>&lt;class-cache-mode&gt;</code>: Controls the local caching behavior for the classes loaded from the remote class repository. Available values are as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>ETERNAL</code>: Cache the loaded classes locally. This is the default value and suitable when you load long-living objects, such as domain objects stored in a map.</p>
</li>
<li>
<p><code>OFF</code>: Do not cache the loaded classes locally. It is suitable for loading runnables, callables, entry processors, etc.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>&lt;provider-mode&gt;</code>: Controls how the classes are served to the other cluster members. Available values are as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>LOCAL_AND_CACHED_CLASSES</code>: Serve classes loaded from both local classpath and from other members. This is the default value.</p>
</li>
<li>
<p><code>LOCAL_CLASSES_ONLY</code>: Serve classes from the local classpath only. Classes loaded from other members will be used locally, but they are not served to other members.</p>
</li>
<li>
<p><code>OFF</code>: Never serve classes to other members.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>&lt;blacklist-prefixes&gt;</code>: Comma separated name prefixes of classes/packages to be prevented from dynamic class loading. For example, if you set it as "com.foo", remote loading of all classes from the "com.foo" package will be blacklisted, including the classes from all its sub-packages. If you set it as "com.foo.Class", then the "Class" and all classes having the "Class" as prefix in the "com.foo" package will be blacklisted. There are some built-in prefixes which are blacklisted by default. These are as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>javax.</code></p>
</li>
<li>
<p><code>java.</code></p>
</li>
<li>
<p><code>sun.</code></p>
</li>
<li>
<p><code>com.hazelcast.</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>&lt;whitelist-prefixes&gt;</code>: Comma separated name prefixes of classes/packages only from which the classes will be loaded. It allows to quickly configure remote loading only for classes from selected packages. It can be used together with blacklisting. For example, you can whitelist the prefix "com.foo" and blacklist the prefix "com.foo.secret".</p>
</li>
<li>
<p><code>&lt;provider-filter&gt;</code>: Filter to constraint members to be used for a class loading request when a class is not available locally. The value is in the format "HAS_ATTRIBUTE:foo". When it is set as "HAS_ATTRIBUTE:foo", the class loading request will only be sent to the members which have "foo" as a <a href="#defining-member-attributes">member attribute</a>. Setting this to null will allow to load classes from all members. Please see an example in the below section.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="example-for-filtering-members"><a class="anchor" href="#example-for-filtering-members"></a><a class="link" href="#example-for-filtering-members">5.6.2. Example for Filtering Members</a></h4>
<div class="paragraph">
<p>As described above, the configuration element <code>provider-filter</code> is used to constrain a member to load classes only from a subset of all cluster members. The value of the <code>provider-filter</code> must be set as a member attribute in the desired members from which the classes will be loaded. Please see the following example usage provided as programmatic configurations.</p>
</div>
<div class="paragraph">
<p>The below example configuration will allow the Hazelcast member to load classes only from members with the <code>class-provider</code> attribute set. It will not ask any other member to provide a locally unavailable class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config hazelcastConfig = <span class="keyword">new</span> Config();
DistributedClassloadingConfig distributedClassloadingConfig = hazelcastConfig.getDistributedClassloadingConfig();
distributedClassloadingConfig.setProviderFilter(<span class="string"><span class="delimiter">&quot;</span><span class="content">HAS_ATTRIBUTE:class-provider</span><span class="delimiter">&quot;</span></span>);

HazelcastInstance instance = Hazelcast.newHazelcastInstance(hazelcastConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the below example configuration sets the attribute <code>class-provider</code> for a member. So, the above member will load classes from the members who have the attribute <code>class-provider</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config hazelcastConfig = <span class="keyword">new</span> Config();
MemberAttributeConfig memberAttributes = hazelcastConfig.getMemberAttributeConfig();
memberAttributes.setAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">class-provider</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>);

HazecastInstance instance = Hazelcast.newHazelcastInstance(hazelcastConfig);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="client-user-code-deployment-beta"><a class="anchor" href="#client-user-code-deployment-beta"></a><a class="link" href="#client-user-code-deployment-beta">5.7. Client User Code Deployment - BETA</a></h3>
<div class="paragraph">
<p>You can use the User Code Deployment at the client side for the following situations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You have objects that will run on the cluster via the clients such as <code>Runnable</code>, <code>Callable</code> and Entry Processors.</p>
</li>
<li>
<p>You have new or amended user domain objects (in-memory format of the IMap set to <code>Object</code>) which need to be deployed into the cluster.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When this feature is enabled, the clients will deploy these classes to the members. By this way, when a client adds a new class, the members will not require restarts to include the new classes in classpath.</p>
</div>
<div class="paragraph">
<p>You can also use the client permission policy to specify which clients are permitted to use User Code Deployment. Please see the <a href="#permissions">Permissions</a>.</p>
</div>
<div class="sect3">
<h4 id="configuring-client-user-code-deployment"><a class="anchor" href="#configuring-client-user-code-deployment"></a><a class="link" href="#configuring-client-user-code-deployment">5.7.1. Configuring Client User Code Deployment</a></h4>
<div class="paragraph">
<p>Client User Code Deployment feature is not enabled by default. You can configure this feature declaratively or programmatically. Following are example configuration snippets:</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration</strong></p>
</div>
<div class="paragraph">
<p>In your <code>hazelcast-client.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;user-code-deployment</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;jarPaths&gt;</span>
        <span class="tag">&lt;jarPath&gt;</span>/User/sample/sample.jar<span class="tag">&lt;/jarPath&gt;</span>
        <span class="tag">&lt;jarPath&gt;</span>sample.jar<span class="tag">&lt;/jarPath&gt;</span> <span class="comment">&lt;!--from class path --&gt;</span>
        <span class="tag">&lt;jarPath&gt;</span>https://com.sample.com/sample.jar<span class="tag">&lt;/jarPath&gt;</span>
        <span class="tag">&lt;jarPath&gt;</span>file://Users/sample/sample.jar<span class="tag">&lt;/jarPath&gt;</span>
    <span class="tag">&lt;/jarPaths&gt;</span>
    <span class="tag">&lt;classNames&gt;</span>
            <span class="comment">&lt;!-- for the classes available in client class path --&gt;</span>
        <span class="tag">&lt;className&gt;</span>sample.ClassName<span class="tag">&lt;/className&gt;</span>
        <span class="tag">&lt;className&gt;</span>sample.ClassName2<span class="tag">&lt;/className&gt;</span>
    <span class="tag">&lt;/classNames&gt;</span>
<span class="tag">&lt;/user-code-deployment&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in setting_up_clusters.adoc - include::{javasource}/ClientUCD.java[tag=clientucd]</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="client-user-code-deployment-note"><a class="anchor" href="#client-user-code-deployment-note"></a><a class="link" href="#client-user-code-deployment-note">Important to Know</a></h5>
<div class="paragraph">
<p>Note that User Code Deployment should also be enabled on the members to use this feature.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
UserCodeDeploymentConfig userCodeDeploymentConfig = config.getUserCodeDeploymentConfig();
userCodeDeploymentConfig.setEnabled( <span class="predefined-constant">true</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the <a href="#member-user-code-deployment-beta">Member User Code Deployment section</a> for more information on enabling it on the member side and its configuration properties.</p>
</div>
<div class="paragraph">
<p>For the property <code>class-cache-mode</code>, Client User Code Deployment supports only the <code>ETERNAL</code> mode, regardless of the configuration set at the member side (which can be <code>ETERNAL</code> and <code>OFF</code>).</p>
</div>
<div class="paragraph">
<p>For the property, <code>provider-mode</code>, Client User Code Deployment supports only the <code>LOCAL_AND_CACHED_CLASSES</code> mode, regardless of the configuration set at the member side (which can be <code>LOCAL_AND_CACHED_CLASSES</code>, <code>LOCAL_CLASSES_ONLY</code> and <code>OFF</code>).</p>
</div>
<div class="paragraph">
<p>The remaining properties, which are <code>blacklist-prefixes</code>, <code>whitelist-prefixes</code> and <code>provider-filter</code> configured at the member side, will effect the client user code deployment&#8217;s behavior too. For example, assuming that you provide <code>com.foo</code> as a blacklist prefix at the member side, the member will discard the classes with the prefix <code>com.foo</code> loaded by the client.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding-user-library-to-classpath"><a class="anchor" href="#adding-user-library-to-classpath"></a><a class="link" href="#adding-user-library-to-classpath">5.7.2. Adding User Library to CLASSPATH</a></h4>
<div class="paragraph">
<p>When you want to use a Hazelcast feature in a non-Java client, you need to make sure that the Hazelcast member recognizes it. For this, you can use the <code>/user-lib</code> directory that comes with the Hazelcast package and deploy your own library to the member.
Let&#8217;s say you use Hazelcast Node.js client and want to use an entry processor. This processor should be <code>IdentifiedDataSerializable</code> or <code>Portable</code> in the Node.js client. You need to implement the Java equivalents of the processor and its factory on the member side, and put these compiled class or JAR files into the <code>/user-lib</code> directory. Then you can run the <code>start.sh</code> script which compiles these codes and adds them to the classpath.</p>
</div>
<div class="paragraph">
<p>The following is an example code which can be the Java equivalent of entry processor in Node.js client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.hazelcast.map.AbstractEntryProcessor</span>;
<span class="keyword">import</span> <span class="include">com.hazelcast.nio.ObjectDataInput</span>;
<span class="keyword">import</span> <span class="include">com.hazelcast.nio.ObjectDataOutput</span>;
<span class="keyword">import</span> <span class="include">com.hazelcast.nio.serialization.IdentifiedDataSerializable</span>;
 <span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;
 <span class="directive">public</span> <span class="type">class</span> <span class="class">IdentifiedEntryProcessor</span> <span class="directive">extends</span> AbstractEntryProcessor&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; <span class="directive">implements</span> IdentifiedDataSerializable {
     <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> CLASS_ID = <span class="integer">1</span>;
     <span class="directive">private</span> <span class="predefined-type">String</span> value;
     <span class="directive">public</span> IdentifiedEntryProcessor() {
    }
     <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getFactoryId() {
        <span class="keyword">return</span> IdentifiedFactory.FACTORY_ID;
    }
     <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getId() {
        <span class="keyword">return</span> CLASS_ID;
    }
     <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> writeData(ObjectDataOutput out) <span class="directive">throws</span> <span class="exception">IOException</span> {
        out.writeUTF(value);
    }
     <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> readData(ObjectDataInput in) <span class="directive">throws</span> <span class="exception">IOException</span> {
        value = in.readUTF();
    }
     <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> process(<span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; entry) {
        entry.setValue(value);
        <span class="keyword">return</span> value;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can implement the above processor&#8217;s factory as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.hazelcast.nio.serialization.DataSerializableFactory</span>;
<span class="keyword">import</span> <span class="include">com.hazelcast.nio.serialization.IdentifiedDataSerializable</span>;
 <span class="directive">public</span> <span class="type">class</span> <span class="class">IdentifiedFactory</span> <span class="directive">implements</span> DataSerializableFactory {
    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> FACTORY_ID = <span class="integer">5</span>;
     <span class="annotation">@Override</span>
    <span class="directive">public</span> IdentifiedDataSerializable create(<span class="type">int</span> typeId) {
        <span class="keyword">if</span> (typeId == IdentifiedEntryProcessor.CLASS_ID) {
            <span class="keyword">return</span> <span class="keyword">new</span> IdentifiedEntryProcessor();
        }
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following is the configuration for the above factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
    <span class="tag">&lt;serialization&gt;</span>
        <span class="tag">&lt;data-serializable-factories&gt;</span>
            <span class="tag">&lt;data-serializable-factory</span> <span class="attribute-name">factory-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                IdentifiedFactory
            <span class="tag">&lt;/data-serializable-factory&gt;</span>
        <span class="tag">&lt;/data-serializable-factories&gt;</span>
    <span class="tag">&lt;/serialization&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, you can start your Hazelcast member by using the start scripts (<code>start.sh</code> or <code>start.bat</code>) in the <code>/bin</code> directory. The start scripts automatically adds your class and JAR files to the classpath.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="partition-group-configuration"><a class="anchor" href="#partition-group-configuration"></a><a class="link" href="#partition-group-configuration">5.8. Partition Group Configuration</a></h3>
<div class="paragraph">
<p>Hazelcast distributes key objects into partitions using the consistent hashing algorithm. Multiple replicas are created for each partition and those partition replicas are distributed among Hazelcast members. An entry is stored in the members that own replicas of the partition to which the entry&#8217;s key is assigned. The total partition count is 271 by default; you can change it with the configuration property <code>hazelcast.partition.count</code>. Please see the <a href="#system-properties">System Properties appendix</a>.</p>
</div>
<div class="paragraph">
<p>Hazelcast member that owns the primary replica of a partition is called as partition owner. Other replicas are called backups. Based on the configuration, a key object can be kept in multiple replicas of a partition. A member can hold at most one replica of a partition (ownership or backup).</p>
</div>
<div class="paragraph">
<p>By default, Hazelcast distributes partition replicas randomly and equally among the cluster members, assuming all members in the cluster are identical. But what if some members share the same JVM or physical machine or chassis and you want backups of these members to be assigned to members in another machine or chassis? What if processing or memory capacities of some members are different and you do not want an equal number of partitions to be assigned to all members?</p>
</div>
<div class="paragraph">
<p>To deal with such scenarios, you can group members in the same JVM (or physical machine) or members located in the same chassis. Or you can group members to create identical capacity. We call these groups <strong>partition groups</strong>. Partitions are assigned to those partition groups instead of individual members. Backup replicas of a partition which is owned by a partition group are located in other partition groups.</p>
</div>
<div class="sect3">
<h4 id="grouping-types"><a class="anchor" href="#grouping-types"></a><a class="link" href="#grouping-types">5.8.1. Grouping Types</a></h4>
<div class="paragraph">
<p>When you enable partition grouping, Hazelcast presents the following choices for you to configure partition groups.</p>
</div>
<div class="sect4">
<h5 id="host_aware"><a class="anchor" href="#host_aware"></a><a class="link" href="#host_aware">HOST_AWARE</a></h5>
<div class="paragraph">
<p>You can group members automatically using the IP addresses of members, so members sharing the same network interface will be grouped together. All members on the same host (IP address or domain name) will be a single partition group. This helps to avoid data loss when a physical server crashes, because multiple replicas of the same partition are not stored on the same host. But if there are multiple network interfaces or domain names per physical machine, that will make this assumption invalid.</p>
</div>
<div class="paragraph">
<p>Following are declarative and programmatic configuration snippets that show how to enable HOST_AWARE grouping.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;partition-group enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> group-type=<span class="string"><span class="delimiter">&quot;</span><span class="content">HOST_AWARE</span><span class="delimiter">&quot;</span></span> /&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = ...;
PartitionGroupConfig partitionGroupConfig = config.getPartitionGroupConfig();
partitionGroupConfig.setEnabled( <span class="predefined-constant">true</span> )
    .setGroupType( MemberGroupType.HOST_AWARE );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="custom"><a class="anchor" href="#custom"></a><a class="link" href="#custom">CUSTOM</a></h5>
<div class="paragraph">
<p>You can do custom grouping using Hazelcast&#8217;s interface matching configuration. This way, you can add different and multiple interfaces to a group. You can also use wildcards in the interface addresses. For example, the users can create rack-aware or data warehouse partition groups using custom partition grouping.</p>
</div>
<div class="paragraph">
<p>Following are declarative and programmatic configuration examples that show how to enable and use CUSTOM grouping.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;partition-group enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> group-type=<span class="string"><span class="delimiter">&quot;</span><span class="content">CUSTOM</span><span class="delimiter">&quot;</span></span>&gt;
&lt;member-group&gt;
  &lt;<span class="type">interface</span>&gt;<span class="float">10.10</span><span class="float">.0</span>.*&lt;/<span class="class">interface</span>&gt;
  &lt;<span class="type">interface</span>&gt;<span class="float">10.10</span><span class="float">.3</span>.*&lt;/<span class="class">interface</span>&gt;
  &lt;<span class="type">interface</span>&gt;<span class="float">10.10</span><span class="float">.5</span>.*&lt;/<span class="class">interface</span>&gt;
&lt;/member-group&gt;
&lt;member-group&gt;
  &lt;<span class="type">interface</span>&gt;<span class="float">10.10</span><span class="float">.10</span><span class="float">.10</span>-<span class="integer">100</span>&lt;/<span class="class">interface</span>&gt;
  &lt;<span class="type">interface</span>&gt;<span class="float">10.10</span><span class="float">.1</span>.*&lt;/<span class="class">interface</span>&gt;
  &lt;<span class="type">interface</span>&gt;<span class="float">10.10</span><span class="float">.2</span>.*&lt;/<span class="class">interface</span>&gt;
&lt;/member-group&gt;
&lt;/partition-group&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in setting_up_clusters.adoc - include::{javasource}/PartitionGrouping.java[tag=partitiongrouping]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While your cluster was forming, if you configured your members to discover each other by their IP addresses, you should use the IP addresses for the <code>&lt;interface&gt;</code> element. If your members discovered each other by their hostnames, you should use the hostnames.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="per_member"><a class="anchor" href="#per_member"></a><a class="link" href="#per_member">PER_MEMBER</a></h5>
<div class="paragraph">
<p>You can give every member its own group. Each member is a group of its own and primary and backup partitions are distributed randomly (not on the same physical member). This gives the least amount of protection and is the default configuration for a Hazelcast cluster. This grouping type provides good redundancy when Hazelcast members are on separate hosts. However, if multiple instances run on the same host, this type is not a good option.</p>
</div>
<div class="paragraph">
<p>Following are declarative and programmatic configuration snippets that show how to enable PER_MEMBER grouping.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;partition-group enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> group-type=<span class="string"><span class="delimiter">&quot;</span><span class="content">PER_MEMBER</span><span class="delimiter">&quot;</span></span> /&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = ...;
PartitionGroupConfig partitionGroupConfig = config.getPartitionGroupConfig();
partitionGroupConfig.setEnabled( <span class="predefined-constant">true</span> )
    .setGroupType( MemberGroupType.PER_MEMBER );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="zone_aware"><a class="anchor" href="#zone_aware"></a><a class="link" href="#zone_aware">ZONE_AWARE</a></h5>
<div class="paragraph">
<p>You can use ZONE_AWARE configuration with <a href="https://github.com/hazelcast/hazelcast-aws">Hazelcast AWS</a>, <a href="https://github.com/hazelcast/hazelcast-gcp">Hazelcast GCP</a>, <a href="https://github.com/hazelcast/hazelcast-jclouds">Hazelcast jclouds</a> or <a href="https://github.com/hazelcast/hazelcast-azure">Hazelcast Azure</a> Discovery Service plugins.</p>
</div>
<div class="paragraph">
<p>As discovery services, these plugins put zone information to the Hazelcast <a href="#defining-member-attributes">member attributes</a> map during the discovery process. When ZONE_AWARE is configured as partition group type, Hazelcast creates the partition groups with respect to member attributes map entries that include zone information. That means backups are created in the other zones and each zone will be accepted as one partition group.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using the ZONE_AWARE partition grouping, a Hazelcast cluster spanning multiple AZs should have an equal number of members in each AZ. Otherwise, it will result in uneven partition distribution among the members.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is the list of supported attributes which is set by Discovery Service plugins during a Hazelcast member start-up:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.partition.group.zone</code>: For the zones in the same area.</p>
</li>
<li>
<p><code>hazelcast.partition.group.rack</code>: For different racks in the same zone.</p>
</li>
<li>
<p><code>hazelcast.partition.group.host</code>: For a shared physical member if virtualization is used.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
hazelcast-jclouds offers rack or host information in addition to zone information based on cloud provider. In such cases, Hazelcast looks for zone, rack and host information in the given order and create partition groups with available information*
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Following are declarative and programmatic configuration snippets that show how to enable ZONE_AWARE grouping.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;partition-group enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> group-type=<span class="string"><span class="delimiter">&quot;</span><span class="content">ZONE_AWARE</span><span class="delimiter">&quot;</span></span> /&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = ...;
PartitionGroupConfig partitionGroupConfig = config.getPartitionGroupConfig();
partitionGroupConfig.setEnabled( <span class="predefined-constant">true</span> )
    .setGroupType( MemberGroupType.ZONE_AWARE );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="spi"><a class="anchor" href="#spi"></a><a class="link" href="#spi">SPI</a></h5>
<div class="paragraph">
<p>You can provide your own partition group implementation using the SPI configuration. To create your partition group implementation, you need to first extend the <code>DiscoveryStrategy</code> class of the discovery service plugin, override the method <code>public PartitionGroupStrategy getPartitionGroupStrategy()</code> and return the <code>PartitionGroupStrategy</code> configuration in that overridden method.</p>
</div>
<div class="paragraph">
<p>Following is a sample code covering the implementation steps mentioned in the above paragraph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomDiscovery</span> <span class="directive">extends</span> AbstractDiscoveryStrategy {

    <span class="directive">public</span> CustomDiscovery(ILogger logger, <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Comparable</span>&gt; properties) {
        <span class="local-variable">super</span>(logger, properties);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Iterable</span>&lt;DiscoveryNode&gt; discoverNodes() {
        <span class="predefined-type">Iterable</span>&lt;DiscoveryNode&gt; iterable = <span class="comment">//your implementation</span>
        <span class="keyword">return</span> iterable;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> PartitionGroupStrategy getPartitionGroupStrategy() {
        <span class="keyword">return</span> <span class="keyword">new</span> CustomPartitionGroupStrategy();
    }

    <span class="directive">private</span> <span class="type">class</span> <span class="class">CustomPartitionGroupStrategy</span> <span class="directive">implements</span> PartitionGroupStrategy {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Iterable</span>&lt;MemberGroup&gt; getMemberGroups() {
            <span class="predefined-type">Iterable</span>&lt;MemberGroup&gt; iterable = <span class="comment">//your implementation</span>
            <span class="keyword">return</span> iterable;
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logging-configuration"><a class="anchor" href="#logging-configuration"></a><a class="link" href="#logging-configuration">5.9. Logging Configuration</a></h3>
<div class="paragraph">
<p>Hazelcast has a flexible logging configuration and does not depend on any logging framework except JDK logging. It has built-in adapters for a number of logging frameworks and it also supports custom loggers by providing logging interfaces.</p>
</div>
<div class="paragraph">
<p>To use built-in adapters, set the <code>hazelcast.logging.type</code> property to one of the predefined types below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdk</strong>: JDK logging (default)</p>
</li>
<li>
<p><strong>log4j</strong>: Log4j</p>
</li>
<li>
<p><strong>log4j2</strong>: Log4j2</p>
</li>
<li>
<p><strong>slf4j</strong>: Slf4j</p>
</li>
<li>
<p><strong>none</strong>: disable logging</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can set <code>hazelcast.logging.type</code> through declarative configuration, programmatic configuration, or JVM system property.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you choose to use <code>log4j</code>, <code>log4j2</code>, or <code>slf4j</code>, you should include the proper dependencies in the classpath.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  ....
  &lt;properties&gt;
    &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.logging.type</span><span class="delimiter">&quot;</span></span>&gt;log4j&lt;/property&gt;
    ....
  &lt;/properties&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config() ;
config.setProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.logging.type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">log4j</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>System Property</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using JVM parameter: <code>java -Dhazelcast.logging.type=slf4j</code></p>
</li>
<li>
<p>Using System class: <code>System.setProperty( "hazelcast.logging.type", "none" );</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the provided logging mechanisms are not satisfactory, you can implement your own using the custom logging feature. To use it, implement the <code>com.hazelcast.logging.LoggerFactory</code> and <code>com.hazelcast.logging.ILogger</code> interfaces and set the system property <code>hazelcast.logging.class</code> as your custom <code>LoggerFactory</code> class name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.logging.class=foo.bar.MyLoggingFactory</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also listen to logging events generated by Hazelcast runtime by registering <code>LogListener</code>s to <code>LoggingService</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">LogListener listener = <span class="keyword">new</span> LogListener() {
  <span class="directive">public</span> <span class="type">void</span> log( LogEvent logEvent ) {
    <span class="comment">// do something</span>
  }
};
HazelcastInstance instance = Hazelcast.newHazelcastInstance();
LoggingService loggingService = instance.getLoggingService();
loggingService.addLogListener( <span class="predefined-type">Level</span>.INFO, listener );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Through the <code>LoggingService</code>, you can get the currently used ILogger implementation and log your own messages too.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are not using command line for configuring logging, you should be careful about Hazelcast classes. They may be defaulted to <code>jdk</code> logging before newly configured logging is read. When logging mechanism is selected, it will not change.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Below are example configurations for Log4j2 and Log4j. Note that Hazelcast does not recommend any specific logging library, these examples are provided only to demonstrate how to configure the logging. You can use your custom logging as explained above.</p>
</div>
<div class="sect3">
<h4 id="example-log4j2-configuration"><a class="anchor" href="#example-log4j2-configuration"></a><a class="link" href="#example-log4j2-configuration">5.9.1. Example Log4j2 Configuration</a></h4>
<div class="paragraph">
<p>Specify the logging type as Log4j2 and a separate logging configuration file as shown below.</p>
</div>
<div class="paragraph">
<p>Using JVM arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.logging.type=log4j2
-Dlog4j.configurationFile=/path/to/properties/log4j2.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using declarative configuration (<code>hazelcast.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
   ...
   &lt;properties&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.logging.type</span><span class="delimiter">&quot;</span></span>&gt;log4j2&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">log4j2.configuration</span><span class="delimiter">&quot;</span></span>&gt;/path/to/properties/log4j2.properties&lt;/property&gt;
      ...
   &lt;/properties&gt;
   ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following is an example <code>log4j2.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">rootLogger=file
rootLogger.level=info
property.filepath=/path/to/log/files
property.filename=hazelcast

appender.file.type=RollingFile
appender.file.name=RollingFile
appender.file.fileName=<span class="error">$</span>{filepath}/<span class="error">$</span>{filename}.log
appender.file.filePattern=<span class="error">$</span>{filepath}/<span class="error">$</span>{filename}-%d{yyyy-MM-dd}-%i.log.gz
appender.file.layout.type=PatternLayout
appender.file.layout.pattern = %d{yyyy-MM-dd HH:mm:ss} %-<span class="integer">5</span>p %c{<span class="integer">1</span>}:%L - %m%n
appender.file.policies.type=Policies
appender.file.policies.time.type=TimeBasedTriggeringPolicy
appender.file.policies.time.interval=<span class="integer">1</span>
appender.file.policies.time.modulate=<span class="predefined-constant">true</span>
appender.file.policies.size.type=SizeBasedTriggeringPolicy
appender.file.policies.size.size=<span class="integer">50</span>MB
appender.file.strategy.type=DefaultRolloverStrategy
appender.file.strategy.max=<span class="integer">100</span>

rootLogger.appenderRefs=file
rootLogger.appenderRef.file.ref=RollingFile

<span class="error">#</span>Hazelcast specific logs.

<span class="error">#</span>log4j.logger.com.hazelcast=debug

<span class="error">#</span>log4j.logger.com.hazelcast.cluster=debug
<span class="error">#</span>log4j.logger.com.hazelcast.partition=debug
<span class="error">#</span>log4j.logger.com.hazelcast.partition.InternalPartitionService=debug
<span class="error">#</span>log4j.logger.com.hazelcast.nio=debug
<span class="error">#</span>log4j.logger.com.hazelcast.hibernate=debug</code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable the debug logs for all Hazelcast operations uncomment the below line in the above configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">log4j.logger.com.hazelcast=debug</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you do not need detailed logs, the default settings is enough. Using the Hazelcast specific lines in the above configuration file, you can select to see specific logs (cluster, partition, hibernate, etc.) in desired levels.</p>
</div>
</div>
<div class="sect3">
<h4 id="example-log4j-configuration"><a class="anchor" href="#example-log4j-configuration"></a><a class="link" href="#example-log4j-configuration">5.9.2. Example Log4j Configuration</a></h4>
<div class="paragraph">
<p>Its configuration is similar to that of Log4j2. Below is the JVM argument way of specifying the logging type and configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.logging.type=log4j
-Dlog4j.configuration=file:/path/to/properties/log4j.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following is an example <code>log4j.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">log4j.rootLogger=INFO,file

log4j.appender.file=org.apache.log4j.RollingFileAppender
log4j.appender.file.File=/path/to/log/files/hazelcast.log
log4j.appender.file.layout=org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} %p [%c{<span class="integer">1</span>}] - %m%n
log4j.appender.file.maxFileSize=<span class="integer">50</span>MB
log4j.appender.file.maxBackupIndex=<span class="integer">100</span>
log4j.appender.file.threshold=DEBUG

<span class="error">#</span>log4j.logger.com.hazelcast=debug

<span class="error">#</span>log4j.logger.com.hazelcast.cluster=debug
<span class="error">#</span>log4j.logger.com.hazelcast.partition=debug
<span class="error">#</span>log4j.logger.com.hazelcast.partition.InternalPartitionService=debug
<span class="error">#</span>log4j.logger.com.hazelcast.nio=debug
<span class="error">#</span>log4j.logger.com.hazelcast.hibernate=debug</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="other-network-configurations"><a class="anchor" href="#other-network-configurations"></a><a class="link" href="#other-network-configurations">5.10. Other Network Configurations</a></h3>
<div class="paragraph">
<p>All network related configurations are performed via the <code>network</code> element in the Hazelcast XML configuration file or the class <code>NetworkConfig</code> when using programmatic configuration. Following subsections describe the available configurations that you can perform under the <code>network</code> element.</p>
</div>
<div class="sect3">
<h4 id="public-address"><a class="anchor" href="#public-address"></a><a class="link" href="#public-address">5.10.1. Public Address</a></h4>
<div class="paragraph">
<p><code>public-address</code> overrides the public address of a member. By default, a member selects its socket address as its public address. But behind a network address translation (NAT), two endpoints (members) may not be able to see/access each other. If both members set their public addresses to their defined addresses on NAT, then that way they can communicate with each other. In this case, their public addresses are not an address of a local network interface but a virtual address defined by NAT. It is optional to set and useful when you have a private cloud. Note that, the value for this element should be given in the format <strong><code>host IP address:port number</code></strong>. See the following examples.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;network&gt;
    &lt;<span class="directive">public</span>-address&gt;<span class="float">11.22</span><span class="float">.33</span><span class="float">.44</span>:<span class="integer">5555</span>&lt;/<span class="directive">public</span>-address&gt;
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
config.getNetworkConfig()
    .setPublicAddress( <span class="string"><span class="delimiter">&quot;</span><span class="content">11.22.33.44:5555</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="port"><a class="anchor" href="#port"></a><a class="link" href="#port">5.10.2. Port</a></h4>
<div class="paragraph">
<p>You can specify the ports that Hazelcast will use to communicate between cluster members. Its default value is <code>5701</code>. The following are example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;network&gt;
  &lt;port port-count=<span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span> auto-increment=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">5701</span>&lt;/port&gt;
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
config.getNetworkConfig().setPort( <span class="integer">5701</span> )
    .setPortAutoIncrement( <span class="predefined-constant">true</span> ).setPortCount( <span class="integer">20</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>According to the above example, Hazelcast will try to find free ports between 5701 and 5720.</p>
</div>
<div class="paragraph">
<p><code>port</code> has the following attributes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>port-count</code>: By default, Hazelcast will try 100 ports to bind. Meaning that, if you set the value of port as 5701, as members are joining to the cluster, Hazelcast tries to find ports between 5701 and 5801. You can choose to change the port count in the cases like having large instances on a single machine or willing to have only a few ports to be assigned. The parameter <code>port-count</code> is used for this purpose, whose default value is 100.</p>
</li>
<li>
<p><code>auto-increment</code>:  In some cases you may want to choose to use only one port. In that case, you can disable the auto-increment feature of <code>port</code> by setting <code>auto-increment</code> to <code>false</code>. The <code>port-count</code> attribute is not used when auto-increment feature is disabled.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="outbound-ports"><a class="anchor" href="#outbound-ports"></a><a class="link" href="#outbound-ports">5.10.3. Outbound Ports</a></h4>
<div class="paragraph">
<p>By default, Hazelcast lets the system pick up an ephemeral port during socket bind operation. But security policies/firewalls may require you to restrict outbound ports to be used by Hazelcast-enabled applications. To fulfill this requirement, you can configure Hazelcast to use only defined outbound ports. The following are example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;network&gt;
  &lt;outbound-ports&gt;
    &lt;!-- ports between <span class="integer">33000</span> and <span class="integer">35000</span> --&gt;
    &lt;ports&gt;<span class="integer">33000</span>-<span class="integer">35000</span>&lt;/ports&gt;
    &lt;!-- comma separated ports --&gt;
    &lt;ports&gt;<span class="integer">37000</span>,<span class="integer">37001</span>,<span class="integer">37002</span>,<span class="integer">37003</span>&lt;/ports&gt;
    &lt;ports&gt;<span class="integer">38000</span>,<span class="integer">38500</span>-<span class="integer">38600</span>&lt;/ports&gt;
  &lt;/outbound-ports&gt;
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
NetworkConfig networkConfig = config.getNetworkConfig();
<span class="comment">// ports between 35000 and 35100</span>
networkConfig.addOutboundPortDefinition(<span class="string"><span class="delimiter">&quot;</span><span class="content">35000-35100</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// comma separated ports</span>
networkConfig.addOutboundPortDefinition(<span class="string"><span class="delimiter">&quot;</span><span class="content">36001, 36002, 36003</span><span class="delimiter">&quot;</span></span>);
networkConfig.addOutboundPort(<span class="integer">37000</span>);
networkConfig.addOutboundPort(<span class="integer">37001</span>);
...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use port ranges and/or comma separated ports.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As shown in the programmatic configuration, you use the method <code>addOutboundPort</code> to add only one port. If you need to add a group of ports, then use the method <code>addOutboundPortDefinition</code>.</p>
</div>
<div class="paragraph">
<p>In the declarative configuration, the element <code>ports</code> can be used for both single and multiple port definitions. When you set this element to  <code>0</code> or  <code>*</code>, your operating system (not Hazelcast) will select a free port from the ephemeral range.</p>
</div>
</div>
<div class="sect3">
<h4 id="reuse-address"><a class="anchor" href="#reuse-address"></a><a class="link" href="#reuse-address">5.10.4. Reuse Address</a></h4>
<div class="paragraph">
<p>When you shutdown a cluster member, the server socket port will be in the <code>TIME_WAIT</code> state for the next couple of minutes. If you start the member right after shutting it down, you may not be able to bind it to the same port because it is in the <code>TIME_WAIT</code> state. If you set the <code>reuse-address</code> element to <code>true</code>, the <code>TIME_WAIT</code> state is ignored and you can bind the member to the same port again.</p>
</div>
<div class="paragraph">
<p>The following are example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;network&gt;
  &lt;reuse-address&gt;<span class="predefined-constant">true</span>&lt;/reuse-address&gt;
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
NetworkConfig networkConfig = config.getNetworkConfig();

networkConfig.setReuseAddress( <span class="predefined-constant">true</span> );
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="join"><a class="anchor" href="#join"></a><a class="link" href="#join">5.10.5. Join</a></h4>
<div class="paragraph">
<p>The <code>join</code> configuration element is used to discover Hazelcast members and enable them to form a cluster. Hazelcast provides multicast, TCP/IP, EC2 and jclouds discovery mechanisms. These mechanisms are explained the <a href="#discovery-mechanisms">Discovery Mechanisms section</a>. This section describes all the sub-elements and attributes of <code>join</code> element. The following are example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;network&gt;
     &lt;join&gt;
         &lt;multicast enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
             &lt;multicast-group&gt;<span class="float">224.2</span><span class="float">.2</span><span class="float">.3</span>&lt;/multicast-group&gt;
             &lt;multicast-port&gt;<span class="integer">54327</span>&lt;/multicast-port&gt;
             &lt;multicast-time-to-live&gt;<span class="integer">32</span>&lt;/multicast-time-to-live&gt;
             &lt;multicast-timeout-seconds&gt;<span class="integer">2</span>&lt;/multicast-timeout-seconds&gt;
             &lt;trusted-interfaces&gt;
                &lt;<span class="type">interface</span>&gt;<span class="float">192.168</span><span class="float">.1</span><span class="float">.102</span>&lt;/<span class="class">interface</span>&gt;
             &lt;/trusted-interfaces&gt;
         &lt;/multicast&gt;
         &lt;tcp-ip enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>&gt;
             &lt;required-member&gt;<span class="float">192.168</span><span class="float">.1</span><span class="float">.104</span>&lt;/required-member&gt;
             &lt;member&gt;<span class="float">192.168</span><span class="float">.1</span><span class="float">.104</span>&lt;/member&gt;
             &lt;members&gt;<span class="float">192.168</span><span class="float">.1</span><span class="float">.105</span>,<span class="float">192.168</span><span class="float">.1</span><span class="float">.106</span>&lt;/members&gt;
         &lt;/tcp-ip&gt;
         &lt;aws enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>&gt;
             &lt;access-key&gt;my-access-key&lt;/access-key&gt;
             &lt;secret-key&gt;my-secret-key&lt;/secret-key&gt;
             &lt;region&gt;us-west-<span class="integer">1</span>&lt;/region&gt;
             &lt;host-header&gt;ec2.amazonaws.com&lt;/host-header&gt;
             &lt;security-group-name&gt;hazelcast-sg&lt;/security-group-name&gt;
             &lt;tag-key&gt;type&lt;/tag-key&gt;
             &lt;tag-value&gt;hz-members&lt;/tag-value&gt;
         &lt;/aws&gt;
         &lt;discovery-strategies&gt;
           &lt;discovery-strategy ... /&gt;
         &lt;/discovery-strategies&gt;
     &lt;/join&gt;
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
NetworkConfig network = config.getNetworkConfig();
JoinConfig join = network.getJoin();
join.getMulticastConfig().setEnabled( <span class="predefined-constant">false</span> )
            .addTrustedInterface( <span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.1.102</span><span class="delimiter">&quot;</span></span> );
join.getTcpIpConfig().addMember( <span class="string"><span class="delimiter">&quot;</span><span class="content">10.45.67.32</span><span class="delimiter">&quot;</span></span> ).addMember( <span class="string"><span class="delimiter">&quot;</span><span class="content">10.45.67.100</span><span class="delimiter">&quot;</span></span> )
            .setRequiredMember( <span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.10.100</span><span class="delimiter">&quot;</span></span> ).setEnabled( <span class="predefined-constant">true</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>join</code> element has the following sub-elements and attributes.</p>
</div>
<div class="sect4">
<h5 id="multicast-element"><a class="anchor" href="#multicast-element"></a><a class="link" href="#multicast-element">multicast element</a></h5>
<div class="paragraph">
<p>The <code>multicast</code> element includes parameters to fine tune the multicast join mechanism.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Specifies whether the multicast discovery is enabled or not, <code>true</code> or <code>false</code>.</p>
</li>
<li>
<p><code>multicast-group</code>: The multicast group IP address. Specify it when you want to create clusters within the same network. Values can be between 224.0.0.0 and 239.255.255.255. Its default value is 224.2.2.3.</p>
</li>
<li>
<p><code>multicast-port</code>: The multicast socket port that the Hazelcast member listens to and sends discovery messages through. Its default value is 54327.</p>
</li>
<li>
<p><code>multicast-time-to-live</code>: Time-to-live value for multicast packets sent out to control the scope of multicasts. See more information <a href="http://www.tldp.org/HOWTO/Multicast-HOWTO-2.html">here</a>.</p>
</li>
<li>
<p><code>multicast-timeout-seconds</code>: Only when the members are starting up, this timeout (in seconds) specifies the period during which a member waits for a multicast response from another member. For example, if you set it as 60 seconds, each member will wait for 60 seconds until a leader member is selected. Its default value is 2 seconds.</p>
</li>
<li>
<p><code>trusted-interfaces</code>: Includes IP addresses of trusted members. When a member wants to join to the cluster, its join request will be rejected if it is not a trusted member. You can give an IP addresses range using the wildcard (*) on the last digit of IP address, e.g., 192.168.1.\* or 192.168.1.100-110.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="tcp-ip-element"><a class="anchor" href="#tcp-ip-element"></a><a class="link" href="#tcp-ip-element">tcp-ip element</a></h5>
<div class="paragraph">
<p>The <code>tcp-ip</code> element includes parameters to fine tune the TCP/IP join mechanism.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Specifies whether the TCP/IP discovery is enabled or not. Values can be <code>true</code> or <code>false</code>.</p>
</li>
<li>
<p><code>required-member</code>: IP address of the required member. Cluster will only formed if the member with this IP address is found.</p>
</li>
<li>
<p><code>member</code>: IP address(es) of one or more well known members. Once members are connected to these well known ones, all member addresses will be communicated with each other. You can also give comma separated IP addresses using the <code>members</code> element.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>tcp-ip</code> element also accepts the <code>interface</code> parameter. Please refer to the <a href="#interfaces">Interfaces element description</a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>connection-timeout-seconds</code>: Defines the connection timeout in seconds. This is the maximum amount of time Hazelcast is going to try to connect to a well known member before giving up. Setting it to a too low value could mean that a member is not able to connect to a cluster. Setting it to a too high value means that member startup could slow down because of longer timeouts, for example when a well known member is not up. Increasing this value is recommended if you have many IPs listed and the members cannot properly build up the cluster. Its default value is 5 seconds.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="aws-element"><a class="anchor" href="#aws-element"></a><a class="link" href="#aws-element">aws element</a></h5>
<div class="paragraph">
<p>The <code>aws</code> element includes parameters to allow the members to form a cluster on the Amazon EC2 environment.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Specifies whether the EC2 discovery is enabled or not, <code>true</code> or <code>false</code>.</p>
</li>
<li>
<p><code>access-key</code>, <code>secret-key</code>: Access and secret keys of your account on EC2.</p>
</li>
<li>
<p><code>region</code>: The region where your members are running. Its default value is <code>us-east-1</code>. You need to specify this if the region is other than the default one.</p>
</li>
<li>
<p><code>host-header</code>: The URL that is the entry point for a web service. It is optional.</p>
</li>
<li>
<p><code>security-group-name</code>: Name of the security group you specified at the EC2 management console. It is used to narrow the Hazelcast members to be within this group. It is optional.</p>
</li>
<li>
<p><code>tag-key</code>, <code>tag-value</code>: To narrow the members in the cloud down to only Hazelcast members, you can set these parameters as the ones you specified in the EC2 console. They are optional.</p>
</li>
<li>
<p><code>connection-timeout-seconds</code>: The maximum amount of time, in seconds, Hazelcast will try to connect to a well known member before giving up. Setting this value too low could mean that a member is not able to connect to a cluster. Setting the value too high means that member startup could slow down because of longer timeouts (for example, when a well known member is not up). Increasing this value is recommended if you have many IPs listed and the members cannot properly build up the cluster. Its default value is 5 seconds.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are using a cloud provider other than AWS, you can use the programmatic configuration to specify a TCP/IP cluster. The members will need to be retrieved from that provider, e.g., jclouds.</p>
</div>
</div>
<div class="sect4">
<h5 id="discovery-strategies-element"><a class="anchor" href="#discovery-strategies-element"></a><a class="link" href="#discovery-strategies-element">discovery-strategies element</a></h5>
<div class="paragraph">
<p>The <code>discovery-strategies</code> element configures internal or external discovery strategies based on the Hazelcast Discovery SPI. For further information, please refer to the <a href="#discovery-spi">Discovery SPI section</a> and the vendor documentation of the used discovery strategy.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="awsclient-configuration"><a class="anchor" href="#awsclient-configuration"></a><a class="link" href="#awsclient-configuration">5.10.6. AWSClient Configuration</a></h4>
<div class="paragraph">
<p>To make sure EC2 instances are found correctly, you can use the <code>AWSClient</code> class. It determines the private IP addresses of EC2 instances to be connected. Give the <code>AWSClient</code> class the values for the parameters that you specified in the <code>aws</code> element, as shown below. You will see whether your EC2 instances are found.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main( <span class="predefined-type">String</span><span class="type">[]</span> args )<span class="directive">throws</span> <span class="exception">Exception</span>{
  AwsConfig config = <span class="keyword">new</span> AwsConfig();
  config.setSecretKey( ... ) ;
  config.setSecretKey( ... );
  config.setRegion( ... );
  config.setSecurityGroupName( ... );
  config.setTagKey( ... );
  config.setTagValue( ... );
  config.setEnabled( <span class="predefined-constant">true</span> );
  AWSClient client = <span class="keyword">new</span> AWSClient( config );
  <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; ipAddresses = client.getPrivateIpAddresses();
  <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">addresses found:</span><span class="delimiter">&quot;</span></span> + ipAddresses );
  <span class="keyword">for</span> ( <span class="predefined-type">String</span> ip: ipAddresses ) {
    <span class="predefined-type">System</span>.out.println( ip );
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="interfaces"><a class="anchor" href="#interfaces"></a><a class="link" href="#interfaces">5.10.7. Interfaces</a></h4>
<div class="paragraph">
<p>You can specify which network interfaces that Hazelcast should use. Servers mostly have more than one network interface, so you may want to list the valid IPs. Range characters ('*' and '-') can be used for simplicity. For instance, 10.3.10.\* refers to IPs between 10.3.10.0 and 10.3.10.255. Interface 10.3.10.4-18 refers to IPs between 10.3.10.4 and 10.3.10.18 (4 and 18 included). If network interface configuration is enabled (it is disabled by default) and if Hazelcast cannot find a matching interface, then it will print a message on the console and will not start on that member.</p>
</div>
<div class="paragraph">
<p>The following are example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  ...
  &lt;network&gt;
    ...
    &lt;interfaces enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;<span class="type">interface</span>&gt;<span class="float">10.3</span><span class="float">.16</span>.*&lt;/<span class="class">interface</span>&gt;
      &lt;<span class="type">interface</span>&gt;<span class="float">10.3</span><span class="float">.10</span><span class="float">.4</span>-<span class="integer">18</span>&lt;/<span class="class">interface</span>&gt;
      &lt;<span class="type">interface</span>&gt;<span class="float">192.168</span><span class="float">.1</span><span class="float">.3</span>&lt;/<span class="class">interface</span>&gt;
    &lt;/interfaces&gt;
  &lt;/network&gt;
  ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
NetworkConfig network = config.getNetworkConfig();
InterfacesConfig interfaceConfig = network.getInterfaces();
interfaceConfig.setEnabled( <span class="predefined-constant">true</span> )
            .addInterface( <span class="string"><span class="delimiter">&quot;</span><span class="content">192.168.1.3</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ipv6-support"><a class="anchor" href="#ipv6-support"></a><a class="link" href="#ipv6-support">5.10.8. IPv6 Support</a></h4>
<div class="paragraph">
<p>Hazelcast supports IPv6 addresses seamlessly (This support is switched off by default, please see the note at the end of this section).</p>
</div>
<div class="paragraph">
<p>All you need is to define IPv6 addresses or interfaces in the network configuration. The only current limitation is that you cannot define wildcard IPv6 addresses in the TCP/IP join configuration (<code>tcp-ip</code> element). <a href="#interfaces">Interfaces</a> configuration does not have this limitation, you can configure wildcard IPv6 interfaces in the same way as IPv4 interfaces.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  ...
  &lt;network&gt;
    &lt;port auto-increment=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">5701</span>&lt;/port&gt;
    &lt;join&gt;
      &lt;multicast enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;multicast-group&gt;FF02:<span class="integer">0</span>:<span class="integer">0</span>:<span class="integer">0</span>:<span class="integer">0</span>:<span class="integer">0</span>:<span class="integer">0</span>:<span class="integer">1</span>&lt;/multicast-group&gt;
        &lt;multicast-port&gt;<span class="integer">54327</span>&lt;/multicast-port&gt;
      &lt;/multicast&gt;
      &lt;tcp-ip enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;member&gt;[fe80::<span class="integer">223</span>:<span class="integer">6</span>cff:fe93:<span class="integer">7</span>c7e]:<span class="integer">5701</span>&lt;/member&gt;
        &lt;<span class="type">interface</span>&gt;<span class="float">192.168</span><span class="float">.1</span><span class="float">.0</span>-<span class="integer">7</span>&lt;/<span class="class">interface</span>&gt;
        &lt;<span class="type">interface</span>&gt;<span class="float">192.168</span><span class="float">.1</span>.*&lt;/<span class="class">interface</span>&gt;
        &lt;<span class="type">interface</span>&gt;<span class="class">fe80</span>:<span class="integer">0</span>:<span class="integer">0</span>:<span class="integer">0</span>:<span class="integer">45</span>c5:<span class="integer">47</span>ee:fe15:<span class="integer">493</span>a&lt;/<span class="type">interface</span>&gt;
      &lt;/<span class="class">tcp</span>-ip&gt;
    &lt;/join&gt;
    &lt;interfaces enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;<span class="type">interface</span>&gt;<span class="float">10.3</span><span class="float">.16</span>.*&lt;/<span class="class">interface</span>&gt;
      &lt;<span class="type">interface</span>&gt;<span class="float">10.3</span><span class="float">.10</span><span class="float">.4</span>-<span class="integer">18</span>&lt;/<span class="class">interface</span>&gt;
      &lt;<span class="type">interface</span>&gt;<span class="class">fe80</span>:<span class="integer">0</span>:<span class="integer">0</span>:<span class="integer">0</span>:<span class="integer">45</span>c5:<span class="integer">47</span>ee:fe15:*&lt;/<span class="type">interface</span>&gt;
      &lt;<span class="class">interface</span>&gt;fe80::<span class="integer">223</span>:<span class="integer">6</span>cff:fe93:<span class="integer">0</span>-<span class="integer">5555</span>&lt;/<span class="type">interface</span>&gt;
    &lt;/<span class="class">interfaces</span>&gt;
    ...
  &lt;/network&gt;
  ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>JVM has two system properties for setting the preferred protocol stack (IPv4 or IPv6) as well as the preferred address family types (inet4 or inet6). On a dual stack machine, IPv6 stack is preferred by default, you can change this through the <code>java.net.preferIPv4Stack=&lt;true|false&gt;</code> system property. When querying name services, JVM prefers IPv4 addresses over IPv6 addresses and will return an IPv4 address if possible. You can change this through <code>java.net.preferIPv6Addresses=&lt;true|false&gt;</code> system property.</p>
</div>
<div class="paragraph">
<p>Also see additional <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/net/ipv6_guide/">details on IPv6 support in Java</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
IPv6 support has been switched off by default, since some platforms have issues using the IPv6 stack. Some other platforms such as Amazon AWS have no support at all. To enable IPv6 support, just set configuration property <code>hazelcast.prefer.ipv4.stack</code> to <strong>false</strong>. Please refer to the <a href="#system-properties">System Properties appendix</a> for details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="member-address-provides-spi"><a class="anchor" href="#member-address-provides-spi"></a><a class="link" href="#member-address-provides-spi">5.10.9. Member Address Provider SPI</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This SPI is not intended to provide addresses of other cluster members with which the Hazelcast instance will form a cluster. To do that, refer to the other network configuration sections above.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, Hazelcast chooses the public and bind address. You can influence on the choice by defining a <code>public-address</code> in the configuration or by using other properties mentioned above. In some cases, though, these properties are not enough and the default address picking strategy will choose wrong addresses. This may be the case when deploying Hazelcast in some cloud environments, such as AWS, when using Docker or when the instance is deployed behind a NAT and the <code>public-address</code> property is not enough (please see the <a href="#public-address">Public Address section</a>).</p>
</div>
<div class="paragraph">
<p>In these cases, it is possible to configure the bind and public address in a more advanced way. You can provide an implementation of the <code>com.hazelcast.spi.MemberAddressProvider</code> interface which will provide the bind and public address. The implementation may then choose these addresses in any way - it may read from a system property or file or even invoke a web service to retrieve the public and private address.</p>
</div>
<div class="paragraph">
<p>The details of the implementation depend heavily on the environment in which Hazelcast is deployed. As such, we will demonstrate how to configure Hazelcast to use a simplified custom member address provider SPI implementation. An example of an implementation is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">SimpleMemberAddressProvider</span> <span class="directive">implements</span> MemberAddressProvider {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">InetSocketAddress</span> getBindAddress() {
        <span class="comment">// determine the address using some configuration, calling an API, ...</span>
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">InetSocketAddress</span>(hostname, port);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">InetSocketAddress</span> getPublicAddress() {
        <span class="comment">// determine the address using some configuration, calling an API, ...</span>
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">InetSocketAddress</span>(hostname, port);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if the bind address port is <code>0</code> then it will use a port as configured in the Hazelcast network configuration (see the <a href="#port">Port section</a>). If the public address port is set to <code>0</code> then it will broadcast the same port that it is bound to. If you wish to bind to any local interface, you may return <code>new InetSocketAddress((InetAddress) null, port)</code> from the <code>getBindAddress()</code> address.</p>
</div>
<div class="paragraph">
<p>The following configuration examples contain properties that will be provided to the constructor of the provided class. If you do not provide any properties, the class may have either a no-arg constructor or a constructor accepting a single <code>java.util.Properties</code> instance. On the other hand, if you do provide properties in the configuration, the class must have a constructor accepting a single <code>java.util.Properties</code> instance.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;network&gt;
     &lt;member-address-provider enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
         &lt;<span class="type">class</span>-<span class="class">name</span>&gt;SimpleMemberAddressProvider&lt;/<span class="type">class</span>-<span class="class">name</span>&gt;
         &lt;properties&gt;
             &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">prop1</span><span class="delimiter">&quot;</span></span>&gt;prop1-value&lt;/property&gt;
             &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">prop2</span><span class="delimiter">&quot;</span></span>&gt;prop2-value&lt;/property&gt;
         &lt;/properties&gt;
     &lt;/member-address-provider&gt;
     &lt;!-- other network configuration --&gt;
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
MemberAddressProviderConfig memberAddressProviderConfig = config.getNetworkConfig().getMemberAddressProviderConfig();
memberAddressProviderConfig
      .setEnabled(<span class="predefined-constant">true</span>)
      .setClassName(MemberAddressProviderWithStaticProperties.class.getName());
<span class="predefined-type">Properties</span> properties = memberAddressProviderConfig.getProperties();
properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">prop1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">prop1-value</span><span class="delimiter">&quot;</span></span>);
properties.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">prop2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">prop2-value</span><span class="delimiter">&quot;</span></span>);

config.getNetworkConfig().getJoin().getMulticastConfig().setEnabled(<span class="predefined-constant">false</span>);

<span class="comment">// perform other configuration</span>

Hazelcast.newHazelcastInstance(config);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="failure-detector-configuration"><a class="anchor" href="#failure-detector-configuration"></a><a class="link" href="#failure-detector-configuration">5.11. Failure Detector Configuration</a></h3>
<div class="paragraph">
<p>A failure detector is responsible to determine if a member in the cluster is unreachable or crashed. The most important problem in failure detection is to distinguish whether a member is still alive but slow or has crashed. But according to the famous <a href="http://dl.acm.org/citation.cfm?doid=3149.214121">FLP result</a>, it is impossible to distinguish a crashed member from a slow one in an asynchronous system. A workaround to this limitation is to use unreliable failure detectors. An unreliable failure detector allows a member to suspect that others have failed, usually based on liveness criteria but it can make mistakes to a certain degree.</p>
</div>
<div class="paragraph">
<p>Hazelcast has two built-in failure detectors; Deadline Failure Detector and Phi Accrual Failure Detector.</p>
</div>
<div class="paragraph">
<p>Since 3.9.1, Hazelcast provides yet another failure detector, Ping Failure Detector, that, if enabled, works in parallel with the above ones, but identifies
failures on OSI Layer 3 (Network Layer). This detector is by default disabled.</p>
</div>
<div class="paragraph">
<p>Note that, Hazelcast also offers failure detectors for its Java client. Please refer to the <a href="#java-client-failure-detectors">Client Failure Detectors section</a> for more information.</p>
</div>
<div class="sect3">
<h4 id="deadline-failure-detector"><a class="anchor" href="#deadline-failure-detector"></a><a class="link" href="#deadline-failure-detector">5.11.1. Deadline Failure Detector</a></h4>
<div class="paragraph">
<p><em>Deadline Failure Detector</em> uses an absolute timeout for missing/lost heartbeats. After timeout, a member is considered as crashed/unavailable and marked as suspected.</p>
</div>
<div class="paragraph">
<p><em>Deadline Failure Detector</em> has two configuration properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.heartbeat.interval.seconds</code>: This is the interval at which member heartbeat messages are sent to each other.</p>
</li>
<li>
<p><code>hazelcast.max.no.heartbeat.seconds</code>: This is the timeout which defines when a cluster member is suspected because it has not sent any heartbeats.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use <em>Deadline Failure Detector</em> configuration property <code>hazelcast.heartbeat.failuredetector.type</code> should be set to <code>"deadline"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
    [...]
    &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.failuredetector.type</span><span class="delimiter">&quot;</span></span>&gt;deadline&lt;/property&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.interval.seconds</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">5</span>&lt;/property&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.max.no.heartbeat.seconds</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">120</span>&lt;/property&gt;
        [...]
    &lt;/properties&gt;
    [...]
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = ...;
config.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.failuredetector.type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">deadline</span><span class="delimiter">&quot;</span></span>);
config.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.interval.seconds</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>);
config.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.max.no.heartbeat.seconds</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">120</span><span class="delimiter">&quot;</span></span>);
[...]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>Deadline Failure Detector</em> is the default failure detector in Hazelcast.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="phi-accrual-failure-detector"><a class="anchor" href="#phi-accrual-failure-detector"></a><a class="link" href="#phi-accrual-failure-detector">5.11.2. Phi Accrual Failure Detector</a></h4>
<div class="paragraph">
<p>This is the failure detector based on <a href="https://www.computer.org/csdl/proceedings/srds/2004/2239/00/22390066-abs.html">The Phi Accrual Failure Detector' by Hayashibara et al.</a></p>
</div>
<div class="paragraph">
<p>Phi Accrual Failure Detectorkeeps track of the intervals between heartbeats in a sliding window of time andmeasures the mean and variance of these samples and calculates a value of suspicion level (Phi). The value ofphiwill increase when the period since the last heartbeat gets longer.If the network becomes slow or unreliable, the resulting mean and variance will increase, there will need to be a longer period for which no heartbeat is received before the member is suspected.</p>
</div>
<div class="paragraph">
<p><code>hazelcast.heartbeat.interval.seconds</code>and <code>hazelcast.max.no.heartbeat.seconds</code>propertieswill still be used as period of heartbeat messages and deadline of heartbeat messages. Since <em>Phi Accrual Failure Detector</em> is adaptive to network conditions, a much lower <code>hazelcast.max.no.heartbeat.seconds</code> can be defined than <em>Deadline Failure Detector</em>'s timeout.</p>
</div>
<div class="paragraph">
<p>Additional to above two properties, <em>Phi Accrual Failure Detector</em> has three more configuration properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.heartbeat.phiaccrual.failuredetector.threshold</code>: This is the phi threshold for suspicion. After calculated phi exceeds this threshold, a member is considered as unreachable and marked as suspected. A low threshold allows to detect member crashes/failures faster but can generate more mistakes and cause wrong member suspicions. A high threshold generates fewer mistakes but is slower to detect actual crashes/failures.</p>
<div class="paragraph">
<p><code>phi = 1</code> means likeliness that we will make a mistake is about <code>10%</code>. The likeliness is about <code>1%</code> with <code>phi = 2</code>, <code>0.1%</code> with <code>phi = 3</code> and so on. Default phi threshold is 10.</p>
</div>
</li>
<li>
<p><code>hazelcast.heartbeat.phiaccrual.failuredetector.sample.size</code>: Number of samples to keep for history. Its default value is 200.</p>
</li>
<li>
<p><code>hazelcast.heartbeat.phiaccrual.failuredetector.min.std.dev.millis</code>: Minimum standard deviation to use for the normal distribution used when calculating phi. Too low standard deviation might result in too much sensitivity.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use <em>Phi Accrual Failure Detector</em>, configuration property <code>hazelcast.heartbeat.failuredetector.type</code> should be set to <code>"phi-accrual"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
   [...]
   &lt;properties&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.failuredetector.type</span><span class="delimiter">&quot;</span></span>&gt;phi-accrual&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.interval.seconds</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">1</span>&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.max.no.heartbeat.seconds</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">60</span>&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.phiaccrual.failuredetector.threshold</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">10</span>&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.phiaccrual.failuredetector.sample.size</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">200</span>&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.phiaccrual.failuredetector.min.std.dev.millis</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">100</span>&lt;/property&gt;
      [...]
   &lt;/properties&gt;
   [...]
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = ...;
config.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.failuredetector.type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">phi-accrual</span><span class="delimiter">&quot;</span></span>);
config.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.interval.seconds</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>);
config.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.max.no.heartbeat.seconds</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">60</span><span class="delimiter">&quot;</span></span>);
config.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.phiaccrual.failuredetector.threshold</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>);
config.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.phiaccrual.failuredetector.sample.size</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span>);
config.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.heartbeat.phiaccrual.failuredetector.min.std.dev.millis</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span>);
[...]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ping-failure-detector"><a class="anchor" href="#ping-failure-detector"></a><a class="link" href="#ping-failure-detector">5.11.3. Ping Failure Detector</a></h4>
<div class="paragraph">
<p>The Ping Failure Detector may be configured in addition to one of Deadline and Phi Accrual Failure Detectors. It operates at Layer 3 of the OSI protocol and provides much quicker and more deterministic detection of hardware and other lower level events. This detector may be configured to perform an extra check after a member is suspected by one of the other detectors, or it can work in parallel, which is the default. This way hardware and network level issues will be detected more quickly.</p>
</div>
<div class="paragraph">
<p>This failure detector is based on <code>InetAddress.isReachable()</code>.
When the JVM process has enough permissions to create RAW sockets, the implementation will choose to rely on ICMP Echo requests. This is preferred.</p>
</div>
<div class="paragraph">
<p>If there are not enough permissions, it can be configured to fallback on attempting a TCP Echo on port 7. In the latter case, both a successful connection or an explicit rejection will be treated as "Host is Reachable". Or, it can be forced to use only RAW sockets. This is not preferred as each call creates a heavy weight socket and moreover the Echo service is typically disabled.</p>
</div>
<div class="paragraph">
<p>For the Ping Failure Detector to rely <strong>only</strong> on ICMP Echo requests, there are some criteria that need to be met.</p>
</div>
<div class="sect4">
<h5 id="requirements-and-linuxunix-configuration"><a class="anchor" href="#requirements-and-linuxunix-configuration"></a><a class="link" href="#requirements-and-linuxunix-configuration">Requirements and Linux/Unix Configuration</a></h5>
<div class="ulist">
<ul>
<li>
<p><strong>Supported OS: as of Java 1.8 only Linux/Unix environments are supported</strong>. This detector relies on ICMP, i.e., the protocol behind the <code>ping</code> command. It tries to issue the ping attempts periodically, and their responses are used to determine the reachability of the remote member. However, you cannot simply create an ICMP Echo Request because these type of packets do not rely on any of the preexisting transport protocols such as TCP. In order to create such a request, you must have the privileges to create RAW sockets (please see <a href="https://linux.die.net/man/7/raw">https://linux.die.net/man/7/raw</a>). Most operating systems allow this to the root users, however Unix based ones are more flexible and allow the use of custom privileges per process
instead of requiring root access. Therefore, this detector is supported only on Linux.</p>
</li>
<li>
<p><strong>The Java executable must have the <code>cap_net_raw</code> capability.</strong> As described in the above requirement, on Linux, you have the ability to define extra capabilities to a single process, which would allow the process to interact with the RAW sockets. This interaction is achieved via the capability <code>cap_net_raw</code> (please see <a href="https://linux.die.net/man/7/capabilities">https://linux.die.net/man/7/capabilities</a>). To enable this capability run the following command:</p>
<div class="paragraph">
<p><code>sudo setcap cap_net_raw=+ep &lt;JDK_HOME&gt;/jre/bin/java</code></p>
</div>
</li>
<li>
<p><strong>When running with custom capabilities, the dynamic linker on Linux will reject loading libs from untrusted paths.</strong> Since you have now <code>cap_net_raw</code> as a custom capability for a process, it becomes suspicious to the dynamic linker and it will throw an error: <code>java: error while loading shared libraries: libjli.so: cannot open shared object file: No such file or directory</code></p>
<div class="ulist">
<ul>
<li>
<p>To overcome this rejection, the <code>&lt;JDK_HOME&gt;/jre/lib/amd64/jli/</code> path needs to be added in the <code>ld.conf</code>. Run the following command to do this: <code>echo "&lt;JDK_HOME&gt;/jre/lib/amd64/jli/" &gt;&gt; /etc/ld.so.conf.d/java.conf &amp;&amp; sudo ldconfig</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>ICMP Echo Requests must not be blocked by the receiving hosts.</strong> <code>/proc/sys/net/ipv4/icmp_echo_ignore_all</code> set to <code>0</code>. Run the following command:</p>
<div class="paragraph">
<p><code>echo 0 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</code></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If any of the above criteria isn&#8217;t met, then the <code>isReachable</code> will always fallback on TCP Echo attempts on port 7.</p>
</div>
<div class="paragraph">
<p>To be able to use the Ping Failure Detector, please add the following properties in your Hazelcast declarative configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
   [...]
    &lt;properties&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.icmp.enabled</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">true</span>&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.icmp.parallel.mode</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">true</span>&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.icmp.timeout</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">1000</span>&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.icmp.max.attempts</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">3</span>&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.icmp.interval</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">1000</span>&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.icmp.ttl</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">0</span>&lt;/property&gt;
      [...]
   &lt;/properties&gt;
   [...]
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.icmp.enabled</code> (default false) - Enables legacy ICMP detection mode, works cooperatively with the existing failure detector and only kicks-in after a pre-defined period has passed with no heartbeats from a member.</p>
</li>
<li>
<p><code>hazelcast.icmp.parallel.mode</code> (default true) - Enabling the parallel ping detector, works separately from the other detectors.</p>
</li>
<li>
<p><code>hazelcast.icmp.timeout</code> (default 1000) - Number of milliseconds until a ping attempt is considered failed if there was no reply.</p>
</li>
<li>
<p><code>hazelcast.icmp.max.attempts</code> (default 3) - The maximum number of ping attempts before the member/node gets suspected by the detector.</p>
</li>
<li>
<p><code>hazelcast.icmp.interval</code> (default 1000) - The interval, in milliseconds, between each ping attempt. 1000ms (1 sec) is also the minimum interval allowed.</p>
</li>
<li>
<p><code>hazelcast.icmp.ttl</code> (default 0) - The maximum number of hops the packets should go through or 0 for the default.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the above configuration, the Ping detector will attempt 3 pings, one every second and will wait up-to 1 second for each to complete. If after 3 seconds, there was no successful ping, the member will get suspected.</p>
</div>
<div class="paragraph">
<p>To enforce the <a href="#requirements-and-linuxunix-configuration">Requirements</a>, the property <code>hazelcast.icmp.echo.fail.fast.on.startup</code> can also be set to <code>true</code>, in which case, if any of the requirements
isn&#8217;t met, Hazelcast will fail to start.</p>
</div>
<div class="paragraph">
<p>Below is a summary table of all possible configuration combinations of the ping failure detector.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Ping Failure Detector Possible Configuration Combinations</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ICMP</th>
<th class="tableblock halign-left valign-top">Parallel</th>
<th class="tableblock halign-left valign-top">Fail-Fast</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Linux</th>
<th class="tableblock halign-left valign-top">Windows</th>
<th class="tableblock halign-left valign-top">macOS</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Completely disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy ping mode. This works hand-to-hand with the OSI Layer 7 failure detector (see. phi or deadline in sections above). Ping in this mode will only kick in after a period when there are no hearbeats received, in which case the remote Hazelcast member will be pinged up-to 5 times. If all 5 attempts fail, the member gets suspected.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported  ICMP Echo if available - Falls back on TCP Echo on port 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported  TCP Echo on port 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported ICMP Echo if available - Falls back on TCP Echo on port 7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parallel ping detector, works in parallel with the configured failure detector. Checks periodically if members are live (OSI Layer 3) and suspects them immediately, regardless of the other detectors.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported  ICMP Echo if available - Falls back on TCP Echo on port 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported  TCP Echo on port 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported  ICMP Echo if available - Falls back on TCP Echo on port 7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parallel ping detector, works in parallel with the configured failure detector. Checks periodically if members are live (OSI Layer 3) and suspects them immediately, regardless of the other detectors.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported - Requires OS Configuration  Enforcing ICMP Echo if available - No start up if not available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Supported - Requires root privileges</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rolling-member-upgrades"><a class="anchor" href="#rolling-member-upgrades"></a><a class="link" href="#rolling-member-upgrades">6. Rolling Member Upgrades</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise</strong></p>
</div>
<div class="paragraph">
<p>This chapter explains the procedure of upgrading the version of Hazelcast members in a running cluster without interrupting the operation of the cluster.</p>
</div>
<div class="sect2">
<h3 id="terminology"><a class="anchor" href="#terminology"></a><a class="link" href="#terminology">6.1. Terminology</a></h3>
<div class="ulist">
<ul>
<li>
<p><strong>Minor version</strong>: A version change after the decimal point, e.g., 3.8 and 3.9.</p>
</li>
<li>
<p><strong>Patch version</strong>: A version change after the second decimal point, e.g., 3.8.1 and 3.8.2.</p>
</li>
<li>
<p><strong>Member codebase version</strong>: The <code>major.minor.patch</code> version of the Hazelcast binary on which the member executes. For example, when running on <code>hazelcast-3.8.jar</code>, your member&#8217;s codebase version is <code>3.8.0</code>.</p>
</li>
<li>
<p><strong>Cluster version</strong>: The <code>major.minor</code> version at which the cluster operates. This ensures that cluster members are able to communicate using the same cluster protocol and
determines the feature set exposed by the cluster.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hazelcast-members-compatibility-guarantees"><a class="anchor" href="#hazelcast-members-compatibility-guarantees"></a><a class="link" href="#hazelcast-members-compatibility-guarantees">6.2. Hazelcast Members Compatibility Guarantees</a></h3>
<div class="paragraph">
<p>Hazelcast members operating on binaries of the same major and minor version numbers are compatible regardless of patch version.
  For example, in a cluster with members running on version 3.7.1, it is possible to perform a rolling upgrade to 3.7.2 by shutting down, upgrading to <code>hazelcast-3.7.2.jar</code> binary
  and starting each member one by one. <em>Patch level compatibility applies to both Hazelcast IMDG and Hazelcast IMDG Enterprise</em>.</p>
</div>
<div class="paragraph">
<p>Starting with Hazelcast IMDG Enterprise 3.8, each next minor version released will be compatible with the previous one. For example, it will
 be possible to perform a rolling upgrade on a cluster running Hazelcast IMDG Enterprise 3.8 to Hazelcast IMDG Enterprise 3.9 whenever that is released.
 <em>Rolling upgrades across minor versions is a Hazelcast IMDG Enterprise feature, starting with version 3.8</em>.</p>
</div>
<div class="paragraph">
<p>The compatibility guarantees described above are given in the context of rolling member upgrades and only apply to GA (general availability) releases. It is never advisable to run a
 cluster with members running on different patch or minor versions for prolonged periods of time.</p>
</div>
</div>
<div class="sect2">
<h3 id="rolling-upgrade-procedure"><a class="anchor" href="#rolling-upgrade-procedure"></a><a class="link" href="#rolling-upgrade-procedure">6.3. Rolling Upgrade Procedure</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The version numbers used in the paragraph below are only used as an example.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s assume a cluster with four members running on codebase version <code>3.8.0</code> with cluster version <code>3.8</code>, that should be upgraded to codebase version
<code>3.9.0</code> and cluster version <code>3.9</code>. The rolling upgrade process for this cluster, i.e., replacing existing <code>3.8.0</code> members one by one with an upgraded
one at version <code>3.9.0</code>, includes the following steps which should be repeated for each member:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Shutdown gracefully an existing <code>3.8.0</code> member.</p>
</li>
<li>
<p>Wait until all partition migrations are completed; during migrations, membership changes (member joins or removals) are not allowed.</p>
</li>
<li>
<p>Update the member with the new <code>3.9.0</code> Hazelcast binaries.</p>
</li>
<li>
<p>Start the member and wait until it joins the cluster. You should see something like the following in your logs:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
INFO: [<span class="float">192.168</span><span class="float">.2</span><span class="float">.2</span>]:<span class="integer">5701</span> [cluster] [<span class="float">3.9</span>] Hazelcast <span class="float">3.9</span> (<span class="integer">20170630</span> - a67dc3a) starting at [<span class="float">192.168</span><span class="float">.2</span><span class="float">.2</span>]:<span class="integer">5701</span>
...
INFO: [<span class="float">192.168</span><span class="float">.2</span><span class="float">.2</span>]:<span class="integer">5701</span> [cluster] [<span class="float">3.9</span>] Cluster version set to <span class="float">3.8</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The version in brackets <code>[3.9]</code> still denotes the member&#8217;s codebase version (running on the hypothetical <code>hazelcast-3.9.jar</code> binary). Once the member
 locates existing cluster members, it sends its join request to the master. The master validates that the new member is allowed to join the cluster and
 lets the new member know that the cluster is currently operating at <code>3.8</code> cluster version. The new member sets <code>3.8</code> as its cluster version and starts operating
 normally.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>At this point all members of the cluster have been upgraded to codebase version `3.9.0` but the cluster still operates at cluster version `3.8`. In order to use `3.9` features
the cluster version must be changed to `3.9`. There are two ways to accomplish this:</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#rolling-upgrade">Management Center</a>.</p>
</li>
<li>
<p>Use the command line <a href="#using-the-script-cluster-sh">cluster.sh script</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need to upgrade your Management Center version <strong>before</strong> upgrading the member version if you want to
change cluster version using Management Center. Management Center is compatible with the previous minor version of
Hazelcast, starting with version 3.9. For example, Management Center 3.9 works with both Hazelcast IMDG
3.8 and 3.9. To change your cluster version to 3.9, you need Management Center 3.9.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="network-partitions-and-rolling-upgrades"><a class="anchor" href="#network-partitions-and-rolling-upgrades"></a><a class="link" href="#network-partitions-and-rolling-upgrades">6.4. Network Partitions and Rolling Upgrades</a></h3>
<div class="paragraph">
<p>In the event of network partitions which split your cluster into two subclusters, split-brain handling works as explained in the <a href="#network-partitioning">Network Partitioning chapter</a>, with the
additional constraint that two subclusters will only merge as long as they operate on the same cluster version. This is a requirement to ensure that all members participating
in each one of the subclusters will be able to operate as members of the merged cluster at the same cluster version.</p>
</div>
<div class="paragraph">
<p>With regards to rolling upgrades, the above constraint implies that if a network partition occurs while a change of cluster version is in progress, then with some unlucky timing, one subcluster may be upgraded to the new cluster version and another subcluster may have upgraded members but still operate at the old cluster version.</p>
</div>
<div class="paragraph">
<p>In order for the two subclusters to merge, it is necessary to change the cluster version of the subcluster that still operates at the old cluster version, so that both subclusters
will be operating at the same, upgraded cluster version and will be able to merge as soon as the network partition is fixed.</p>
</div>
</div>
<div class="sect2">
<h3 id="rolling-upgrade-faq"><a class="anchor" href="#rolling-upgrade-faq"></a><a class="link" href="#rolling-upgrade-faq">6.5. Rolling Upgrade FAQ</a></h3>
<div class="paragraph">
<p>The following provide answers to the frequently asked questions related to rolling member upgrades.</p>
</div>
<div class="paragraph">
<p><strong>How is the cluster version set?</strong></p>
</div>
<div class="paragraph">
<p>When a new member starts, it is not yet joined to a cluster; therefore its cluster version is still undetermined. In order for the cluster version to be
set, one of the following must happen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the member cannot locate any members of the cluster to join or is configured without a joiner: in this case, the member will appoint itself as the master of a new single-member cluster and its cluster version will be set to the <code>major.minor</code> version of its own codebase version. So a standalone member running on codebase version <code>3.8.0</code> will set its own cluster version to <code>3.8</code>.</p>
</li>
<li>
<p>the member that is starting locates members of the cluster and identifies which is the master: in this case, the master will validate that the joining member&#8217;s codebase version is compatible with the current cluster version. If it is found to be compatible, then the member joins and the master sends the cluster version, which is set on the joining member. Otherwise, the starting member fails to join and shuts down.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>What if a new Hazelcast minor version changes fundamental cluster protocol communication, like join messages?</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The version numbers used in the paragraph below are only used as an example.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On startup, as answered in the above question (How is the cluster version set?), the cluster version is not yet known to a member that has not joined any cluster.
By default the newly started member will use the cluster protocol that corresponds to its codebase version until this member joins a cluster
(so for codebase <code>3.9.0</code> this means implicitly assuming cluster version <code>3.9</code>). If, hypothetically, major changes in discovery &amp; join operations
have been introduced which do not allow the member to join a <code>3.8</code> cluster, then the member should be explicitly configured to start
assuming a <code>3.8</code> cluster version.</p>
</div>
<div class="paragraph">
<p><strong>Do I have to upgrade clients to work with rolling upgrades?</strong></p>
</div>
<div class="paragraph">
<p>Starting with Hazelcast 3.6, the Hazelcast Open Binary Client Protocol was introduced. Clients which implement the Open Binary Client Protocol
are compatible with Hazelcast version 3.6 and newer minor versions. Thus older client versions will be compatible with next minor versions. Newer clients
connected to a cluster will operate at the lower version of capabilities until all members are upgraded and the cluster version upgrade occurs.</p>
</div>
<div class="paragraph">
<p><strong>Can I stop and start multiple members at once during a rolling member upgrade?</strong></p>
</div>
<div class="paragraph">
<p>It is not recommended due to potential network partitions. It is advised to always stop and start one member in each upgrade step.</p>
</div>
<div class="paragraph">
<p><strong>Can I upgrade my business app together with Hazelcast while doing a rolling member upgrade?</strong></p>
</div>
<div class="paragraph">
<p>Yes, but make sure to make the new version of your app compatible with the old one since there will be a timespan when both versions interoperate. Checking if two versions of your app are compatible includes verifying binary and algorithmic compatibility and some other steps.</p>
</div>
<div class="paragraph">
<p>It is worth mentioning that a business app upgrade is orthogonal to a rolling member upgrade. A rolling business app upgrade may be done without upgrading the members.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="distributed-data-structures"><a class="anchor" href="#distributed-data-structures"></a><a class="link" href="#distributed-data-structures">7. Distributed Data Structures</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As mentioned in the <a href="#hazelcast-overview">Overview section</a>, Hazelcast offers distributed implementations of Java interfaces. Below is the list of these implementations with links to the corresponding sections in this manual.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Standard utility collections</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="#map">Map</a> is the distributed implementation of <code>java.util.Map</code>. It lets you read from and write to a Hazelcast map with methods such as <code>get</code> and <code>put</code>.</p>
</li>
<li>
<p><a href="#queue">Queue</a> is the distributed implementation of <code>java.util.concurrent.BlockingQueue</code>. You can add an item in one member and remove it from another one.</p>
</li>
<li>
<p><a href="#ringbuffer">Ringbuffer</a> is implemented for reliable eventing system.</p>
</li>
<li>
<p><a href="#set">Set</a> is the distributed and concurrent implementation of <code>java.util.Set</code>. It does not allow duplicate elements and does not preserve their order.</p>
</li>
<li>
<p><a href="#list">List</a> is similar to Hazelcast Set. The only difference is that it allows duplicate elements and preserves their order.</p>
</li>
<li>
<p><a href="#multimap">Multimap</a> is a specialized Hazelcast map. It is a distributed data structure where you can store multiple values for a single key.</p>
</li>
<li>
<p><a href="#replicated-map">Replicated Map</a> does not partition data. It does not spread data to different cluster members. Instead, it replicates the data to all members.</p>
</li>
<li>
<p><a href="#cardinality-estimator">Cardinality Estimator</a> is a data structure which implements Flajolet&#8217;s HyperLogLog algorithm.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Topic</strong> is the distributed mechanism for publishing messages that are delivered to multiple subscribers. It is also known as the publish/subscribe (pub/sub) messaging model. Please see the <a href="#topic">Topic section</a> for more information. Hazelcast also has a structure called Reliable Topic which uses the same interface of Hazelcast Topic. The difference is that it is backed up by the Ringbuffer data structure. Please see the <a href="#reliable-topic">Reliable Topic section</a>.</p>
</li>
<li>
<p><strong>Concurrency utilities</strong></p>
<div class="ulist">
<ul>
<li>
<p><a href="#lock">Lock</a> is the distributed implementation of <code>java.util.concurrent.locks.Lock</code>. When you use lock, the critical section that Hazelcast Lock guards is guaranteed to be executed by only one thread in the entire cluster.</p>
</li>
<li>
<p><a href="#isemaphore">ISemaphore</a> is the distributed implementation of <code>java.util.concurrent.Semaphore</code>. When performing concurrent activities, semaphores offer permits to control the thread counts.</p>
</li>
<li>
<p><a href="#iatomiclong">IAtomicLong</a> is the distributed implementation of <code>java.util.concurrent.atomic.AtomicLong</code>. Most of AtomicLong&#8217;s operations are available. However, these operations involve remote calls and hence their performances differ from AtomicLong, due to being distributed.</p>
</li>
<li>
<p><a href="#iatomicreference">IAtomicReference</a> is the distributed implementation of <code>java.util.concurrent.atomic.AtomicReference</code>. When you need to deal with a reference in a distributed environment, you can use Hazelcast IAtomicReference.</p>
</li>
<li>
<p><a href="#idgenerator">IdGenerator</a> is used to generate cluster-wide unique identifiers. ID generation occurs almost at the speed of <code>AtomicLong.incrementAndGet()</code>. This feature is deprecated, please use <a href="#flakeidgenerator">FlakeIdGenerator</a> instead.</p>
</li>
<li>
<p><a href="#icountdownlatch">ICountdownLatch</a> is the distributed implementation of <code>java.util.concurrent.CountDownLatch</code>. Hazelcast CountDownLatch is a gate keeper for concurrent activities. It enables the threads to wait for other threads to complete their operations.</p>
</li>
<li>
<p><a href="#pn-counter">PN counter</a> is a distributed data structure where each Hazelcast instance can increment and decrement the counter value and these updates are propagated to all replicas.</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#event-journal">Event Journal</a> is a distributed data structure that stores the history of mutation actions on map or cache.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="overview-of-hazelcast-distributed-objects"><a class="anchor" href="#overview-of-hazelcast-distributed-objects"></a><a class="link" href="#overview-of-hazelcast-distributed-objects">7.1. Overview of Hazelcast Distributed Objects</a></h3>
<div class="paragraph">
<p>Hazelcast has two types of distributed objects in terms of their partitioning strategies:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Data structures where each partition stores a part of the instance, namely partitioned data structures.</p>
</li>
<li>
<p>Data structures where a single partition stores the whole instance, namely non-partitioned data structures.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Partitioned Hazelcast data structures are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Map</p>
</li>
<li>
<p>MultiMap</p>
</li>
<li>
<p>Cache (Hazelcast JCache implementation)</p>
</li>
<li>
<p>PN Counter</p>
</li>
<li>
<p>Event Journal</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Non-partitioned Hazelcast data structures are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Queue</p>
</li>
<li>
<p>Set</p>
</li>
<li>
<p>List</p>
</li>
<li>
<p>Ringbuffer</p>
</li>
<li>
<p>Lock</p>
</li>
<li>
<p>ISemaphore</p>
</li>
<li>
<p>IAtomicLong</p>
</li>
<li>
<p>IAtomicReference</p>
</li>
<li>
<p>FlakeIdGenerator</p>
</li>
<li>
<p>ICountdownLatch</p>
</li>
<li>
<p>Cardinality Estimator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Besides these, Hazelcast also offers the Replicated Map structure as explained in the above <strong>Standard utility collections</strong> list.</p>
</div>
<div class="sect3">
<h4 id="loading-and-destroying-a-distributed-object"><a class="anchor" href="#loading-and-destroying-a-distributed-object"></a><a class="link" href="#loading-and-destroying-a-distributed-object">7.1.1. Loading and Destroying a Distributed Object</a></h4>
<div class="paragraph">
<p>Hazelcast offers a <code>get</code> method for most of its distributed objects. To load an object, first create a Hazelcast instance and then use the related <code>get</code> method on this instance. Following example code snippet creates an Hazelcast instance and a map on this instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; customers = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>As to the configuration of distributed object, Hazelcast uses the default settings from the file <code>hazelcast.xml</code> that comes with your Hazelcast download. Of course, you can provide an explicit configuration in this XML or programmatically according to your needs. Please see the <a href="#understanding-configuration">Understanding Configuration section</a>.</p>
</div>
<div class="paragraph">
<p>Note that, most of Hazelcast&#8217;s distributed objects are created lazily, i.e., a distributed object is created once the first operation accesses it.</p>
</div>
<div class="paragraph">
<p>If you want to use an object you loaded in other places, you can safely reload it using its reference without creating a new Hazelcast instance (<code>customers</code> in the above example).</p>
</div>
<div class="paragraph">
<p>To destroy a Hazelcast distributed object, you can use the method <code>destroy</code>. This method clears and releases all resources of the object. Therefore, you must use it with care since a reload with the same object reference after the object is destroyed creates a new data structure without an error. Please see the following example code where one of the queues are destroyed and the other one is accessed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/MapMember.java[tag=mapmember]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you start the <code>Member</code> above, the output will be as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">q1.size: <span class="integer">1</span> q2.size:<span class="integer">1</span>
q1.size: <span class="integer">0</span> q2.size:<span class="integer">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you see, no error is generated and a new queue resource is created.</p>
</div>
</div>
<div class="sect3">
<h4 id="controlling-partitions"><a class="anchor" href="#controlling-partitions"></a><a class="link" href="#controlling-partitions">7.1.2. Controlling Partitions</a></h4>
<div class="paragraph">
<p>Hazelcast uses the name of a distributed object to determine which partition it will be put. Let&#8217;s load two semaphores as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
ISemaphore s1 = hazelcastInstance.getSemaphore(<span class="string"><span class="delimiter">&quot;</span><span class="content">s1</span><span class="delimiter">&quot;</span></span>);
ISemaphore s2 = hazelcastInstance.getSemaphore(<span class="string"><span class="delimiter">&quot;</span><span class="content">s2</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since these semaphores have different names, they will be placed into different partitions. If you want to put these two into the same partition, you use the <code>@</code> symbol as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
ISemaphore s1 = hazelcastInstance.getSemaphore(<span class="string"><span class="delimiter">&quot;</span><span class="content">s1@foo</span><span class="delimiter">&quot;</span></span>);
ISemaphore s2 = hazelcastInstance.getSemaphore(<span class="string"><span class="delimiter">&quot;</span><span class="content">s2@foo</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, these two semaphores will be put into the same partition whose partition key is <code>foo</code>. Note that you can use the method <code>getPartitionKey</code> to learn the partition key of a distributed object. It may be useful when you want to create an object in the same partition of an existing object. Please see its usage as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> partitionKey = s1.getPartitionKey();
ISemaphore s3 = hazelcastInstance.getSemaphore(<span class="string"><span class="delimiter">&quot;</span><span class="content">s3@</span><span class="delimiter">&quot;</span></span>+partitionKey);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="common-features-of-all-hazelcast-data-structures"><a class="anchor" href="#common-features-of-all-hazelcast-data-structures"></a><a class="link" href="#common-features-of-all-hazelcast-data-structures">7.1.3. Common Features of all Hazelcast Data Structures</a></h4>
<div class="ulist">
<ul>
<li>
<p>If a member goes down, its backup replica (which holds the same data) will dynamically redistribute the data, including the ownership and locks on them, to the remaining live members. As a result, there will not be any data loss.</p>
</li>
<li>
<p>There is no single cluster master that can be a single point of failure. Every member in the cluster has equal rights and responsibilities. No single member is superior. There is no dependency on an external 'server' or 'master'.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="example-distributed-object-code"><a class="anchor" href="#example-distributed-object-code"></a><a class="link" href="#example-distributed-object-code">7.1.4. Example Distributed Object Code</a></h4>
<div class="paragraph">
<p>Here is an example of how you can retrieve existing data structure instances (map, queue, set, lock, topic, etc.) and how you can listen for instance events, such as an instance being created or destroyed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/SampleDOL.java[tag=sampledol]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="map"><a class="anchor" href="#map"></a><a class="link" href="#map">7.2. Map</a></h3>
<div class="paragraph">
<p>Hazelcast Map (<code>IMap</code>) extends the interface <code>java.util.concurrent.ConcurrentMap</code> and hence <code>java.util.Map</code>. It is the distributed implementation of Java map. You can perform operations like reading and writing from/to a Hazelcast map with the well known get and put methods.</p>
</div>
<hr>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
IMap data structure can also be used by <a href="https://jet.hazelcast.org/">Hazelcast Jet</a> for Real-Time Stream Processing (by enabling the Event Journal on your map) and Fast Batch Processing. Hazelcast Jet uses IMap as a source (reads data from IMap) and as a sink (writes data to IMap). Please see the <a href="https://jet.hazelcast.org/use-cases/fast-batch-processing/">Fast Batch Processing</a> and <a href="https://jet.hazelcast.org/use-cases/real-time-stream-processing/">Real-Time Stream Processing</a> use cases for Hazelcast Jet. Please also see <a href="https://docs.hazelcast.org/docs/jet/latest/manual/#connector-imdg">here</a> in the Hazelcast Jet Reference Manual to learn how Jet uses IMap, i.e., how it can read from and write to IMap.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="getting-a-map-and-putting-an-entry"><a class="anchor" href="#getting-a-map-and-putting-an-entry"></a><a class="link" href="#getting-a-map-and-putting-an-entry">7.2.1. Getting a Map and Putting an Entry</a></h4>
<div class="paragraph">
<p>Hazelcast will partition your map entries and their backups, and almost evenly distribute them onto all Hazelcast members. Each member carries approximately "number of map entries * 2 * 1/n" entries, where <strong>n</strong> is the number of members in the cluster. For example, if you have a member with 1000 objects to be stored in the cluster and then you start a second member, each member will both store 500 objects and back up the 500 objects in the other member.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create a Hazelcast instance and fill a map named <code>Capitals</code> with key-value pairs using the following code. Use the HazelcastInstance <code>getMap</code> method to get the map, then use the map <code>put</code> method to put an entry into the map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hzInstance = Hazelcast.newHazelcastInstance();
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; capitalcities = hzInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">capitals</span><span class="delimiter">&quot;</span></span> );
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Tokyo</span><span class="delimiter">&quot;</span></span> );
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Paris</span><span class="delimiter">&quot;</span></span> );
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Washington</span><span class="delimiter">&quot;</span></span> );
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">4</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Ankara</span><span class="delimiter">&quot;</span></span> );
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Brussels</span><span class="delimiter">&quot;</span></span> );
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">6</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Amsterdam</span><span class="delimiter">&quot;</span></span> );
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">7</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">New Delhi</span><span class="delimiter">&quot;</span></span> );
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">8</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">London</span><span class="delimiter">&quot;</span></span> );
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">9</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Berlin</span><span class="delimiter">&quot;</span></span> );
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Oslo</span><span class="delimiter">&quot;</span></span> );
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">11</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Moscow</span><span class="delimiter">&quot;</span></span> );
    ...
    capitalcities.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">120</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Stockholm</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run this code, a cluster member is created with a map whose entries are distributed across the members' partitions. See the below illustration. For now, this is a single member cluster.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/1Node.png" alt="Map Entries in a Single Member">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note that some of the partitions will not contain any data entries since we only have 120 objects and the partition count is 271 by default. This count is configurable and can be changed using the system property <code>hazelcast.partition.count</code>. Please see the <a href="#system-properties">System Properties appendix</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="creating-a-member-for-map-backup"><a class="anchor" href="#creating-a-member-for-map-backup"></a><a class="link" href="#creating-a-member-for-map-backup">7.2.2. Creating A Member for Map Backup</a></h4>
<div class="paragraph">
<p>Now let&#8217;s create a second member by running the above code again. This will create a cluster with two members. This is also where backups of entries are created - remember the backup partitions mentioned in the <a href="#hazelcast-overview">Hazelcast Overview section</a>. The following illustration shows two members and how the data and its backup is distributed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/2Nodes.png" alt="Map Entries with Backups in Two Members">
</div>
</div>
<div class="paragraph">
<p>As you see, when a new member joins the cluster, it takes ownership and loads some of the data in the cluster. Eventually, it will carry almost "(1/n <code>*</code> total-data) + backups" of the data, reducing the load on other members.</p>
</div>
<div class="paragraph">
<p><code>HazelcastInstance.getMap()</code> returns an instance of <code>com.hazelcast.core.IMap</code> which extends
the <code>java.util.concurrent.ConcurrentMap</code> interface. Methods like
<code>ConcurrentMap.putIfAbsent(key,value)</code> and <code>ConcurrentMap.replace(key,value)</code> can be used
on the distributed map, as shown in the example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/BasicMapOperations.java[tag=bmo]</code></pre>
</div>
</div>
<div class="paragraph">
<p>All <code>ConcurrentMap</code> operations such as <code>put</code> and <code>remove</code> might wait if the key is locked by another thread in the local or remote JVM. But, they will eventually return with success. <code>ConcurrentMap</code> operations never throw a <code>java.util.ConcurrentModificationException</code>.</p>
</div>
<div class="paragraph">
<p>Also see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#data-affinity">Data Affinity section</a>.</p>
</li>
<li>
<p><a href="#using-wildcards">Map Configuration with wildcards</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="backing-up-maps"><a class="anchor" href="#backing-up-maps"></a><a class="link" href="#backing-up-maps">7.2.3. Backing Up Maps</a></h4>
<div class="paragraph">
<p>Hazelcast distributes map entries onto multiple cluster members (JVMs). Each member holds some portion of the data.</p>
</div>
<div class="paragraph">
<p>Distributed maps have one backup by default. If a member goes down, your data is recovered using the backups in the cluster. There are two types of backups as described below: <em>sync</em> and <em>async</em>.</p>
</div>
<div class="sect4">
<h5 id="creating-sync-backups"><a class="anchor" href="#creating-sync-backups"></a><a class="link" href="#creating-sync-backups">Creating Sync Backups</a></h5>
<div class="paragraph">
<p>To provide data safety, Hazelcast allows you to specify the number of backup copies you want to have. That way, data on a cluster member will be copied onto other member(s).</p>
</div>
<div class="paragraph">
<p>To create synchronous backups, select the number of backup copies using the <code>backup-count</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;backup-count&gt;</span>1<span class="tag">&lt;/backup-count&gt;</span>
  <span class="tag">&lt;/map&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When this count is 1, a map entry will have its backup on one other member in the cluster. If you set it to 2, then a map entry will have its backup on two other members. You can set it to 0 if you do not want your entries to be backed up, e.g., if performance is more important than backing up. The maximum value for the backup count is 6.</p>
</div>
<div class="paragraph">
<p>Hazelcast supports both synchronous and asynchronous backups. By default, backup operations are synchronous and configured with <code>backup-count</code>. In this case, backup operations block operations until backups are successfully copied to backup members (or deleted from backup members in case of remove) and acknowledgements are received. Therefore, backups are updated before a <code>put</code> operation is completed, provided that the cluster is stable. Sync backup operations have a blocking cost which may lead to latency issues.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-async-backups"><a class="anchor" href="#creating-async-backups"></a><a class="link" href="#creating-async-backups">Creating Async Backups</a></h5>
<div class="paragraph">
<p>Asynchronous backups, on the other hand, do not block operations. They are fire &amp; forget and do not require acknowledgements; the backup operations are performed at some point in time.</p>
</div>
<div class="paragraph">
<p>To create asynchronous backups, select the number of async backups with the <code>async-backup-count</code> property. An example is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;backup-count&gt;</span>0<span class="tag">&lt;/backup-count&gt;</span>
    <span class="tag">&lt;async-backup-count&gt;</span>1<span class="tag">&lt;/async-backup-count&gt;</span>
  <span class="tag">&lt;/map&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#consistency-and-replication-model">Consistency and Replication Model</a> for more detail.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Backups increase memory usage since they are also kept in memory.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A map can have both sync and async backups at the same time.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="enabling-backup-reads"><a class="anchor" href="#enabling-backup-reads"></a><a class="link" href="#enabling-backup-reads">Enabling Backup Reads</a></h5>
<div class="paragraph">
<p>By default, Hazelcast has one sync backup copy. If <code>backup-count</code> is set to more than 1, then each member will carry both owned entries and backup copies of other members. So for the <code>map.get(key)</code> call, it is possible that the calling member has a backup copy of that key. By default, <code>map.get(key)</code> will always read the value from the actual owner of the key for consistency.</p>
</div>
<div class="paragraph">
<p>To enable backup reads (read local backup entries), set the value of the <code>read-backup-data</code> property to <strong>true</strong>. Its default value is <strong>false</strong> for consistency. Enabling backup reads can improve performance but on the other hand it can cause stale reads while still preserving monotonic-reads property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;backup-count&gt;</span>0<span class="tag">&lt;/backup-count&gt;</span>
    <span class="tag">&lt;async-backup-count&gt;</span>1<span class="tag">&lt;/async-backup-count&gt;</span>
    <span class="tag">&lt;read-backup-data&gt;</span>true<span class="tag">&lt;/read-backup-data&gt;</span>
  <span class="tag">&lt;/map&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This feature is available when there is at least one sync or async backup.</p>
</div>
<div class="paragraph">
<p>Please note that if you are performing a read from a backup, you should take into account that your hits to the keys in the backups are not reflected as hits to the original keys on the primary members. This has an impact on IMap&#8217;s maximum idle seconds or time-to-live seconds expiration. Therefore, even though there is a hit on a key in backups, your original key on the primary member may expire.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="map-eviction"><a class="anchor" href="#map-eviction"></a><a class="link" href="#map-eviction">7.2.4. Map Eviction</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Starting with Hazelcast 3.7, Hazelcast Map uses a new eviction mechanism which is based on the sampling of entries. Please see the <a href="#eviction-algorithm">Eviction Algorithm section</a> for details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Unless you delete the map entries manually or use an eviction policy, they will remain in the map. Hazelcast supports policy-based eviction for distributed maps. Currently supported policies are LRU (Least Recently Used) and LFU (Least Frequently Used).</p>
</div>
<div class="sect4">
<h5 id="understanding-map-eviction"><a class="anchor" href="#understanding-map-eviction"></a><a class="link" href="#understanding-map-eviction">Understanding Map Eviction</a></h5>
<div class="paragraph">
<p>Hazelcast Map performs eviction based on partitions. For example, when you specify a size using the <code>PER_NODE</code> attribute for <code>max-size</code> (please see <a href="#configuring-map-eviction">Configuring Map Eviction</a>), Hazelcast internally calculates the maximum size for every partition. Hazelcast uses the following equation to calculate the maximum size of a partition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">partition-maximum-size = max-size * member-count / partition-count</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the <code>partition-maximum-size</code> is less than 1 in the equation above, it will be set to 1 (otherwise, the partitions would be emptied immediately by eviction due to the exceedance of <code>max-size</code> being less than 1).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The eviction process starts according to this calculated partition maximum size when you try to put an entry. When entry count in that partition exceeds partition maximum size, eviction starts on that partition.</p>
</div>
<div class="paragraph">
<p>Assume that you have the following figures as examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Partition count: 200</p>
</li>
<li>
<p>Entry count for each partition: 100</p>
</li>
<li>
<p><code>max-size</code> (PER_NODE): 20000</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The total number of entries here is 20000 (partition count * entry count for each partition). This means you are at the eviction threshold since you set the <code>max-size</code> to 20000. When you try to put an entry</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the entry goes to the relevant partition;</p>
</li>
<li>
<p>the partition checks whether the eviction threshold is reached (<code>max-size</code>);</p>
</li>
<li>
<p>only one entry will be evicted.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As a result of this eviction process, when you check the size of your map, it is 19999. After this eviction, subsequent put operations will not trigger the next eviction until the map size is again close to the <code>max-size</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The above scenario is simply an example that describes how the eviction process works. Hazelcast finds the most optimum number of entries to be evicted according to your cluster size and selected policy.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="configuring-map-eviction"><a class="anchor" href="#configuring-map-eviction"></a><a class="link" href="#configuring-map-eviction">Configuring Map Eviction</a></h5>
<div class="paragraph">
<p>The following is an example declarative configuration for map eviction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;time-to-live-seconds&gt;</span>0<span class="tag">&lt;/time-to-live-seconds&gt;</span>
    <span class="tag">&lt;max-idle-seconds&gt;</span>0<span class="tag">&lt;/max-idle-seconds&gt;</span>
    <span class="tag">&lt;eviction-policy&gt;</span>LRU<span class="tag">&lt;/eviction-policy&gt;</span>
    <span class="tag">&lt;max-size</span> <span class="attribute-name">policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PER_NODE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>5000<span class="tag">&lt;/max-size&gt;</span>
    ...
  <span class="tag">&lt;/map&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s describe each element:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>time-to-live-seconds</code>: Maximum time in seconds for each entry to stay in the map (TTL). It limits the lifetime of the entries relative to the time of the last write access performed on them. If it is not 0, the entries whose lifetime exceeds this period (without any write access performed on them during this period) are expired and evicted automatically. An individual entry may have its own lifetime limit by using one of the methods accepting a TTL; see <a href="#evicting-specific-entries">Evicting Specific Entries section</a>. If there is no TTL value provided for the individual entry, it inherits the value set for this element. Valid values are integers between 0 and <code>Integer.MAX VALUE</code>. Its default value is 0, which means infinite (no expiration and eviction). If it is not 0, entries are evicted regardless of the set <code>eviction-policy</code> described below.</p>
</li>
<li>
<p><code>max-idle-seconds</code>: Maximum time in seconds for each entry to stay idle in the map. It limits the lifetime of the entries relative to the time of the last read or write access performed on them. The entries whose idle period exceeds this limit are expired and evicted automatically. An entry is idle if no <code>get</code>, <code>put</code>, <code>EntryProcessor.process</code> or <code>containsKey</code> is called on it. Valid values are integers between 0 and <code>Integer.MAX VALUE</code>. Its default value is 0, which means infinite.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Both <code>time-to-live-seconds</code> and <code>max-idle-seconds</code> may be used simultaneously on the map entries. In that case, the entry is considered expired if at least one of the policies marks it as expired.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>eviction-policy</code>: Eviction policy to be applied when the size of map grows larger than the value specified by the <code>max-size</code> element described below.  Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p>NONE: Default policy. If set, no items will be evicted and the property <code>max-size</code> described below will be ignored. You still can combine it with <code>time-to-live-seconds</code> and <code>max-idle-seconds</code>.</p>
</li>
<li>
<p>LRU: Least Recently Used.</p>
</li>
<li>
<p>LFU: Least Frequently Used.</p>
<div class="paragraph">
<p>Apart from the above values, you can also develop and use your own eviction policy. Please see the <a href="#custom-eviction-policy">Custom Eviction Policy section</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>max-size</code>: Maximum size of the map. When maximum size is reached, the map is evicted based on the policy defined. Valid values are integers between 0 and <code>Integer.MAX VALUE</code>. Its default value is 0, which means infinite. If you want <code>max-size</code> to work, set the <code>eviction-policy</code> property to a value other than NONE. Its attributes are described below.</p>
<div class="ulist">
<ul>
<li>
<p><code>PER_NODE</code>: Maximum number of map entries in each cluster member. This is the default policy.</p>
<div class="paragraph">
<p><code>&lt;max-size policy="PER_NODE"&gt;5000&lt;/max-size&gt;</code></p>
</div>
</li>
<li>
<p><code>PER_PARTITION</code>: Maximum number of map entries within each partition. Storage size depends on the partition count in a cluster member. This attribute should not be used often. For instance, avoid using this attribute with a small cluster. If the cluster is small, it will be hosting more partitions, and therefore map entries, than that of a larger cluster. Thus, for a small cluster, eviction of the entries will decrease performance (the number of entries is large).</p>
<div class="paragraph">
<p><code>&lt;max-size policy="PER_PARTITION"&gt;27100&lt;/max-size&gt;</code></p>
</div>
</li>
<li>
<p><code>USED_HEAP_SIZE</code>: Maximum used heap size in megabytes per map for each Hazelcast instance. Please note that this policy does not work when <a href="#setting-in-memory-format">in-memory format</a> is set to <code>OBJECT</code>, since the memory footprint cannot be determined when data is put as <code>OBJECT</code>.</p>
<div class="paragraph">
<p><code>&lt;max-size policy="USED_HEAP_SIZE"&gt;4096&lt;/max-size&gt;</code></p>
</div>
</li>
<li>
<p><code>USED_HEAP_PERCENTAGE</code>: Maximum used heap size percentage per map for each Hazelcast instance. If, for example, a JVM is configured to have 1000 MB and this value is 10, then the map entries will be evicted when used heap size exceeds 100 MB. Please note that this policy does not work when <a href="#setting-in-memory-format">in-memory format</a> is set to <code>OBJECT</code>, since the memory footprint cannot be determined when data is put as <code>OBJECT</code>.</p>
<div class="paragraph">
<p><code>&lt;max-size policy="USED_HEAP_PERCENTAGE"&gt;10&lt;/max-size&gt;</code></p>
</div>
</li>
<li>
<p><code>FREE_HEAP_SIZE</code>: Minimum free heap size in megabytes for each JVM.</p>
<div class="paragraph">
<p><code>&lt;max-size policy="FREE_HEAP_SIZE"&gt;512&lt;/max-size&gt;</code></p>
</div>
</li>
<li>
<p><code>FREE_HEAP_PERCENTAGE</code>: Minimum free heap size percentage for each JVM. If, for example, a JVM is configured to have 1000 MB and this value is 10, then the map entries will be evicted when free heap size is below 100 MB.</p>
<div class="paragraph">
<p><code>&lt;max-size policy="FREE_HEAP_PERCENTAGE"&gt;10&lt;/max-size&gt;</code></p>
</div>
</li>
<li>
<p><code>USED_NATIVE_MEMORY_SIZE</code>: (<strong class="navy">Hazelcast IMDG Enterprise HD</strong>) Maximum used native memory size in megabytes per map for each Hazelcast instance.</p>
<div class="paragraph">
<p><code>&lt;max-size policy="USED_NATIVE_MEMORY_SIZE"&gt;1024&lt;/max-size&gt;</code></p>
</div>
</li>
<li>
<p><code>USED_NATIVE_MEMORY_PERCENTAGE</code>: (<strong class="navy">Hazelcast IMDG Enterprise HD</strong>) Maximum used native memory size percentage per map for each Hazelcast instance.</p>
<div class="paragraph">
<p><code>&lt;max-size policy="USED_NATIVE_MEMORY_PERCENTAGE"&gt;65&lt;/max-size&gt;</code></p>
</div>
</li>
<li>
<p><code>FREE_NATIVE_MEMORY_SIZE</code>: (<strong class="navy">Hazelcast IMDG Enterprise HD</strong>) Minimum free native memory size in megabytes for each Hazelcast instance.</p>
<div class="paragraph">
<p><code>&lt;max-size policy="FREE_NATIVE_MEMORY_SIZE"&gt;256&lt;/max-size&gt;</code></p>
</div>
</li>
<li>
<p><code>FREE_NATIVE_MEMORY_PERCENTAGE</code>: (<strong class="navy">Hazelcast IMDG Enterprise HD</strong>) Minimum free native memory size percentage for each Hazelcast instance.</p>
<div class="paragraph">
<p><code>&lt;max-size policy="FREE_NATIVE_MEMORY_PERCENTAGE"&gt;5&lt;/max-size&gt;</code></p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of Hazelcast 3.7, the elements <code>eviction-percentage</code> and <code>min-eviction-check-millis</code> are deprecated. They will be ignored if configured since map eviction is based on the sampling of entries. Please see the <a href="#eviction-algorithm">Eviction Algorithm section</a> for details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To put it briefly, Hazelcast maps have no restrictions on the size and may grow arbitrarily large, by default. When it comes to reducing the size of a map, there are two concepts: expiration and eviction.</p>
</div>
<div class="paragraph">
<p>Expiration puts a limit on the maximum lifetime of an entry stored inside the map. When the entry expires it cannot be retrieved from the map any longer and at some point in time it will be cleaned out from the map to free up the memory. Expiration, and hence the eviction based on the expiration, can be configured using the element <code>time-to-live-seconds- and `max-idle-seconds</code> as described above.</p>
</div>
<div class="paragraph">
<p>Eviction puts a limit on the maximum size of the map. If the size of the map grows larger than the maximum allowed size, an eviction policy decides which item to evict from the map to reduce its size. The maximum allowed size can be configured using the element <code>max-size</code> and the eviction policy can be configured using the element <code>eviction-policy</code> as described above.</p>
</div>
<div class="paragraph">
<p>Eviction and expiration can be used together. In this case, the expiration configurations (<code>time-to-live-seconds- and `max-idle-seconds</code>) continue to work as usual cleaning out the expired entries regardless of the map size. Note that locked map entries are not the subjects for eviction and expiration.</p>
</div>
</div>
<div class="sect4">
<h5 id="example-eviction-configurations"><a class="anchor" href="#example-eviction-configurations"></a><a class="link" href="#example-eviction-configurations">Example Eviction Configurations</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">documents</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;max-size</span> <span class="attribute-name">policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PER_NODE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>10000<span class="tag">&lt;/max-size&gt;</span>
  <span class="tag">&lt;eviction-policy&gt;</span>LRU<span class="tag">&lt;/eviction-policy&gt;</span>
  <span class="tag">&lt;max-idle-seconds&gt;</span>60<span class="tag">&lt;/max-idle-seconds&gt;</span>
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, <code>documents</code> map starts to evict its entries from a member when the map size exceeds 10000 in that member. Then the entries least recently used will be evicted. The entries not used for more than 60 seconds will be evicted as well.</p>
</div>
<div class="paragraph">
<p>And the following is an example eviction configuration for a map having <code>NATIVE</code> as the in-memory format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nativeMap*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;in-memory-format&gt;</span>NATIVE<span class="tag">&lt;/in-memory-format&gt;</span>
    <span class="tag">&lt;eviction-policy&gt;</span>LFU<span class="tag">&lt;/eviction-policy&gt;</span>
    <span class="tag">&lt;max-size</span> <span class="attribute-name">policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">USED_NATIVE_MEMORY_PERCENTAGE</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>99<span class="tag">&lt;/max-size&gt;</span>
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="evicting-specific-entries"><a class="anchor" href="#evicting-specific-entries"></a><a class="link" href="#evicting-specific-entries">Evicting Specific Entries</a></h5>
<div class="paragraph">
<p>The eviction policies and configurations explained above apply to all the entries of a map. The entries that meet the specified eviction conditions are evicted.</p>
</div>
<div class="paragraph">
<p>If you want to evict some specific map entries, you can use the <code>ttl</code> and <code>ttlUnit</code> parameters of the method <code>map.put()</code>. An example code line is given below.</p>
</div>
<div class="paragraph">
<p><code>myMap.put( "1", "John", 50, TimeUnit.SECONDS )</code></p>
</div>
<div class="paragraph">
<p>The map entry with the key "1" will be evicted 50 seconds after it is put into <code>myMap</code>.</p>
</div>
<div class="paragraph">
<p>You may also use <code>map.setTTL</code> method to alter the time-to-live value of an existing entry. It is done as follows:</p>
</div>
<div class="paragraph">
<p><code>myMap.setTTL( "1", 50, TimeUnit.SECONDS )</code></p>
</div>
<div class="paragraph">
<p>In addition to the <code>ttl</code>, you may also specify a maximum idle timeout for specific map entries using the <code>maxIdle</code> and <code>maxIdleUnit</code> parameters:</p>
</div>
<div class="paragraph">
<p><code>myMap.put( "1", "John", 50, TimeUnit.SECONDS, 40, TimeUnit.SECONDS )</code></p>
</div>
<div class="paragraph">
<p>Here <code>ttl</code> is set as 50 seconds and <code>maxIdle</code> is set as 40 seconds. The entry is considered to be evicted if at least one of these policies marks it as expired. If you want to specify only the <code>maxIdle</code> parameter, you need to set <code>ttl</code> as 0 seconds.</p>
</div>
</div>
<div class="sect4">
<h5 id="evicting-all-entries"><a class="anchor" href="#evicting-all-entries"></a><a class="link" href="#evicting-all-entries">Evicting All Entries</a></h5>
<div class="paragraph">
<p>To evict all keys from the map except the locked ones, use the method <code>evictAll()</code>. If a MapStore is defined for the map, <code>deleteAll</code> is not called by <code>evictAll</code>. If you want to call the method <code>deleteAll</code>, use <code>clear()</code>.</p>
</div>
<div class="paragraph">
<p>An example is given below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/EvictAll.java[tag=evictall]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only EVICT_ALL event is fired for any registered listeners.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="forced-eviction"><a class="anchor" href="#forced-eviction"></a><a class="link" href="#forced-eviction">Forced Eviction</a></h5>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast may use forced eviction in the cases when the eviction explained in <a href="#understanding-map-eviction">Understanding Map Eviction</a> is not enough to free up your memory. Note that this is valid if you are using <strong class="blue">Hazelcast IMDG Enterprise</strong> and you set your in-memory format to <code>NATIVE</code>.</p>
</div>
<div class="paragraph">
<p>Forced eviction mechanism is explained below as steps in the given order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the normal eviction is not enough, forced eviction is triggered and first it tries to evict approx. 20% of the entries from the current partition. It retries this five times.</p>
</li>
<li>
<p>If the result of above step is still not enough, forced eviction applies the above step to all maps. This time it might perform eviction from some other partitions too, provided that they are owned by the same thread.</p>
</li>
<li>
<p>If that is still not enough to free up your memory, it evicts not the 20% but all the entries from the current partition.</p>
</li>
<li>
<p>if that is not enough, it will evict all the entries from the other data structures; from the partitions owned by the local thread.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, when all the above steps are not enough, Hazelcast throws a  Native Out of Memory Exception.</p>
</div>
</div>
<div class="sect4">
<h5 id="custom-eviction-policy"><a class="anchor" href="#custom-eviction-policy"></a><a class="link" href="#custom-eviction-policy">Custom Eviction Policy</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section is valid for Hazelcast 3.7 and higher releases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Apart from the policies such as LRU and LFU, which Hazelcast provides out-of-the-box, you can develop and use your own eviction policy.</p>
</div>
<div class="paragraph">
<p>To achieve this, you need to provide an implementation of <code>MapEvictionPolicy</code> as in the following <code>OddEvictor</code> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/MapCustomEvictionPolicy.java[tag=mcep]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can enable your policy by setting it via the method <code>MapConfig.setMapEvictionPolicy()</code>
programmatically or via XML declaratively. Following is the example declarative configuration for the eviction policy <code>OddEvictor</code> implemented above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;map-eviction-policy-class-name&gt;</span>com.package.OddEvictor<span class="tag">&lt;/map-eviction-policy-class-name&gt;</span>
   ....
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you Hazelcast with Spring, you can enable your policy as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;hz:map-eviction-policy</span> <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.package.OddEvictor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/hz:map&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="setting-in-memory-format"><a class="anchor" href="#setting-in-memory-format"></a><a class="link" href="#setting-in-memory-format">7.2.5. Setting In-Memory Format</a></h4>
<div class="paragraph">
<p>IMap (and a few other Hazelcast data structures, such as ICache) has an <code>in-memory-format</code> configuration option. By default, Hazelcast stores data into memory in binary (serialized) format. Sometimes it can be efficient to store the entries in their object form, especially in cases of local processing, such as entry processor and queries.</p>
</div>
<div class="paragraph">
<p>To set how the data will be stored in memory, set <code>in-memory-format</code> in the configuration. You have the following format options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BINARY</code> (default): The data (both the key and value) will be stored in serialized binary format. You can use this option if you mostly perform regular map operations, such as <code>put</code> and <code>get</code>.</p>
</li>
<li>
<p><code>OBJECT</code>: The data will be stored in deserialized form. This configuration is good for maps where entry processing and queries form the majority of all operations and the objects are complex, making the serialization cost comparatively high. By storing objects, entry processing will not contain the deserialization cost. Note that when you use <code>OBJECT</code> as the in-memory format, the key will still be stored in binary format and the value will be stored in object format.</p>
</li>
<li>
<p><code>NATIVE</code>: (<strong class="navy">Hazelcast IMDG Enterprise HD</strong>) This format behaves the same as BINARY, however, instead of heap memory, key and value will be stored in the off-heap memory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Regular operations like <code>get</code> rely on the object instance. When the <code>OBJECT</code> format is used and a <code>get</code> is performed, the map does not return the stored instance, but creates a clone. Therefore, this whole <code>get</code> operation first includes a serialization on the member owning the instance and then a deserialization on the member calling the instance. When the <code>BINARY</code> format is used, only a deserialization is required; <code>BINARY</code> is faster.</p>
</div>
<div class="paragraph">
<p>Similarly, a <code>put</code> operation is faster when the <code>BINARY</code> format is used. If the format was <code>OBJECT</code>, the map would create a clone of the instance, and there would first be a serialization and then a deserialization. When BINARY is used, only a deserialization is needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If a value is stored in <code>OBJECT</code> format, a change on a returned value does not affect the stored instance. In this case, the returned instance is not the actual one but a clone. Therefore, changes made on an object after it is returned will not reflect on the actual stored data. Similarly, when a value is written to a map and the value is stored in <code>OBJECT</code> format, it will be a copy of the <code>put</code> value. Therefore, changes made on the object after it is stored will not reflect on the stored data.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="using-high-density-memory-store-with-map"><a class="anchor" href="#using-high-density-memory-store-with-map"></a><a class="link" href="#using-high-density-memory-store-with-map">7.2.6. Using High-Density Memory Store with Map</a></h4>
<div class="paragraph">
<p><strong class="navy">Hazelcast IMDG Enterprise HD</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast instances are Java programs. In case of <code>BINARY</code> and <code>OBJECT</code> in-memory formats, Hazelcast stores your distributed data into the heap of its server instances. Java heap is subject to garbage collection (GC). In case of larger heaps, garbage collection might cause your application to pause for tens of seconds (even minutes for really large heaps), badly affecting your application performance and response times.</p>
</div>
<div class="paragraph">
<p>As the data gets bigger, you either run the application with larger heap, which would result in longer GC pauses or run multiple instances with smaller heap which can turn into an operational nightmare if the number of such instances becomes very high.</p>
</div>
<div class="paragraph">
<p>To overcome this challenge, Hazelcast offers High-Density Memory Store for your maps. You can configure your map to use High-Density Memory Store by setting the in-memory format to <code>NATIVE</code>. The following snippet is the declarative configuration example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nativeMap*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;in-memory-format&gt;</span>NATIVE<span class="tag">&lt;/in-memory-format&gt;</span>
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that you should have already enabled the High-Density Memory Store usage for your cluster. Please see <a href="#configuring-high-density-memory-store">Configuring High-Density Memory Store section</a>.</p>
</div>
<div class="sect4">
<h5 id="required-configuration-changes-when-using-native"><a class="anchor" href="#required-configuration-changes-when-using-native"></a><a class="link" href="#required-configuration-changes-when-using-native">Required configuration changes when using NATIVE</a></h5>
<div class="paragraph">
<p>Note that the eviction mechanism is different for <code>NATIVE</code> in-memory format.
The new eviction algorithm for map with High-Density Memory Store is similar to that of JCache with High-Density Memory Store and is described <a href="#eviction-algorithm">here</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eviction percentage has no effect.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nativeMap*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;in-memory-format&gt;</span>NATIVE<span class="tag">&lt;/in-memory-format&gt;</span>
    <span class="tag">&lt;eviction-percentage&gt;</span>25<span class="tag">&lt;/eviction-percentage&gt;</span> <span class="tag">&lt;--</span><span class="error">!</span> <span class="attribute-name">NO</span> <span class="attribute-name">IMPACT</span> <span class="attribute-name">with</span> <span class="attribute-name">NATIVE</span> <span class="attribute-name">--</span><span class="tag">&gt;</span>
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>These IMap eviction policies for <code>max-size</code> cannot be used: <code>FREE_HEAP_PERCENTAGE</code>, <code>FREE_HEAP_SIZE</code>, <code>USED_HEAP_PERCENTAGE</code>, <code>USED_HEAP_SIZE</code>.</p>
</li>
<li>
<p>Near Cache eviction configuration is also different for <code>NATIVE</code> in-memory format. For a Near Cache configuration with in-memory format set to <code>BINARY</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nativeMap*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;near-cache&gt;</span>
      <span class="tag">&lt;in-memory-format&gt;</span>BINARY<span class="tag">&lt;/in-memory-format&gt;</span>
      <span class="tag">&lt;max-size&gt;</span>10000<span class="tag">&lt;/max-size&gt;</span> <span class="tag">&lt;--</span><span class="error">!</span> <span class="attribute-name">NO</span> <span class="attribute-name">IMPACT</span> <span class="attribute-name">with</span> <span class="attribute-name">NATIVE</span> <span class="attribute-name">--</span><span class="tag">&gt;</span>
      <span class="tag">&lt;eviction-policy&gt;</span>LFU<span class="tag">&lt;/eviction-policy&gt;</span> <span class="tag">&lt;--</span><span class="error">!</span> <span class="attribute-name">NO</span> <span class="attribute-name">IMPACT</span> <span class="attribute-name">with</span> <span class="attribute-name">NATIVE</span> <span class="attribute-name">--</span><span class="tag">&gt;</span>
   <span class="tag">&lt;/near-cache&gt;</span>
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>the equivalent configuration for <code>NATIVE</code> in-memory format would be similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nativeMap*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;near-cache&gt;</span>
      <span class="tag">&lt;in-memory-format&gt;</span>NATIVE<span class="tag">&lt;/in-memory-format&gt;</span>
      <span class="tag">&lt;eviction</span> <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">eviction-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LFU</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-size-policy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">USED_NATIVE_MEMORY_SIZE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>   <span class="tag">&lt;--</span><span class="error">!</span> <span class="attribute-name">Correct</span> <span class="attribute-name">configuration</span> <span class="attribute-name">with</span> <span class="attribute-name">NATIVE</span> <span class="attribute-name">--</span><span class="tag">&gt;</span>
   <span class="tag">&lt;/near-cache&gt;</span>
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Near Cache eviction policy <code>ENTRY_COUNT</code> cannot be used for <code>max-size-policy</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="#high-density-memory-store">High-Density Memory Store section</a> for more information.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="loading-and-storing-persistent-data"><a class="anchor" href="#loading-and-storing-persistent-data"></a><a class="link" href="#loading-and-storing-persistent-data">7.2.7. Loading and Storing Persistent Data</a></h4>
<div class="paragraph">
<p>Hazelcast allows you to load and store the distributed map entries from/to a persistent data store such as a relational database. To do this, you can use Hazelcast&#8217;s <code>MapStore</code> and <code>MapLoader</code> interfaces.</p>
</div>
<div class="paragraph">
<p>When you provide a <code>MapLoader</code> implementation and request an entry (<code>IMap.get()</code>) that does not exist in memory, <code>MapLoader</code>'s <code>load</code> method will load that entry from the data store. This loaded entry is placed into the map and will stay there until it is removed or evicted.</p>
</div>
<div class="paragraph">
<p>When a <code>MapStore</code> implementation is provided, an entry is also put into a user defined data store.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Data store needs to be a centralized system that is
accessible from all Hazelcast members. Persistence to a local file system is not supported.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Also note that the <code>MapStore</code> interface extends the <code>MapLoader</code> interface as you can see in the interface <a href="http://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/core/MapStore.html">code</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Starting with Hazelcast IMDG 3.11, all loads can be listened via <code>EntryLoadedListener</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Following is a <code>MapStore</code> example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/PersonMapStore.java[tag=personms]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
During the initial loading process, MapStore uses a thread different from the partition threads that are used by the ExecutorService. After the initialization is completed, the <code>map.get</code> method looks up any nonexistent value from the database in a partition thread, or the <code>map.put</code> method looks up the database to return the previously associated value for a key also in a partition thread.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more MapStore/MapLoader code samples, please see <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/distributed-map/mapstore/src/main/java">here</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hazelcast supports read-through, write-through and write-behind persistence modes, which are explained in the subsections below.</p>
</div>
<div class="sect4">
<h5 id="using-read-through-persistence"><a class="anchor" href="#using-read-through-persistence"></a><a class="link" href="#using-read-through-persistence">Using Read-Through Persistence</a></h5>
<div class="paragraph">
<p>If an entry does not exist in memory when an application asks for it, Hazelcast asks the loader implementation to load that entry from the data store.  If the entry exists there, the loader implementation gets it, hands it to Hazelcast, and Hazelcast puts it into memory. This is read-through persistence mode.</p>
</div>
</div>
<div class="sect4">
<h5 id="setting-write-through-persistence"><a class="anchor" href="#setting-write-through-persistence"></a><a class="link" href="#setting-write-through-persistence">Setting Write-Through Persistence</a></h5>
<div class="paragraph">
<p><code>MapStore</code> can be configured to be write-through by setting the <code>write-delay-seconds</code> property to <strong>0</strong>. This means the entries will be put to the data store synchronously.</p>
</div>
<div class="paragraph">
<p>In this mode, when the <code>map.put(key,value)</code> call returns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MapStore.store(key,value)</code> is successfully called so the entry is persisted.</p>
</li>
<li>
<p>In-Memory entry is updated.</p>
</li>
<li>
<p>In-Memory backup copies are successfully created on other cluster members (if <code>backup-count</code> is greater than 0).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>MapStore</code> throws an exception then the exception is propagated to the original <code>put</code> or <code>remove</code> call in the form of <code>RuntimeException</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is a key difference in the behaviors of <code>map.remove(key)</code> and <code>map.delete(key)</code>, i.e., the latter results in <code>MapStore.delete(key)</code> to be invoked whereas the former only removes the entry from IMap.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="setting-write-behind-persistence"><a class="anchor" href="#setting-write-behind-persistence"></a><a class="link" href="#setting-write-behind-persistence">Setting Write-Behind Persistence</a></h5>
<div class="paragraph">
<p>You can configure <code>MapStore</code> as write-behind by setting the <code>write-delay-seconds</code> property to a value bigger than <strong>0</strong>. This means the modified entries will be put to the data store asynchronously after a configured delay.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In write-behind mode, Hazelcast coalesces updates on a specific key by default, which means it applies only the last update on that key. However, you can set <code>MapStoreConfig.setWriteCoalescing()</code> to <code>FALSE</code> and you can store all updates performed on a key to the data store.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you set <code>MapStoreConfig.setWriteCoalescing()</code> to <code>FALSE</code>, after you reached per-node maximum write-behind-queue capacity, subsequent put operations will fail with <code>ReachedMaxSizeException</code>. This exception will be thrown to prevent uncontrolled grow of write-behind queues. You can set per-node maximum capacity using the system property <code>hazelcast.map.write.behind.queue.capacity</code>. Please refer to the <a href="#system-properties">System Properties section</a> for information on this property and how to set the system properties.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In write-behind mode, when the <code>map.put(key,value)</code> call returns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In-Memory entry is updated.</p>
</li>
<li>
<p>In-Memory backup copies are successfully created on other cluster members (if <code>backup-count</code> is greater than 0).</p>
</li>
<li>
<p>The entry is marked as dirty so that after <code>write-delay-seconds</code>, it can be persisted with <code>MapStore.store(key,value)</code> call.</p>
</li>
<li>
<p>For fault tolerance, dirty entries are stored in a queue on the primary member and also on a back-up member.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The same behavior goes for the <code>map.remove(key)</code>, the only difference is that  <code>MapStore.delete(key)</code> is called when the entry will be deleted.</p>
</div>
<div class="paragraph">
<p>If <code>MapStore</code> throws an exception, then Hazelcast tries to store the entry again. If the entry still cannot be stored, a log message is printed and the entry is re-queued.</p>
</div>
<div class="paragraph">
<p>For batch write operations, which are only allowed in write-behind mode, Hazelcast will call <code>MapStore.storeAll(map)</code> and <code>MapStore.deleteAll(collection)</code> to do all writes in a single call.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If a map entry is marked as dirty, meaning that it is waiting to be persisted to the <code>MapStore</code> in a write-behind scenario, the eviction process forces the entry to be stored. This way you have control over the number of entries waiting to be stored, and thus you can prevent a possible OutOfMemory exception.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>MapStore</code> or <code>MapLoader</code> implementations should not use Hazelcast Map/Queue/MultiMap/List/Set operations. Your implementation should only work with your data store. Otherwise, you may get into deadlock situations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is a sample configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  ...
  <span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;map-store</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">initial-mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LAZY</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;class-name&gt;</span>com.hazelcast.examples.DummyStore<span class="tag">&lt;/class-name&gt;</span>
      <span class="tag">&lt;write-delay-seconds&gt;</span>60<span class="tag">&lt;/write-delay-seconds&gt;</span>
      <span class="tag">&lt;write-batch-size&gt;</span>1000<span class="tag">&lt;/write-batch-size&gt;</span>
      <span class="tag">&lt;write-coalescing&gt;</span>true<span class="tag">&lt;/write-coalescing&gt;</span>
    <span class="tag">&lt;/map-store&gt;</span>
  <span class="tag">&lt;/map&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are the descriptions of MapStore configuration elements and attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>class-name</code>: Name of the class implementing MapLoader and/or MapStore.</p>
</li>
<li>
<p><code>write-delay-seconds</code>: Number of seconds to delay to call the MapStore.store(key, value). If the value is zero then it is write-through so MapStore.store(key, value) will be called as soon as the entry is updated. Otherwise it is write-behind so updates will be stored after write-delay-seconds value by calling Hazelcast.storeAll(map). Its default value is 0.</p>
</li>
<li>
<p><code>write-batch-size</code>: Used to create batch chunks when writing map store. In default mode, all map entries will be tried to be written in one go. To create batch chunks, the minimum meaningful value for write-batch-size is 2. For values smaller than 2, it works as in default mode.</p>
</li>
<li>
<p><code>write-coalescing</code>: In write-behind mode, Hazelcast coalesces updates on a specific key by default; it applies only the last update on it. You can set this element to <code>false</code> to store all updates performed on a key to the data store.</p>
</li>
<li>
<p><code>enabled</code>: True to enable this map-store, false to disable. Its default value is true.</p>
</li>
<li>
<p><code>initial-mode</code>: Sets the initial load mode. LAZY is the default load mode, where load is asynchronous. EAGER means load is blocked till all partitions are loaded. Please see the <a href="#initializing-map-on-startup">Initializing Map on Startup section</a> for more details.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="storing-entries-to-multiple-maps"><a class="anchor" href="#storing-entries-to-multiple-maps"></a><a class="link" href="#storing-entries-to-multiple-maps">Storing Entries to Multiple Maps</a></h5>
<div class="paragraph">
<p>A configuration can be applied to more than one map using wildcards (see <a href="#using-wildcards">Using Wildcards</a>), meaning that the configuration is shared among the maps. But <code>MapStore</code> does not know which entries to store when there is one configuration applied to multiple maps.</p>
</div>
<div class="paragraph">
<p>To store entries when there is one configuration applied to multiple maps, use Hazelcast&#8217;s <code>MapStoreFactory</code> interface. Using the <code>MapStoreFactory</code> interface, `MapStore`s for each map can be created when a wildcard configuration is used. Example code is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
MapConfig mapConfig = config.getMapConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> );
MapStoreConfig mapStoreConfig = mapConfig.getMapStoreConfig();
mapStoreConfig.setFactoryImplementation( <span class="keyword">new</span> MapStoreFactory&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt;() {
  <span class="annotation">@Override</span>
  <span class="directive">public</span> MapLoader&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; newMapStore( <span class="predefined-type">String</span> mapName, <span class="predefined-type">Properties</span> properties ) {
    <span class="keyword">return</span> <span class="predefined-constant">null</span>;
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>To initialize the <code>MapLoader</code> implementation with the given map name, configuration properties and the Hazelcast instance, implement the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/core/MapLoaderLifecycleSupport.html"><code>MapLoaderLifecycleSupport</code> interface</a>. This interface has the methods <code>init()</code> and <code>destroy()</code>.</p>
</div>
<div class="paragraph">
<p>The method <code>init()</code> initializes the <code>MapLoader</code> implementation. Hazelcast calls this method when the map is first used on the Hazelcast instance. The <code>MapLoader</code> implementation can initialize the required resources for implementing <code>MapLoader</code> such as reading a configuration file or creating a database connection.</p>
</div>
<div class="paragraph">
<p>Hazelcast calls the method <code>destroy()</code> before shutting down. You can override this method  to cleanup the resources held by this <code>MapLoader</code> implementation, such as closing the database connections.</p>
</div>
</div>
<div class="sect4">
<h5 id="initializing-map-on-startup"><a class="anchor" href="#initializing-map-on-startup"></a><a class="link" href="#initializing-map-on-startup">Initializing Map on Startup</a></h5>
<div class="paragraph">
<p>To pre-populate the in-memory map when the map is first touched/used, use the <code>MapLoader.loadAllKeys</code> API.</p>
</div>
<div class="paragraph">
<p>If <code>MapLoader.loadAllKeys</code> returns NULL, then nothing will be loaded. Your <code>MapLoader.loadAllKeys</code> implementation can return all or some of the keys. For example, you may select and return only the keys which are most important to you that you want to load them while initializing the map. <code>MapLoader.loadAllKeys</code> is the fastest way of pre-populating the map since Hazelcast will optimize the loading process by having each cluster member load its owned portion of the entries.</p>
</div>
<div class="paragraph">
<p>The <code>InitialLoadMode</code> configuration parameter in the class <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/config/MapStoreConfig.html">MapStoreConfig</a> has two values: <code>LAZY</code> and <code>EAGER</code>. If <code>InitialLoadMode</code> is set to <code>LAZY</code>, data is not loaded during the map creation. If it is set to <code>EAGER</code>, all the data is loaded while the map is created and everything becomes ready to use. Also, if you add indices to your map with the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/config/MapIndexConfig.html">MapIndexConfig</a> class or the <a href="#indexing-queries"><code>addIndex</code></a> method, then <code>InitialLoadMode</code> is overridden and <code>MapStoreConfig</code> behaves as if <code>EAGER</code> mode is on.</p>
</div>
<div class="paragraph">
<p>Here is the <code>MapLoader</code> initialization flow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When <code>getMap()</code> is first called from any member, initialization will start depending on the value of <code>InitialLoadMode</code>. If it is set to <code>EAGER</code>, initialization starts on all partitions as soon as the map is touched, i.e., all partitions will be loaded when <code>getMap</code> is called.  If it is set to <code>LAZY</code>, data will be loaded partition by partition, i.e., each partition will be loaded with its first touch.</p>
</li>
<li>
<p>Hazelcast will call <code>MapLoader.loadAllKeys()</code> to get all your keys on one of the members.</p>
</li>
<li>
<p>That member will distribute keys to all other members in batches.</p>
</li>
<li>
<p>Each member will load values of all its owned keys by calling <code>MapLoader.loadAll(keys)</code>.</p>
</li>
<li>
<p>Each member puts its owned entries into the map by calling <code>IMap.putTransient(key,value)</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the load mode is <code>LAZY</code> and the <code>clear()</code> method is called (which triggers <code>MapStore.deleteAll()</code>), Hazelcast will remove <strong>ONLY</strong> the loaded entries from your map and datastore. Since all the data is not loaded in this case (<code>LAZY</code> mode), please note that there may still be entries in your datastore.*
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you do not want the MapStore start to load as soon as the first cluster member starts, you can use the system property <code>hazelcast.initial.min.cluster.size</code>. For example, if you set its value as <code>3</code>, loading process will be blocked until all three members are completely up.*
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The return type of <code>loadAllKeys()</code> is changed from <code>Set</code> to <code>Iterable</code> with the release of Hazelcast 3.5. MapLoader implementations from previous releases are also supported and do not need to be adapted.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="loading-keys-incrementally"><a class="anchor" href="#loading-keys-incrementally"></a><a class="link" href="#loading-keys-incrementally">Loading Keys Incrementally</a></h5>
<div class="paragraph">
<p>If the number of keys to load is large, it is more efficient to load them incrementally rather than loading them all at once. To support incremental loading, the <code>MapLoader.loadAllKeys()</code> method returns an <code>Iterable</code> which can be lazily populated with the results of a database query.</p>
</div>
<div class="paragraph">
<p>Hazelcast iterates over the <code>Iterable</code> and, while doing so, sends out the keys to their respective owner members. The <code>Iterator</code> obtained from <code>MapLoader.loadAllKeys()</code> may also implement the <code>Closeable</code> interface, in which case <code>Iterator</code> is closed once the iteration is over. This is intended for releasing resources such as closing a JDBC result set.</p>
</div>
</div>
<div class="sect4">
<h5 id="forcing-all-keys-to-be-loaded"><a class="anchor" href="#forcing-all-keys-to-be-loaded"></a><a class="link" href="#forcing-all-keys-to-be-loaded">Forcing All Keys To Be Loaded</a></h5>
<div class="paragraph">
<p>The method <code>loadAll</code> loads some or all keys into a data store in order to optimize the multiple load operations. The method has two signatures; the same method can take two different parameter lists. One signature loads the given keys and the other loads all keys. Please see the example code below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/LoadAll.java[tag=loadall]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="post-processing-objects-in-map-store"><a class="anchor" href="#post-processing-objects-in-map-store"></a><a class="link" href="#post-processing-objects-in-map-store">Post-Processing Objects in Map Store</a></h5>
<div class="paragraph">
<p>In some scenarios, you may need to modify the object after storing it into the map store.
For example, you can get an ID or version auto-generated by your database and then need to modify your object stored in the distributed map, but not to break the synchronization between the database and the data grid.</p>
</div>
<div class="paragraph">
<p>To post-process an object in the map store, implement the <code>PostProcessingMapStore</code> interface to put the modified object into the distributed map. This will trigger an extra step of <code>Serialization</code>, so use it only when needed. (This is only valid when using the <code>write-through</code> map store configuration.)</p>
</div>
<div class="paragraph">
<p>Here is an example of post processing map store:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">ProcessingStore</span> <span class="directive">implements</span> MapStore&lt;<span class="predefined-type">Integer</span>, Employee&gt;, PostProcessingMapStore {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> store( <span class="predefined-type">Integer</span> key, Employee employee ) {
        EmployeeId id = saveEmployee();
        employee.setId( id.getId() );
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note that if you are using a post processing map store in combination with entry processors, post-processed values will not be carried to backups.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="accessing-a-database-using-properties"><a class="anchor" href="#accessing-a-database-using-properties"></a><a class="link" href="#accessing-a-database-using-properties">Accessing a Database Using <code>Properties</code></a></h5>
<div class="paragraph">
<p>You can prepare your own <code>MapLoader</code> to access a database such as Cassandra and MongoDB. For this, you can first declaratively specify the database properties in your <code>hazelcast.xml</code> configuration file and then implement the <code>MapLoaderLifecycleSupport</code> interface to pass those properties.</p>
</div>
<div class="paragraph">
<p>You can define the database properties, such as its URL and name, using the <code>properties</code> configuration element. The following is a configuration example for MongoDB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">supplements</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;map-store</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">initial-mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LAZY</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;class-name&gt;</span>com.hazelcast.loader.YourMapStoreImplementation<span class="tag">&lt;/class-name&gt;</span>
        <span class="tag">&lt;properties&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mongo.url</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>mongodb://localhost:27017<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mongo.db</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>mydb<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mongo.collection</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>supplements<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/map-store&gt;</span>
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After you specified the database properties in your configuration, you need to implement the <code>MapLoaderLifecycleSupport</code> interface and give those properties in the <code>init()</code> method, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/YourMapStoreImplementation.java[tag=ymsi]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can refer to the full example <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/hazelcast-integration/mongodb">here</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-near-cache-for-map"><a class="anchor" href="#creating-near-cache-for-map"></a><a class="link" href="#creating-near-cache-for-map">7.2.8. Creating Near Cache for Map</a></h4>
<div class="paragraph">
<p>The Hazelcast distributed map supports a local Near Cache for remotely stored entries to increase the performance of local read operations. Please refer to the <a href="#near-cache">Near Cache section</a> for a detailed explanation of the Near Cache feature and its configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="locking-maps"><a class="anchor" href="#locking-maps"></a><a class="link" href="#locking-maps">7.2.9. Locking Maps</a></h4>
<div class="paragraph">
<p>Hazelcast Distributed Map (IMap) is thread-safe to meet your thread safety requirements. When these requirements increase or you want to have more control on the concurrency, consider the Hazelcast solutions described here.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s work on a sample case as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/RacyUpdateMember.java[tag=racy]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the above code is run by more than one cluster member simultaneously, a race condition is likely. You can solve this condition with Hazelcast using either pessimistic locking or optimistic locking.</p>
</div>
<div class="sect4">
<h5 id="pessimistic-looking"><a class="anchor" href="#pessimistic-looking"></a><a class="link" href="#pessimistic-looking">Pessimistic Locking</a></h5>
<div class="paragraph">
<p>One way to solve the race issue is by using pessimistic locking - lock the map entry until you are finished with it.</p>
</div>
<div class="paragraph">
<p>To perform pessimistic locking, use the lock mechanism provided by the Hazelcast distributed map, i.e., the <code>map.lock</code> and <code>map.unlock</code> methods. See the below example code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/PessimisticUpdateMember.java[tag=pum]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The IMap lock will automatically be collected by the garbage collector when the lock is released and no other waiting conditions exist on the lock.</p>
</div>
<div class="paragraph">
<p>The IMap lock is reentrant, but it does not support fairness.</p>
</div>
<div class="paragraph">
<p>Another way to solve the race issue is by acquiring a predictable <code>Lock</code> object from Hazelcast. This way, every value in the map can be given a lock, or you can create a stripe of locks.</p>
</div>
</div>
<div class="sect4">
<h5 id="optimistic-locking"><a class="anchor" href="#optimistic-locking"></a><a class="link" href="#optimistic-locking">Optimistic Locking</a></h5>
<div class="paragraph">
<p>In Hazelcast, you can apply the optimistic locking strategy with the map&#8217;s <code>replace</code> method. This method compares values in object or data forms depending on the in-memory format configuration. If the values are equal, it replaces the old value with the new one. If you want to use your defined <code>equals</code> method, <code>in-memory-format</code> should be <code>OBJECT</code>. Otherwise, Hazelcast serializes objects to <code>BINARY</code> forms and compares them.</p>
</div>
<div class="paragraph">
<p>See the below example code.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The below example code is intentionally broken.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/OptimisticMember.java[tag=om]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="pessimistic-vs-optimistic-locking"><a class="anchor" href="#pessimistic-vs-optimistic-locking"></a><a class="link" href="#pessimistic-vs-optimistic-locking">Pessimistic vs. Optimistic Locking</a></h5>
<div class="paragraph">
<p>The locking strategy you choose will depend on your locking requirements.</p>
</div>
<div class="paragraph">
<p>Optimistic locking is better for mostly read-only systems. It has a performance boost over pessimistic locking.</p>
</div>
<div class="paragraph">
<p>Pessimistic locking is good if there are lots of updates on the same key. It is more robust than optimistic locking from the perspective of data consistency.</p>
</div>
<div class="paragraph">
<p>In Hazelcast, use <code>IExecutorService</code> to submit a task to a key owner, or to a member or members. This is the recommended way to perform task executions, rather than using pessimistic or optimistic locking techniques. <code>IExecutorService</code> will have fewer network hops and less data over wire, and tasks will be executed very near to the data. Please refer to the <a href="#data-affinity">Data Affinity section</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="solving-the-aba-problem"><a class="anchor" href="#solving-the-aba-problem"></a><a class="link" href="#solving-the-aba-problem">Solving the ABA Problem</a></h5>
<div class="paragraph">
<p>The ABA problem occurs in environments when a shared resource is open to change by multiple threads. Even if one thread sees the same value for a particular key in consecutive reads, it does not mean that nothing has changed between the reads. Another thread may change the value, do work and change the value back, while the first thread thinks that nothing has changed.</p>
</div>
<div class="paragraph">
<p>To prevent these kind of problems, you can assign a version number and check it before any write to be sure that nothing has changed between consecutive reads. Although all the other fields will be equal, the version field will prevent objects from being seen as equal. This is the optimistic locking strategy; it is used in environments that do not expect intensive concurrent changes on a specific key.</p>
</div>
<div class="paragraph">
<p>In Hazelcast, you can apply the <a href="#optimistic-locking">optimistic locking</a> strategy with the map <code>replace</code> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="lock-split-brain-protection-with-pessimistic-locking"><a class="anchor" href="#lock-split-brain-protection-with-pessimistic-locking"></a><a class="link" href="#lock-split-brain-protection-with-pessimistic-locking">Lock Split-Brain Protection with Pessimistic Locking</a></h5>
<div class="paragraph">
<p>Locks can be configured to check the number of currently present members before applying a locking operation. If the check fails, the lock operation will fail with a <code>QuorumException</code> (see <a href="#split-brain-protection">Split-Brain Protection</a>). As pessimistic locking uses lock operations internally, it will also use the configured lock quorum. This means that you can configure a lock quorum with the same name or a pattern that matches the map name. Note that the quorum for IMap locking actions can be different from the quorum for other IMap actions.</p>
</div>
<div class="paragraph">
<p>The following actions will then check for lock quorum before being applied:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IMap.lock(K)</code> and <code>IMap.lock(K, long, java.util.concurrent.TimeUnit)</code></p>
</li>
<li>
<p><code>IMap.isLocked()</code></p>
</li>
<li>
<p><code>IMap.tryLock(K)</code>, <code>IMap.tryLock(K, long, java.util.concurrent.TimeUnit)</code> and <code>IMap.tryLock(K, long, java.util.concurrent.TimeUnit, long, java.util.concurrent.TimeUnit)</code></p>
</li>
<li>
<p><code>IMap.unlock()</code></p>
</li>
<li>
<p><code>IMap.forceUnlock()</code></p>
</li>
<li>
<p><code>MultiMap.lock(K)</code> and <code>MultiMap.lock(K, long, java.util.concurrent.TimeUnit)</code></p>
</li>
<li>
<p><code>MultiMap.isLocked()</code></p>
</li>
<li>
<p><code>MultiMap.tryLock(K)</code>, <code>MultiMap.tryLock(K, long, java.util.concurrent.TimeUnit)</code> and <code>MultiMap.tryLock(K, long, java.util.concurrent.TimeUnit, long, java.util.concurrent.TimeUnit)</code></p>
</li>
<li>
<p><code>MultiMap.unlock()</code></p>
</li>
<li>
<p><code>MultiMap.forceUnlock()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;quorum-ref&gt;</span>map-actions-quorum<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/map&gt;</span>

<span class="tag">&lt;lock</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;quorum-ref&gt;</span>map-lock-actions-quorum<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/lock&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the configured map will use the <code>map-lock-actions-quorum</code> quorum for map lock actions and the <code>map-actions-quorum</code> quorum for other map actions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="accessing-entry-statistics"><a class="anchor" href="#accessing-entry-statistics"></a><a class="link" href="#accessing-entry-statistics">7.2.10. Accessing Entry Statistics</a></h4>
<div class="paragraph">
<p>Hazelcast keeps statistics about each map entry, such as creation time, last update time, last access time, number of hits and version. To access the map entry statistics, use an <code>IMap.getEntryView(key)</code> call. Here is an example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hz = Hazelcast.newHazelcastInstance();
EntryView entry = hz.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">quotes</span><span class="delimiter">&quot;</span></span> ).getEntryView( <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> );
<span class="predefined-type">System</span>.out.println ( <span class="string"><span class="delimiter">&quot;</span><span class="content">size in memory  : </span><span class="delimiter">&quot;</span></span> + entry.getCost() );
<span class="predefined-type">System</span>.out.println ( <span class="string"><span class="delimiter">&quot;</span><span class="content">creationTime    : </span><span class="delimiter">&quot;</span></span> + entry.getCreationTime() );
<span class="predefined-type">System</span>.out.println ( <span class="string"><span class="delimiter">&quot;</span><span class="content">expirationTime  : </span><span class="delimiter">&quot;</span></span> + entry.getExpirationTime() );
<span class="predefined-type">System</span>.out.println ( <span class="string"><span class="delimiter">&quot;</span><span class="content">number of hits  : </span><span class="delimiter">&quot;</span></span> + entry.getHits() );
<span class="predefined-type">System</span>.out.println ( <span class="string"><span class="delimiter">&quot;</span><span class="content">lastAccessedTime: </span><span class="delimiter">&quot;</span></span> + entry.getLastAccessTime() );
<span class="predefined-type">System</span>.out.println ( <span class="string"><span class="delimiter">&quot;</span><span class="content">lastUpdateTime  : </span><span class="delimiter">&quot;</span></span> + entry.getLastUpdateTime() );
<span class="predefined-type">System</span>.out.println ( <span class="string"><span class="delimiter">&quot;</span><span class="content">version         : </span><span class="delimiter">&quot;</span></span> + entry.getVersion() );
<span class="predefined-type">System</span>.out.println ( <span class="string"><span class="delimiter">&quot;</span><span class="content">key             : </span><span class="delimiter">&quot;</span></span> + entry.getKey() );
<span class="predefined-type">System</span>.out.println ( <span class="string"><span class="delimiter">&quot;</span><span class="content">value           : </span><span class="delimiter">&quot;</span></span> + entry.getValue() );</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="map-listener"><a class="anchor" href="#map-listener"></a><a class="link" href="#map-listener">7.2.11. Map Listener</a></h4>
<div class="paragraph">
<p>Please refer to the <a href="#listening-for-map-events">Listening for Map Events section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="listening-to-map-entries-with-predicates"><a class="anchor" href="#listening-to-map-entries-with-predicates"></a><a class="link" href="#listening-to-map-entries-with-predicates">7.2.12. Listening to Map Entries with Predicates</a></h4>
<div class="paragraph">
<p>You can listen to the modifications performed on specific map entries. You can think of it as an entry listener with predicates. Please see the <a href="#listening-for-map-events">Listening for Map Events section</a> for information on how to add entry listeners to a map.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default backwards-compatible event publishing strategy only publishes
<code>UPDATED</code> events when map entries are updated to a value that matches the predicate with which the listener was registered.
This implies that when using the default event publishing strategy, your listener will not be notified about an entry whose
value is updated from one that matches the predicate to a new value that does not match the predicate.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since version 3.7, when you configure Hazelcast members with property <code>hazelcast.map.entry.filtering.natural.event.types</code> set to <code>true</code>,
handling of entry updates conceptually treats value transition as entry, update or exit with regards to the predicate value space.
The following table compares how a listener is notified about an update to a map entry value under the default
backwards-compatible Hazelcast behavior (when property <code>hazelcast.map.entry.filtering.natural.event.types</code> is not set or is set
to <code>false</code>) versus when set to <code>true</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.map.entry.filtering.natural.event.types = true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">When old value matches predicate, new value does not match predicate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No event is delivered to entry listener</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REMOVED</code> event is delivered to entry listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">When old value matches predicate, new value matches predicate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPDATED</code> event is delivered to entry listener</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPDATED</code> event is delivered to entry listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">When old value does not match predicate, new value does not match predicate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No event is delivered to entry listener</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No event is delivered to entry listener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">When old value does not match predicate, new value matches predicate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPDATED</code> event is delivered to entry listener</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ADDED</code> event is delivered to entry listener</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As an example, let&#8217;s listen to the changes made on an employee with the surname "Smith". First, let&#8217;s create the <code>Employee</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/Employee.java[tag=emp]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, let&#8217;s create a listener with predicate by adding a listener that tracks <code>ADDED</code>, <code>UPDATED</code> and <code>REMOVED</code> entry events with the <code>surname</code> predicate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/ListenerWithPredicate.java[tag=lwp]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now, let&#8217;s play with the employee "smith" and see how that employee will be listened to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/Modify.java[tag=modify]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you first run the class <code>ListenerWithPredicate</code> and then run <code>Modify</code>, you will see output similar to the listing below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">entryAdded:EntryEvent {Address[<span class="float">192.168</span><span class="float">.178</span><span class="float">.10</span>]:<span class="integer">5702</span>} key=<span class="integer">1</span>,oldValue=<span class="predefined-constant">null</span>,
value=Person{name= smith }, event=ADDED, by <span class="predefined-type">Member</span> [<span class="float">192.168</span><span class="float">.178</span><span class="float">.10</span>]:<span class="integer">5702</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to <a href="#continuous-query-cache">Continuous Query Cache</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="removing-map-entries-in-bulk-with-predicates"><a class="anchor" href="#removing-map-entries-in-bulk-with-predicates"></a><a class="link" href="#removing-map-entries-in-bulk-with-predicates">7.2.13. Removing Map Entries in Bulk with Predicates</a></h4>
<div class="paragraph">
<p>You can remove all map entries that match your predicate. For this, Hazelcast offers the method <code>removeAll()</code>. Its syntax is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">void</span> removeAll(<span class="predefined-type">Predicate</span>&lt;K, V&gt; predicate);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Normally the map entries matching the predicate are found with a full scan of the map. If the entries are indexed, Hazelcast uses the index search to find them. With index, you can expect that finding the entries is faster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When <code>removeAll()</code> is called, ALL entries in the caller member&#8217;s Near Cache are also removed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="adding-interceptors"><a class="anchor" href="#adding-interceptors"></a><a class="link" href="#adding-interceptors">7.2.14. Adding Interceptors</a></h4>
<div class="paragraph">
<p>You can add intercept operations and execute your own business logic synchronously blocking the operations. You can change the returned value from a <code>get</code> operation, change the value in <code>put</code>, or <code>cancel</code> operations by throwing an exception.</p>
</div>
<div class="paragraph">
<p>Interceptors are different from listeners. With listeners, you take an action after the operation has been completed. Interceptor actions are synchronous and you can alter the behavior of operation, change its values, or totally cancel it.</p>
</div>
<div class="paragraph">
<p>Map interceptors are chained, so adding the same interceptor multiple times to the same map can result in duplicate effects. This can easily happen when the interceptor is added to the map at member initialization, so that each member adds the same interceptor. When you add the interceptor in this way, be sure to implement the <code>hashCode()</code> method to return the same value for every instance of the interceptor. It is not strictly necessary, but it is a good idea to also implement <code>equals()</code> as this will ensure that the map interceptor can be removed reliably.</p>
</div>
<div class="paragraph">
<p>The IMap API has two methods for adding and removing an interceptor to the map: <code>addInterceptor</code> and <code>removeInterceptor</code>. Please also refer to the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/map/MapInterceptor.html"><code>MapInterceptor</code> interface</a> to see the methods used to intercept the changes in a map.</p>
</div>
<div class="paragraph">
<p>The following is an example usage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/map/MapInterceptorMember.java[tag=mim]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="preventing-out-of-memory-exceptions"><a class="anchor" href="#preventing-out-of-memory-exceptions"></a><a class="link" href="#preventing-out-of-memory-exceptions">7.2.15. Preventing Out of Memory Exceptions</a></h4>
<div class="paragraph">
<p>It is very easy to trigger an out of memory exception (OOME) with query-based map methods, especially with large clusters or heap sizes. For example, on a cluster with five members having 10 GB of data and 25 GB heap size per member, a single call of <code>IMap.entrySet()</code> fetches 50 GB of data and crashes the calling instance.</p>
</div>
<div class="paragraph">
<p>A call of <code>IMap.values()</code> may return too much data for a single member. This can also happen with a real query and an unlucky choice of predicates, especially when the parameters are chosen by a user of your application.</p>
</div>
<div class="paragraph">
<p>To prevent this, you can configure a maximum result size limit for query based operations. This is not a limit like <code>SELECT * FROM map LIMIT 100</code>, which you can achieve by a <a href="#filtering-with-paging-predicates">Paging Predicate</a>. A maximum result size limit for query based operations is meant to be a last line of defense to prevent your members from retrieving more data than they can handle.</p>
</div>
<div class="paragraph">
<p>The Hazelcast component which calculates this limit is the <code>QueryResultSizeLimiter</code>.</p>
</div>
<div class="sect4">
<h5 id="setting-query-result-size-limit"><a class="anchor" href="#setting-query-result-size-limit"></a><a class="link" href="#setting-query-result-size-limit">Setting Query Result Size Limit</a></h5>
<div class="paragraph">
<p>If the <code>QueryResultSizeLimiter</code> is activated, it calculates a result size limit per partition. Each <code>QueryOperation</code> runs on all partitions of a member, so it collects result entries as long as the member limit is not exceeded. If that happens, a <code>QueryResultSizeExceededException</code> is thrown and propagated to the calling instance.</p>
</div>
<div class="paragraph">
<p>This feature depends on an equal distribution of the data on the cluster members to calculate the result size limit per member. Therefore, there is a minimum value defined in <code>QueryResultSizeLimiter.MINIMUM_MAX_RESULT_LIMIT</code>. Configured values below the minimum will be increased to the minimum.</p>
</div>
</div>
<div class="sect4">
<h5 id="local-pre-check"><a class="anchor" href="#local-pre-check"></a><a class="link" href="#local-pre-check">Local Pre-check</a></h5>
<div class="paragraph">
<p>In addition to the distributed result size check in the <code>QueryOperations</code>, there is a local pre-check on the calling instance. If you call the method from a client, the pre-check is executed on the member that invokes the <code>QueryOperations</code>.</p>
</div>
<div class="paragraph">
<p>Since the local pre-check can increase the latency of a <code>QueryOperation</code>, you can configure how many local partitions should be considered for the pre-check, or you can deactivate the feature completely.</p>
</div>
</div>
<div class="sect4">
<h5 id="scope-of-result-size-limit"><a class="anchor" href="#scope-of-result-size-limit"></a><a class="link" href="#scope-of-result-size-limit">Scope of Result Size Limit</a></h5>
<div class="paragraph">
<p>Besides the designated query operations, there are other operations that use predicates internally. Those method calls will throw the <code>QueryResultSizeExceededException</code> as well. Please see the following matrix to see the methods that are covered by the query result size limit.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Map-QueryResultSizeLimiterScope.png" alt="Methods Covered by Query Result Size Limit">
</div>
</div>
</div>
<div class="sect4">
<h5 id="configuring-query-result-size"><a class="anchor" href="#configuring-query-result-size"></a><a class="link" href="#configuring-query-result-size">Configuring Query Result Size</a></h5>
<div class="paragraph">
<p>The query result size limit is configured via the following system properties.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.query.result.size.limit</code>: Result size limit for query operations on maps. This value defines the maximum number of returned elements for a single query result. If a query exceeds this number of elements, a QueryResultSizeExceededException is thrown.</p>
</li>
<li>
<p><code>hazelcast.query.max.local.partition.limit.for.precheck</code>: Maximum value of local partitions to trigger local pre-check for TruePredicate query operations on maps.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to the <a href="#system-properties">System Properties appendix</a> to see the full descriptions of these properties and how to set them.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="queue"><a class="anchor" href="#queue"></a><a class="link" href="#queue">7.3. Queue</a></h3>
<div class="paragraph">
<p>Hazelcast distributed queue is an implementation of <code>java.util.concurrent.BlockingQueue</code>. Being distributed, Hazelcast distributed queue enables all cluster members to interact with it. Using Hazelcast distributed queue, you can add an item in one cluster member and remove it from another one.</p>
</div>
<div class="sect3">
<h4 id="getting-a-queue-and-putting-items"><a class="anchor" href="#getting-a-queue-and-putting-items"></a><a class="link" href="#getting-a-queue-and-putting-items">7.3.1. Getting a Queue and Putting Items</a></h4>
<div class="paragraph">
<p>Use the Hazelcast instance&#8217;s <code>getQueue</code> method to get the queue, then use the queue&#8217;s <code>put</code> method to put items into the queue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/queue/SampleQueue.java[tag=samplequeue]</code></pre>
</div>
</div>
<div class="paragraph">
<p>FIFO ordering will apply to all queue operations across the cluster. The user objects (such as <code>MyTask</code> in the example above) that are enqueued or dequeued have to be <code>Serializable</code>.</p>
</div>
<div class="paragraph">
<p>Hazelcast distributed queue performs no batching while iterating over the queue. All items will be copied locally and iteration will occur locally.</p>
</div>
<div class="paragraph">
<p>Hazelcast distributed queue uses <code>ItemListener</code> to listen to the events that occur when items are added to and removed from the queue. Please refer to the <a href="#listening-for-item-events">Listening for Item Events section</a> for information on how to create an item listener class and register it.</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-an-example-queue"><a class="anchor" href="#creating-an-example-queue"></a><a class="link" href="#creating-an-example-queue">7.3.2. Creating an Example Queue</a></h4>
<div class="paragraph">
<p>The following example code illustrates a distributed queue that connects a producer and consumer.</p>
</div>
<div class="sect4">
<h5 id="putting-items-on-the-queue"><a class="anchor" href="#putting-items-on-the-queue"></a><a class="link" href="#putting-items-on-the-queue">Putting Items on the Queue</a></h5>
<div class="paragraph">
<p>Let&#8217;s <code>put</code> one integer on the queue every second, 100 integers total.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/queue/ProducerMember.java[tag=producer]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Producer</code> puts a <strong>-1</strong> on the queue to show that the `put`s are finished.</p>
</div>
</div>
<div class="sect4">
<h5 id="taking-items-off-the-queue"><a class="anchor" href="#taking-items-off-the-queue"></a><a class="link" href="#taking-items-off-the-queue">Taking Items off the Queue</a></h5>
<div class="paragraph">
<p>Now, let&#8217;s create a <code>Consumer</code> class to <code>take</code> a message from this queue, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/queue/ConsumerMember.java[tag=consumer]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen in the above example code, <code>Consumer</code> waits five seconds before it consumes the next message. It stops once it receives <strong>-1</strong>. Also note that <code>Consumer</code> puts <strong>-1</strong> back on the queue before the loop is ended.</p>
</div>
<div class="paragraph">
<p>When you first start <code>Producer</code> and then start <code>Consumer</code>, items produced on the queue will be consumed from the same queue.</p>
</div>
</div>
<div class="sect4">
<h5 id="balancing-the-queue-operations"><a class="anchor" href="#balancing-the-queue-operations"></a><a class="link" href="#balancing-the-queue-operations">Balancing the Queue Operations</a></h5>
<div class="paragraph">
<p>From the above example code, you can see that an item is produced every second and consumed every five seconds. Therefore, the consumer keeps growing. To balance the produce/consume operation, let&#8217;s start another consumer. This way, consumption is distributed to these two consumers, as seen in the sample outputs below.</p>
</div>
<div class="paragraph">
<p>The second consumer is started. After a while, here is the first consumer output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
Consumed <span class="integer">13</span>
Consumed <span class="integer">15</span>
Consumer <span class="integer">17</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the second consumer output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
Consumed <span class="integer">14</span>
Consumed <span class="integer">16</span>
Consumer <span class="integer">18</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the case of a lot of producers and consumers for the queue, using a list of queues may solve the queue bottlenecks. In this case, be aware that the order of the messages sent to different queues is not guaranteed. Since in most cases strict ordering is not important, a list of queues is a good solution.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The items are taken from the queue in the same order they were put on the queue. However, if there is more than one consumer, this order is not guaranteed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="itemids-when-offering-items"><a class="anchor" href="#itemids-when-offering-items"></a><a class="link" href="#itemids-when-offering-items">ItemIDs When Offering Items</a></h5>
<div class="paragraph">
<p>Hazelcast gives an <code>itemId</code> for each item you offer, which is an incrementing sequence identification for the queue items. You should consider the following to understand the <code>itemId</code> assignment behavior:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a Hazelcast member has a queue and that queue is configured to have at least one backup, and that member is restarted, the <code>itemId</code> assignment resumes from the last known highest <code>itemId</code> before the restart; <code>itemId</code> assignment does not start from the beginning for the new items.</p>
</li>
<li>
<p>When the whole cluster is restarted, the same behavior explained in the above consideration applies if your queue has a persistent data store (<code>QueueStore</code>). If the queue has <code>QueueStore</code>, the <code>itemId</code> for the new items are given, starting from the highest <code>itemId</code> found in the IDs returned by the method <code>loadAllKeys</code>. If the method <code>loadAllKeys</code> does not return anything, the `itemId`s will started from the beginning after a cluster restart.</p>
</li>
<li>
<p>The above two considerations mean there will be no duplicated `itemId`s in the memory or in the persistent data store.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="setting-a-bounded-queue"><a class="anchor" href="#setting-a-bounded-queue"></a><a class="link" href="#setting-a-bounded-queue">7.3.3. Setting a Bounded Queue</a></h4>
<div class="paragraph">
<p>A bounded queue is a queue with a limited capacity. When the bounded queue is full, no more items can be put into the queue until some items are taken out.</p>
</div>
<div class="paragraph">
<p>To turn a Hazelcast distributed queue into a bounded queue, set the capacity limit with the <code>max-size</code> property. You can set the <code>max-size</code> property in the configuration, as shown below. <code>max-size</code> specifies the maximum size of the queue. Once the queue size reaches this value, <code>put</code> operations will be blocked until the queue size goes below <code>max-size</code>, which happens when a consumer removes items from the queue.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s set <strong>10</strong> as the maximum size of our example queue in <a href="#creating-an-example-queue">Creating an Example Queue</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  ...
  <span class="tag">&lt;queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;max-size&gt;</span>10<span class="tag">&lt;/max-size&gt;</span>
  <span class="tag">&lt;/queue&gt;</span>
  ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the producer is started, ten items are put into the queue and then the queue will not allow more <code>put</code> operations. When the consumer is started, it will remove items from the queue. This means that the producer can <code>put</code> more items into the queue until there are ten items in the queue again, at which point the <code>put</code> operation again becomes blocked.</p>
</div>
<div class="paragraph">
<p>In this example code, the producer is five times faster than the consumer. It will effectively always be waiting for the consumer to remove items before it can put more on the queue. For this example code, if maximum throughput is the goal, it would be a good option to start multiple consumers to prevent the queue from filling up.</p>
</div>
</div>
<div class="sect3">
<h4 id="queueing-with-persistent-datastore"><a class="anchor" href="#queueing-with-persistent-datastore"></a><a class="link" href="#queueing-with-persistent-datastore">7.3.4. Queueing with Persistent Datastore</a></h4>
<div class="paragraph">
<p>Hazelcast allows you to load and store the distributed queue items from/to a persistent datastore using the interface <code>QueueStore</code>. If queue store is enabled, each item added to the queue will also be stored at the configured queue store. When the number of items in the queue exceeds the memory limit, the subsequent items are persisted in the queue store, they are not stored in the queue memory.</p>
</div>
<div class="paragraph">
<p>The <code>QueueStore</code> interface enables you to store, load and delete queue items with methods like <code>store</code>, <code>storeAll</code>, <code>load</code> and <code>delete</code>. The following example class includes all of the <code>QueueStore</code> methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/queue/TheQueueStore.java[tag=qs]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Item</code> must be serializable. The following is an example queue store configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;queue-store&gt;</span>
  <span class="tag">&lt;class-name&gt;</span>com.hazelcast.QueueStoreImpl<span class="tag">&lt;/class-name&gt;</span>
  <span class="tag">&lt;properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">binary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>false<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">memory-limit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1000<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bulk-load</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>500<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/properties&gt;</span>
<span class="tag">&lt;/queue-store&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s explain the queue store properties.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Binary</strong>: By default, Hazelcast stores the queue items in serialized form, and before it inserts the queue items into the queue store, it deserializes them. If you are not reaching the queue store from an external application, you might prefer that the items be inserted in binary form. Do this by setting the <code>binary</code> property to true: then you can get rid of the deserialization step, which is a performance optimization. The <code>binary</code> property is false by default.</p>
</li>
<li>
<p><strong>Memory Limit</strong>: This is the number of items after which Hazelcast will store items only to the datastore. For example, if the memory limit is 1000, then the 1001st item will be put only to the datastore. This feature is useful when you want to avoid out-of-memory conditions. If you want to always use memory, you can set it to <code>Integer.MAX_VALUE</code>. The default number for <code>memory-limit</code> is 1000.</p>
</li>
<li>
<p><strong>Bulk Load</strong>: When the queue is initialized, items are loaded from <code>QueueStore</code> in bulks. Bulk load is the size of these bulks. The default value of <code>bulk-load</code> is 250.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-queue"><a class="anchor" href="#split-brain-protection-for-queue"></a><a class="link" href="#split-brain-protection-for-queue">7.3.5. Split-Brain Protection for Queue</a></h4>
<div class="paragraph">
<p>Queues can be configured to check for a minimum number of available members before applying queue operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful queue operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE</p>
<div class="ulist">
<ul>
<li>
<p><code>Collection.addAll()</code></p>
</li>
<li>
<p><code>Collection.removeAll()</code>, <code>Collection.retainAll()</code></p>
</li>
<li>
<p><code>BlockingQueue.offer()</code>, <code>BlockingQueue.add()</code>, <code>BlockingQueue.put()</code></p>
</li>
<li>
<p><code>BlockingQueue.drainTo()</code></p>
</li>
<li>
<p><code>IQueue.poll()</code>, <code>Queue.remove()</code>, <code>IQueue.take()</code></p>
</li>
<li>
<p><code>BlockingQueue.remove()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE</p>
<div class="ulist">
<ul>
<li>
<p><code>Collection.clear()</code></p>
</li>
<li>
<p><code>Collection.containsAll()</code>, <code>BlockingQueue.contains()</code></p>
</li>
<li>
<p><code>Collection.isEmpty()</code></p>
</li>
<li>
<p><code>Collection.iterator()</code>, <code>Collection.toArray()</code></p>
</li>
<li>
<p><code>Queue.peek()</code>, <code>Queue.element()</code></p>
</li>
<li>
<p><code>Collection.size()</code></p>
</li>
<li>
<p><code>BlockingQueue.remainingCapacity()</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-queue"><a class="anchor" href="#configuring-queue"></a><a class="link" href="#configuring-queue">7.3.6. Configuring Queue</a></h4>
<div class="paragraph">
<p>The following are examples of queue configurations. It includes the <code>QueueStore</code> configuration, which is explained in the <a href="#queueing-with-persistent-datastore">Queueing with Persistent Datastore</a> section.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;max-size&gt;</span>0<span class="tag">&lt;/max-size&gt;</span>
    <span class="tag">&lt;backup-count&gt;</span>1<span class="tag">&lt;/backup-count&gt;</span>
    <span class="tag">&lt;async-backup-count&gt;</span>0<span class="tag">&lt;/async-backup-count&gt;</span>
    <span class="tag">&lt;empty-queue-ttl&gt;</span>-1<span class="tag">&lt;/empty-queue-ttl&gt;</span>
    <span class="tag">&lt;item-listeners&gt;</span>
        <span class="tag">&lt;item-listener&gt;</span>com.hazelcast.examples.ItemListener<span class="tag">&lt;/item-listener&gt;</span>
    <span class="tag">&lt;/item-listeners&gt;</span>
    <span class="tag">&lt;statistics-enabled&gt;</span>true<span class="tag">&lt;/statistics-enabled&gt;</span>
    <span class="tag">&lt;queue-store&gt;</span>
        <span class="tag">&lt;class-name&gt;</span>com.hazelcast.QueueStoreImpl<span class="tag">&lt;/class-name&gt;</span>
        <span class="tag">&lt;properties&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">binary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>false<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">memory-limit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>10000<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bulk-load</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>500<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/queue-store&gt;</span>
    <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/queue&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/queue/QueueConfiguration.java[tag=queueconf]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hazelcast distributed queue has one synchronous backup by default. By having this backup, when a cluster member with a queue goes down, another member having the backup of that queue will continue. Therefore, no items are lost. You can define the number of synchronous backups for a queue using the <code>backup-count</code> element in the declarative configuration. A queue can also have asynchronous backups: you can define the number of asynchronous backups using the <code>async-backup-count</code> element.</p>
</div>
<div class="paragraph">
<p>To set the maximum size of the queue, use the <code>max-size</code> element. To purge unused or empty queues after a period of time, use the <code>empty-queue-ttl</code> element. If you define a value (time in seconds) for the <code>empty-queue-ttl</code> element, then your queue will be destroyed if it stays empty or unused for the time in seconds that you give.</p>
</div>
<div class="paragraph">
<p>The following is the full list of queue configuration elements with their descriptions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>max-size</code>: Maximum number of items in the queue. It is used to set an upper bound for the queue. You will not be able to put more items when the queue reaches to this maximum size whether you have a queue store configured or not.</p>
</li>
<li>
<p><code>backup-count</code>: Number of synchronous backups. Queue is a non-partitioned data structure, so all entries of a queue reside in one partition. When this parameter is '1', it means there will be one backup of that queue in another member in the cluster. When it is '2', two members will have the backup.</p>
</li>
<li>
<p><code>async-backup-count</code>: Number of asynchronous backups.</p>
</li>
<li>
<p><code>empty-queue-ttl</code>: Used to purge unused or empty queues. If you define a value (time in seconds) for this element, then your queue will be destroyed if it stays empty or unused for that time.</p>
</li>
<li>
<p><code>item-listeners</code>: Adds listeners (listener classes) for the queue items. You can also set the attribute <code>include-value</code> to <code>true</code> if you want the item event to contain the item values. You can set <code>local</code> to <code>true</code> if you want to listen to the items on the local member.</p>
</li>
<li>
<p><code>queue-store</code>: Includes the queue store factory class name and the properties  <strong>binary</strong>, <strong>memory limit</strong> and <strong>bulk load</strong>. Please refer to <a href="#queueing-with-persistent-datastore">Queueing with Persistent Datastore</a>.</p>
</li>
<li>
<p><code>statistics-enabled</code>: If set to <code>true</code>, you can retrieve statistics for this queue using the method <code>getLocalQueueStats()</code>.</p>
</li>
<li>
<p><code>quorum-ref</code> : Name of quorum configuration that you want this queue to use.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multimap"><a class="anchor" href="#multimap"></a><a class="link" href="#multimap">7.4. MultiMap</a></h3>
<div class="paragraph">
<p>Hazelcast <code>MultiMap</code> is a specialized map where you can store multiple values under a single key. Just like any other distributed data structure implementation in Hazelcast, <code>MultiMap</code> is distributed and thread-safe.</p>
</div>
<div class="paragraph">
<p>Hazelcast <code>MultiMap</code> is not an implementation of <code>java.util.Map</code> due to the difference in method signatures. It supports most features of Hazelcast Map except for indexing, predicates and MapLoader/MapStore. Yet, like Hazelcast Map, entries are almost evenly distributed onto all cluster members. When a new member joins the cluster, the same ownership logic used in the distributed map applies.</p>
</div>
<div class="sect3">
<h4 id="getting-a-multimap-and-putting-an-entry"><a class="anchor" href="#getting-a-multimap-and-putting-an-entry"></a><a class="link" href="#getting-a-multimap-and-putting-an-entry">7.4.1. Getting a MultiMap and Putting an Entry</a></h4>
<div class="paragraph">
<p>The following example creates a MultiMap and puts items into it. Use the HazelcastInstance <code>getMultiMap</code> method to get the MultiMap, then use the MultiMap <code>put</code> method to put an entry into the MultiMap.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/multimap/SampleMultiMap.java[tag=mm]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s print the entries in this MultiMap.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/multimap/PrintMember.java[tag=pm]</code></pre>
</div>
</div>
<div class="paragraph">
<p>After you run the first code sample, run the <code>PrintMember</code> sample. You will see the key <strong><code>a</code></strong> has two values, as shown below.</p>
</div>
<div class="paragraph">
<p><code>b &#8594; [3]</code></p>
</div>
<div class="paragraph">
<p><code>a &#8594; [2, 1]</code></p>
</div>
<div class="paragraph">
<p>Hazelcast MultiMap uses <code>EntryListener</code> to listen to events which occur when entries are added to, updated in or removed from the MultiMap. Please refer to the <a href="#listening-for-multimap-events">Listening for MultiMap Events section</a> for information on how to create an entry listener class and register it.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-multimap"><a class="anchor" href="#configuring-multimap"></a><a class="link" href="#configuring-multimap">7.4.2. Configuring MultiMap</a></h4>
<div class="paragraph">
<p>When using MultiMap, the collection type of the values can be either <strong>Set</strong> or <strong>List</strong>. Configure the collection type with the <code>valueCollectionType</code> parameter. If you choose <code>Set</code>, duplicate and null values are not allowed in your collection and ordering is irrelevant. If you choose <code>List</code>, ordering is relevant and your collection can include duplicate and null values.</p>
</div>
<div class="paragraph">
<p>You can also enable statistics for your MultiMap with the <code>statisticsEnabled</code> parameter. If you enable <code>statisticsEnabled</code>, statistics can be retrieved with <code>getLocalMultiMapStats()</code> method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, eviction is not supported for the MultiMap data structure.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following are the example MultiMap configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;multimap</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;backup-count&gt;</span>0<span class="tag">&lt;/backup-count&gt;</span>
    <span class="tag">&lt;async-backup-count&gt;</span>1<span class="tag">&lt;/async-backup-count&gt;</span>
    <span class="tag">&lt;value-collection-type&gt;</span>SET<span class="tag">&lt;/value-collection-type&gt;</span>
    <span class="tag">&lt;entry-listeners&gt;</span>
        <span class="tag">&lt;entry-listener</span> <span class="attribute-name">include-value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">local</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>com.hazelcast.examples.EntryListener<span class="tag">&lt;/entry-listener&gt;</span>
    <span class="tag">&lt;/entry-listeners&gt;</span>
    <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/multimap&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/multimap/MultiMapConfiguration.java[tag=mmc]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are the configuration elements and their descriptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>backup-count</code>: Defines the number of synchronous backups. For example, if it is set to 1, backup of a partition will be
placed on one other member. If it is 2, it will be placed on two other members.</p>
</li>
<li>
<p><code>async-backup-count</code>: The number of asynchronous backups. Behavior is the same as that of the <code>backup-count</code> element.</p>
</li>
<li>
<p><code>statistics-enabled</code>: You can retrieve some statistics such as owned entry count, backup entry count, last update time and locked entry count by setting this parameter&#8217;s value as "true". The method for retrieving the statistics is <code>getLocalMultiMapStats()</code>.</p>
</li>
<li>
<p><code>value-collection-type</code>: Type of the value collection. It can be <code>SET</code> or <code>LIST</code>.</p>
</li>
<li>
<p><code>entry-listeners</code>: Lets you add listeners (listener classes) for the map entries. You can also set the attribute
include-value to true if you want the item event to contain the entry values. You can set
local to true if you want to listen to the entries on the local member.</p>
</li>
<li>
<p><code>quorum-ref</code>: Name of quorum configuration that you want this MultiMap to use. Please see the <a href="#split-brain-protection-for-multimap-and-transactionalmultimap">Split-Brain Protection for MultiMap and TransactionalMultiMap section</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-multimap-and-transactionalmultimap"><a class="anchor" href="#split-brain-protection-for-multimap-and-transactionalmultimap"></a><a class="link" href="#split-brain-protection-for-multimap-and-transactionalmultimap">7.4.3. Split-Brain Protection for MultiMap and TransactionalMultiMap</a></h4>
<div class="paragraph">
<p>MultiMap &amp; TransactionalMultiMap can be configured to check for a minimum number of available members before applying their operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful queue operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="paragraph">
<p>MultiMap:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>clear</code></p>
</li>
<li>
<p><code>forceUnlock</code></p>
</li>
<li>
<p><code>lock</code></p>
</li>
<li>
<p><code>put</code></p>
</li>
<li>
<p><code>remove</code></p>
</li>
<li>
<p><code>tryLock</code></p>
</li>
<li>
<p><code>unlock</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>containsEntry</code></p>
</li>
<li>
<p><code>containsKey</code></p>
</li>
<li>
<p><code>containsValue</code></p>
</li>
<li>
<p><code>entrySet</code></p>
</li>
<li>
<p><code>get</code></p>
</li>
<li>
<p><code>isLocked</code></p>
</li>
<li>
<p><code>keySet</code></p>
</li>
<li>
<p><code>localKeySet</code></p>
</li>
<li>
<p><code>size</code></p>
</li>
<li>
<p><code>valueCount</code></p>
</li>
<li>
<p><code>values</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>TransactionalMultiMap:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>put</code></p>
</li>
<li>
<p><code>remove</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>size</code></p>
</li>
<li>
<p><code>get</code></p>
</li>
<li>
<p><code>valueCount</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for MultiMap can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/MultiMapConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;multimap</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
    ...
<span class="tag">&lt;/multimap&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="set"><a class="anchor" href="#set"></a><a class="link" href="#set">7.5. Set</a></h3>
<div class="paragraph">
<p>Hazelcast Set is a distributed and concurrent implementation of <code>java.util.Set</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hazelcast Set does not allow duplicate elements.</p>
</li>
<li>
<p>Hazelcast Set does not preserve the order of elements.</p>
</li>
<li>
<p>Hazelcast Set is a non-partitioned data structure&#8212;&#8203;all the data that belongs to a set will live on one single partition in that member.</p>
</li>
<li>
<p>Hazelcast Set cannot be scaled beyond the capacity of a single machine. Since the whole set lives on a single partition, storing a large amount of data on a single set may cause memory pressure. Therefore, you should use multiple sets to store a large amount of data. This way, all the sets will be spread across the cluster, sharing the load.</p>
</li>
<li>
<p>A backup of Hazelcast Set is stored on a partition of another member in the cluster so that data is not lost in the event of a primary member failure.</p>
</li>
<li>
<p>All items are copied to the local member and iteration occurs locally.</p>
</li>
<li>
<p>The equals method implemented in Hazelcast Set uses a serialized byte version of objects, as opposed to <code>java.util.HashSet</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="getting-a-set-and-putting-items"><a class="anchor" href="#getting-a-set-and-putting-items"></a><a class="link" href="#getting-a-set-and-putting-items">7.5.1. Getting a Set and Putting Items</a></h4>
<div class="paragraph">
<p>Use the HazelcastInstance <code>getSet</code> method to get the Set, then use the <code>add</code> method to put items into the Set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/set/SampleSet.java[tag=set]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hazelcast Set uses <code>ItemListener</code> to listen to events that occur when items are added to and removed from the Set. Please refer to the <a href="#listening-for-item-events">Listening for Item Events section</a> for information on how to create an item listener class and register it.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-set"><a class="anchor" href="#configuring-set"></a><a class="link" href="#configuring-set">7.5.2. Configuring Set</a></h4>
<div class="paragraph">
<p>The following are the example set configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;set</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;backup-count&gt;</span>1<span class="tag">&lt;/backup-count&gt;</span>
    <span class="tag">&lt;async-backup-count&gt;</span>0<span class="tag">&lt;/async-backup-count&gt;</span>
    <span class="tag">&lt;max-size&gt;</span>10<span class="tag">&lt;/max-size&gt;</span>
    <span class="tag">&lt;item-listeners&gt;</span>
        <span class="tag">&lt;item-listener&gt;</span>com.hazelcast.examples.ItemListener<span class="tag">&lt;/item-listener&gt;</span>
    <span class="tag">&lt;/item-listeners&gt;</span>
    <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/set&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/set/SetConfiguration.java[tag=sc]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set configuration has the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>statistics-enabled</code>: True (default) if statistics gathering is enabled on the Set, false otherwise.</p>
</li>
<li>
<p><code>backup-count</code>: Count of synchronous backups. Set is a non-partitioned data structure, so all entries of a Set reside in one partition. When this parameter is '1', it means there will be one backup of that Set in another member in the cluster. When it is '2', two members will have the backup.</p>
</li>
<li>
<p><code>async-backup-count</code>: Count of asynchronous backups.</p>
</li>
<li>
<p><code>max-size</code>: The maximum number of entries for this Set. It can be any number between 0 and Integer.MAX_VALUE. Its default value is 0, meaning there is no capacity constraint.</p>
</li>
<li>
<p><code>item-listeners</code>: Lets you add listeners (listener classes) for the list items. You can also set the attributes <code>include-value</code> to <code>true</code> if you want the item event to contain the item values. You can set <code>local</code> to <code>true</code> if you want to listen to the items on the local member.</p>
</li>
<li>
<p><code>quorum-ref</code>: Name of quorum configuration that you want this Set to use. Please refer to the <a href="#split-brain-protection-for-iset-and-transactionalset">Split-Brain Protection for ISet and TransactionalSet section</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-iset-and-transactionalset"><a class="anchor" href="#split-brain-protection-for-iset-and-transactionalset"></a><a class="link" href="#split-brain-protection-for-iset-and-transactionalset">7.5.3. Split-Brain Protection for ISet and TransactionalSet</a></h4>
<div class="paragraph">
<p>ISet &amp; TransactionalSet can be configured to check for a minimum number of available members before applying queue operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful queue operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="paragraph">
<p>ISet:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>add</code></p>
</li>
<li>
<p><code>addAll</code></p>
</li>
<li>
<p><code>clear</code></p>
</li>
<li>
<p><code>remove</code></p>
</li>
<li>
<p><code>removeAll</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>contains</code></p>
</li>
<li>
<p><code>containsAll</code></p>
</li>
<li>
<p><code>isEmpty</code></p>
</li>
<li>
<p><code>iterator</code></p>
</li>
<li>
<p><code>size</code></p>
</li>
<li>
<p><code>toArray</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>TransactionalSet:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>add</code></p>
</li>
<li>
<p><code>remove</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>size</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for ISet can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/SetConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;set</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
    <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
    ...
<span class="tag">&lt;/set&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="list"><a class="anchor" href="#list"></a><a class="link" href="#list">7.6. List</a></h3>
<div class="paragraph">
<p>Hazelcast List (IList) is similar to Hazelcast Set, but Hazelcast List also allows duplicate elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Besides allowing duplicate elements, Hazelcast List preserves the order of elements.</p>
</li>
<li>
<p>Hazelcast List is a non-partitioned data structure where values and each backup are represented by their own single partition.</p>
</li>
<li>
<p>Hazelcast List cannot be scaled beyond the capacity of a single machine.</p>
</li>
<li>
<p>All items are copied to local and iteration occurs locally.</p>
</li>
</ul>
</div>
<hr>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While IMap and ICache are the recommended data structures to be used by <a href="https://jet.hazelcast.org/">Hazelcast Jet</a>, IList can also be used by it for unit testing or similar non-production situations. Please see <a href="https://docs.hazelcast.org/docs/jet/latest/manual/#imdg-list">here</a> in the Hazelcast Jet Reference Manual to learn how Jet can use IList, e.g., how it can fill IList with data, consume it in a Jet job and drain the results to another IList. Please also see the <a href="https://jet.hazelcast.org/use-cases/fast-batch-processing/">Fast Batch Processing</a> and <a href="https://jet.hazelcast.org/use-cases/real-time-stream-processing/">Real-Time Stream Processing</a> use cases for Hazelcast Jet.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="getting-a-list-and-putting-items"><a class="anchor" href="#getting-a-list-and-putting-items"></a><a class="link" href="#getting-a-list-and-putting-items">7.6.1. Getting a List and Putting Items</a></h4>
<div class="paragraph">
<p>Use the HazelcastInstance <code>getList</code> method to get the List, then use the <code>add</code> method to put items into the List.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/list/SampleList.java[tag=list]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hazelcast List uses <code>ItemListener</code> to listen to events that occur when items are added to and removed from the List. Please refer to the <a href="#listening-for-item-events">Listening for Item Events section</a> for information on how to create an item listener class and register it.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-list"><a class="anchor" href="#configuring-list"></a><a class="link" href="#configuring-list">7.6.2. Configuring List</a></h4>
<div class="paragraph">
<p>The following are example list configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;list</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;backup-count&gt;</span>1<span class="tag">&lt;/backup-count&gt;</span>
   <span class="tag">&lt;async-backup-count&gt;</span>0<span class="tag">&lt;/async-backup-count&gt;</span>
   <span class="tag">&lt;max-size&gt;</span>10<span class="tag">&lt;/max-size&gt;</span>
   <span class="tag">&lt;item-listeners&gt;</span>
      <span class="tag">&lt;item-listener&gt;</span>
          com.hazelcast.examples.ItemListener
      <span class="tag">&lt;/item-listener&gt;</span>
   <span class="tag">&lt;/item-listeners&gt;</span>
   <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/list/ListConfiguration.java[tag=lc]</code></pre>
</div>
</div>
<div class="paragraph">
<p>List configuration has the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>statistics-enabled</code>: True (default) if statistics gathering is enabled on the list, false otherwise.</p>
</li>
<li>
<p><code>backup-count</code>: Number of synchronous backups. List is a non-partitioned data structure, so all entries of a List reside in one partition. When this parameter is '1', there will be one backup of that List in another member in the cluster. When it is '2', two members will have the backup.</p>
</li>
<li>
<p><code>async-backup-count</code>: Number of asynchronous backups.</p>
</li>
<li>
<p><code>max-size</code>: The maximum number of entries for this List.</p>
</li>
<li>
<p><code>item-listeners</code>: Lets you add listeners (listener classes) for the list items. You can also set the attribute <code>include-value</code> to <code>true</code> if you want the item event to contain the item values. You can set the attribute <code>local</code> to <code>true</code> if you want to listen the items on the local member.</p>
</li>
<li>
<p><code>quorum-ref</code>: Name of quorum configuration that you want this List to use. Please see the <a href="#split-brain-protection-for-ilist-and-transactionallist">Split-Brain Protection for IList and TransactionalList section</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-ilist-and-transactionallist"><a class="anchor" href="#split-brain-protection-for-ilist-and-transactionallist"></a><a class="link" href="#split-brain-protection-for-ilist-and-transactionallist">7.6.3. Split-Brain Protection for IList and TransactionalList</a></h4>
<div class="paragraph">
<p>IList &amp; TransactionalList can be configured to check for a minimum number of available members before applying queue operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful queue operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="paragraph">
<p>IList:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>add</code></p>
</li>
<li>
<p><code>addAll</code></p>
</li>
<li>
<p><code>clear</code></p>
</li>
<li>
<p><code>remove</code></p>
</li>
<li>
<p><code>removeAll</code></p>
</li>
<li>
<p><code>set</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>add</code></p>
</li>
<li>
<p><code>contains</code></p>
</li>
<li>
<p><code>containsAll</code></p>
</li>
<li>
<p><code>get</code></p>
</li>
<li>
<p><code>indexOf</code></p>
</li>
<li>
<p><code>isEmpty</code></p>
</li>
<li>
<p><code>iterator</code></p>
</li>
<li>
<p><code>lastIndexOf</code></p>
</li>
<li>
<p><code>listIterator</code></p>
</li>
<li>
<p><code>size</code></p>
</li>
<li>
<p><code>subList</code></p>
</li>
<li>
<p><code>toArray</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>TransactionalList:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>add</code></p>
</li>
<li>
<p><code>remove</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>size</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for IList can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/ListConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;list</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
   ...
<span class="tag">&lt;/list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ringbuffer"><a class="anchor" href="#ringbuffer"></a><a class="link" href="#ringbuffer">7.7. Ringbuffer</a></h3>
<div class="paragraph">
<p>Hazelcast Ringbuffer is a replicated but not partitioned data structure that stores its data in a ring-like structure. You can
think of it as a circular array with a given capacity. Each Ringbuffer has a tail and a head. The tail is where the items are
added and the head is where the items are overwritten or expired. You can reach each element in a Ringbuffer using a sequence
ID, which is mapped to the elements between the head and tail (inclusive) of the Ringbuffer.</p>
</div>
<div class="sect3">
<h4 id="getting-a-ringbuffer-and-reading-items"><a class="anchor" href="#getting-a-ringbuffer-and-reading-items"></a><a class="link" href="#getting-a-ringbuffer-and-reading-items">7.7.1. Getting a Ringbuffer and Reading Items</a></h4>
<div class="paragraph">
<p>Reading from Ringbuffer is simple: get the Ringbuffer with the HazelcastInstance <code>getRingbuffer</code> method, get its current head with
the <code>headSequence</code> method and start reading. Use the method <code>readOne</code> to return the item at the
given sequence; <code>readOne</code> blocks if no item is available. To read the next item, increment the sequence by one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/ringbuffer/SampleRB.java[tag=rb]</code></pre>
</div>
</div>
<div class="paragraph">
<p>By exposing the sequence, you can now move the item from the Ringbuffer as long as the item is still available. If the item is not available
any longer, <code>StaleSequenceException</code> is thrown.</p>
</div>
</div>
<div class="sect3">
<h4 id="adding-items-to-a-ringbuffer"><a class="anchor" href="#adding-items-to-a-ringbuffer"></a><a class="link" href="#adding-items-to-a-ringbuffer">7.7.2. Adding Items to a Ringbuffer</a></h4>
<div class="paragraph">
<p>Adding an item to a Ringbuffer is also easy with the Ringbuffer <code>add</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Ringbuffer&lt;<span class="predefined-type">String</span>&gt; ringbuffer = hz.getRingbuffer(<span class="string"><span class="delimiter">&quot;</span><span class="content">SampleRB</span><span class="delimiter">&quot;</span></span>);
ringbuffer.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">someitem</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the method <code>add</code> to return the sequence of the inserted item; the sequence value will always be unique. You can use this as a
very cheap way of generating unique IDs if you are already using Ringbuffer.</p>
</div>
</div>
<div class="sect3">
<h4 id="iqueue-vs-ringbuffer"><a class="anchor" href="#iqueue-vs-ringbuffer"></a><a class="link" href="#iqueue-vs-ringbuffer">7.7.3. IQueue vs. Ringbuffer</a></h4>
<div class="paragraph">
<p>Hazelcast Ringbuffer can sometimes be a better alternative than an Hazelcast IQueue. Unlike IQueue, Ringbuffer does not remove the items, it only
reads items using a certain position. There are many advantages to this approach:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The same item can be read multiple times by the same thread. This is useful for realizing semantics of read-at-least-once or
read-at-most-once.</p>
</li>
<li>
<p>The same item can be read by multiple threads. Normally you could use an IQueue per thread for the same semantic, but this is
less efficient because of the increased remoting. A take from an IQueue is destructive, so the change needs to be applied for backup
also, which is why a <code>queue.take()</code> is more expensive than a <code>ringBuffer.read(&#8230;&#8203;)</code>.</p>
</li>
<li>
<p>Reads are extremely cheap since there is no change in the Ringbuffer. Therefore no replication is required.</p>
</li>
<li>
<p>Reads and writes can be batched to speed up performance. Batching can dramatically improve the performance of Ringbuffer.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-ringbuffer-capacity"><a class="anchor" href="#configuring-ringbuffer-capacity"></a><a class="link" href="#configuring-ringbuffer-capacity">7.7.4. Configuring Ringbuffer Capacity</a></h4>
<div class="paragraph">
<p>By default, a Ringbuffer is configured with a <code>capacity</code> of 10000 items. This creates an array with a size of 10000. If
a <code>time-to-live</code> is configured, then an array of longs is also created that stores the expiration time for every item.
In a lot of cases you may want to change this <code>capacity</code> number to something that better fits your needs.</p>
</div>
<div class="paragraph">
<p>Below is a declarative configuration example of a Ringbuffer with a <code>capacity</code> of 2000 items.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ringbuffer</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rb</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;capacity&gt;</span>2000<span class="tag">&lt;/capacity&gt;</span>
<span class="tag">&lt;/ringbuffer&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently, Hazelcast Ringbuffer is not a partitioned data structure; its data is stored in a single partition and the replicas
 are stored in another partition. Therefore, create a Ringbuffer that can safely fit in a single cluster member.</p>
</div>
</div>
<div class="sect3">
<h4 id="backing-up-ringbuffer"><a class="anchor" href="#backing-up-ringbuffer"></a><a class="link" href="#backing-up-ringbuffer">7.7.5. Backing Up Ringbuffer</a></h4>
<div class="paragraph">
<p>Hazelcast Ringbuffer has a single synchronous backup by default. You can control the Ringbuffer backup just like most of the other Hazelcast
distributed data structures by setting the synchronous and asynchronous backups: <code>backup-count</code> and <code>async-backup-count</code>. In the example below, a Ringbuffer is configured with no
synchronous backups and one asynchronous backup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ringbuffer</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rb</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;backup-count&gt;</span>0<span class="tag">&lt;/backup-count&gt;</span>
    <span class="tag">&lt;async-backup-count&gt;</span>1<span class="tag">&lt;/async-backup-count&gt;</span>
<span class="tag">&lt;/ringbuffer&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An asynchronous backup will probably give you better performance. However, there is a chance that the item added will be lost
when the member owning the primary crashes before the backup could complete. You may want to consider batching
methods if you need high performance but do not want to give up on consistency.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-ringbuffer-time-to-live"><a class="anchor" href="#configuring-ringbuffer-time-to-live"></a><a class="link" href="#configuring-ringbuffer-time-to-live">7.7.6. Configuring Ringbuffer Time-To-Live</a></h4>
<div class="paragraph">
<p>You can configure Hazelcast Ringbuffer with a time-to-live in seconds. Using this setting, you can control how long the items remain in
the Ringbuffer before they are expired. By default, the time-to-live is set to 0, meaning that unless the item is overwritten,
it will remain in the Ringbuffer indefinitely. If you set a time-to-live and an item is added, then, depending on the Overflow Policy,
either the oldest item is overwritten, or the call is rejected.</p>
</div>
<div class="paragraph">
<p>In the example below, a Ringbuffer is configured with a time-to-live of 180 seconds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ringbuffer</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rb</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;time-to-live-seconds&gt;</span>180<span class="tag">&lt;/time-to-live-seconds&gt;</span>
<span class="tag">&lt;/ringbuffer&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="setting-ringbuffer-overflow-policy"><a class="anchor" href="#setting-ringbuffer-overflow-policy"></a><a class="link" href="#setting-ringbuffer-overflow-policy">7.7.7. Setting Ringbuffer Overflow Policy</a></h4>
<div class="paragraph">
<p>Using the overflow policy, you can determine what to do if the oldest item in the Ringbuffer is not old enough to expire when
 more items than the configured Ringbuffer capacity are being added. The below options are currently available.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OverflowPolicy.OVERWRITE</code>: The oldest item is overwritten.</p>
</li>
<li>
<p><code>OverflowPolicy.FAIL</code>: The call is aborted. The methods that make use of the OverflowPolicy return <code>-1</code> to indicate that adding
the item has failed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Overflow policy gives you fine control on what to do if the Ringbuffer is full. You can also use the overflow policy to apply
a back pressure mechanism. The following example code shows the usage of an exponential backoff.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/ringbuffer/<span class="predefined-type">Writer</span>.java[tag=writer]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ringbuffer-with-persistent-datastore"><a class="anchor" href="#ringbuffer-with-persistent-datastore"></a><a class="link" href="#ringbuffer-with-persistent-datastore">7.7.8. Ringbuffer with Persistent Datastore</a></h4>
<div class="paragraph">
<p>Hazelcast allows you to load and store the Ringbuffer items from/to a persistent datastore using the interface <code>RingbufferStore</code>. If a Ringbuffer store is enabled, each item added to the Ringbuffer will also be stored at the configured Ringbuffer store.</p>
</div>
<div class="paragraph">
<p>If the Ringbuffer store is configured, you can get items with sequences which are no longer in the actual Ringbuffer but are only in the Ringbuffer store. This will probably be much slower but still allow you to continue consuming items from the Ringbuffer even if they are overwritten with newer items in the Ringbuffer.</p>
</div>
<div class="paragraph">
<p>When a Ringbuffer is being instantiated, it will check if the Ringbuffer store is configured and will request the latest sequence in the Ringbuffer store. This is to enable the Ringbuffer to start with sequences larger than the ones in the Ringbuffer store. In this case, the Ringbuffer is empty but you can still request older items from it (which will be loaded from the Ringbuffer store).</p>
</div>
<div class="paragraph">
<p>The Ringbuffer store will store items in the same format as the Ringbuffer. If the <code>BINARY</code> in-memory format is used, the Ringbuffer store must implement the interface <code>RingbufferStore&lt;byte[]&gt;</code> meaning that the Ringbuffer will receive items in the binary format. If the <code>OBJECT</code> in-memory format is used, the Ringbuffer store must implement the interface <code>RingbufferStore&lt;K&gt;</code>, where <code>K</code> is the type of item being stored (meaning that the Ringbuffer store will receive the deserialized object).</p>
</div>
<div class="paragraph">
<p>When adding items to the Ringbuffer, the method <code>storeAll</code> allows you to store items in batches.</p>
</div>
<div class="paragraph">
<p>The following example class includes all of the <code>RingbufferStore</code> methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/ringbuffer/TheRingbufferObjectStore.java[tag=rbstore]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Item</code> must be serializable. The following is an example of a Ringbuffer with the Ringbuffer store configured and enabled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ringbuffer</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;capacity&gt;</span>10000<span class="tag">&lt;/capacity&gt;</span>
    <span class="tag">&lt;time-to-live-seconds&gt;</span>30<span class="tag">&lt;/time-to-live-seconds&gt;</span>
    <span class="tag">&lt;backup-count&gt;</span>1<span class="tag">&lt;/backup-count&gt;</span>
    <span class="tag">&lt;async-backup-count&gt;</span>0<span class="tag">&lt;/async-backup-count&gt;</span>
    <span class="tag">&lt;in-memory-format&gt;</span>BINARY<span class="tag">&lt;/in-memory-format&gt;</span>
    <span class="tag">&lt;ringbuffer-store&gt;</span>
        <span class="tag">&lt;class-name&gt;</span>com.hazelcast.RingbufferStoreImpl<span class="tag">&lt;/class-name&gt;</span>
    <span class="tag">&lt;/ringbuffer-store&gt;</span>
<span class="tag">&lt;/ringbuffer&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Below are the explanations for the Ringbuffer store configuration elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>class-name: Name of the class implementing the `RingbufferStore</code> interface.</p>
</li>
<li>
<p><code>factory-class-name</code>: Name of the class implementing the <code>RingbufferStoreFactory</code> interface. This interface allows a factory class to be registered instead of a class implementing the <code>RingbufferStore</code> interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Either the <code>class-name</code> or the <code>factory-class-name</code> element should be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-ringbuffer-in-memory-format"><a class="anchor" href="#configuring-ringbuffer-in-memory-format"></a><a class="link" href="#configuring-ringbuffer-in-memory-format">7.7.9. Configuring Ringbuffer In-Memory Format</a></h4>
<div class="paragraph">
<p>You can configure Hazelcast Ringbuffer with an in-memory format that controls the format of the Ringbuffer&#8217;s stored items. By default, <code>BINARY</code> in-memory format is used,
meaning that the object is stored in a serialized form. You can select the <code>OBJECT</code> in-memory format, which is useful when filtering is
applied or when the <code>OBJECT</code> in-memory format has a smaller memory footprint than <code>BINARY</code>.</p>
</div>
<div class="paragraph">
<p>In the declarative configuration example below, a Ringbuffer is configured with the <code>OBJECT</code> in-memory format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ringbuffer</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rb</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;in-memory-format&gt;</span>OBJECT<span class="tag">&lt;/in-memory-format&gt;</span>
<span class="tag">&lt;/ringbuffer&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-split-brain-protection-for-ringbuffer"><a class="anchor" href="#configuring-split-brain-protection-for-ringbuffer"></a><a class="link" href="#configuring-split-brain-protection-for-ringbuffer">7.7.10. Configuring Split-Brain Protection for Ringbuffer</a></h4>
<div class="paragraph">
<p>Ringbuffer can be configured to check for a minimum number of available members before applying Ringbuffer operations. This is a check to avoid performing successful Ringbuffer operations on all parts of a cluster during a network partition and can be configured using the element <code>quorum-ref</code>. You should set this element&#8217;s value as the quorum&#8217;s name, which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>. Following is an example snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ringbuffer</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rb</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/ringbuffer&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>add</code></p>
</li>
<li>
<p><code>addAllAsync</code></p>
</li>
<li>
<p><code>addAsync</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>capacity</code></p>
</li>
<li>
<p><code>headSequence</code></p>
</li>
<li>
<p><code>readManyAsync</code></p>
</li>
<li>
<p><code>readOne</code></p>
</li>
<li>
<p><code>remainingCapacity</code></p>
</li>
<li>
<p><code>size</code></p>
</li>
<li>
<p><code>tailSequence</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="adding-batched-items"><a class="anchor" href="#adding-batched-items"></a><a class="link" href="#adding-batched-items">7.7.11. Adding Batched Items</a></h4>
<div class="paragraph">
<p>In the previous examples, the method <code>ringBuffer.add()</code> is used to add an item to the Ringbuffer. The problems with this method
are that it always overwrites and that it does not support batching. Batching can have a huge
impact on the performance. You can use the method <code>addAllAsync</code> to support batching.</p>
</div>
<div class="paragraph">
<p>Please see the following example code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; items = <span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>);
ICompletableFuture&lt;<span class="predefined-type">Long</span>&gt; f = rb.addAllAsync(items, OverflowPolicy.OVERWRITE);
f.get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case, three strings are added to the Ringbuffer using the policy <code>OverflowPolicy.OVERWRITE</code>. Please see the <a href="#setting-ringbuffer-overflow-policy">Overflow Policy section</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="reading-batched-items"><a class="anchor" href="#reading-batched-items"></a><a class="link" href="#reading-batched-items">7.7.12. Reading Batched Items</a></h4>
<div class="paragraph">
<p>In the previous example, the <code>readOne</code> method read items from the Ringbuffer. <code>readOne</code> is simple but not very efficient for the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>readOne</code> does not use batching.</p>
</li>
<li>
<p><code>readOne</code> cannot filter items at the source; the items need to be retrieved before being filtered.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The method <code>readManyAsync</code> can read a batch of items and can filter items at the source.</p>
</div>
<div class="paragraph">
<p>Please see the following example code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ICompletableFuture&lt;ReadResultSet&lt;E&gt;&gt; readManyAsync(
   <span class="type">long</span> startSequence,
   <span class="type">int</span> minCount,
   <span class="type">int</span> maxCount,
   IFunction&lt;E, <span class="predefined-type">Boolean</span>&gt; filter);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The meanings of the <code>readManyAsync</code> arguments are given below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>startSequence</code>: Sequence of the first item to read.</p>
</li>
<li>
<p><code>minCount</code>: Minimum number of items to read. If you do not want to block, set it to 0. If you want to block for at least one item,
set it to 1.</p>
</li>
<li>
<p><code>maxCount</code>: Maximum number of the items to retrieve. Its value cannot exceed 1000.</p>
</li>
<li>
<p><code>filter</code>: A function that accepts an item and checks if it should be returned. If no filtering should be applied, set it to null.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A full example is given below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">long</span> sequence = rb.headSequence();
<span class="keyword">for</span>(;;) {
    ICompletableFuture&lt;ReadResultSet&lt;<span class="predefined-type">String</span>&gt;&gt; f = rb.readManyAsync(sequence, <span class="integer">1</span>, <span class="integer">10</span>, <span class="predefined-constant">null</span>);
    ReadResultSet&lt;<span class="predefined-type">String</span>&gt; rs = f.get();
    <span class="keyword">for</span> (<span class="predefined-type">String</span> s : rs) {
        <span class="predefined-type">System</span>.out.println(s);
    }
    sequence+=rs.readCount();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please take a careful look at how your sequence is being incremented. You cannot always rely on the number of items being returned
if the items are filtered out.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-async-methods"><a class="anchor" href="#using-async-methods"></a><a class="link" href="#using-async-methods">7.7.13. Using Async Methods</a></h4>
<div class="paragraph">
<p>Hazelcast Ringbuffer provides asynchronous methods for more powerful operations like batched writing or batched reading with filtering.
To make these methods synchronous, just call the method <code>get()</code> on the returned future.</p>
</div>
<div class="paragraph">
<p>Please see the following example code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ICompletableFuture f = ringbuffer.addAsync(item, OverflowPolicy.FAIL);
f.get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, you can also use <code>ICompletableFuture</code> to get notified when the operation has completed. The advantage of <code>ICompletableFuture</code> is that the thread used for the call is not blocked till the response is returned.</p>
</div>
<div class="paragraph">
<p>Please see the below code as an example of when you want to
get notified when a batch of reads has completed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ICompletableFuture&lt;ReadResultSet&lt;<span class="predefined-type">String</span>&gt;&gt; f = rb.readManyAsync(sequence, min, max, someFilter);
f.andThen(<span class="keyword">new</span> ExecutionCallback&lt;ReadResultSet&lt;<span class="predefined-type">String</span>&gt;&gt;() {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> onResponse(ReadResultSet&lt;<span class="predefined-type">String</span>&gt; response) {
        <span class="keyword">for</span> (<span class="predefined-type">String</span> s : response) {
            <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Received:</span><span class="delimiter">&quot;</span></span> + s);
        }
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> onFailure(<span class="predefined-type">Throwable</span> t) {
        t.printStackTrace();
   }
});</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ringbuffer-configuration-examples"><a class="anchor" href="#ringbuffer-configuration-examples"></a><a class="link" href="#ringbuffer-configuration-examples">7.7.14. Ringbuffer Configuration Examples</a></h4>
<div class="paragraph">
<p>The following shows the declarative configuration of a Ringbuffer called <code>rb</code>. The configuration is modeled after the Ringbuffer defaults.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ringbuffer</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rb</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;capacity&gt;</span>10000<span class="tag">&lt;/capacity&gt;</span>
    <span class="tag">&lt;backup-count&gt;</span>1<span class="tag">&lt;/backup-count&gt;</span>
    <span class="tag">&lt;async-backup-count&gt;</span>0<span class="tag">&lt;/async-backup-count&gt;</span>
    <span class="tag">&lt;time-to-live-seconds&gt;</span>0<span class="tag">&lt;/time-to-live-seconds&gt;</span>
    <span class="tag">&lt;in-memory-format&gt;</span>BINARY<span class="tag">&lt;/in-memory-format&gt;</span>
    <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/ringbuffer&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also configure a Ringbuffer programmatically. The following is a programmatic version of the above declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/ringbuffer/RBConfiguration.java[tag=rbc]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="topic"><a class="anchor" href="#topic"></a><a class="link" href="#topic">7.8. Topic</a></h3>
<div class="paragraph">
<p>Hazelcast provides a distribution mechanism for publishing messages that are delivered to multiple subscribers. This is
also known as a publish/subscribe (pub/sub) messaging model. Publishing and subscribing operations are cluster wide.
When a member subscribes to a topic, it is actually registering for messages published by any member in the cluster,
including the new members that joined after you add the listener.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Publish operation is async. It does not wait for operations to run in
remote members; it works as fire and forget.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="getting-a-topic-and-publishing-messages"><a class="anchor" href="#getting-a-topic-and-publishing-messages"></a><a class="link" href="#getting-a-topic-and-publishing-messages">7.8.1. Getting a Topic and Publishing Messages</a></h4>
<div class="paragraph">
<p>Use the HazelcastInstance&#8217;s <code>getTopic</code> method to get the topic, then use the topic&#8217;s <code>publish</code> method to publish your messages. The following is a sample publisher:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/topic/TopicPublisher.java[tag=tp]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is a sample subscriber:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/topic/TopicSubscriber.java[tag=tsub]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hazelcast Topic uses the <code>MessageListener</code> interface to listen for events that occur when a message is received. Please refer to the <a href="#listening-for-topic-messages">Listening for Topic Messages section</a> for information on how to create a message listener class and register it.</p>
</div>
</div>
<div class="sect3">
<h4 id="getting-topic-statistics"><a class="anchor" href="#getting-topic-statistics"></a><a class="link" href="#getting-topic-statistics">7.8.2. Getting Topic Statistics</a></h4>
<div class="paragraph">
<p>Topic has two statistic variables that you can query. These values are incremental and local to the member.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/topic/TopicStats.java[tag=ts]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getPublishOperationCount</code> and <code>getReceiveOperationCount</code> returns the total number of published and received messages since the start of this member, respectively. Please note that these values are not backed up, so if the member goes down, these values will be lost.</p>
</div>
<div class="paragraph">
<p>You can disable this feature with topic configuration. Please see the <a href="#configuring-topic">Configuring Topic section</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These statistics values can be also viewed in Management Center. Please see the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#monitoring-topics">Monitoring Topics section</a> in Hazelcast Management Center Reference Manual.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="understanding-topic-behavior"><a class="anchor" href="#understanding-topic-behavior"></a><a class="link" href="#understanding-topic-behavior">7.8.3. Understanding Topic Behavior</a></h4>
<div class="paragraph">
<p>Each cluster member has a list of all registrations in the cluster. When a new member is registered for a topic, it sends a registration message to all members in the cluster. Also, when a new member joins the cluster, it will receive all registrations made so far in the cluster.</p>
</div>
<div class="paragraph">
<p>The behavior of a topic varies depending on the value of the configuration parameter <code>globalOrderEnabled</code>.</p>
</div>
<div class="sect4">
<h5 id="ordering-messages-as-published"><a class="anchor" href="#ordering-messages-as-published"></a><a class="link" href="#ordering-messages-as-published">Ordering Messages as Published</a></h5>
<div class="paragraph">
<p>If <code>globalOrderEnabled</code> is disabled, messages are not ordered and listeners (subscribers) process the messages in the order that the messages are published. If cluster member M publishes messages <strong>m1, m2, m3, &#8230;&#8203;, mn</strong> to a topic <strong>T</strong>, then Hazelcast makes sure that all of the subscribers of topic <strong>T</strong> will receive and process <strong>m1, m2, m3, &#8230;&#8203;, mn</strong> in the given order.</p>
</div>
<div class="paragraph">
<p>Here is how it works. Let&#8217;s say that we have three members (<strong>member1</strong>, <strong>member2</strong> and <strong>member3</strong>) and that <strong>member1</strong> and <strong>member2</strong> are registered to a topic named <code>news</code>. Note that all three members know that <strong>member1</strong> and <strong>member2</strong> are registered to <code>news</code>.</p>
</div>
<div class="paragraph">
<p>In this example, <strong>member1</strong> publishes two messages: <code>a1</code> and <code>a2</code>. <strong>Member3</strong> publishes two messages: <code>c1</code> and <code>c2</code>. When <strong>member1</strong> and <strong>member3</strong> publish a message, they will check their local list for registered members, they will discover that <strong>member1</strong> and <strong>member2</strong> are in their lists, and then they will fire messages to those members. One possible order of the messages received could be the following.</p>
</div>
<div class="paragraph">
<p><strong>member1</strong> &#8594; <code>c1</code>, <code>a1</code>, <code>a2</code>, <code>c2</code></p>
</div>
<div class="paragraph">
<p><strong>member2</strong> &#8594; <code>c1</code>, <code>c2</code>, <code>a1</code>, <code>a2</code></p>
</div>
</div>
<div class="sect4">
<h5 id="ordering-messages-for-members"><a class="anchor" href="#ordering-messages-for-members"></a><a class="link" href="#ordering-messages-for-members">Ordering Messages for Members</a></h5>
<div class="paragraph">
<p>If <code>globalOrderEnabled</code> is enabled, all members listening to the same topic will get its messages in the same order.</p>
</div>
<div class="paragraph">
<p>Here is how it works. Let&#8217;s say that we have three members (<strong>member1</strong>, <strong>member2</strong> and <strong>member3</strong>) and that <strong>member1</strong> and <strong>member2</strong> are registered to a topic named <code>news</code>. Note that all three members know that <strong>member1</strong> and <strong>member2</strong> are registered to <code>news</code>.</p>
</div>
<div class="paragraph">
<p>In this example, <strong>member1</strong> publishes two messages: <code>a1</code> and <code>a2</code>. <strong>Member3</strong> publishes two messages: <code>c1</code> and <code>c2</code>. When a member publishes messages over the topic <code>news</code>, it first calculates which partition the <code>news</code> ID corresponds to. Then it sends an operation to the owner of the partition for that member to publish messages. Let&#8217;s assume that <code>news</code> corresponds to a partition that <strong>member2</strong> owns. <strong>member1</strong> and <strong>member3</strong> first sends all messages to <strong>member2</strong>. Assume that the messages are published in the following order:</p>
</div>
<div class="paragraph">
<p><strong>member1</strong> &#8594; <code>a1</code>, <code>c1</code>, <code>a2</code>, <code>c2</code></p>
</div>
<div class="paragraph">
<p><strong>member2</strong> then publishes these messages by looking at registrations in its local list. It sends these messages to <strong>member1</strong> and <strong>member2</strong> (it makes a local dispatch for itself).</p>
</div>
<div class="paragraph">
<p><strong>member1</strong> &#8594; <code>a1</code>, <code>c1</code>, <code>a2</code>, <code>c2</code></p>
</div>
<div class="paragraph">
<p><strong>member2</strong> &#8594; <code>a1</code>, <code>c1</code>, <code>a2</code>, <code>c2</code></p>
</div>
<div class="paragraph">
<p>This way we guarantee that all members will see the events in the same order.</p>
</div>
</div>
<div class="sect4">
<h5 id="keeping-generated-and-published-order-the-same"><a class="anchor" href="#keeping-generated-and-published-order-the-same"></a><a class="link" href="#keeping-generated-and-published-order-the-same">Keeping Generated and Published Order the Same</a></h5>
<div class="paragraph">
<p>In both cases, there is a <code>StripedExecutor</code> in EventService that is responsible for dispatching the received message. For all events in Hazelcast, the order that events are generated and the order they are published to the user are guaranteed to be the same via this <code>StripedExecutor</code>.</p>
</div>
<div class="paragraph">
<p>In <code>StripedExecutor</code>, there are as many threads as are specified in the property  <code>hazelcast.event.thread.count</code> (default is five). For a specific event source (for a particular topic name), <strong>hash of that source&#8217;s name % 5</strong> gives the ID of the responsible thread. Note that there can be another event source (entry listener of a map, item listener of a collection, etc.) corresponding to the same thread. In order not to make other messages to block, heavy processing should not be done in this thread. If there is time-consuming work that needs to be done, the work should be handed over to another thread. Please see the <a href="#getting-a-topic-and-publishing-messages">Getting a Topic and Publishing Messages section</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-topic"><a class="anchor" href="#configuring-topic"></a><a class="link" href="#configuring-topic">7.8.4. Configuring Topic</a></h4>
<div class="paragraph">
<p>To configure a topic, set the topic name, decide on statistics and global ordering, and set message listeners.
Default values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>global-ordering</code> is <strong>false</strong>, meaning that by default, there is no guarantee of global order.</p>
</li>
<li>
<p><code>statistics</code> is <strong>true</strong>, meaning that by default, statistics are calculated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can see the example configuration snippets below.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  ...
  <span class="tag">&lt;topic</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yourTopicName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;global-ordering-enabled&gt;</span>true<span class="tag">&lt;/global-ordering-enabled&gt;</span>
    <span class="tag">&lt;statistics-enabled&gt;</span>true<span class="tag">&lt;/statistics-enabled&gt;</span>
    <span class="tag">&lt;message-listeners&gt;</span>
      <span class="tag">&lt;message-listener&gt;</span>MessageListenerImpl<span class="tag">&lt;/message-listener&gt;</span>
    <span class="tag">&lt;/message-listeners&gt;</span>
  <span class="tag">&lt;/topic&gt;</span>
  ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/topic/TopicConfiguration.java[tag=tc]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Topic configuration has the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>statistics-enabled</code>: Default is <code>true</code>, meaning statistics are calculated.</p>
</li>
<li>
<p><code>global-ordering-enabled</code>: Default is <code>false</code>, meaning there is no global order guarantee.</p>
</li>
<li>
<p><code>message-listeners</code>: Lets you add listeners (listener classes) for the topic messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Besides the above elements, there are the following system properties that are topic related but not topic specific:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.event.queue.capacity</code> with a default value of 1,000,000</p>
</li>
<li>
<p><code>hazelcast.event.queue.timeout.millis</code> with a default value of 250</p>
</li>
<li>
<p><code>hazelcast.event.thread.count</code> with a default value of 5</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a description of these parameters, please see the <a href="#global-event-configuration">Global Event Configuration section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reliable-topic"><a class="anchor" href="#reliable-topic"></a><a class="link" href="#reliable-topic">7.9. Reliable Topic</a></h3>
<div class="paragraph">
<p>Reliable Topic uses the same <code>ITopic</code> interface
as a regular topic. The main difference is that Reliable Topic is backed up by the Ringbuffer data structure. The following are the advantages of this approach:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Events are not lost since the Ringbuffer is configured with one synchronous backup by default.</p>
</li>
<li>
<p>Each Reliable <code>ITopic</code> gets its own Ringbuffer; if a topic has a very fast producer, it will not lead to problems at topics that run at a slower pace.</p>
</li>
<li>
<p>Since the event system behind a regular <code>ITopic</code> is shared with other data structures, e.g., collection listeners,
you can run into isolation problems. This does not happen with the Reliable <code>ITopic</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is a sample code snippet for a publisher using Reliable Topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/reliabletopic/PublisherMember.java[tag=publisher]</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the following is a sample code snippet for the subscriber:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/reliabletopic/SubscribedMember.java[tag=sm]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you create a Reliable Topic, Hazelcast automatically creates a Ringbuffer for it. You may configure this Ringbuffer by adding a Ringbuffer config with the same name as the Reliable Topic. For instance, if you have a Reliable Topic with the name "sometopic", you should add a Ringbuffer config with the name "sometopic" to configure the backing Ringbuffer. Some of the things that you may configure is the capacity, the time-to-live for the topic messages and you can even add a Ringbuffer store which will allow you to have a persistent topic.
By default, a Ringbuffer does not have any TTL (time-to-live) and it has a limited capacity; you may want to change that configuration. The following is an example configuration for the "sometopic" given above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>

    <span class="comment">&lt;!-- This is the ringbuffer that is used by the 'sometopic' Reliable-topic. As you can see the
         ringbuffer has the same name as the topic. --&gt;</span>
    <span class="tag">&lt;ringbuffer</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sometopic</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;capacity&gt;</span>1000<span class="tag">&lt;/capacity&gt;</span>
        <span class="tag">&lt;time-to-live-seconds&gt;</span>5<span class="tag">&lt;/time-to-live-seconds&gt;</span>
    <span class="tag">&lt;/ringbuffer&gt;</span>

    <span class="tag">&lt;reliable-topic</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sometopic</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;topic-overload-policy&gt;</span>BLOCK<span class="tag">&lt;/topic-overload-policy&gt;</span>
    <span class="tag">&lt;/reliable-topic&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please see the <a href="#configuring-reliable-topic">Configuring Reliable Topic section</a> below for the descriptions of all Reliable Topic configuration elements.</p>
</div>
<div class="paragraph">
<p>By default, the Reliable <code>ITopic</code> uses a shared thread pool. If you need a better isolation, you can configure a custom executor on the
<code>ReliableTopicConfig</code>.</p>
</div>
<div class="paragraph">
<p>Because the reads on a Ringbuffer are not destructive, batching is easy to apply. <code>ITopic</code> uses read batching and reads
ten items at a time (if available) by default. See <a href="#reading-batched-items">Reading Batched Items</a> for more information.</p>
</div>
<div class="sect3">
<h4 id="slow-consumers"><a class="anchor" href="#slow-consumers"></a><a class="link" href="#slow-consumers">7.9.1. Slow Consumers</a></h4>
<div class="paragraph">
<p>The Reliable <code>ITopic</code> provides control and a way to deal with slow consumers. It is unwise to keep events for a slow consumer in memory
indefinitely since you do not know when the slow consumer is going to catch up. You can control the size of the Ringbuffer by using its capacity. For the cases when a Ringbuffer runs out of its capacity, you can specify the following policies for the <code>TopicOverloadPolicy</code> configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DISCARD_OLDEST</code>: Overwrite the oldest item, even if a TTL is set. In this case the fast producer supersedes a slow consumer.</p>
</li>
<li>
<p><code>DISCARD_NEWEST</code>: Discard the newest item.</p>
</li>
<li>
<p><code>BLOCK</code>: Wait until the items are expired in the Ringbuffer.</p>
</li>
<li>
<p><code>ERROR</code>: Immediately throw <code>TopicOverloadException</code> if there is no space in the Ringbuffer.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-reliable-topic"><a class="anchor" href="#configuring-reliable-topic"></a><a class="link" href="#configuring-reliable-topic">7.9.2. Configuring Reliable Topic</a></h4>
<div class="paragraph">
<p>The following are example Reliable Topic configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;reliable-topic</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;statistics-enabled&gt;</span>true<span class="tag">&lt;/statistics-enabled&gt;</span>
    <span class="tag">&lt;message-listeners&gt;</span>
        <span class="tag">&lt;message-listener&gt;</span>
        ...
        <span class="tag">&lt;/message-listener&gt;</span>
    <span class="tag">&lt;/message-listeners&gt;</span>
    <span class="tag">&lt;read-batch-size&gt;</span>10<span class="tag">&lt;/read-batch-size&gt;</span>
    <span class="tag">&lt;topic-overload-policy&gt;</span>BLOCK<span class="tag">&lt;/topic-overload-policy&gt;</span>
<span class="tag">&lt;/reliable-topic&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
ReliableTopicConfig rtConfig = config.getReliableTopicConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> );
rtConfig.setTopicOverloadPolicy( TopicOverloadPolicy.BLOCK )
        .setReadBatchSize( <span class="integer">10</span> )
        .setStatisticsEnabled( <span class="predefined-constant">true</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reliable Topic configuration has the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>statistics-enabled</code>: Enables or disables the statistics collection for the Reliable Topic. Its default value is <code>true</code>.</p>
</li>
<li>
<p><code>message-listener</code>: Message listener class that listens to the messages when they are added or removed.</p>
</li>
<li>
<p><code>read-batch-size</code>: Minimum number of messages that Reliable Topic will try to read in batches. Its default value is 10.</p>
</li>
<li>
<p><code>topic-overload-policy</code>: Policy to handle an overloaded topic. Available values are <code>DISCARD_OLDEST</code>, <code>DISCARD_NEWEST</code>, <code>BLOCK</code> and <code>ERROR</code>. Its default value is <code>BLOCK</code>. See <a href="#slow-consumers">Slow Consumers</a> for definitions of these policies.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="lock"><a class="anchor" href="#lock"></a><a class="link" href="#lock">7.10. Lock</a></h3>
<div class="paragraph">
<p>ILock is the distributed implementation of <code>java.util.concurrent.locks.Lock</code>, meaning that if you lock using an ILock, the critical
section that it guards is guaranteed to be executed by only one thread in the entire cluster, provided that there are no network failures. Even though locks are great for synchronization, they can lead to problems if not used properly. Also note that Hazelcast Lock does not support fairness.</p>
</div>
<div class="sect3">
<h4 id="using-try-catch-blocks-with-locks"><a class="anchor" href="#using-try-catch-blocks-with-locks"></a><a class="link" href="#using-try-catch-blocks-with-locks">7.10.1. Using Try-Catch Blocks with Locks</a></h4>
<div class="paragraph">
<p>Always use locks with <strong>try</strong>-<strong>catch</strong> blocks. This will ensure that locks are released if an exception is thrown from
the code in a critical section. Also note that the <code>lock</code> method is outside the <strong>try</strong>-<strong>catch</strong> block because we do not want to unlock
if the lock operation itself fails.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/lock/SampleLock.java[tag=lock]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="releasing-locks-with-trylock-timeout"><a class="anchor" href="#releasing-locks-with-trylock-timeout"></a><a class="link" href="#releasing-locks-with-trylock-timeout">7.10.2. Releasing Locks with tryLock Timeout</a></h4>
<div class="paragraph">
<p>If a lock is not released in the cluster, another thread that is trying to get the
lock can wait forever. To avoid this, use <code>tryLock</code> with a timeout value. You can
set a high value (normally it should not take that long) for <code>tryLock</code>. You can check the return value of <code>tryLock</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> ( lock.tryLock ( <span class="integer">10</span>, <span class="predefined-type">TimeUnit</span>.SECONDS ) ) {
  <span class="keyword">try</span> {
    <span class="comment">// do some stuff here..</span>
  } <span class="keyword">finally</span> {
    lock.unlock();
  }
} <span class="keyword">else</span> {
  <span class="comment">// warning</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="avoiding-waiting-threads-with-lease-time"><a class="anchor" href="#avoiding-waiting-threads-with-lease-time"></a><a class="link" href="#avoiding-waiting-threads-with-lease-time">7.10.3. Avoiding Waiting Threads with Lease Time</a></h4>
<div class="paragraph">
<p>You can also avoid indefinitely waiting threads by using lock with lease time - the lock will be released in the given lease time. The lock can be safely unlocked before the lease time expires. Note that the unlock operation can
throw an <code>IllegalMonitorStateException</code> if the lock is released because the lease time expires. If that is the case, critical section guarantee is broken.</p>
</div>
<div class="paragraph">
<p>Please see the below example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">lock.lock( <span class="integer">5</span>, <span class="predefined-type">TimeUnit</span>.SECONDS )
<span class="keyword">try</span> {
  <span class="comment">// do some stuff here..</span>
} <span class="keyword">finally</span> {
  <span class="keyword">try</span> {
    lock.unlock();
  } <span class="keyword">catch</span> ( <span class="exception">IllegalMonitorStateException</span> ex ){
    <span class="comment">// WARNING Critical section guarantee can be broken</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify a lease time when trying to acquire a lock: <code>tryLock(time, unit, leaseTime, leaseUnit)</code>. In that case, it tries to acquire the lock within the specified lease time. If the lock is not available, the current thread becomes disabled for thread scheduling purposes until either it acquires the lock or the specified waiting time elapses. Note that this lease time cannot be longer than the time you specify with the system property <code>hazelcast.lock.max.lease.time.seconds</code>. Please see the <a href="#system-properties">System Properties appendix</a> to see the description of this property and to learn how to set a system property.</p>
</div>
</div>
<div class="sect3">
<h4 id="understanding-lock-behavior"><a class="anchor" href="#understanding-lock-behavior"></a><a class="link" href="#understanding-lock-behavior">7.10.4. Understanding Lock Behavior</a></h4>
<div class="ulist">
<ul>
<li>
<p>Locks are fail-safe. If a member holds a lock and some other members go down, the cluster will keep your locks safe and available.
Moreover, when a member leaves the cluster, all the locks acquired by that dead member will be removed so that those
locks are immediately available for live members.</p>
</li>
<li>
<p>Locks are re-entrant. The same thread can lock multiple times on the same lock. Note that for other threads to be able to require this lock, the owner of the lock must call <code>unlock</code> as many times as the owner called <code>lock</code>.</p>
</li>
<li>
<p>In the split-brain scenario, the cluster behaves as if it were two different clusters. Since two separate clusters are not aware of each other,
two members from different clusters can acquire the same lock.
For more information on places where split-brain syndrome can be handled, please see <a href="#split-brain-syndrome">Split-Brain syndrome</a>.</p>
</li>
<li>
<p>Locks are not automatically removed. If a lock is not used anymore, Hazelcast will not automatically garbage collect the lock.
This can lead to an <code>OutOfMemoryError</code>. If you create locks on the fly, make sure they are destroyed.</p>
</li>
<li>
<p>Hazelcast IMap also provides locking support on the entry level with the method <code>IMap.lock(key)</code>. Although the same infrastructure
is used, <code>IMap.lock(key)</code> is not an ILock and it is not possible to expose it directly.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ilock-vs-imaplock"><a class="anchor" href="#ilock-vs-imaplock"></a><a class="link" href="#ilock-vs-imaplock">ILock vs. IMap.lock</a></h5>
<div class="paragraph">
<p>ILock-based locks use system resources even when they are not acquired. You have to call <code>destroy()</code>, but this can have a side effect when another thread is trying to acquire it. ILock-based lock is a good choice when you have a limited number of locks. The IMap-based locks are auto-destructed. They use no resources when they are not acquired. This implies they are invisible for monitoring unless they are being hold by some thread.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="synchronizing-threads-with-icondition"><a class="anchor" href="#synchronizing-threads-with-icondition"></a><a class="link" href="#synchronizing-threads-with-icondition">7.10.5. Synchronizing Threads with ICondition</a></h4>
<div class="paragraph">
<p><code>ICondition</code> is the distributed implementation of the <code>notify</code>, <code>notifyAll</code> and <code>wait</code> operations on the Java object. You can use it to synchronize
threads across the cluster. More specifically, you use <code>ICondition</code> when a thread&#8217;s work depends on another thread&#8217;s output. A good example
is producer/consumer methodology.</p>
</div>
<div class="paragraph">
<p>Please see the below code examples for a producer/consumer implementation.</p>
</div>
<div class="paragraph">
<p><strong>Producer thread:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
<span class="predefined-type">Lock</span> lock = hazelcastInstance.getLock( <span class="string"><span class="delimiter">&quot;</span><span class="content">myLockId</span><span class="delimiter">&quot;</span></span> );
ICondition condition = lock.newCondition( <span class="string"><span class="delimiter">&quot;</span><span class="content">myConditionId</span><span class="delimiter">&quot;</span></span> );

lock.lock();
<span class="keyword">try</span> {
  <span class="keyword">while</span> ( !shouldProduce() ) {
    condition.await(); <span class="comment">// frees the lock and waits for signal</span>
                       <span class="comment">// when it wakes up it re-acquires the lock</span>
                       <span class="comment">// if available or waits for it to become</span>
                       <span class="comment">// available</span>
  }
  produce();
  condition.signalAll();
} <span class="keyword">finally</span> {
  lock.unlock();
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The method <code>await()</code> takes time value and time unit as arguments. If you specify a negative value for the time, it is interpreted as infinite.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Consumer thread:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
<span class="predefined-type">Lock</span> lock = hazelcastInstance.getLock( <span class="string"><span class="delimiter">&quot;</span><span class="content">myLockId</span><span class="delimiter">&quot;</span></span> );
ICondition condition = lock.newCondition( <span class="string"><span class="delimiter">&quot;</span><span class="content">myConditionId</span><span class="delimiter">&quot;</span></span> );

lock.lock();
<span class="keyword">try</span> {
  <span class="keyword">while</span> ( !canConsume() ) {
    condition.await(); <span class="comment">// frees the lock and waits for signal</span>
                       <span class="comment">// when it wakes up it re-acquires the lock if</span>
                       <span class="comment">// available or waits for it to become</span>
                       <span class="comment">// available</span>
  }
  consume();
  condition.signalAll();
} <span class="keyword">finally</span> {
  lock.unlock();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-lock"><a class="anchor" href="#split-brain-protection-for-lock"></a><a class="link" href="#split-brain-protection-for-lock">7.10.6. Split-Brain Protection for Lock</a></h4>
<div class="paragraph">
<p>Locks can be configured to check for a minimum number of available members before applying lock operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful lock operations on all parts of a cluster during a network partition. Due to the implementation details, the check does not guarantee that the lock will fail in all conditions of a network partition and it can happen that two members can acquire the same lock.</p>
</div>
<div class="paragraph">
<p>Once the membership change has been detected, the lock operations will fail with a <code>QuorumException</code> if enough size of members are not present. In essence, this does not provide correctness but rather narrows down the window of opportunity in which locks can continue operations on several members concurrently.</p>
</div>
<div class="paragraph">
<p>Although the check does not provide correctness it can still be useful. In cases where members acquire the lock to perform some costly but idempotent operation, configuring lock quorum can further prevent some cases where the cluster has been split into several sub-clusters and more than one member perform the same operation.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support quorum checks. The list is grouped by quorum type. Additionally, since Hazelcast IMap also provides locking support, certain map and multimap methods also allow quorum checks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE</p>
<div class="ulist">
<ul>
<li>
<p><code>Condition.await(())</code>, <code>Condition.awaitUninterruptibly()</code>, <code>Condition.awaitNanos()</code>, <code>Condition.awaitUntil()</code></p>
</li>
<li>
<p><code>Lock.lockInterruptibly()</code>, <code>ILock.lock()</code>, <code>IMap.tryLock()</code>, <code>IMap.lock()</code>, <code>MultiMap.lock()</code>, <code>MultiMap.tryLock()</code></p>
</li>
<li>
<p><code>Condition.signal()</code>, <code>Condition.signalAll()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE</p>
<div class="ulist">
<ul>
<li>
<p><code>ILock.getLockCount()</code></p>
</li>
<li>
<p><code>ILock.getRemainingLeaseTime()</code></p>
</li>
<li>
<p><code>ILock.isLocked()</code>, <code>IMap.isLocked()</code>, <code>MultiMap.isLocked()</code></p>
</li>
<li>
<p><code>ILock.forceUnlock()</code>, <code>IMap.forceUnlock()</code>, <code>MultiMap.forceUnlock()</code>, <code>ILock.unlock()</code>, <code>IMap.unlock()</code>, <code>ObjectMultiMapProxy.unlock()</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="lock-configuration"><a class="anchor" href="#lock-configuration"></a><a class="link" href="#lock-configuration">7.10.7. Lock Configuration</a></h4>
<div class="paragraph">
<p>As mentioned in the <a href="#split-brain-protection-for-lock">Split-brain Protection for Lock section</a>, Lock allows for split-brain protection.</p>
</div>
<div class="paragraph">
<p>An example of declarative configuration is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;lock</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myLock</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;quorum-ref&gt;</span>quorum-name<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/lock&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quorum-ref</code> : Name of quorum configuration that you want this lock to use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of programmatic configuration is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/lock/LockConfiguration.java[tag=lc]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As mentioned above, a quorum definition for a lock that has the same name or a pattern that matches a map name will force the map locking actions to use the defined quorum. It is important to keep this in mind when using lock quorum and map locking actions.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="iatomiclong"><a class="anchor" href="#iatomiclong"></a><a class="link" href="#iatomiclong">7.11. IAtomicLong</a></h3>
<div class="paragraph">
<p>Hazelcast <code>IAtomicLong</code> is the distributed implementation of <code>java.util.concurrent.atomic.AtomicLong</code>. It offers most of AtomicLong&#8217;s operations such as <code>get</code>, <code>set</code>, <code>getAndSet</code>, <code>compareAndSet</code> and <code>incrementAndGet</code>. Since IAtomicLong is a distributed implementation, these operations involve remote calls and thus their performances differ from AtomicLong.</p>
</div>
<div class="paragraph">
<p>The following example code creates an instance, increments it by a million and prints the count.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/iatomiclong/IAtomicLongSample.java[tag=ial]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you start other instances with the code above, you will see the count as <strong>member count</strong> times <strong>a million</strong>.</p>
</div>
<div class="sect3">
<h4 id="sending-functions-to-iatomiclong"><a class="anchor" href="#sending-functions-to-iatomiclong"></a><a class="link" href="#sending-functions-to-iatomiclong">7.11.1. Sending Functions to IAtomicLong</a></h4>
<div class="paragraph">
<p>You can send functions to an IAtomicLong. <code>IFunction</code> is a Hazelcast owned, single method interface. The following sample <code>IFunction</code> implementation adds two to the original value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/iatomiclong/IAtomicLongExecuteFuncs.java[tag=add2func]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="executing-functions-on-iatomiclong"><a class="anchor" href="#executing-functions-on-iatomiclong"></a><a class="link" href="#executing-functions-on-iatomiclong">7.11.2. Executing Functions on IAtomicLong</a></h4>
<div class="paragraph">
<p>You can use the following methods to execute functions on IAtomicLong.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>apply</code>: Applies the function to the value in IAtomicLong without changing the actual value and returning the result.</p>
</li>
<li>
<p><code>alter</code>: Alters the value stored in the IAtomicLong by applying the function. It will not send back a result.</p>
</li>
<li>
<p><code>alterAndGet</code>: Alters the value stored in the IAtomicLong by applying the function, storing the result in the IAtomicLong and returning the result.</p>
</li>
<li>
<p><code>getAndAlter</code>: Alters the value stored in the IAtomicLong by applying the function and returning the original value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following sample code includes these methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/iatomiclong/IAtomicLongExecuteFuncs.java[tag=ialef]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of the above class when run is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">apply.result: <span class="integer">3</span>
apply.value: <span class="integer">1</span>
alter.value: <span class="integer">3</span>
alterAndGet.result: <span class="integer">3</span>
alterAndGet.value: <span class="integer">3</span>
getAndAlter.result: <span class="integer">1</span>
getAndAlter.value: <span class="integer">3</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reasons-to-use-functions-with-iatomic"><a class="anchor" href="#reasons-to-use-functions-with-iatomic"></a><a class="link" href="#reasons-to-use-functions-with-iatomic">7.11.3. Reasons to Use Functions with IAtomic</a></h4>
<div class="paragraph">
<p>The reason for using a function instead of a simple code line like <code>atomicLong.set(atomicLong.get() + 2));</code> is that the IAtomicLong read and write operations are not atomic. Since <code>IAtomicLong</code> is a distributed implementation, those operations can be remote ones, which may lead to race problems. By using functions, the data is not pulled into the code, but the code is sent to the data. This makes it more scalable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
IAtomicLong has one synchronous backup and no asynchronous backups. Its backup count is not configurable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-iatomiclong"><a class="anchor" href="#split-brain-protection-for-iatomiclong"></a><a class="link" href="#split-brain-protection-for-iatomiclong">7.11.4. Split-Brain Protection for IAtomicLong</a></h4>
<div class="paragraph">
<p>IAtomicLong can be configured to check for a minimum number of available members before applying its operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful operations on all parts of a cluster during a network partition.  Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>addAndGet</code></p>
</li>
<li>
<p><code>addAndGetAsync</code></p>
</li>
<li>
<p><code>alter</code></p>
</li>
<li>
<p><code>alterAndGet</code></p>
</li>
<li>
<p><code>alterAndGetAsync</code></p>
</li>
<li>
<p><code>alterAsync</code></p>
</li>
<li>
<p><code>apply</code></p>
</li>
<li>
<p><code>applyAsync</code></p>
</li>
<li>
<p><code>compareAndSet</code></p>
</li>
<li>
<p><code>compareAndSetAsync</code></p>
</li>
<li>
<p><code>decrementAndGet</code></p>
</li>
<li>
<p><code>decrementAndGetAsync</code></p>
</li>
<li>
<p><code>getAndAdd</code></p>
</li>
<li>
<p><code>getAndAddAsync</code></p>
</li>
<li>
<p><code>getAndAlter</code></p>
</li>
<li>
<p><code>getAndAlterAsync</code></p>
</li>
<li>
<p><code>getAndIncrement</code></p>
</li>
<li>
<p><code>getAndIncrementAsync</code></p>
</li>
<li>
<p><code>getAndSet</code></p>
</li>
<li>
<p><code>getAndSetAsync</code></p>
</li>
<li>
<p><code>incrementAndGet</code></p>
</li>
<li>
<p><code>incrementAndGetAsync</code></p>
</li>
<li>
<p><code>set</code></p>
</li>
<li>
<p><code>setAsync</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>get</code></p>
</li>
<li>
<p><code>getAsync</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for IAtomicLong can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/AtomicLongConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;atomic-long</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
   ...
<span class="tag">&lt;/atomic-long&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="isemaphore"><a class="anchor" href="#isemaphore"></a><a class="link" href="#isemaphore">7.12. ISemaphore</a></h3>
<div class="paragraph">
<p>Hazelcast ISemaphore is the distributed implementation of <code>java.util.concurrent.Semaphore</code>.</p>
</div>
<div class="sect3">
<h4 id="controlling-thread-counts-with-permits"><a class="anchor" href="#controlling-thread-counts-with-permits"></a><a class="link" href="#controlling-thread-counts-with-permits">7.12.1. Controlling Thread Counts with Permits</a></h4>
<div class="paragraph">
<p>Semaphores offer <strong>permit</strong>s to control the thread counts when performing concurrent activities. To execute a concurrent activity, a thread grants a permit or waits until a permit becomes available. When the execution is completed, the permit is released.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ISemaphore with a single permit may be considered as a lock. Unlike the locks, when semaphores are used, any thread can release the permit, and semaphores can have multiple permits.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hazelcast ISemaphore does not support fairness at all times. There are some edge cases where the fairness is not honored, e.g., when the permit becomes available at the time when an internal timeout occurs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a permit is acquired on ISemaphore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if there are permits, the number of permits in the semaphore is decreased by one and the calling thread performs its activity. If there is contention, the longest waiting thread will acquire the permit before all other threads.</p>
</li>
<li>
<p>if no permits are available, the calling thread blocks until a permit becomes available. When a timeout happens during this block, the thread is interrupted.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="example-semaphore-code"><a class="anchor" href="#example-semaphore-code"></a><a class="link" href="#example-semaphore-code">7.12.2. Example Semaphore Code</a></h4>
<div class="paragraph">
<p>The following example code uses an <code>IAtomicLong</code> resource 1000 times, increments the resource when a thread starts to use it and decrements it when the thread completes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/semaphore/SemaphoreMember.java[tag=sm]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s limit the concurrent access to this resource by allowing at most three threads. You can configure it declaratively by setting the <code>initial-permits</code> property, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;semaphore</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">semaphore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;initial-permits&gt;</span>3<span class="tag">&lt;/initial-permits&gt;</span>
<span class="tag">&lt;/semaphore&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If there is a shortage of permits while the semaphore is being created, value of this property can be set to a negative number.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you execute the above <code>SemaphoreMember</code> class 5 times, the output will be similar to the following:</p>
</div>
<div class="paragraph">
<p><code>At iteration: 0, Active Threads: 1</code></p>
</div>
<div class="paragraph">
<p><code>At iteration: 1, Active Threads: 2</code></p>
</div>
<div class="paragraph">
<p><code>At iteration: 2, Active Threads: 3</code></p>
</div>
<div class="paragraph">
<p><code>At iteration: 3, Active Threads: 3</code></p>
</div>
<div class="paragraph">
<p><code>At iteration: 4, Active Threads: 3</code></p>
</div>
<div class="paragraph">
<p>As you can see, the maximum count of concurrent threads is equal or smaller than three. If you remove the semaphore acquire/release statements in <code>SemaphoreMember</code>, you will see that there is no limitation on the number of concurrent usages.</p>
</div>
<div class="paragraph">
<p>Hazelcast also provides backup support for <code>ISemaphore</code>. When a member goes down, you can have another member take over the semaphore with the permit information (permits are automatically released when a member goes down). To enable this, configure synchronous or asynchronous backup with the properties <code>backup-count</code> and <code>async-backup-count</code> (by default, synchronous backup is already enabled).</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-semaphore"><a class="anchor" href="#configuring-semaphore"></a><a class="link" href="#configuring-semaphore">7.12.3. Configuring Semaphore</a></h4>
<div class="paragraph">
<p>The following are example semaphore configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;semaphore</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">semaphore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;backup-count&gt;</span>1<span class="tag">&lt;/backup-count&gt;</span>
   <span class="tag">&lt;async-backup-count&gt;</span>0<span class="tag">&lt;/async-backup-count&gt;</span>
   <span class="tag">&lt;initial-permits&gt;</span>3<span class="tag">&lt;/initial-permits&gt;</span>
   <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/semaphore&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/semaphore/SemaphoreMember.java[tag=sc]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Semaphore configuration has the below elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial-permits</code>: Thread count to which the concurrent access is limited. For example, if you set it to "3", concurrent access to the object is limited to 3 threads.</p>
</li>
<li>
<p><code>backup-count</code>: Number of synchronous backups.</p>
</li>
<li>
<p><code>async-backup-count</code>: Number of asynchronous backups.</p>
</li>
<li>
<p><code>quorum-ref</code>: Name of quorum configuration that you want this Semaphore to use. Please see the <a href="#split-brain-protection-for-isemaphore">Split-Brain Protection for ISemaphore section</a> below.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If high performance is more important than not losing the permit information, you can disable the backups by setting <code>backup-count</code> to 0.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-isemaphore"><a class="anchor" href="#split-brain-protection-for-isemaphore"></a><a class="link" href="#split-brain-protection-for-isemaphore">7.12.4. Split-Brain Protection for ISemaphore</a></h4>
<div class="paragraph">
<p>ISemaphore can be configured to check for a minimum number of available members before applying its operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful queue operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>acquire</code></p>
</li>
<li>
<p><code>drainPermits</code></p>
</li>
<li>
<p><code>init</code></p>
</li>
<li>
<p><code>reducePermits</code></p>
</li>
<li>
<p><code>release</code></p>
</li>
<li>
<p><code>tryAcquire</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>availablePermits</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for ISemaphore can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/SemaphoreConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;semaphore</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
   ...
<span class="tag">&lt;/semaphore&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="iatomicreference"><a class="anchor" href="#iatomicreference"></a><a class="link" href="#iatomicreference">7.13. IAtomicReference</a></h3>
<div class="paragraph">
<p>The <code>IAtomicLong</code> is very useful if you need to deal with a long, but in some cases you need to deal with a reference. That is why Hazelcast also supports the <code>IAtomicReference</code> which is the distributed version of the <code>java.util.concurrent.atomic.AtomicReference</code>.</p>
</div>
<div class="paragraph">
<p>Here is an IAtomicReference example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/IAtomicReferenceSample.java[tag=iar]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you execute the above example, you will see the following output.</p>
</div>
<div class="paragraph">
<p><code>foo</code></p>
</div>
<div class="sect3">
<h4 id="sending-functions-to-iatomicreference"><a class="anchor" href="#sending-functions-to-iatomicreference"></a><a class="link" href="#sending-functions-to-iatomicreference">7.13.1. Sending Functions to IAtomicReference</a></h4>
<div class="paragraph">
<p>Just like <code>IAtomicLong</code>, <code>IAtomicReference</code> has methods that accept a 'function' as an argument, such as <code>alter</code>, <code>alterAndGet</code>, <code>getAndAlter</code> and <code>apply</code>. There are two big advantages of using these methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From a performance point of view, it is better to send the function to the data then the data to the function. Often the function is a lot smaller than the data and therefore cheaper to send over the line. Also the function only needs to be transferred once to the target machine and the data needs to be transferred twice.</p>
</li>
<li>
<p>You do not need to deal with concurrency control. If you would perform a load, transform, store, you could run into a data race since another thread might have updated the value you are about to overwrite.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="using-iatomicreference"><a class="anchor" href="#using-iatomicreference"></a><a class="link" href="#using-iatomicreference">7.13.2. Using IAtomicReference</a></h4>
<div class="paragraph">
<p>Below are some considerations you need to know when you use IAtomicReference.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IAtomicReference</code> works based on the byte-content and not on the object-reference. If you use the <code>compareAndSet</code> method, do not change to original value because its serialized content will then be different. It is also important to know that if you rely on Java serialization, sometimes (especially with hashmaps) the same object can result in different binary content.</p>
</li>
<li>
<p><code>IAtomicReference</code> will always have one synchronous backup.</p>
</li>
<li>
<p>All methods returning an object will return a private copy. You can modify the private copy, but the rest of the world will be shielded from your changes. If you want these changes to be visible to the rest of the world, you need to write the change back to the <code>IAtomicReference</code>; but be careful about introducing a data-race.</p>
</li>
<li>
<p>The 'in-memory format' of an <code>IAtomicReference</code> is <code>binary</code>. The receiving side does not need to have the class definition available unless it needs to be deserialized on the other side, e.g., because a method like 'alter' is executed. This deserialization is done for every call that needs to have the object instead of the binary content, so be careful with expensive object graphs that need to be deserialized.</p>
</li>
<li>
<p>If you have an object with many fields or an object graph and you only need to calculate some information or need a subset of fields, you can use the <code>apply</code> method. With the <code>apply</code> method, the whole object does not need to be sent over the line; only the information that is relevant is sent.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-iatomicreference"><a class="anchor" href="#split-brain-protection-for-iatomicreference"></a><a class="link" href="#split-brain-protection-for-iatomicreference">7.13.3. Split-Brain Protection for IAtomicReference</a></h4>
<div class="paragraph">
<p>IAtomicReference can be configured to check for a minimum number of available members before applying its operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>alter</code></p>
</li>
<li>
<p><code>alterAndGet</code></p>
</li>
<li>
<p><code>alterAndGetAsync</code></p>
</li>
<li>
<p><code>alterAsync</code></p>
</li>
<li>
<p><code>apply</code></p>
</li>
<li>
<p><code>applyAsync</code></p>
</li>
<li>
<p><code>clear</code></p>
</li>
<li>
<p><code>clearAsync</code></p>
</li>
<li>
<p><code>compareAndSet</code></p>
</li>
<li>
<p><code>compareAndSetAsync</code></p>
</li>
<li>
<p><code>getAndAlter</code></p>
</li>
<li>
<p><code>getAndAlterAsync</code></p>
</li>
<li>
<p><code>getAndSet</code></p>
</li>
<li>
<p><code>getAndSetAsync</code></p>
</li>
<li>
<p><code>set</code></p>
</li>
<li>
<p><code>setAndGet</code></p>
</li>
<li>
<p><code>setAsync</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>contains</code></p>
</li>
<li>
<p><code>containsAsync</code></p>
</li>
<li>
<p><code>get</code></p>
</li>
<li>
<p><code>getAsync</code></p>
</li>
<li>
<p><code>isNull</code></p>
</li>
<li>
<p><code>isNullAsync</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for IAtomicReference can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/AtomicReferenceConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;atomic-reference</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
   ...
<span class="tag">&lt;/atomic-reference&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="icountdownlatch"><a class="anchor" href="#icountdownlatch"></a><a class="link" href="#icountdownlatch">7.14. ICountDownLatch</a></h3>
<div class="paragraph">
<p>Hazelcast <code>ICountDownLatch</code> is the distributed implementation of <code>java.util.concurrent.CountDownLatch</code>.</p>
</div>
<div class="sect3">
<h4 id="gate-keeping-concurrent-activities"><a class="anchor" href="#gate-keeping-concurrent-activities"></a><a class="link" href="#gate-keeping-concurrent-activities">7.14.1. Gate-Keeping Concurrent Activities</a></h4>
<div class="paragraph">
<p><code>CountDownLatch</code> is considered to be a gate keeper for concurrent activities. It enables the threads to wait for other threads to complete their operations.</p>
</div>
<div class="paragraph">
<p>The following code samples describe the mechanism of <code>ICountDownLatch</code>. Assume that there is a leader process and there are follower processes that will wait until the leader completes. Here is the leader:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/countdownlatch/Leader.java[tag=leader]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since only a single step is needed to be completed as a sample, the above code initializes the latch with 1. Then, the code sleeps for a while to simulate a process and starts the countdown. Finally, it clears up the latch. Let&#8217;s write a follower:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/countdownlatch/Follower.java[tag=follower]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The follower class above first retrieves <code>ICountDownLatch</code> and then calls the <code>await</code> method to enable the thread to listen for the latch. The method <code>await</code> has a timeout value as a parameter. This is useful when the <code>countDown</code> method fails. To see <code>ICountDownLatch</code> in action, start the leader first and then start one or more followers. You will see that the followers will wait until the leader completes.</p>
</div>
</div>
<div class="sect3">
<h4 id="recovering-from-failure"><a class="anchor" href="#recovering-from-failure"></a><a class="link" href="#recovering-from-failure">7.14.2. Recovering From Failure</a></h4>
<div class="paragraph">
<p>In a distributed environment, the counting down cluster member may go down. In this case, all listeners are notified immediately and automatically by Hazelcast. The state of the current process just before the failure should be verified and 'how to continue now' should be decided, e.g., restart all process operations, continue with the first failed process operation and throw an exception.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-icountdownlatch"><a class="anchor" href="#using-icountdownlatch"></a><a class="link" href="#using-icountdownlatch">7.14.3. Using ICountDownLatch</a></h4>
<div class="paragraph">
<p>Although the <code>ICountDownLatch</code> is a very useful synchronization aid, you will probably not use it on a daily basis. Unlike Java&#8217;s implementation, Hazelcast&#8217;s <code>ICountDownLatch</code> count can be reset after a countdown has finished, but not during an active count.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ICountDownLatch has 1 synchronous backup and no asynchronous backups. Its backup count is not configurable. Also, the count cannot be re-set during an active count, it should be re-set after the countdown is finished.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-icountdownlatch"><a class="anchor" href="#split-brain-protection-for-icountdownlatch"></a><a class="link" href="#split-brain-protection-for-icountdownlatch">7.14.4. Split-Brain Protection for ICountDownLatch</a></h4>
<div class="paragraph">
<p>ICountDownLatch can be configured to check for a minimum number of available members before applying ICountDownLatch operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful queue operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>countDown</code></p>
</li>
<li>
<p><code>trySetCount</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>await</code></p>
</li>
<li>
<p><code>getCount</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for ICountDownLatch can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/CountDownLatchConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;count-down-latch</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
   ...
<span class="tag">&lt;/count-down-latch&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="pn-counter"><a class="anchor" href="#pn-counter"></a><a class="link" href="#pn-counter">7.15. PN Counter</a></h3>
<div class="paragraph">
<p>A Conflict-free Replicated Data Type (CRDT) is a distributed data structure that achieves high availability by relaxing consistency constraints. There may be several replicas for the same data and these replicas can be modified concurrently without coordination. This means that you may achieve high throughput and low latency when updating a CRDT data structure. On the other hand, all of the updates are replicated asynchronously. Each replica will then receive updates made on other replicas eventually and if no new updates are done, all replicas which can communicate to each other will return the same state (converge) after some time.</p>
</div>
<div class="paragraph">
<p>Hazelcast offers a lightweight CRDT PN counter (Positive-Negative Counter) implementation where each Hazelcast instance can increment and decrement the counter value and these updates are propagated to all replicas. Only a Hazelcast member can store state for a counter which means that counter method invocations performed on a Hazelcast member are usually local (depending on the configured replica count). If there is no member failure, it is guaranteed that each replica sees the final value of the counter eventually. Counter&#8217;s state converges with each update and all CRDT replicas that can communicate to each other will eventually have the same state.</p>
</div>
<div class="paragraph">
<p>Using the PN Counter, you can get a distributed counter, increment and decrement it, and query its value with RYW (read-your-writes) and monotonic reads. The implementation borrows most methods from the <code>AtomicLong</code> which should be familiar in most cases and easily interchangeable in the existing code.</p>
</div>
<div class="paragraph">
<p>Some examples of PN counter are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>counting the number of "likes" or "+1"</p>
</li>
<li>
<p>counting the number of logged in users</p>
</li>
<li>
<p>counting the number of page hits/views</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>How it works</strong></p>
</div>
<div class="paragraph">
<p>The counter supports adding and subtracting values as well as retrieving the current counter value. Each replica of this counter can perform operations locally without coordination with the other replicas, thus increasing availability. The counter guarantees that whenever two members have received the same set of updates, possibly in a different order, their state is identical, and any conflicting updates are merged automatically. If no new updates are made to the shared state, all members that can communicate will eventually have the same data.</p>
</div>
<div class="paragraph">
<p>The updates to the counter are applied locally when invoked on a CRDT replica. A CRDT replica can be any Hazelcast instance <strong>which is NOT a client or a lite member</strong>. You can configure the number of replicas in the cluster using the <code>replica-count</code> configuration element.</p>
</div>
<div class="paragraph">
<p>When invoking updates from a non-replica instance, the invocation is remote. This may lead to indeterminate state - the update may be applied but the response has not been received. In this case, the caller will be notified with a <code>TargetDisconnectedException</code> when invoked from a client or a <code>MemberLeftException</code> when invoked from a member.</p>
</div>
<div class="paragraph">
<p>The read and write methods provide monotonic read and RYW (read-your-write) guarantees. These guarantees are session guarantees which means that if no replica with the previously observed state is reachable, the session guarantees are lost and the method invocation will throw a <code>ConsistencyLostException</code>. This does not mean that an update is lost. All of the updates are part of some replica and will be eventually reflected in the state of all other replicas. This exception just means that you cannot observe your own writes because all replicas that contain your updates are currently unreachable. After you have received a <code>ConsistencyLostException</code>, you can either wait for a sufficiently up-to-date replica to become reachable in which case the session can be continued or you can reset the session by calling the method `reset(). If you have called this method, a new session is started with the next invocation to a CRDT replica.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The CRDT state is kept entirely on non-lite (data) members. If there aren&#8217;t any and the methods here are invoked on a lite member, they fail with a <code>NoDataMemberInClusterException</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is an example code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/PNCounterSample.java[tag=pnc]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code snippet creates an instance of a PN counter, increments it by 5 and retrieves the value.</p>
</div>
<div class="sect3">
<h4 id="configuring-pn-counter"><a class="anchor" href="#configuring-pn-counter"></a><a class="link" href="#configuring-pn-counter">7.15.1. Configuring PN Counter</a></h4>
<div class="paragraph">
<p>Following is an example declarative configuration snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;pn-counter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;replica-count&gt;</span>10<span class="tag">&lt;/replica-count&gt;</span>
    <span class="tag">&lt;statistics-enabled&gt;</span>true<span class="tag">&lt;/statistics-enabled&gt;</span>
  <span class="tag">&lt;/pn-counter&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Name of your PN Counter.</p>
</li>
<li>
<p><code>replica-count</code>: Number of replicas on which state for this PN counter will be kept. This number applies in quiescent state, if there are currently membership changes or clusters are merging, the state may be temporarily kept on more replicas. Its default value is Integer.MAX_VALUE. Generally, keeping the state on more replicas means that more Hazelcast members will be able to perform updates locally but it also means that the PN counter state will be kept on more replicas, increasing the network traffic, decreasing the speed at which replica states converge and increasing the size of the PN counter state kept on each replica.</p>
</li>
<li>
<p><code>statistics-enabled</code>: Specifies whether the statistics gathering will be enabled for your PN Counter. If set to <code>false</code>, you cannot collect statistics in your implementation and also Hazelcast Management Center will not show them. Its default value is <code>true</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following is an equivalent snippet of Java configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/PNCounterSample.java[tag=pncc]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-crdt-replication-mechanism"><a class="anchor" href="#configuring-the-crdt-replication-mechanism"></a><a class="link" href="#configuring-the-crdt-replication-mechanism">7.15.2. Configuring the CRDT replication mechanism</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Configuring the replication mechanism is for advanced use cases only - usually the default configuration will work fine for most cases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some cases, you may want to configure the replication mechanism for all CRDT implementations. The CRDT states are replicated in rounds (the period is configurable) and in each round the state is replicated up to the configured number of members. Generally speaking, you may increase the speed at which replicas converge at the expense of more network traffic or decrease the network traffic at the expense of slower convergence of replicas.
Hazelcast implements the state-based replication mechanism - the CRDT state for changed CRDTs is replicated in its entirety to other replicas on each replication round.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;crdt-replication&gt;</span>
      <span class="tag">&lt;max-concurrent-replication-targets&gt;</span>1<span class="tag">&lt;/max-concurrent-replication-targets&gt;</span>
      <span class="tag">&lt;replication-period-millis&gt;</span>1000<span class="tag">&lt;/replication-period-millis&gt;</span>
  <span class="tag">&lt;/crdt-replication&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>max-concurrent-replication-targets</code>: The maximum number of target members that we replicate the CRDT states to in one period. A higher count will lead to states being disseminated more rapidly at the expense of burst-like behavior - one update to a CRDT will lead to a sudden burst in the number of replication messages in a short time interval. Its default value is 1 which means that each replica will replicate state to only one other replica in each replication round.</p>
</li>
<li>
<p><code>replication-period-millis</code>: The period between two replications of CRDT states in milliseconds. A lower value will increase the speed at which changes are disseminated to other cluster members at the expense of burst-like behavior - less updates will be batched together in one replication message and one update to a CRDT may cause a sudden burst of replication messages in a short time interval. The value must be a positive non-null integer. Its default value is 1000 milliseconds which means that the changed CRDT state is replicated every 1 second.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following is an equivalent snippet of Java configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/CRDTReplication.java[tag=crdt]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="idgenerator"><a class="anchor" href="#idgenerator"></a><a class="link" href="#idgenerator">7.16. IdGenerator</a></h3>
<div class="paragraph">
<p>Hazelcast IdGenerator is used to generate cluster-wide unique identifiers. Generated identifiers are long type primitive values between 0 and <code>Long.MAX_VALUE</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><strong>Feature is deprecated.</strong></strong> The implementation can produce duplicate IDs in case of a network split, even with split-brain protection enabled (during short window while split-brain is detected). Please use <a href="#flakeidgenerator">FlakeIdGenerator</a> for an alternative implementation which does not suffer from the issue. Also see the <a href="#migrating-to-flakeidgenerator">Migration guide</a> at the end of this section.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="generating-cluster-wide-ids"><a class="anchor" href="#generating-cluster-wide-ids"></a><a class="link" href="#generating-cluster-wide-ids">7.16.1. Generating Cluster-Wide IDs</a></h4>
<div class="paragraph">
<p>ID generation occurs almost at the speed of <code>AtomicLong.incrementAndGet()</code>. A group of 10,000 identifiers is allocated for each cluster member. In the background, this allocation takes place with an <code>IAtomicLong</code> incremented by 10,000. Once a cluster member generates IDs (allocation is done), <code>IdGenerator</code> increments a local counter. If a cluster member uses all IDs in the group, it will get another 10,000 IDs. This way, only one time of network traffic is needed, meaning that 9,999 identifiers are generated in memory instead of over the network. This is fast.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s write a sample identifier generator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/IdGeneratorSample.java[tag=idg]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s run the above code two times. The output will be similar to the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Members [<span class="integer">1</span>] {
  <span class="predefined-type">Member</span> [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5701</span> <span class="local-variable">this</span>
}
Id: <span class="integer">1</span>
Id: <span class="integer">2</span>
Id: <span class="integer">3</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Members [<span class="integer">2</span>] {
  <span class="predefined-type">Member</span> [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5701</span>
  <span class="predefined-type">Member</span> [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5702</span> <span class="local-variable">this</span>
}
Id: <span class="integer">10001</span>
Id: <span class="integer">10002</span>
Id: <span class="integer">10003</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="unique-ids-and-duplicate-ids"><a class="anchor" href="#unique-ids-and-duplicate-ids"></a><a class="link" href="#unique-ids-and-duplicate-ids">7.16.2. Unique IDs and Duplicate IDs</a></h4>
<div class="paragraph">
<p>You can see that the generated IDs are unique and counting upwards. If you see duplicated identifiers, it means your instances could not form a cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Generated IDs are unique during the life cycle of the cluster. If the entire cluster is restarted, IDs start from 0, again or you can initialize to a value using the <code>init()</code> method of IdGenerator.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
IdGenerator has one synchronous backup and no asynchronous backups. Its backup count is not configurable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="migrating-to-flakeidgenerator"><a class="anchor" href="#migrating-to-flakeidgenerator"></a><a class="link" href="#migrating-to-flakeidgenerator">7.16.3. Migrating to FlakeIdGenerator</a></h4>
<div class="paragraph">
<p>The Flake ID generator provides similar features with more safety guarantees during network splits. The two generators are completely different implementations, but both types of generator generate roughly ordered IDs. So in order to ensure uniqueness of the generated IDs, we can force the Flake ID generator to start at least where the old generator ended. This is likely the case, because the values from Flake generator are quite large compared to values from the old generator. Anyway, here are the steps you need to take:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure the version of your Hazelcast cluster and of all clients is at least 3.10.</p>
</li>
<li>
<p>If the current ID from old <code>IdGenerator</code> is higher than the ID from <code>FlakeIdGenerator</code>, you need to configure ID offset. See <a href="https://github.com/hazelcast/hazelcast-code-samples/blob/master/distributed-primitives/flake-id-generator/src/main/java/FlakeIdMigrationSample.java">FlakeIdMigrationSample</a> for mor details.</p>
</li>
<li>
<p>Replace all calls to <code>HazelcastInstance.getIdGenerator()</code> with <code>HazelcastInstance.getFlakeIdGenerator()</code>. If you use Spring configuration, replace <code>&lt;id-generator&gt;</code> with <code>&lt;flake-id-generator&gt;</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="flakeidgenerator"><a class="anchor" href="#flakeidgenerator"></a><a class="link" href="#flakeidgenerator">7.17. FlakeIdGenerator</a></h3>
<div class="paragraph">
<p>Hazelcast Flake ID Generator is used to generate cluster-wide unique identifiers. Generated identifiers are <code>long</code> primitive values and are k-ordered (roughly ordered). IDs are in the range from 0 to Long.MAX_VALUE.</p>
</div>
<div class="sect3">
<h4 id="generating-cluster-wide-flake-ids"><a class="anchor" href="#generating-cluster-wide-flake-ids"></a><a class="link" href="#generating-cluster-wide-flake-ids">7.17.1. Generating Cluster-Wide IDs</a></h4>
<div class="paragraph">
<p>The IDs contain timestamp component and a node ID component, which is assigned when the member joins the cluster. This allows the IDs to be ordered and unique without any coordination between the members, which makes the generator safe even in split-brain scenarios (for limitations in this case, please see the <a href="#node-id-assignment">Node ID assignment section</a> below).</p>
</div>
<div class="paragraph">
<p>Timestamp component is in milliseconds since 1.1.2018, 0:00 UTC and has 41 bits. This caps the useful lifespan of the generator to little less than 70 years (until ~2088). The sequence component is 6 bits. If more than 64 IDs are requested in single millisecond, IDs will gracefully overflow to the next millisecond and uniqueness is guaranteed in this case. The implementation does not allow overflowing by more than 15 seconds, if IDs are requested at higher rate, the call will block. Note, however, that clients are able to generate even faster because each call goes to a different (random) member and the 64 IDs/ms limit is for single member.</p>
</div>
</div>
<div class="sect3">
<h4 id="flakeidgenerator-performance"><a class="anchor" href="#flakeidgenerator-performance"></a><a class="link" href="#flakeidgenerator-performance">7.17.2. Performance</a></h4>
<div class="paragraph">
<p>Operation on member is always local, if the member has valid node ID, otherwise it&#8217;s remote. On client, the newId() method goes to a random member and gets a batch of IDs, which will then be returned locally for limited time. The pre-fetch size and the validity time can be configured for each client and member.</p>
</div>
</div>
<div class="sect3">
<h4 id="flakeidgenerator-example"><a class="anchor" href="#flakeidgenerator-example"></a><a class="link" href="#flakeidgenerator-example">7.17.3. Example</a></h4>
<div class="paragraph">
<p>Let&#8217;s write a sample identifier generator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FlakeIdGeneratorSample</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        HazelcastInstance hazelcast = Hazelcast.newHazelcastInstance();

        ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig()
                .addFlakeIdGeneratorConfig(<span class="keyword">new</span> FlakeIdGeneratorConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">idGenerator</span><span class="delimiter">&quot;</span></span>)
                        .setPrefetchCount(<span class="integer">10</span>));
        HazelcastInstance client = HazelcastClient.newHazelcastClient(clientConfig);

        FlakeIdGenerator idGenerator = client.getFlakeIdGenerator(<span class="string"><span class="delimiter">&quot;</span><span class="content">idGenerator</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; <span class="integer">10000</span>; i++) {
            sleepSeconds(<span class="integer">1</span>);
            <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Id: %s</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>, idGenerator.newId());
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="node-id-assignment"><a class="anchor" href="#node-id-assignment"></a><a class="link" href="#node-id-assignment">7.17.4. Node ID Assignment</a></h4>
<div class="paragraph">
<p>Flake IDs require a unique node ID to be assigned to each member, from which point the member can generate unique IDs without any coordination. Hazelcast uses the member list version from the moment when the member joined the cluster as a unique node ID.</p>
</div>
<div class="paragraph">
<p>The join algorithm is specifically designed to ensure that member list join version is unique for each member in the cluster. This ensures that IDs are unique even during network splits, with one caveat: at most one member is allowed to join the cluster during a network split. If two members join different subclusters, they are likely to get the same node ID. This will be resolved when the cluster heals, but until then, they can generate duplicate IDs.</p>
</div>
<div class="sect4">
<h5 id="node-id-overflow"><a class="anchor" href="#node-id-overflow"></a><a class="link" href="#node-id-overflow">Node ID Overflow</a></h5>
<div class="paragraph">
<p>Node ID component of the ID has 16 bits. Members with the member list join version higher than 2^16 won&#8217;t be able to generate IDs, but functionality will be preserved by forwarding to another member. It is possible to generate IDs on any member or client as long as there is at least one member with join version smaller than 2^16 in the cluster. The remedy is to restart the cluster: the node ID component will be reset and assigned starting from zero again. Uniqueness after the restart will be preserved thanks to the timestamp component.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="replicated-map"><a class="anchor" href="#replicated-map"></a><a class="link" href="#replicated-map">7.18. Replicated Map</a></h3>
<div class="paragraph">
<p>A Replicated Map is a distributed key-value data structure where the data is replicated to all members in the cluster. It provides full replication of entries to all members for high speed access. The following are its features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When you have a Replicated Map in the  cluster, your clients can communicate with any cluster member.</p>
</li>
<li>
<p>All cluster members are able to perform write operations.</p>
</li>
<li>
<p>It supports all methods of the interface <code>java.util.Map</code>.</p>
</li>
<li>
<p>It supports automatic initial fill up when a new member is started.</p>
</li>
<li>
<p>It provides statistics for entry access, write and update so that you can monitor it using Hazelcast Management Center.</p>
</li>
<li>
<p>New members joining to the cluster pull all the data from the existing members.</p>
</li>
<li>
<p>You can listen to entry events using listeners. Please refer to <a href="#using-entrylistener-on-replicated-map">Using EntryListener on Replicated Map</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="replicating-instead-of-partitioning"><a class="anchor" href="#replicating-instead-of-partitioning"></a><a class="link" href="#replicating-instead-of-partitioning">7.18.1. Replicating Instead of Partitioning</a></h4>
<div class="paragraph">
<p>A Replicated Map does not partition data
(it does not spread data to different cluster members); instead, it replicates the data to all members. All other data structures are partitioned in design.</p>
</div>
<div class="paragraph">
<p>Replication leads to higher memory consumption. However, a Replicated Map has faster read and write access since the data is available on all members.</p>
</div>
<div class="paragraph">
<p>Writes could take place on local/remote members in order to provide write-order, eventually being replicated to all other members.</p>
</div>
<div class="paragraph">
<p>Replicated Map is suitable for objects, catalog data, or idempotent calculable data (such as HTML pages). It fully implements the <code>java.util.Map</code> interface, but it lacks the methods from <code>java.util.concurrent.ConcurrentMap</code> since
there are no atomic guarantees to writes or reads.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If Replicated Map is used from a dummy client and this dummy client is connected to a lite member, the entry listeners cannot be registered/de-registered.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot use Replicated Map from a lite member. A <code>com.hazelcast.replicatedmap.ReplicatedMapCantBeCreatedOnLiteMemberException</code> is thrown if <code>com.hazelcast.core.HazelcastInstance.getReplicatedMap(name)</code> is invoked on a lite member.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="example-replicated-map-code"><a class="anchor" href="#example-replicated-map-code"></a><a class="link" href="#example-replicated-map-code">7.18.2. Example Replicated Map Code</a></h4>
<div class="paragraph">
<p>Here is an example of Replicated Map code. The HazelcastInstance&#8217;s <code>getReplicatedMap</code> method gets the Replicated Map, and the Replicated Map&#8217;s <code>put</code> method creates map entries.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/replicatedmap/FillMapMember.java[tag=fmm]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>HazelcastInstance.getReplicatedMap()</code> returns <code>com.hazelcast.core.ReplicatedMap</code> which, as stated above, extends the
<code>java.util.Map</code> interface.</p>
</div>
<div class="paragraph">
<p>The <code>com.hazelcast.core.ReplicatedMap</code> interface has some additional methods for registering entry listeners or retrieving values in an expected order.</p>
</div>
</div>
<div class="sect3">
<h4 id="considerations-for-replicated-map"><a class="anchor" href="#considerations-for-replicated-map"></a><a class="link" href="#considerations-for-replicated-map">7.18.3. Considerations for Replicated Map</a></h4>
<div class="paragraph">
<p>If you have a large cluster or very high occurrences of updates, the Replicated Map may not scale linearly as expected since it has to replicate update operations to all members in the cluster.</p>
</div>
<div class="paragraph">
<p>Since the replication of updates is performed in an asynchronous manner, we recommend you enable back pressure in case your system has high occurrences of updates. Please refer to the <a href="#back-pressure">Back Pressure</a> section to learn how to enable it.</p>
</div>
<div class="paragraph">
<p>Replicated Map has an anti-entropy system that will converge values to a common one if some of the members are missing replication updates.</p>
</div>
<div class="paragraph">
<p>Replicated Map does not guarantee eventual consistency because there are some edge cases that fail to provide consistency.</p>
</div>
<div class="paragraph">
<p>Replicated Map uses the internal partition system of Hazelcast in order to serialize updates happening on the same key at the same time. This happens by sending updates of the same key to the same Hazelcast member in the cluster.</p>
</div>
<div class="paragraph">
<p>Due to the asynchronous nature of replication, a Hazelcast member could die before successfully replicating a "write" operation to other members after sending the "write completed" response to its caller during the write process. In this scenario, Hazelcast&#8217;s internal partition system will promote one of the replicas of the partition as the primary one. The new primary partition will not have the latest "write" since the dead member could not successfully replicate the update. (This will leave the system in a state that the caller is the only one that has the update and the rest of the cluster have not.) In this case even the anti-entropy system simply could not converge the value since the source of true information is lost for the update. This leads to a break in the eventual consistency because different values can be read from the system for the same key.</p>
</div>
<div class="paragraph">
<p>Other than the aforementioned scenario, the Replicated Map will behave like an eventually consistent system with read-your-writes and monotonic-reads consistency.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-design-for-replicated-map"><a class="anchor" href="#configuration-design-for-replicated-map"></a><a class="link" href="#configuration-design-for-replicated-map">7.18.4. Configuration Design for Replicated Map</a></h4>
<div class="paragraph">
<p>There are several technical design decisions you should consider when you configure a Replicated Map.</p>
</div>
<div class="paragraph">
<p><strong>Initial Provisioning</strong></p>
</div>
<div class="paragraph">
<p>If a new member joins the cluster, there are two ways you can handle the initial provisioning that is executed to replicate all existing
values to the new member. Each involves how you configure the async fill up.</p>
</div>
<div class="paragraph">
<p>First, you can configure async fill up to true, which does not block reads while the fill up operation is underway. That way,
you have immediate access on the new member, but it will take time until all the values are eventually accessible. Not yet
replicated values are returned as non-existing (null).</p>
</div>
<div class="paragraph">
<p>Second, you can configure for a synchronous initial fill up (by configuring the async fill up to false), which blocks every read or write access to the map until the
fill up operation is finished. Use this with caution since it might block your application from operating.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-replicated-map"><a class="anchor" href="#configuring-replicated-map"></a><a class="link" href="#configuring-replicated-map">7.18.5. Configuring Replicated Map</a></h4>
<div class="paragraph">
<p>Replicated Map can be configured programmatically or declaratively.</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration:</strong></p>
</div>
<div class="paragraph">
<p>You can declare your Replicated Map configuration in the Hazelcast configuration file <code>hazelcast.xml</code>. Please see the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;replicatedmap</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;in-memory-format&gt;</span>BINARY<span class="tag">&lt;/in-memory-format&gt;</span>
  <span class="tag">&lt;async-fillup&gt;</span>true<span class="tag">&lt;/async-fillup&gt;</span>
  <span class="tag">&lt;statistics-enabled&gt;</span>true<span class="tag">&lt;/statistics-enabled&gt;</span>
  <span class="tag">&lt;entry-listeners&gt;</span>
    <span class="tag">&lt;entry-listener</span> <span class="attribute-name">include-value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      com.hazelcast.examples.EntryListener
    <span class="tag">&lt;/entry-listener&gt;</span>
  <span class="tag">&lt;/entry-listeners&gt;</span>
  <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/replicatedmap&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>in-memory-format</code>: Internal storage format.  Please see the <a href="#in-memory-format-on-replicated-map">In-Memory Format section</a>. Its default value is <code>OBJECT</code>.</p>
</li>
<li>
<p><code>async-fillup</code>: Specifies whether the Replicated Map is available for reads before the initial replication is completed. Its default value is <code>true</code>. If set to <code>false</code> (i.e., synchronous initial fill up), no exception will be thrown when the Replicated Map is not yet ready, but <code>null</code> values can be seen until the initial replication is completed.</p>
</li>
<li>
<p><code>statistics-enabled</code>: If set to <code>true</code>, the statistics such as cache hits and misses are collected. Its default value is <code>true</code>.</p>
</li>
<li>
<p><code>entry-listener</code>: Full canonical classname of the <code>EntryListener</code> implementation.</p>
<div class="ulist">
<ul>
<li>
<p><code>entry-listener#include-value</code>: Specifies whether the event includes the value or not. Sometimes the key is enough to react on an event. In those situations, setting this value to <code>false</code> will save a deserialization cycle. Its default value is <code>true</code>.</p>
</li>
<li>
<p><code>entry-listener#local</code>: Not used for Replicated Map since listeners are always local.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>quorum-ref</code>: Name of quorum configuration that you want this Replicated Map to use. Please see the <a href="#split-brain-protection-for-replicated-map">Split-Brain Protection for Replicated Map section</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration:</strong></p>
</div>
<div class="paragraph">
<p>You can configure a Replicated Map programmatically, as you can do for all other data structures in Hazelcast. You must create the configuration upfront, when you instantiate the <code>HazelcastInstance</code>.
A basic example of how to configure the Replicated Map using the programmatic approach is shown in the following snippet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/replicatedmap/ReplicatedMapConfiguration.java[tag=rmc]</code></pre>
</div>
</div>
<div class="paragraph">
<p>All properties that can be configured using the declarative configuration are also available using programmatic configuration
by transforming the tag names into getter or setter names.</p>
</div>
<div class="sect4">
<h5 id="in-memory-format-on-replicated-map"><a class="anchor" href="#in-memory-format-on-replicated-map"></a><a class="link" href="#in-memory-format-on-replicated-map">In-Memory Format on Replicated Map</a></h5>
<div class="paragraph">
<p>Currently, two <code>in-memory-format</code> values are usable with the Replicated Map.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OBJECT</code> (default): The data will be stored in deserialized form. This configuration is the default choice since
the data replication is mostly used for high speed access. Please be aware that changing the values without a <code>Map.put()</code> is
not reflected on the other members but is visible on the changing members for later value accesses.</p>
</li>
<li>
<p><code>BINARY</code>: The data is stored in serialized binary format and has to be deserialized on every request. This
option offers higher encapsulation since changes to values are always discarded as long as the newly changed object is
not explicitly <code>Map.put()</code> into the map again.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-entrylistener-on-replicated-map"><a class="anchor" href="#using-entrylistener-on-replicated-map"></a><a class="link" href="#using-entrylistener-on-replicated-map">7.18.6. Using EntryListener on Replicated Map</a></h4>
<div class="paragraph">
<p>A <code>com.hazelcast.core.EntryListener</code> used on a Replicated Map serves the same purpose as it would on other
data structures in Hazelcast. You can use it to react on add, update and remove operations. Replicated Maps do not yet support eviction.</p>
</div>
<div class="sect4">
<h5 id="difference-in-entrylistener-on-replicated-map"><a class="anchor" href="#difference-in-entrylistener-on-replicated-map"></a><a class="link" href="#difference-in-entrylistener-on-replicated-map">Difference in EntryListener on Replicated Map</a></h5>
<div class="paragraph">
<p>The fundamental difference in Replicated Map behavior, compared to the other data structures, is that an EntryListener only reflects
changes on local data. Since replication is asynchronous, all listener events are fired only when an operation is finished
on a local member. Events can fire at different times on different members.</p>
</div>
</div>
<div class="sect4">
<h5 id="example-of-replicated-map-entrylistener"><a class="anchor" href="#example-of-replicated-map-entrylistener"></a><a class="link" href="#example-of-replicated-map-entrylistener">Example of Replicated Map EntryListener</a></h5>
<div class="paragraph">
<p>Here is a code example for using EntryListener on a Replicated Map.</p>
</div>
<div class="paragraph">
<p>The <code>HazelcastInstance&#8217;s `getReplicatedMap</code> method gets a Replicated Map (customers), and the <code>ReplicatedMap&#8217;s `addEntryListener</code> method adds an entry listener to the Replicated Map. Then, the <code>ReplicatedMap&#8217;s `put</code> method adds a Replicated Map
entry and updates it. The method <code>remove</code> removes the entry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/replicatedmap/ListeningMember.java[tag=lm]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-replicated-map"><a class="anchor" href="#split-brain-protection-for-replicated-map"></a><a class="link" href="#split-brain-protection-for-replicated-map">7.18.7. Split-Brain Protection for Replicated Map</a></h4>
<div class="paragraph">
<p>Replicated Map can be configured to check for a minimum number of available members before applying its operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful queue operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>clear</code></p>
</li>
<li>
<p><code>put</code></p>
</li>
<li>
<p><code>putAll</code></p>
</li>
<li>
<p><code>remove</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>containsKey</code></p>
</li>
<li>
<p><code>containsValue</code></p>
</li>
<li>
<p><code>entrySet</code></p>
</li>
<li>
<p><code>get</code></p>
</li>
<li>
<p><code>isEmpty</code></p>
</li>
<li>
<p><code>keySet</code></p>
</li>
<li>
<p><code>size</code></p>
</li>
<li>
<p><code>values</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for Replicated Map can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/ReplicatedMapConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;replicatedmap</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
   ...
<span class="tag">&lt;/replicatedmap&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cardinality-estimator"><a class="anchor" href="#cardinality-estimator"></a><a class="link" href="#cardinality-estimator">7.19. Cardinality Estimator Service</a></h3>
<div class="paragraph">
<p>Hazelcast&#8217;s cardinality estimator service is a data structure which implements Flajolet&#8217;s HyperLogLog algorithm for estimating cardinalities of unique objects in theoretically huge data sets.
The implementation offered by Hazelcast includes improvements from Google&#8217;s version of the algorithm, i.e., HyperLogLog++.</p>
</div>
<div class="paragraph">
<p>The cardinality estimator service does not provide any ways to configure its properties, but rather uses some well tested defaults.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>P</code>: Precision - 14, using the 14 LSB of the hash for the index.</p>
</li>
<li>
<p><code>M</code>: 2 ^ P = 16384 (16K) registers</p>
</li>
<li>
<p><code>P'</code>: Sparse Precision - 25</p>
</li>
<li>
<p><code>Durability</code>: How many backups for each estimator, default 2</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to understand that this data structure is not 100% accurate, it is used to provide estimates. The error rate is typically a result of <code>1.04/sqrt(M)</code> which in our implementation is around 0.81% for high percentiles.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The memory consumption of this data structure is close to 16K despite the size of elements in the source data set or stream.</p>
</div>
<div class="paragraph">
<p>There are two phases in using the cardinality estimator.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add objects to the instance of the estimator, e.g., for IPs <code>estimator.add("0.0.0.0.")</code>. The provided object is first serialized and then the byte array is used to generate a hash for that object.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Objects must be serializable in a form that Hazelcast understands.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Compute the estimate of the set so far <code>estimator.estimate()</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Please see the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/cardinality/CardinalityEstimator.html">cardinality estimator Javadoc</a> for more information on its API.</p>
</div>
<div class="paragraph">
<p>The following is an example code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/CardinalityEstimatorSample.java[tag=ces]</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-cardinality-estimator"><a class="anchor" href="#split-brain-protection-for-cardinality-estimator"></a><a class="link" href="#split-brain-protection-for-cardinality-estimator">7.19.1. Split-Brain Protection for Cardinality Estimator</a></h4>
<div class="paragraph">
<p>Cardinality Estimator can be configured to check for a minimum number of available members before applying its operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful queue operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>add</code></p>
</li>
<li>
<p><code>addAsync</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>estimate</code></p>
</li>
<li>
<p><code>estimateAsync</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for Cardinality Estimator can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/CardinalityEstimatorConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cardinality-estimator</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
   ...
<span class="tag">&lt;/cardinality-estimator&gt;</span>
[source,xml]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
<div class="paragraph">
<p><strong>Configuring Merge Policy</strong></p>
</div>
<div class="paragraph">
<p>While recovering from a Split-Brain syndrome, Cardinality Estimator in the small cluster merges into the bigger cluster based on a configured merge policy. When an estimator merges into the cluster, an estimator with the same name might already exist in the cluster.
So the merge policy resolves these kinds of conflicts with different out-of-the-box strategies. It can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/CardinalityEstimatorConfig.html"><code>setMergePolicyConfig()</code></a>, or declaratively using the element <code>merge-policy</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;cardinality-estimator</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;merge-policy&gt;</span>HyperLogLogMergePolicy<span class="tag">&lt;/merge-policy&gt;</span>
   ...
<span class="tag">&lt;/cardinality-estimator&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Following out-of-the-box merge policies are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DiscardMergePolicy</code>: Estimator from the smaller cluster will be discarded.</p>
</li>
<li>
<p><code>HyperLogLogMergePolicy</code>: Estimator will merge with the existing one, using the algorithmic merge for HyperLogLog. This is the default policy.</p>
</li>
<li>
<p><code>PassThroughMergePolicy</code>: Estimator from the smaller cluster wins.</p>
</li>
<li>
<p><code>PutIfAbsentMergePolicy</code>: Estimator from the smaller cluster wins if it doesn&#8217;t exist in the cluster.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="event-journal"><a class="anchor" href="#event-journal"></a><a class="link" href="#event-journal">7.20. Event Journal</a></h3>
<div class="paragraph">
<p>The event journal is a distributed data structure that stores the history of mutation actions on map or cache. Each action on the map or cache which modifies its contents (such as <code>put</code>, <code>remove</code> or scheduled tasks which are not triggered by using the public API) will create an event which will be stored in the event journal. The event will store the event type as well as the key, old value and updated value for the entry (when applicable). As a user, you can only append to the journal indirectly by using the map and cache methods or by configuring expiration and eviction.  By reading from the event journal you can recreate the state of the map or cache at any point in time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently the event journal does not expose a public API for reading the event journal in Hazelcast IMDG. The event journal can be used to stream event data to Hazelcast Jet, so it should be used in conjunction with <a href="http://jet.hazelcast.org/">Hazelcast Jet</a>. Because of this we will describe how to configure it but not how to use it from IMDG. If you enable and configure the event journal, you may only reach it through private API and you will most probably not get any benefits but the journal will retain events nevertheless and consume heap space.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The event journal has a fixed capacity and an expiration time. Internally it is structured as a ringbuffer (partitioned by ringbuffer item) and shares many similarities with it.</p>
</div>
<div class="sect3">
<h4 id="interaction-with-evictions-and-expiration-for-imap"><a class="anchor" href="#interaction-with-evictions-and-expiration-for-imap"></a><a class="link" href="#interaction-with-evictions-and-expiration-for-imap">7.20.1. Interaction with Evictions and Expiration for IMap</a></h4>
<div class="paragraph">
<p>Configuring IMap with eviction and expiration can cause the event journal to contain different events on the different replicas of the same partition. You can run into issues if you are reading from the event journal and the partition owner is terminated. A backup replica will then be promoted into the partition owner but the event journal will contain different events. The event count should stay the same but the entries which you previously thought were evicted and expired could now be "alive" and vice versa.</p>
</div>
<div class="paragraph">
<p>This is because eviction and expiration randomly choose entries to be evicted/expired. The entry is not coordinated between partition replicas. In these cases, the event journal diverges and will not converge at any future point but will remain inconsistent just as well as the contents of the internal record stores are inconsistent between replicas. You may say that the event journal on a specific replica is in-sync with the record store on that replica but the event journals and record stores between replicas are out-of-sync.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-event-journal-capacity"><a class="anchor" href="#configuring-event-journal-capacity"></a><a class="link" href="#configuring-event-journal-capacity">7.20.2. Configuring Event Journal Capacity</a></h4>
<div class="paragraph">
<p>By default, an event journal is configured with a <code>capacity</code> of 10000 items. This creates a single array per partition, roughly the size of the capacity divided by the number of partitions. Thus, if the configured capacity is 10000 and the number of partitions is 271, we will create 271 arrays of size 36 (10000/271). If
a <code>time-to-live</code> is configured, then an array of longs is also created that stores the expiration time for every item.
A single array of the event journal keeps events that are only related to the map entries in that partition. In a lot of cases you may want to change this <code>capacity</code> number to something that better fits your needs. As the capacity is shared between partitions, keep in mind not to set it to a value which is too low for you. Setting the capacity to a number lower than the partition count will result in an error when initializing the event journal.</p>
</div>
<div class="paragraph">
<p>Below is a declarative configuration example of an event journal with a <code>capacity</code> of 5000 items for a map and 10000 items for a cache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;event-journal</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;mapName&gt;</span>myMap<span class="tag">&lt;/mapName&gt;</span>
    <span class="tag">&lt;capacity&gt;</span>5000<span class="tag">&lt;/capacity&gt;</span>
    <span class="tag">&lt;time-to-live-seconds&gt;</span>20<span class="tag">&lt;/time-to-live-seconds&gt;</span>
<span class="tag">&lt;/event-journal&gt;</span>

<span class="tag">&lt;event-journal</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;cacheName&gt;</span>myCache<span class="tag">&lt;/cacheName&gt;</span>
    <span class="tag">&lt;capacity&gt;</span>10000<span class="tag">&lt;/capacity&gt;</span>
    <span class="tag">&lt;time-to-live-seconds&gt;</span>0<span class="tag">&lt;/time-to-live-seconds&gt;</span>
<span class="tag">&lt;/event-journal&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also configure an event journal programmatically. The following is a programmatic version of the above declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in dds.adoc - include::{javasource}/dds/EventJournalConfiguration.java[tag=ejc]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mapName</code> and <code>cacheName</code> attributes define the map or cache to which this event journal configuration applies. You can use pattern-matching and the <code>default</code> keyword when doing so. For instance, by using a <code>mapName</code> of <code>journaled*</code>, the journal configuration will apply to all maps whose names start with "journaled" and don&#8217;t have other journal configurations that match (e.g., if you would have a more specific journal configuration with an exact name match). If you specify the <code>mapName</code> or <code>cacheName</code> as <code>default</code>, the journal configuration will apply to all maps and caches that don&#8217;t have any other journal configuration. This means that potentially all maps and/or caches will have one single event journal configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="event-journal-partitioning"><a class="anchor" href="#event-journal-partitioning"></a><a class="link" href="#event-journal-partitioning">7.20.3. Event Journal Partitioning</a></h4>
<div class="paragraph">
<p>The event journal is a partitioned data structure. The partitioning is done by the event key. Because of this, the map and cache entry with a specific key is co-located with the events for that key and will be migrated accordingly.
Also, the backup count for the event journal is equal to the backup count of the map or cache for which it contains events. The events on the backup replicas will be created with the map or cache backup operations and no additional network traffic is introduced when appending events to the event journal.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-event-journal-ttl"><a class="anchor" href="#configuring-event-journal-ttl"></a><a class="link" href="#configuring-event-journal-ttl">7.20.4. Configuring Event Journal time-to-live</a></h4>
<div class="paragraph">
<p>You can configure Hazelcast event journal with a <code>time-to-live</code> in seconds. Using this setting, you can control how long the items remain in
the event journal before they are expired. By default, the <code>time-to-live</code> is set to 0, meaning that unless the item is overwritten,
it will remain in the journal indefinitely. The expiration time of the existing journal events is checked whenever a new event is appended to the event journal or when the event journal is being read. If the journal is not being read or written to, the journal may keep expired items indefinitely.</p>
</div>
<div class="paragraph">
<p>In the example below, an event journal is configured with a <code>time-to-live</code> of 180 seconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;event-journal</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;cacheName&gt;</span>myCache<span class="tag">&lt;/cacheName&gt;</span>
    <span class="tag">&lt;capacity&gt;</span>10000<span class="tag">&lt;/capacity&gt;</span>
    <span class="tag">&lt;time-to-live-seconds&gt;</span>180<span class="tag">&lt;/time-to-live-seconds&gt;</span>
<span class="tag">&lt;/event-journal&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="distributed-events"><a class="anchor" href="#distributed-events"></a><a class="link" href="#distributed-events">8. Distributed Events</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can register for Hazelcast entry events so you will be notified when those events occur. Event Listeners are cluster-wide&#8212;&#8203;when a listener is registered in one member of cluster, it is actually registered for events that originated at any member in the cluster. When a new member joins, events originated at the new member will also be delivered.</p>
</div>
<div class="paragraph">
<p>An Event is created only if you registered an event listener. If no listener is registered, then no event will be created. If you provided a predicate when you registered the event listener, pass the predicate before sending the event to the listener (member/client).</p>
</div>
<div class="paragraph">
<p>As a rule of thumb, your event listener should not implement heavy processes in its event methods that block the thread for a long time. If needed, you can use <code>ExecutorService</code> to transfer long running processes to another thread and thus offload the current listener thread.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In a failover scenario, events are not highly available and may get lost. Eventing mechanism is being improved for failover scenarios.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hazelcast offers the following event listeners.</p>
</div>
<div class="paragraph">
<p>For cluster events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Membership Listener</strong> for cluster membership events.</p>
</li>
<li>
<p><strong>Distributed Object Listener</strong> for distributed object creation and destroy events.</p>
</li>
<li>
<p><strong>Migration Listener</strong> for partition migration start and complete events.</p>
</li>
<li>
<p><strong>Partition Lost Listener</strong> for partition lost events.</p>
</li>
<li>
<p><strong>Lifecycle Listener</strong> for <code>HazelcastInstance</code> lifecycle events.</p>
</li>
<li>
<p><strong>Client Listener</strong> for client connection events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For distributed object events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Entry Listener</strong> for <code>IMap</code> and <code>MultiMap</code> entry events.</p>
</li>
<li>
<p><strong>Item Listener</strong> for <code>IQueue</code>, <code>ISet</code> and <code>IList</code> item events.</p>
</li>
<li>
<p><strong>Message Listener</strong> for <code>ITopic</code> message events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Hazelcast JCache implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Cache Entry Listener</strong>, please see <a href="#cacheentrylistener">CacheEntryListener</a>.</p>
</li>
<li>
<p><strong>Cache Partition Lost Listener</strong>, please see <a href="#icache-partition-lost-listener">ICache Partition Lost Listener</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For Hazelcast clients:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Lifecycle Listener</strong></p>
</li>
<li>
<p><strong>Membership Listener</strong></p>
</li>
<li>
<p><strong>Distributed Object Listener</strong></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="cluster-events"><a class="anchor" href="#cluster-events"></a><a class="link" href="#cluster-events">8.1. Cluster Events</a></h3>
<div class="sect3">
<h4 id="listening-for-member-events"><a class="anchor" href="#listening-for-member-events"></a><a class="link" href="#listening-for-member-events">8.1.1. Listening for Member Events</a></h4>
<div class="paragraph">
<p>The Membership Listener interface has methods that are invoked for the following events.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>memberAdded</code>: A new member is added to the cluster.</p>
</li>
<li>
<p><code>memberRemoved</code>: An existing member leaves the cluster.</p>
</li>
<li>
<p><code>memberAttributeChanged</code>: An attribute of a member is changed. Please refer to <a href="#defining-member-attributes">Defining Member Attributes</a> to learn about member attributes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To write a Membership Listener class, you implement the MembershipListener interface and its methods.</p>
</div>
<div class="paragraph">
<p>The following is an example Membership Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_events.adoc - include::{javasource}/distributedevents/ClusterMembershipListener.java[tag=cml]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a respective event is fired, the membership listener outputs the addresses of the members that joined and left, and also which attribute changed on which member.</p>
</div>
<div class="sect4">
<h5 id="registering-membership-listeners"><a class="anchor" href="#registering-membership-listeners"></a><a class="link" href="#registering-membership-listeners">Registering Membership Listeners</a></h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to include the membership listener. Below is an example using the method <code>addMembershipListener</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
hazelcastInstance.getCluster().addMembershipListener( <span class="keyword">new</span> ClusterMembershipListener() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events between the creation of the instance and registering the listener. To overcome this race condition, Hazelcast allows you to register listeners in the configuration. You can register listeners using declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
config.addListenerConfig(
<span class="keyword">new</span> ListenerConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.ClusterMembershipListener</span><span class="delimiter">&quot;</span></span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
   ...
   <span class="tag">&lt;listeners&gt;</span>
      <span class="tag">&lt;listener&gt;</span>
         com.yourpackage.ClusterMembershipListener
      <span class="tag">&lt;/listener&gt;</span>
   <span class="tag">&lt;/listeners&gt;</span>
   ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:listeners&gt;</span>
 <span class="tag">&lt;hz:listener</span> <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.ClusterMembershipListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
 <span class="tag">&lt;hz:listener</span> <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MembershipListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/hz:listeners&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-distributed-object-events"><a class="anchor" href="#listening-for-distributed-object-events"></a><a class="link" href="#listening-for-distributed-object-events">8.1.2. Listening for Distributed Object Events</a></h4>
<div class="paragraph">
<p>The Distributed Object Listener methods <code>distributedObjectCreated</code> and <code>distributedObjectDestroyed</code> are invoked when a distributed object is created and destroyed throughout the cluster. To write a Distributed Object Listener class, you implement the DistributedObjectListener interface and its methods.</p>
</div>
<div class="paragraph">
<p>The following is an example Distributed Object Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_events.adoc - include::{javasource}/distributedevents/SampleDistObjListener.java[tag=distobjlistener]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a respective event is fired, the distributed object listener outputs the event type, the object name and a service name (for example, for a Map object the service name is <code>"hz:impl:mapService"</code>).</p>
</div>
<div class="sect4">
<h5 id="registering-distributed-object-listeners"><a class="anchor" href="#registering-distributed-object-listeners"></a><a class="link" href="#registering-distributed-object-listeners">Registering Distributed Object Listeners</a></h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to include distributed object listeners. Below is an example using the method <code>addDistributedObjectListener</code>. You can also see this portion in the above class creation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
SampleDistObjListener sample = <span class="keyword">new</span> SampleDistObjListener();

hazelcastInstance.addDistributedObjectListener( sample );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events between the creation of the instance and registering the listener. To overcome this race condition, Hazelcast allows you to register the listeners in the configuration. You can register listeners using declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">config.addListenerConfig(
<span class="keyword">new</span> ListenerConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.SampleDistObjListener</span><span class="delimiter">&quot;</span></span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
   ...
   <span class="tag">&lt;listeners&gt;</span>
      <span class="tag">&lt;listener&gt;</span>
         com.yourpackage.SampleDistObjListener
      <span class="tag">&lt;/listener&gt;</span>
   <span class="tag">&lt;/listeners&gt;</span>
   ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:listeners&gt;</span>
   <span class="tag">&lt;hz:listener</span> <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.SampleDistObjListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;hz:listener</span> <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DistributedObjectListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/hz:listeners&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-migration-events"><a class="anchor" href="#listening-for-migration-events"></a><a class="link" href="#listening-for-migration-events">8.1.3. Listening for Migration Events</a></h4>
<div class="paragraph">
<p>The Migration Listener interface has methods that are invoked for the following events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>migrationStarted</code>: A partition migration is started.</p>
</li>
<li>
<p><code>migrationCompleted</code>: A partition migration is completed.</p>
</li>
<li>
<p><code>migrationFailed</code>: A partition migration failed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To write a Migration Listener class, you implement the MigrationListener interface and its methods.</p>
</div>
<div class="paragraph">
<p>The following is an example Migration Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_events.adoc - include::{javasource}/distributedevents/ClusterMigrationListener.java[tag=clstrmigrationlistener]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a respective event is fired, the migration listener outputs the partition ID, status of the migration, the old member and the new member. The following is an example output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Started: MigrationEvent{partitionId=<span class="integer">98</span>, oldOwner=<span class="predefined-type">Member</span> [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5701</span>,
newOwner=<span class="predefined-type">Member</span> [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5702</span> <span class="local-variable">this</span>}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="registering-migration-listeners"><a class="anchor" href="#registering-migration-listeners"></a><a class="link" href="#registering-migration-listeners">Registering Migration Listeners</a></h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to include migration listeners. Below is an example using the method <code>addMigrationListener</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();

PartitionService partitionService = hazelcastInstance.getPartitionService();
partitionService.addMigrationListener( <span class="keyword">new</span> ClusterMigrationListener() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events between the creation of the instance and registering the listener. To overcome this race condition, Hazelcast allows you to register the listeners in the configuration. You can register listeners using declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">config.addListenerConfig(
<span class="keyword">new</span> ListenerConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.ClusterMigrationListener</span><span class="delimiter">&quot;</span></span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
   ...
   <span class="tag">&lt;listeners&gt;</span>
      <span class="tag">&lt;listener&gt;</span>
         com.yourpackage.ClusterMigrationListener
      <span class="tag">&lt;/listener&gt;</span>
   <span class="tag">&lt;/listeners&gt;</span>
   ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:listeners&gt;</span>
   <span class="tag">&lt;hz:listener</span> <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.ClusterMigrationListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;hz:listener</span> <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MigrationListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/hz:listeners&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-partition-lost-events"><a class="anchor" href="#listening-for-partition-lost-events"></a><a class="link" href="#listening-for-partition-lost-events">8.1.4. Listening for Partition Lost Events</a></h4>
<div class="paragraph">
<p>Hazelcast provides fault-tolerance by keeping multiple copies of your data. For each partition, one of your cluster members becomes the owner and some of the other members become replica members, based on your configuration. Nevertheless, data loss may occur if a few members crash simultaneously.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following example with three members: N1, N2, N3 for a given partition-0. N1 is owner of partition-0. N2 and N3 are the first and second replicas respectively. If N1 and N2 crash simultaneously, partition-0 loses its data that is configured with less than two backups.
For instance, if we configure a map with one backup, that map loses its data in partition-0 since both owner and first replica of partition-0 have crashed. However, if we configure our map with two backups, it does not lose any data since a copy of partition-0&#8217;s data for the given map
also resides in N3.</p>
</div>
<div class="paragraph">
<p>The Partition Lost Listener notifies for possible data loss occurrences with the information of how many replicas are lost for a partition. It listens to <code>PartitionLostEvent</code> instances. Partition lost events are dispatched per partition.</p>
</div>
<div class="paragraph">
<p>Partition loss detection is done after a member crash is detected by the other members and the crashed member is removed from the cluster. Please note that false-positive <code>PartitionLostEvent</code> instances may be fired on the network split errors.</p>
</div>
<div class="sect4">
<h5 id="writing-a-partition-lost-listener-class"><a class="anchor" href="#writing-a-partition-lost-listener-class"></a><a class="link" href="#writing-a-partition-lost-listener-class">Writing a Partition Lost Listener Class</a></h5>
<div class="paragraph">
<p>To write a Partition Lost Listener, you implement the PartitionLostListener interface and its <code>partitionLost</code> method, which is invoked when a partition loses its owner and all backups.</p>
</div>
<div class="paragraph">
<p>The following is an example Partition Lost Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ConsoleLoggingPartitionLostListener</span> <span class="directive">implements</span> PartitionLostListener {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> partitionLost(PartitionLostEvent event) {
        <span class="predefined-type">System</span>.out.println(event);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a <code>PartitionLostEvent</code> is fired, the partition lost listener given above outputs the partition ID, the replica index that is lost and the member that has detected the partition loss. The following is an example output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">com.hazelcast.partition.PartitionLostEvent{partitionId=<span class="integer">242</span>, lostBackupCount=<span class="integer">0</span>,
eventSource=Address[<span class="float">192.168</span><span class="float">.2</span><span class="float">.49</span>]:<span class="integer">5701</span>}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="registering-partition-lost-listeners"><a class="anchor" href="#registering-partition-lost-listeners"></a><a class="link" href="#registering-partition-lost-listeners">Registering Partition Lost Listeners</a></h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster programmatically or declaratively to include the partition lost listener. Below is an example of its programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
hazelcastInstance.getPartitionService().addPartitionLostListener( <span class="keyword">new</span> ConsoleLoggingPartitionLostListener() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
   ...
   <span class="tag">&lt;listeners&gt;</span>
      <span class="tag">&lt;listener&gt;</span>
         com.yourpackage.ConsoleLoggingPartitionLostListener
      <span class="tag">&lt;/listener&gt;</span>
   <span class="tag">&lt;/listeners&gt;</span>
   ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-lifecycle-events"><a class="anchor" href="#listening-for-lifecycle-events"></a><a class="link" href="#listening-for-lifecycle-events">8.1.5. Listening for Lifecycle Events</a></h4>
<div class="paragraph">
<p>The Lifecycle Listener notifies for the following events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>STARTING</code>: A member is starting.</p>
</li>
<li>
<p><code>STARTED</code>: A member started.</p>
</li>
<li>
<p><code>SHUTTING_DOWN</code>: A member is shutting down.</p>
</li>
<li>
<p><code>SHUTDOWN</code>: A member&#8217;s shutdown has completed.</p>
</li>
<li>
<p><code>MERGING</code>: A member is merging with the cluster.</p>
</li>
<li>
<p><code>MERGED</code>: A member&#8217;s merge operation has completed.</p>
</li>
<li>
<p><code>CLIENT_CONNECTED</code>: A Hazelcast Client connected to the cluster.</p>
</li>
<li>
<p><code>CLIENT_DISCONNECTED</code>: A Hazelcast Client disconnected from the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example Lifecycle Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">NodeLifecycleListener</span> <span class="directive">implements</span> LifecycleListener {
     <span class="annotation">@Override</span>
     <span class="directive">public</span> <span class="type">void</span> stateChanged(LifecycleEvent event) {
         <span class="predefined-type">System</span>.err.println(event);
     }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This listener is local to an individual member. It notifies the application that uses Hazelcast about the events mentioned above for a particular member.</p>
</div>
<div class="sect4">
<h5 id="registering-lifecycle-listeners"><a class="anchor" href="#registering-lifecycle-listeners"></a><a class="link" href="#registering-lifecycle-listeners">Registering Lifecycle Listeners</a></h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to include lifecycle listeners. Below is an example using the method <code>addLifecycleListener</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
hazelcastInstance.getLifecycleService().addLifecycleListener( <span class="keyword">new</span> NodeLifecycleListener() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events between the creation of the instance and registering the listener. To overcome this race condition, Hazelcast allows you to register the listeners in the configuration. You can register listeners using declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">config.addListenerConfig(
    <span class="keyword">new</span> ListenerConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.NodeLifecycleListener</span><span class="delimiter">&quot;</span></span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
   ...
   <span class="tag">&lt;listeners&gt;</span>
      <span class="tag">&lt;listener&gt;</span>
         com.yourpackage.NodeLifecycleListener
      <span class="tag">&lt;/listener&gt;</span>
   <span class="tag">&lt;/listeners&gt;</span>
   ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:listeners&gt;</span>
   <span class="tag">&lt;hz:listener</span> <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.NodeLifecycleListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;hz:listener</span> <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LifecycleListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/hz:listeners&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-clients"><a class="anchor" href="#listening-for-clients"></a><a class="link" href="#listening-for-clients">8.1.6. Listening for Clients</a></h4>
<div class="paragraph">
<p>The Client Listener is used by the Hazelcast cluster members. It notifies the cluster members when a client is connected to or disconnected from the cluster.</p>
</div>
<div class="paragraph">
<p>To write a client listener class, you implement the <code>ClientListener</code> interface and its methods <code>clientConnected</code> and <code>clientDisconnected</code>,
which are invoked when a client is connected to or disconnected from the cluster. You can add your client listener as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">hazelcastInstance.getClientService().addClientListener(<span class="keyword">new</span> SampleClientListener());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is the equivalent declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;listeners&gt;</span>
   <span class="tag">&lt;listener&gt;</span>
      com.yourpackage.SampleClientListener
   <span class="tag">&lt;/listener&gt;</span>
<span class="tag">&lt;/listeners&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is the equivalent configuration in the Spring context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:listeners&gt;</span>
   <span class="tag">&lt;hz:listener</span> <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.SampleClientListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;hz:listener</span> <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.SampleClientListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/hz:listeners&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also add event listeners to a Hazelcast client. Please refer to <a href="#configuring-client-listeners">Client Listenerconfig</a> for the related information.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="distributed-object-events"><a class="anchor" href="#distributed-object-events"></a><a class="link" href="#distributed-object-events">8.2. Distributed Object Events</a></h3>
<div class="sect3">
<h4 id="listening-for-map-events"><a class="anchor" href="#listening-for-map-events"></a><a class="link" href="#listening-for-map-events">8.2.1. Listening for Map Events</a></h4>
<div class="paragraph">
<p>You can listen to map-wide or entry-based events using the listeners provided by the Hazelcast&#8217;s eventing framework. To listen to these events, implement a <code>MapListener</code> sub-interface.</p>
</div>
<div class="paragraph">
<p>A map-wide event is fired as a result of a map-wide operation. For
example, <code>IMap.clear()</code> or <code>IMap.evictAll()</code>.
An entry-based event is fired after the operations that affect a
specific entry. For example, <code>IMap.remove()</code> or <code>IMap.evict()</code>.</p>
</div>
<div class="sect4">
<h5 id="catching-a-map-event"><a class="anchor" href="#catching-a-map-event"></a><a class="link" href="#catching-a-map-event">Catching a Map Event</a></h5>
<div class="paragraph">
<p>To catch an event, you should explicitly
implement a corresponding sub-interface of a <code>MapListener</code>,
such as <code>EntryAddedListener</code> or <code>MapClearedListener</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>EntryListener</code> interface still can be implemented (we kept
it for backward compatibility reasons). However, if you need to listen to a
different event, one that is not available in the <code>EntryListener</code> interface, you should also
implement a relevant <code>MapListener</code> sub-interface.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at the following class example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_events.adoc - include::{javasource}/distributedevents/Listen.java[tag=listen]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s perform some modifications on the map entries using the following example code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_events.adoc - include::{javasource}/distributedevents/ModifyMap.java[tag=modify]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you execute the <code>Listen</code> class and then the <code>Modify</code> class, you get the following output
produced by the <code>Listen</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Entry Added:EntryEvent{entryEventType=ADDED, member=<span class="predefined-type">Member</span> [<span class="float">192.168</span><span class="float">.1</span><span class="float">.100</span>]]:<span class="integer">5702</span>
 - ffedb655-bbad-<span class="integer">43</span>ea-aee8-d429d37ce528, name=<span class="string"><span class="delimiter">'</span><span class="content">somemap</span><span class="delimiter">'</span></span>, key=<span class="integer">11455268066242</span>,
 oldValue=<span class="predefined-constant">null</span>, value=<span class="integer">1</span>, mergingValue=<span class="predefined-constant">null</span>}

Entry Updated:EntryEvent{entryEventType=UPDATED, member=<span class="predefined-type">Member</span> [<span class="float">192.168</span><span class="float">.1</span><span class="float">.100</span>]]:<span class="integer">5702</span>
 - ffedb655-bbad-<span class="integer">43</span>ea-aee8-d429d37ce528, name=<span class="string"><span class="delimiter">'</span><span class="content">somemap</span><span class="delimiter">'</span></span>, key=<span class="integer">11455268066242</span>,
 oldValue=<span class="integer">1</span>, value=<span class="integer">2</span>, mergingValue=<span class="predefined-constant">null</span>}

Entry Removed:EntryEvent{entryEventType=REMOVED, member=<span class="predefined-type">Member</span> [<span class="float">192.168</span><span class="float">.1</span><span class="float">.100</span>]]:<span class="integer">5702</span>
 - ffedb655-bbad-<span class="integer">43</span>ea-aee8-d429d37ce528, name=<span class="string"><span class="delimiter">'</span><span class="content">somemap</span><span class="delimiter">'</span></span>, key=<span class="integer">11455268066242</span>,
 oldValue=<span class="predefined-constant">null</span>, value=<span class="predefined-constant">null</span>, mergingValue=<span class="predefined-constant">null</span>}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note that the method <code>IMap.clear()</code> does not fire an "EntryRemoved" event, but fires a "MapCleared" event.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Listeners have to offload all blocking operations to another thread (pool).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-lost-map-partitions"><a class="anchor" href="#listening-for-lost-map-partitions"></a><a class="link" href="#listening-for-lost-map-partitions">8.2.2. Listening for Lost Map Partitions</a></h4>
<div class="paragraph">
<p>You can listen to <code>MapPartitionLostEvent</code> instances by registering an implementation
of <code>MapPartitionLostListener</code>, which is also a sub-interface of <code>MapListener</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following example code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_events.adoc - include::{javasource}/distributedevents/ListenMapPartitionLostEvents.java[tag=lmple]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within this example code, a <code>MapPartitionLostListener</code> implementation is registered to a map
that is configured with one backup. For this particular map and any of the partitions in the
system, if the partition owner member and its first backup member crash simultaneously, the
given <code>MapPartitionLostListener</code> receives a
corresponding <code>MapPartitionLostEvent</code>. If only a single member crashes in the cluster,
there will be no <code>MapPartitionLostEvent</code> fired for this map since backups for the partitions
owned by the crashed member are kept on other members.</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="#listening-for-partition-lost-events">Listening for Partition Lost Events</a> for more
information about partition lost detection and partition lost events.</p>
</div>
<div class="sect4">
<h5 id="registering-map-listeners"><a class="anchor" href="#registering-map-listeners"></a><a class="link" href="#registering-map-listeners">Registering Map Listeners</a></h5>
<div class="paragraph">
<p>After you create your listener class, you can configure your cluster to include map listeners using the method <code>addEntryListener</code> (as you can see in the example <code>Listen</code> class above). Below is the related portion from this code, showing how to register a map listener.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hz = Hazelcast.newHazelcastInstance();
IMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; map = hz.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">somemap</span><span class="delimiter">&quot;</span></span> );
map.addEntryListener( <span class="keyword">new</span> MyEntryListener(), <span class="predefined-constant">true</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events between the creation of the instance and registering the listener. To overcome this race condition, Hazelcast allows you to register listeners in configuration. You can register listeners using declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mapConfig.addEntryListenerConfig(
<span class="keyword">new</span> EntryListenerConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.MyEntryListener</span><span class="delimiter">&quot;</span></span>,
                                 <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
   ...
   <span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">somemap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      ...
      <span class="tag">&lt;entry-listeners&gt;</span>
         <span class="tag">&lt;entry-listener</span> <span class="attribute-name">include-value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">local</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            com.yourpackage.MyEntryListener
         <span class="tag">&lt;/entry-listener&gt;</span>
      <span class="tag">&lt;/entry-listeners&gt;</span>
   <span class="tag">&lt;/map&gt;</span>
   ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">somemap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;hz:entry-listeners&gt;</span>
      <span class="tag">&lt;hz:entry-listener</span> <span class="attribute-name">include-value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.spring.DummyEntryListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;hz:entry-listener</span> <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dummyEntryListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">local</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/hz:entry-listeners&gt;</span>
<span class="tag">&lt;/hz:map&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="map-listener-attributes"><a class="anchor" href="#map-listener-attributes"></a><a class="link" href="#map-listener-attributes">Map Listener Attributes</a></h5>
<div class="paragraph">
<p>As you see, there are attributes of the map listeners in the above examples: <code>include-value</code> and <code>local</code>. The attribute <code>include-value</code> is a boolean attribute that is optional, and if you set it to <code>true</code>, the map event will contain the map value. Its default value is <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The attribute <code>local</code> is also a boolean attribute that is optional, and if you set it to <code>true</code>, you can listen to the map on the local member. Its default value is <code>false</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-multimap-events"><a class="anchor" href="#listening-for-multimap-events"></a><a class="link" href="#listening-for-multimap-events">8.2.3. Listening for MultiMap Events</a></h4>
<div class="paragraph">
<p>You can listen to entry-based events in the MultiMap using <code>EntryListener</code>. The following is an example entry listener implementation for MultiMap.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_events.adoc - include::{javasource}/distributedevents/SampleEntryListener.java[tag=mm]</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="registering-multimap-listeners"><a class="anchor" href="#registering-multimap-listeners"></a><a class="link" href="#registering-multimap-listeners">Registering MultiMap Listeners</a></h5>
<div class="paragraph">
<p>After you create your listener class, you can configure your cluster to include MultiMap listeners using the method <code>addEntryListener</code>. Below is the related portion from a code, showing how to register a map listener.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hz = Hazelcast.newHazelcastInstance();
MultiMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; map = hz.getMultiMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">somemap</span><span class="delimiter">&quot;</span></span> );
map.addEntryListener( <span class="keyword">new</span> SampleEntryListener(), <span class="predefined-constant">true</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events between the creation of the instance and registering the listener. To overcome this race condition, Hazelcast allows you to register listeners in the configuration. You can register listeners using declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">multiMapConfig.addEntryListenerConfig(
  new EntryListenerConfig( &quot;com.yourpackage.SampleEntryListener&quot;,
    false, false ) );
[source,xml]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
   ...
   <span class="tag">&lt;multimap</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">somemap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;value-collection-type&gt;</span>SET<span class="tag">&lt;/value-collection-type&gt;</span>
      <span class="tag">&lt;entry-listeners&gt;</span>
         <span class="tag">&lt;entry-listener</span> <span class="attribute-name">include-value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">local</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            com.yourpackage.SampleEntryListener
         <span class="tag">&lt;/entry-listener&gt;</span>
      <span class="tag">&lt;/entry-listeners&gt;</span>
   <span class="tag">&lt;/multimap&gt;</span>
   ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:multimap</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">somemap</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-collection-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SET</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;hz:entry-listeners&gt;</span>
      <span class="tag">&lt;hz:entry-listener</span> <span class="attribute-name">include-value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.SampleEntryListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;hz:entry-listener</span> <span class="attribute-name">implementation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EntryListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">local</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/hz:entry-listeners&gt;</span>
<span class="tag">&lt;/hz:multimap&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="multimap-listener-attributes"><a class="anchor" href="#multimap-listener-attributes"></a><a class="link" href="#multimap-listener-attributes">MultiMap Listener Attributes</a></h5>
<div class="paragraph">
<p>As you see, there are attributes of the MultiMap listeners in the above examples: <code>include-value</code> and <code>local</code>. The attribute <code>include-value</code> is a boolean attribute that is optional, and if you set it to <code>true</code>, the MultiMap event will contain the map value. Its default value is <code>true</code>.</p>
</div>
<div class="paragraph">
<p>The attribute <code>local</code> is also a boolean attribute that is optional, and if you set it to <code>true</code>, you can listen to the MultiMap on the local member. Its default value is <code>false</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-item-events"><a class="anchor" href="#listening-for-item-events"></a><a class="link" href="#listening-for-item-events">8.2.4. Listening for Item Events</a></h4>
<div class="paragraph">
<p>The Item Listener is used by the Hazelcast <code>IQueue</code>, <code>ISet</code> and <code>IList</code> interfaces.</p>
</div>
<div class="paragraph">
<p>To write an Item Listener class, you implement the ItemListener interface and its methods <code>itemAdded</code> and <code>itemRemoved</code>. These methods
are invoked when an item is added or removed.</p>
</div>
<div class="paragraph">
<p>The following is an example Item Listener class for an <code>ISet</code> structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SampleItemListener</span> <span class="directive">implements</span> <span class="predefined-type">ItemListener</span>&lt;Price&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> itemAdded(<span class="predefined-type">ItemEvent</span>&lt;Price&gt; event) {
        <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">Item added:  </span><span class="delimiter">&quot;</span></span> + event );
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> itemRemoved(<span class="predefined-type">ItemEvent</span>&lt;Price&gt; event) {
        <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">Item removed: </span><span class="delimiter">&quot;</span></span> + event );
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use <code>ICollection</code> when creating any of the collection (queue, set and list) data structures, as shown above. You can also use <code>IQueue</code>, <code>ISet</code> or <code>IList</code> instead of <code>ICollection</code>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="registering-item-listeners"><a class="anchor" href="#registering-item-listeners"></a><a class="link" href="#registering-item-listeners">Registering Item Listeners</a></h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to include item listeners. Below is an example using the method <code>addItemListener</code> for <code>ISet</code> (it applies also to <code>IQueue</code> and <code>IList</code>). You can also see this portion in the above class creation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();

ICollection&lt;Price&gt; set = hazelcastInstance.getSet( <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> );
<span class="comment">// or ISet&lt;Prices&gt; set = hazelcastInstance.getSet( &quot;default&quot; );</span>
set.addItemListener( <span class="keyword">new</span> SampleItemListener(), <span class="predefined-constant">true</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing events between the creation of the instance and registering the listener. To overcome this race condition, Hazelcast allows you to register listeners in the configuration. You can register listeners using declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">setConfig.addItemListenerConfig(
<span class="keyword">new</span> ItemListenerConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.SampleItemListener</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  <span class="tag">&lt;set&gt;</span>
    <span class="tag">&lt;item-listeners&gt;</span>
      <span class="tag">&lt;item-listener</span> <span class="attribute-name">include-value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        com.yourpackage.SampleItemListener
      <span class="tag">&lt;/item-listener&gt;</span>
    <span class="tag">&lt;/item-listeners&gt;</span>
  <span class="tag">&lt;/set&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:set</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
  <span class="tag">&lt;hz:item-listeners&gt;</span>
    <span class="tag">&lt;hz:item-listener</span> <span class="attribute-name">include-value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.SampleItemListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/hz:item-listeners&gt;</span>
<span class="tag">&lt;/hz:set&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="item-listener-attributes"><a class="anchor" href="#item-listener-attributes"></a><a class="link" href="#item-listener-attributes">Item Listener Attributes</a></h5>
<div class="paragraph">
<p>As you see, there is an attribute in the above examples: <code>include-value</code>. It is a boolean attribute that is optional, and if you set it to <code>true</code>, the item event will contain the item value. Its default value is <code>true</code>.</p>
</div>
<div class="paragraph">
<p>There is also another attribute called <code>local</code>, which is not shown in the above examples. It is also a boolean attribute that is optional, and if you set it to <code>true</code>, you can listen to the items on the local member. Its default value is <code>false</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="listening-for-topic-messages"><a class="anchor" href="#listening-for-topic-messages"></a><a class="link" href="#listening-for-topic-messages">8.2.5. Listening for Topic Messages</a></h4>
<div class="paragraph">
<p>The Message Listener is used by the <code>ITopic</code> interface. It notifies when a message is received for the registered topic.</p>
</div>
<div class="paragraph">
<p>To write a Message Listener class, you implement the MessageListener interface and its method <code>onMessage</code>, which is invoked
when a message is received for the registered topic.</p>
</div>
<div class="paragraph">
<p>The following is an example Message Listener class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SampleMessageListener</span> <span class="directive">implements</span> MessageListener&lt;MyEvent&gt; {

    <span class="directive">public</span> <span class="type">void</span> onMessage( Message&lt;MyEvent&gt; message ) {
        MyEvent myEvent = message.getMessageObject();
        <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">Message received = </span><span class="delimiter">&quot;</span></span> + myEvent.toString() );
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="registering-message-listeners"><a class="anchor" href="#registering-message-listeners"></a><a class="link" href="#registering-message-listeners">Registering Message Listeners</a></h5>
<div class="paragraph">
<p>After you create your class, you can configure your cluster to include message listeners. Below is an example using the method <code>addMessageListener</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();

ITopic topic = hazelcastInstance.getTopic( <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> );
topic.addMessageListener( <span class="keyword">new</span> SampleMessageListener() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above approach, there is the possibility of missing messaging events between the creation of the instance and registering the listener. To overcome this race condition, Hazelcast allows you to register this listener in the configuration. You can register it using declarative, programmatic, or Spring configuration, as shown below.</p>
</div>
<div class="paragraph">
<p>The following is an example programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">topicConfig.addMessageListenerConfig(
  <span class="keyword">new</span> ListenerConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.SampleMessageListener</span><span class="delimiter">&quot;</span></span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
   ...
   <span class="tag">&lt;topic</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;message-listeners&gt;</span>
         <span class="tag">&lt;message-listener&gt;</span>
            com.yourpackage.SampleMessageListener
         <span class="tag">&lt;/message-listener&gt;</span>
      <span class="tag">&lt;/message-listeners&gt;</span>
   <span class="tag">&lt;/topic&gt;</span>
   ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example of the equivalent Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:topic</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;hz:message-listeners&gt;</span>
    <span class="tag">&lt;hz:message-listener</span>
      <span class="attribute-name">class-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.yourpackage.SampleMessageListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/hz:message-listeners&gt;</span>
<span class="tag">&lt;/hz:topic&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="event-listeners-for-hazelcast-clients"><a class="anchor" href="#event-listeners-for-hazelcast-clients"></a><a class="link" href="#event-listeners-for-hazelcast-clients">8.3. Event Listeners for Hazelcast Clients</a></h3>
<div class="paragraph">
<p>You can add event listeners to a Hazelcast Java client. You can configure the following listeners to listen to the events on the client side. Please see the respective sections under the <a href="#cluster-events">Cluster Events section</a> for example codes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#listening-for-lifecycle-events">Lifecycle Listener</a>: Notifies when the client is starting, started, shutting down and shutdown.</p>
</li>
<li>
<p><a href="#listening-for-member-events">Membership Listener</a>: Notifies when a member joins to/leaves the cluster to which the client is connected, or when an attribute is changed in a member.</p>
</li>
<li>
<p><a href="#listening-for-distributed-object-events">DistributedObject Listener</a>: Notifies when a distributed object is created or destroyed throughout the cluster to which the client is connected.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="#configuring-client-listeners">Configuring Client Listeners section</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="global-event-configuration"><a class="anchor" href="#global-event-configuration"></a><a class="link" href="#global-event-configuration">8.4. Global Event Configuration</a></h3>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.event.queue.capacity</code>: default value is 1000000</p>
</li>
<li>
<p><code>hazelcast.event.queue.timeout.millis</code>: default value is 250</p>
</li>
<li>
<p><code>hazelcast.event.thread.count</code>: default value is 5</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A striped executor in each cluster member controls and dispatches the received events. This striped executor also guarantees the event order. For all events in Hazelcast, the order in which events are generated and the order in which they are published are guaranteed for given keys. For map and multimap, the order is preserved for the operations on the same key of the entry. For list, set, topic and queue, the order is preserved for events on that instance of the distributed data structure.</p>
</div>
<div class="paragraph">
<p>To achieve the order guarantee, you make only one thread responsible for a particular set of events (entry events of a key in a map, item events of a collection, etc.) in <code>StripedExecutor</code> (within <code>com.hazelcast.util.executor</code>).</p>
</div>
<div class="paragraph">
<p>If the event queue reaches its capacity (<code>hazelcast.event.queue.capacity</code>) and the last item cannot be put into the event queue for the period specified in <code>hazelcast.event.queue.timeout.millis</code>, these events will be dropped with a warning message, such as "EventQueue overloaded".</p>
</div>
<div class="paragraph">
<p>If event listeners perform a computation that takes a long time, the event queue can reach its maximum capacity and lose events. For map and multimap, you can configure <code>hazelcast.event.thread.count</code> to a higher value so that fewer collisions occur for keys, and therefore worker threads will not block each other in <code>StripedExecutor</code>. For list, set, topic and queue, you should offload heavy work to another thread. To preserve order guarantee, you should implement similar logic with <code>StripedExecutor</code> in the offloaded thread pool.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hazelcast-jet"><a class="anchor" href="#hazelcast-jet"></a><a class="link" href="#hazelcast-jet">9. Hazelcast Jet</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This chapter briefly describes Hazelcast Jet. For detailed information and Jet documentation, please visit <a href="https://jet.hazelcast.org/">jet.hazelcast.org</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="jet-overview"><a class="anchor" href="#jet-overview"></a><a class="link" href="#jet-overview">9.1. Overview</a></h3>
<div class="paragraph">
<p>Hazelcast Jet, built on top of the Hazelcast IMDG, is a distributed processing engine for fast stream and batch processing of large data sets. It reuses the features and services of Hazelcast IMDG, but it is a separate product with features not available in IMDG.</p>
</div>
<div class="paragraph">
<p>With Hazelcast IMDG providing storage functionality, Jet performs parallel execution in a Hazelcast Jet cluster, composed of Jet instances, to enable data-intensive applications to operate in near real-time. Jet uses green threads (threads that are scheduled by a runtime library or VM) to achieve this parallel execution.</p>
</div>
<div class="paragraph">
<p>Since Jet uses Hazelcast IMDGs discovery mechanisms, it can be used both on-premises and on the cloud environments. Hazelcast Jet typically runs on several machines that form a cluster.</p>
</div>
<div class="sect3">
<h4 id="how-you-can-use-it"><a class="anchor" href="#how-you-can-use-it"></a><a class="link" href="#how-you-can-use-it">9.1.1. How You Can Use It</a></h4>
<div class="paragraph">
<p>The Pipeline API is the primary high-level API of Hazelcast Jet for batch and stream processing. This API is easy-to-use and set-up providing you with the tools to compose batch computations from building blocks such as filters, aggregators and joiners - saving time and resource. With Pipeline API, you can build bounded and unbounded data pipelines on a variety of sources and sinks.</p>
</div>
<div class="paragraph">
<p>In addition to the Pipeline API, Jet also offers a distributed implementation of <code>java.util.stream</code>. You can express your computation over any data source Jet supports using the familiar API from the JDK 8. This distributed implementation can be used for simple transform and reduce operations on top of IMap and IList.</p>
</div>
<div class="paragraph">
<p>There is also Jet&#8217;s Core API for advanced users to build custom data sources and sinks, to have a low-level control over the data flow, to fine-tune performance and build DSLs.</p>
</div>
<div class="paragraph">
<p>Please see the <a href="https://docs.hazelcast.org/docs/jet/latest-dev/manual/index.html#work-with-jet">Work with Jet</a> section in the Hazelcast Jet Reference Manual to see a simple example.</p>
</div>
</div>
<div class="sect3">
<h4 id="where-you-can-use-it"><a class="anchor" href="#where-you-can-use-it"></a><a class="link" href="#where-you-can-use-it">9.1.2. Where You Can Use It</a></h4>
<div class="paragraph">
<p>Hazelcast Jet is appropriate for applications that require a near real-time experience such as operations in IoT architectures (house thermostats, lighting systems, etc.), in-store e-commerce systems and social media platforms. Typical use cases include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Real-time (low-latency) stream processing</p>
</li>
<li>
<p>Fast batch processing</p>
</li>
<li>
<p>Streaming analytics</p>
</li>
<li>
<p>Complex event processing</p>
</li>
<li>
<p>Implementing event sourcing and CQRS (Command Query Responsibility Segregation)</p>
</li>
<li>
<p>Internet-of-things (IoT) data ingestion, processing and storage</p>
</li>
<li>
<p>Data processing microservice architectures</p>
</li>
<li>
<p>Online trading</p>
</li>
<li>
<p>Social media platforms</p>
</li>
<li>
<p>System log events</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The aforementioned use cases require huge amounts of data to be processed in near real-time. Hazelcast Jet achieves this by processing the incoming records as soon as possible,  hence lowering the latency, and ingesting the data at high-velocity. Jet&#8217;s execution model and keeping both the computation and data storage in memory enables high application speeds.</p>
</div>
</div>
<div class="sect3">
<h4 id="data-processing-styles"><a class="anchor" href="#data-processing-styles"></a><a class="link" href="#data-processing-styles">9.1.3. Data Processing Styles</a></h4>
<div class="paragraph">
<p>The data processing is traditionally divided into batch and stream processing.</p>
</div>
<div class="paragraph">
<p>Batch data is considered as bounded, i.e., finite, and fast batch processing typically may refer to running a job on a data set which is available in a data center. You simply provide one or more pre-existing datasets and order Hazelcast Jet to mine them for the information you need.</p>
</div>
<div class="paragraph">
<p>Stream data is considered as unbounded, i.e., infinite, and infinite stream processing deals with in-flight data before it is stored. It offers lower latency; data is processed on-the-fly and you do not have to wait for the whole data set to arrive in order to run a computation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="relationship-with-hazelcast-imdg"><a class="anchor" href="#relationship-with-hazelcast-imdg"></a><a class="link" href="#relationship-with-hazelcast-imdg">9.2. Relationship with Hazelcast IMDG</a></h3>
<div class="paragraph">
<p>Hazelcast Jet leans on Hazelcast IMDG for cluster management and deployment, data partitioning and networking; all the services of IMDG are available to your Jet Jobs (units of work which are executed). A Jet instance is also a fully functional Hazelcast IMDG instance and a Jet cluster is also a Hazelcast IMDG cluster.</p>
</div>
<div class="paragraph">
<p>A Jet job is implemented as a Hazelcast IMDG proxy, similar to the other services and data structures in Hazelcast. Hazelcast operations are used for different actions that can be performed on a job. Jet can also be used with the Hazelcast Client, which uses the Hazelcast Open Binary Protocol to communicate different actions to the server instance.</p>
</div>
<div class="paragraph">
<p>In the Hazelcast Jet world, Hazelcast IMDG can be used for data ingestion prior to processing,
connecting multiple Jet jobs, enriching processed events, caching the remote data, distributing Jet-processed data and running advanced data processing tasks on top of IMDG data structures.</p>
</div>
<div class="paragraph">
<p>Hazelcast Jet can use Hazelcast IMDG&#8217;s <strong>IMap</strong>, <strong>ICache</strong> and <strong>IList</strong> on the embedded cluster as sources (data structures from which Jet reads data) and sinks (data structures to which Jet writes data). IMap and ICache are partitioned data structures distributed across the cluster and Jet members can read from these structures by having each member read just its local partitions. Hazelcast IMDG&#8217;s IList is stored on a single partition; all the data will be read on the single member that owns that partition. Please refer to <a href="https://docs.hazelcast.org/docs/jet/latest-dev/manual/index.html#connector-imdg">IMap and ICache</a> and <a href="https://docs.hazelcast.org/docs/jet/latest-dev/manual/index.html#imdg-list">IList</a> in the Hazelcast Jet Reference Manual to learn how Jet uses these IMDG data structures. In addition to these data structures, Jet can also process a stream of changes of IMap and ICache, using the <a href="#event-journal">Event Journal</a>.</p>
</div>
<div class="paragraph">
<p>You can use Hazelcast Jet with embedded Hazelcast IMDG or a remote Hazelcast IMDG cluster. Benefits of using Hazelcast Jet with embedded Hazelcast IMDG are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sharing the processing state among Jet Jobs.</p>
</li>
<li>
<p>Caching intermediate processing results.</p>
</li>
<li>
<p>Enriching processed events; cache remote data, e.g., fact tables from a database, on Jet members.</p>
</li>
<li>
<p>Running advanced data processing tasks on top of Hazelcast data structures.</p>
</li>
<li>
<p>Improving development processes by making start up of a Jet cluster simple and fast.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jet Jobs use Hazelcast IMDG connector by allowing reading and writing records to/from a remote Hazelcast IMDG instance. You can use a remote Hazelcast IMDG cluster for the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Distributing data across IMap, ICache and IList structures.</p>
</li>
<li>
<p>Sharing state or intermediate results among more Jet clusters.</p>
</li>
<li>
<p>Isolating the processing cluster (Jet) from operational data storage cluster (IMDG).</p>
</li>
<li>
<p>Publishing intermediate results, e.g., to show real-time processing stats on a dashboard.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hazelcast-imdg-computing-vs-hazelcast-jet"><a class="anchor" href="#hazelcast-imdg-computing-vs-hazelcast-jet"></a><a class="link" href="#hazelcast-imdg-computing-vs-hazelcast-jet">9.3. Hazelcast IMDG Computing vs. Hazelcast Jet</a></h3>
<div class="paragraph">
<p>As described in the <a href="#fast-aggregations">Fast-Aggregations section</a> Hazelcast IMDG has native support for aggregation operations on the contents of its distributed data structures.</p>
</div>
<div class="paragraph">
<p>Fast-Aggregations are a good fit for simple operations (count, distinct, sum, avg, min, max, etc.). However, they may not be sufficient for operations that group data by key and produce the results of size O(keyCount). The architecture of Hazelcast aggregations is not well suited to this use case, although it will still work even for moderately sized results (up to 100 MB, as a ballpark figure). Hazelcast Jet can be the preferred choice for larger sized results and whenever something more than a single aggregation step is needed. Please see the <a href="#jet-compared-with-new-aggregations">Jet Compared with New Aggregations section</a>.</p>
</div>
<div class="paragraph">
<p>Another Hazelcast IMDG computing feature is <a href="#entry-processor">Entry Processors</a>. They are used for fast mutating operations in an atomic way, in which the map entry is mutated by executing logic directly on the JVM where the data resides. And this means the network hops are reduced and atomicity is provided in a single step. Keeping this in mind, you can use Hazelcast IMDG Entry Processors when they perform bulk mutations of an IMap, where the processing function is fast and involves a single map entry per call. On the other hand, you can prefer to use Hazelcast Jet when the processing involves multiple entries (aggregations, joins, etc.), or involves multiple computing steps to be made parallel, or when the data source and sink are not a single IMap instance.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="distributed-computing"><a class="anchor" href="#distributed-computing"></a><a class="link" href="#distributed-computing">10. Distributed Computing</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains Hazelcast&#8217;s executor service, durable/scheduled executor services and entry processor implementations.</p>
</div>
<div class="sect2">
<h3 id="executor-service"><a class="anchor" href="#executor-service"></a><a class="link" href="#executor-service">10.1. Executor Service</a></h3>
<div class="paragraph">
<p>One of the coolest features of Java is the Executor framework, which allows you to asynchronously execute your tasks (logical units of work), such as database queries, complex calculations and image rendering.</p>
</div>
<div class="paragraph">
<p>The default implementation of this framework (<code>ThreadPoolExecutor</code>) is designed to run within a single JVM (cluster member). In distributed systems, this implementation is not desired since you may want a task submitted in one JVM and processed in another one. Hazelcast offers <code>IExecutorService</code> for you to use in distributed environments. It implements <code>java.util.concurrent.ExecutorService</code> to serve the applications requiring computational and data processing power.</p>
</div>
<hr>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that you may want to use <a href="https://jet.hazelcast.org/">Hazelcast Jet</a> if you want to process batch or real-time streaming data. Please see the <a href="https://jet.hazelcast.org/use-cases/fast-batch-processing/">Fast Batch Processing</a> and <a href="https://jet.hazelcast.org/use-cases/real-time-stream-processing/">Real-Time Stream Processing</a> use cases for Hazelcast Jet.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With <code>IExecutorService</code>, you can execute tasks asynchronously and perform other useful tasks. If your task execution takes longer than expected, you can cancel the task execution. Tasks should be <code>Serializable</code> since they will be distributed.</p>
</div>
<div class="paragraph">
<p>In the Java Executor framework, you implement tasks two ways: Callable or Runnable.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Callable: If you need to return a value and submit it to Executor, implement the task as <code>java.util.concurrent.Callable</code>.</p>
</li>
<li>
<p>Runnable: If you do not need to return a value, implement the task as <code>java.util.concurrent.Runnable</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that, the distributed executor service (<code>IExecutorService</code>) is intended to run processing where the data is hosted: on the server members. In general, you cannot run a Java Runnable or Callable on the clients as the clients may not be Java. Also, the clients do not host any data, so they would have to fetch what data they need from the servers potentially. If you want something to run on all or some clients connected to your cluster, you could implement this using the publish/subscribe mechanism; a payload could be sent to an <a href="#topic"><code>ITopic</code></a> with the necessary execution parameters, and clients listening can act on the message.</p>
</div>
<div class="sect3">
<h4 id="implementing-a-callable-task"><a class="anchor" href="#implementing-a-callable-task"></a><a class="link" href="#implementing-a-callable-task">10.1.1. Implementing a Callable Task</a></h4>
<div class="paragraph">
<p>In Hazelcast, when you implement a task as <code>java.util.concurrent.Callable</code> (a task that returns a value), you implement Callable and Serializable.</p>
</div>
<div class="paragraph">
<p>Below is an example of a Callable task. SumTask prints out map keys and returns the summed map values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/SumTask.java[tag=st]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example is the Echo callable below. In its call() method, it returns the local member and the input passed in. Remember that <code>instance.getCluster().getLocalMember()</code> returns the local member and <code>toString()</code> returns the member&#8217;s address (IP + port) in String form, just to see which member actually executed the code for our example. Of course, the <code>call()</code> method can do and return anything you like.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/Echo.java[tag=echo]</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="executing-a-callable-task"><a class="anchor" href="#executing-a-callable-task"></a><a class="link" href="#executing-a-callable-task">Executing a Callable Task</a></h5>
<div class="paragraph">
<p>To execute a callable task:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retrieve the Executor from <code>HazelcastInstance</code>.</p>
</li>
<li>
<p>Submit a task which returns a <code>Future</code>.</p>
</li>
<li>
<p>After executing the task, you do not have to wait for the execution to complete, you can process other things.</p>
</li>
<li>
<p>When ready, use the <code>Future</code> object to retrieve the result as shown in the code example below.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Below, the Echo task is executed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/MasterMember.java[tag=mm]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that the Echo callable in the above code sample also implements a Serializable interface, since it may be sent to another member to be processed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When a task is deserialized, HazelcastInstance needs to be accessed. To do this, the task should implement <code>HazelcastInstanceAware</code> interface. Please see the <a href="#implementing-hazelcastinstanceaware">HazelcastInstanceAware Interface section</a> for more information.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="implementing-a-runnable-task"><a class="anchor" href="#implementing-a-runnable-task"></a><a class="link" href="#implementing-a-runnable-task">10.1.2. Implementing a Runnable Task</a></h4>
<div class="paragraph">
<p>In Hazelcast, when you implement a task as <code>java.util.concurrent.runnable</code> (a task that does not return a value), you implement Runnable and Serializable.</p>
</div>
<div class="paragraph">
<p>Below is Runnable example code. It is a task that waits for some time and echoes a message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/EchoTask.java[tag=et]</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="executing-a-runnable-task"><a class="anchor" href="#executing-a-runnable-task"></a><a class="link" href="#executing-a-runnable-task">Executing a Runnable Task</a></h5>
<div class="paragraph">
<p>To execute the runnable task:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retrieve the Executor from <code>HazelcastInstance</code>.</p>
</li>
<li>
<p>Submit the tasks to the Executor.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now let&#8217;s write a class that submits and executes these echo messages. Executor is retrieved from <code>HazelcastInstance</code> and 1000 echo tasks are submitted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/RunnableMasterMember.java[tag=rmm]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="scaling-the-executor-service"><a class="anchor" href="#scaling-the-executor-service"></a><a class="link" href="#scaling-the-executor-service">10.1.3. Scaling The Executor Service</a></h4>
<div class="paragraph">
<p>You can scale the Executor service both vertically (scale up) and horizontally (scale out).</p>
</div>
<div class="paragraph">
<p>To scale up, you should improve the processing capacity of the cluster member (JVM). You can do this by increasing the <code>pool-size</code> property mentioned in <a href="#configuring-executor-service">Configuring Executor Service</a> (i.e., increasing the thread count). However, please be aware of your member&#8217;s capacity. If you think it cannot handle such an additional load caused by increasing the thread count, you may want to consider improving the member&#8217;s resources (CPU, memory, etc.). As an example, set the <code>pool-size</code> to 5 and run the above <code>MasterMember</code>. You will see that <code>EchoTask</code> is run as soon as it is produced.</p>
</div>
<div class="paragraph">
<p>To scale out, add more members instead of increasing only one member&#8217;s capacity. In reality, you may want to expand your cluster by adding more physical or virtual machines. For example, in the EchoTask example in the <a href="#implementing-a-runnable-task">Runnable section</a>, you can create another Hazelcast instance. That instance will automatically get involved in the executions started in <code>MasterMember</code> and start processing.</p>
</div>
</div>
<div class="sect3">
<h4 id="executing-code-in-the-cluster"><a class="anchor" href="#executing-code-in-the-cluster"></a><a class="link" href="#executing-code-in-the-cluster">10.1.4. Executing Code in the Cluster</a></h4>
<div class="paragraph">
<p>The distributed executor service is a distributed implementation of <code>java.util.concurrent.ExecutorService</code>. It allows you to execute your code in the cluster. In this section, the code examples are based on the <a href="#implementing-a-callable-task">Echo class above</a> (please note that the Echo class is <code>Serializable</code>). The code examples show how Hazelcast can execute your code (<code>Runnable, Callable</code>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>echoOnTheMember</code>: On a specific cluster member you choose with the <code>IExecutorService</code> <code>submitToMember</code> method.</p>
</li>
<li>
<p><code>echoOnTheMemberOwningTheKey</code>: On the member owning the key you choose with the <code>IExecutorService</code> <code>submitToKeyOwner</code> method.</p>
</li>
<li>
<p><code>echoOnSomewhere</code>: On the member Hazelcast picks with the <code>IExecutorService</code> <code>submit</code> method.</p>
</li>
<li>
<p><code>echoOnMembers</code>: On all or a subset of the cluster members with the <code>IExecutorService</code> <code>submitToMembers</code> method.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> echoOnTheMember( <span class="predefined-type">String</span> input, <span class="predefined-type">Member</span> member ) <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">String</span>&gt; task = <span class="keyword">new</span> Echo( input );
    HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
    IExecutorService executorService =
      hazelcastInstance.getExecutorService( <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> );

    <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; future = executorService.submitToMember( task, member );
    <span class="predefined-type">String</span> echoResult = future.get();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> echoOnTheMemberOwningTheKey( <span class="predefined-type">String</span> input, <span class="predefined-type">Object</span> key ) <span class="directive">throws</span> <span class="exception">Exception</span> {
    <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">String</span>&gt; task = <span class="keyword">new</span> Echo( input );
    HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
    IExecutorService executorService =
      hazelcastInstance.getExecutorService( <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> );

    <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; future = executorService.submitToKeyOwner( task, key );
    <span class="predefined-type">String</span> echoResult = future.get();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> echoOnSomewhere( <span class="predefined-type">String</span> input ) <span class="directive">throws</span> <span class="exception">Exception</span> {
    HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
    IExecutorService executorService =
      hazelcastInstance.getExecutorService( <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> );

    <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; future = executorService.submit( <span class="keyword">new</span> Echo( input ) );
    <span class="predefined-type">String</span> echoResult = future.get();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> echoOnMembers( <span class="predefined-type">String</span> input, <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Member</span>&gt; members ) <span class="directive">throws</span> <span class="exception">Exception</span> {
    HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
    IExecutorService executorService =
      hazelcastInstance.getExecutorService( <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> );

    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">Member</span>, <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt;&gt; futures = executorService
      .submitToMembers( <span class="keyword">new</span> Echo( input ), members );

    <span class="keyword">for</span> ( <span class="predefined-type">Future</span>&lt;<span class="predefined-type">String</span>&gt; future : futures.values() ) {
        <span class="predefined-type">String</span> echoResult = future.get();
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can obtain the set of cluster members via <code>HazelcastInstance.getCluster().getMembers()</code> call.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="canceling-an-executing-task"><a class="anchor" href="#canceling-an-executing-task"></a><a class="link" href="#canceling-an-executing-task">10.1.5. Canceling an Executing Task</a></h4>
<div class="paragraph">
<p>A task in the code that you execute in a cluster might take longer than expected. If you cannot stop/cancel that task, it will keep eating your resources.</p>
</div>
<div class="paragraph">
<p>To cancel a task, you can use the standard Java executor framework&#8217;s <code>cancel()</code> API. This framework encourages us to code and design for cancellations, a highly ignored part of software development.</p>
</div>
<div class="sect4">
<h5 id="example-task-to-cancel"><a class="anchor" href="#example-task-to-cancel"></a><a class="link" href="#example-task-to-cancel">Example Task to Cancel</a></h5>
<div class="paragraph">
<p>The Fibonacci callable class below calculates the Fibonacci number for a given number. In the <code>calculate</code> method, we check if the current thread is interrupted so that the code can respond to cancellations once the execution is started.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/FibonacciCallable.java[tag=fc]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-method-to-execute-and-cancel-the-task"><a class="anchor" href="#example-method-to-execute-and-cancel-the-task"></a><a class="link" href="#example-method-to-execute-and-cancel-the-task">Example Method to Execute and Cancel the Task</a></h5>
<div class="paragraph">
<p>The <code>fib()</code> method below submits the Fibonacci calculation task above for number 'n' and waits a maximum of 3 seconds for the result. If the execution does not completed in three seconds, <code>future.get()</code> will throw a <code>TimeoutException</code> and upon catching it, we cancel the execution, saving some CPU cycles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/FibonacciCallable.java[lines=<span class="integer">36</span>.<span class="float">.47</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>fib(20)</code> will probably take less than 3 seconds. However, <code>fib(50)</code> will take much longer. (This is not an example for writing better Fibonacci calculation code, but for showing how to cancel a running execution that takes too long.) The method <code>future.cancel(false)</code> can only cancel execution before it is running (executing), but <code>future.cancel(true)</code> can interrupt running executions provided that your code is able to handle the interruption. If you are willing to cancel an already running task, then your task should be designed to handle interruptions. If the <code>calculate (int n)</code> method did not have the <code>(Thread.currentThread().isInterrupted())</code> line, then you would not be able to cancel the execution after it is started.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="callback-when-task-completes"><a class="anchor" href="#callback-when-task-completes"></a><a class="link" href="#callback-when-task-completes">10.1.6. Callback When Task Completes</a></h4>
<div class="paragraph">
<p>You can use the <code>ExecutionCallback</code> offered by Hazelcast to asynchronously be notified when the execution is done.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To be notified when your task completes without an error, implement the <code>onResponse</code> method.</p>
</li>
<li>
<p>To be notified when your task completes with an error, implement the <code>onFailure</code> method.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="example-task-to-callback"><a class="anchor" href="#example-task-to-callback"></a><a class="link" href="#example-task-to-callback">Example Task to Callback</a></h5>
<div class="paragraph">
<p>Let&#8217;s use the Fibonacci series to explain this. The example code below is the calculation that will be executed. Note that it is Callable and Serializable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/Fibonacci2.java[tag=ec]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-method-to-callback-the-task"><a class="anchor" href="#example-method-to-callback-the-task"></a><a class="link" href="#example-method-to-callback-the-task">Example Method to Callback the Task</a></h5>
<div class="paragraph">
<p>The example code below submits the Fibonacci calculation to <code>ExecutionCallback</code> and prints the result asynchronously. <code>ExecutionCallback</code> has the methods <code>onResponse</code> and <code>onFailure</code>. In this example code, <code>onResponse</code> is called upon a valid response and prints the calculation result, whereas <code>onFailure</code> is called upon a failure and prints the stacktrace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/MasterMemberCallback.java[tag=mmc]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="selecting-members-for-task-execution"><a class="anchor" href="#selecting-members-for-task-execution"></a><a class="link" href="#selecting-members-for-task-execution">10.1.7. Selecting Members for Task Execution</a></h4>
<div class="paragraph">
<p>As previously mentioned, it is possible to indicate where in the Hazelcast cluster the <code>Runnable</code> or <code>Callable</code> is executed. Usually you execute these in the cluster based on the location of a key or a set of keys, or you allow Hazelcast to select a member.</p>
</div>
<div class="paragraph">
<p>If you want more control over where your code runs, use the <code>MemberSelector</code> interface. For example, you may want certain tasks to run only on certain members, or you may wish to implement some form of custom load balancing regime.  The <code>MemberSelector</code> is an interface that you can implement and then provide to the <code>IExecutorService</code> when you submit or execute.</p>
</div>
<div class="paragraph">
<p>The <code>select(Member)</code> method is called for every available member in the cluster. Implement this method to decide if the member is going to be used or not.</p>
</div>
<div class="paragraph">
<p>In a simple example shown below, we select the cluster members based on the presence of an attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyMemberSelector</span> <span class="directive">implements</span> MemberSelector {
    <span class="directive">public</span> <span class="type">boolean</span> select(<span class="predefined-type">Member</span> member) {
        <span class="keyword">return</span> <span class="predefined-type">Boolean</span>.TRUE.equals(member.getBooleanAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">my.special.executor</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>MemberSelector</code> instances provided by the <code>com.hazelcast.cluster.memberselector.MemberSelectors</code> class. For example, you can select a lite member for running a task using <code>com.hazelcast.cluster.memberselector.MemberSelectors#LITE_MEMBER_SELECTOR</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-executor-service"><a class="anchor" href="#configuring-executor-service"></a><a class="link" href="#configuring-executor-service">10.1.8. Configuring Executor Service</a></h4>
<div class="paragraph">
<p>The following are example configurations for executor service.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;executor-service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">exec</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;pool-size&gt;</span>1<span class="tag">&lt;/pool-size&gt;</span>
   <span class="tag">&lt;queue-capacity&gt;</span>10<span class="tag">&lt;/queue-capacity&gt;</span>
   <span class="tag">&lt;statistics-enabled&gt;</span>true<span class="tag">&lt;/statistics-enabled&gt;</span>
   <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/executor-service&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/ExecutorConfiguration.java[tag=execconf]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Executor service configuration has the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pool-size</code>: The number of executor threads per Member for the Executor. By default, Executor is configured to have 16 threads in the pool. You can change that with this element.</p>
</li>
<li>
<p><code>queue-capacity</code>: Executor&#8217;s task queue capacity; the number of tasks this queue can hold.</p>
</li>
<li>
<p><code>statistics-enabled</code>: You can retrieve some statistics (such as pending operations count, started operations count, completed operations count and cancelled operations count) by setting this parameter&#8217;s value to <code>true</code>. The method for retrieving the statistics is <code>getLocalExecutorStats()</code>.</p>
</li>
<li>
<p><code>quorum-ref</code>: Name of quorum configuration that you want this Executor Service to use. Please see the <a href="#split-brain-protection-for-iexecutorservice">Split-Brain Protection for IExecutorService section</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-iexecutorservice"><a class="anchor" href="#split-brain-protection-for-iexecutorservice"></a><a class="link" href="#split-brain-protection-for-iexecutorservice">10.1.9. Split-Brain Protection for IExecutorService</a></h4>
<div class="paragraph">
<p>IExecutorService can be configured to check for a minimum number of available members before applying its operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful queue operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>execute</code></p>
</li>
<li>
<p><code>executeOnAllMembers</code></p>
</li>
<li>
<p><code>executeOnKeyOwner</code></p>
</li>
<li>
<p><code>executeOnMember</code></p>
</li>
<li>
<p><code>executeOnMembers</code></p>
</li>
<li>
<p><code>shutdown</code></p>
</li>
<li>
<p><code>shutdownNow</code></p>
</li>
<li>
<p><code>submit</code></p>
</li>
<li>
<p><code>submitToAllMembers</code></p>
</li>
<li>
<p><code>submitToKeyOwner</code></p>
</li>
<li>
<p><code>submitToMember</code></p>
</li>
<li>
<p><code>submitToMembers</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for Executor Service can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/ExecutorConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;executor-service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   ...
   <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
   ...
<span class="tag">&lt;/executor-service&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="durable-executor-service"><a class="anchor" href="#durable-executor-service"></a><a class="link" href="#durable-executor-service">10.2. Durable Executor Service</a></h3>
<div class="paragraph">
<p>Hazelcast&#8217;s durable executor service is a data structure which is able to store an execution task both on the executing Hazelcast member and its backup member(s), if configured. By this way, you do not lose any tasks if a member goes down or any results if the submitter (member or client) goes down while executing the task. When using the durable executor service you can either submit or execute a task randomly or on the owner of a provided key. Note that in <a href="#executor-service">executor service</a>, you can submit or execute tasks to/on the selected member(s).</p>
</div>
<div class="paragraph">
<p>Processing of the tasks when using durable executor service involves two invocations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sending the task to primary Hazelcast member (primary partition) and to its backups, if configured, and executing the task.</p>
</li>
<li>
<p>Retrieving the result of the task.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As you may already know, Hazelcast&#8217;s executor service returns a <code>future</code> representing the task to the user. With the above two-invocations approach, it is guaranteed that the task is executed before the <code>future</code> returns and you can track the response of a submitted task with a unique ID. Hazelcast stores the task on both primary and backup members, and starts the execution also.</p>
</div>
<div class="paragraph">
<p>With the first invocation, a <a href="#ringbuffer">Ringbuffer</a> stores the task and a generated sequence for the task is returned to the caller as a result. In addition to the storing, the task is executed on the local execution service for the primary member. By this way, the task is now resilient to member failures and you are able to track the task with its ID.</p>
</div>
<div class="paragraph">
<p>After the first invocation has completed and the sequence of task is returned, second invocation starts to retrieve the result of task with that sequence. This retrieval waits in the waiting operations queue until notified, or it runs immediately if the result is already available.</p>
</div>
<div class="paragraph">
<p>When task execution is completed, Ringbuffer replaces the task with the result for the given task sequence. This replacement notifies the waiting operations queue.</p>
</div>
<div class="sect3">
<h4 id="configuring-durable-executor-service"><a class="anchor" href="#configuring-durable-executor-service"></a><a class="link" href="#configuring-durable-executor-service">10.2.1. Configuring Durable Executor Service</a></h4>
<div class="paragraph">
<p>This section presents example configurations for durable executor service along with the descriptions of its configuration elements and attributes.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;durable-executor-service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDurableExecSvc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;pool-size&gt;</span>8<span class="tag">&lt;/pool-size&gt;</span>
        <span class="tag">&lt;durability&gt;</span>1<span class="tag">&lt;/durability&gt;</span>
        <span class="tag">&lt;capacity&gt;</span>1<span class="tag">&lt;/capacity&gt;</span>
        <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/durable-executor-service&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/DurableExecutorConfiguration.java[tag=dec]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following are the descriptions of each configuration element and attribute:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Name of the executor task.</p>
</li>
<li>
<p><code>pool-size</code>: Number of executor threads per member for the executor.</p>
</li>
<li>
<p><code>durability</code>: Number of backups in the cluster for the submitted task. Its default value is 1.</p>
</li>
<li>
<p><code>capacity</code>: Executor&#8217;s task queue capacity; the number of tasks this queue can hold.</p>
</li>
<li>
<p><code>quorum-ref</code>: Name of quorum configuration that you want this Durable Executor Service to use. Please see the <a href="#split-brain-protection-for-durable-executor-service">Split-Brain Protection for Durable Executor Service section</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-durable-executor-service"><a class="anchor" href="#split-brain-protection-for-durable-executor-service"></a><a class="link" href="#split-brain-protection-for-durable-executor-service">10.2.2. Split-Brain Protection for Durable Executor Service</a></h4>
<div class="paragraph">
<p>Durable Executor Service can be configured to check for a minimum number of available members before applying its operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful queue operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>disposeResult</code></p>
</li>
<li>
<p><code>execute</code></p>
</li>
<li>
<p><code>executeOnKeyOwner</code></p>
</li>
<li>
<p><code>retrieveAndDisposeResult</code></p>
</li>
<li>
<p><code>shutdown</code></p>
</li>
<li>
<p><code>shutdownNow</code></p>
</li>
<li>
<p><code>submit</code></p>
</li>
<li>
<p><code>submitToKeyOwner</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>retrieveResult</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for Durable Executor Service can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/DurableExecutorConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;durable-executor-service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDurableExecSvc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
        <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
        ...
<span class="tag">&lt;/durable-executor-service&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="scheduled-executor-service"><a class="anchor" href="#scheduled-executor-service"></a><a class="link" href="#scheduled-executor-service">10.3. Scheduled Executor Service</a></h3>
<div class="paragraph">
<p>Hazelcast&#8217;s scheduled executor service (IScheduledExecutorService) is a data structure which implements the <code>java.util.concurrent.ScheduledExecutorService</code>, partially.
Here, partially means that it allows the scheduling of a single future execution and/or at a fixed rate execution but not at a fixed delay.</p>
</div>
<div class="paragraph">
<p>On top of the Vanilla Scheduling API, IScheduledExecutorService allows additional methods such as the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>scheduleOnMember</code>: On a specific cluster member.</p>
</li>
<li>
<p><code>scheduleOnKeyOwner</code>: On the partition owning that key.</p>
</li>
<li>
<p><code>scheduleOnAllMembers</code>: On all cluster members.</p>
</li>
<li>
<p><code>scheduleOnAllMembers</code>: On all given members.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/scheduledexecutor/IScheduledExecutorService.html">IScheduledExecutorService Javadoc</a> for its API details.</p>
</div>
<div class="paragraph">
<p>There are two different modes of durability for the service:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Upon partition specific scheduling, the future task is stored both in the primary partition and also in its N backups, N being the <code>&lt;durability&gt;</code> property in the configuration. More specifically, there are always one or more backups to take ownership of the task in the event of a lost member. If a member is lost, the task will be re-scheduled on the backup (new primary) member, which might induce further delays on the subsequent executions of the task.
For example, if we schedule a task to run in 10 seconds from now, <code>schedule(new ExampleTask(), 10, TimeUnit.SECONDS);</code> and after 5 seconds the owner member goes down (before the execution takes place), then the backup owner will re-schedule the task in 10 seconds from now. Therefore, from the user&#8217;s perspective waiting on the result, this will be available in <code>10 + 5 = 15</code> seconds rather than 10 seconds as it is anticipated originally. If <code>atFixedRate</code> was used, then only the initial delay is affected in the above scenario, all subsequent executions should adhere to the given period parameter.</p>
</li>
<li>
<p>Upon member specific scheduling, the future task is <strong>only</strong> stored in the member itself, which means that in the event of a lost member, the task will be lost as well.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To accomplish the described durability, all tasks provide a unique identity/name before the scheduling takes place. The name allows the service to reach the scheduled task even after the caller (client or member) goes down and also allows to prevent duplicate tasks.
The name of the task can be user-defined if it needs to be, by implementing the <code>com.hazelcast.scheduledexecutor.NamedTask</code> interface (plain wrapper util is available here: <code>com.hazelcast.scheduledexecutor.TaskUtils.named(java.lang.String, java.lang.Runnable)</code>). If the task does not provide a name in its implementation, the service provides a random UUID for it, internally.</p>
</div>
<div class="paragraph">
<p>Upon scheduling, the service returns an <code>IScheduledFuture</code>, which on top of the <code>java.util.concurrent.ScheduledFuture</code> functionality, provides an API to get the resource handler of the task <code>ScheduledTaskHandler</code> and also the runtime statistics of the task.</p>
</div>
<div class="paragraph">
<p>Futures associated with a scheduled task, in order to be aware of lost partitions and/or members, act as listeners on the local member/client. Therefore, they are always strongly referenced, on the member/client side. In order to clean up their resources, once completed, you can use the method <code>dispose()</code>. This method will also cancel further executions of the task if scheduled at fixed rate. You can refer to the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/scheduledexecutor/IScheduledFuture.html">IScheduledFuture Javadoc</a> for its API details.</p>
</div>
<div class="paragraph">
<p>The task handler is a descriptor class holding information for the scheduled future, which is used to pinpoint the actual task in the cluster. It contains the name of the task, the owner (member or partition) and the scheduler name.</p>
</div>
<div class="paragraph">
<p>The handler is always available after scheduling and can be stored in a plain string format <code>com.hazelcast.scheduledexecutor.ScheduledTaskHandler.toUrn()</code> and re-constructed back from that String <code>com.hazelcast.scheduledexecutor.ScheduledTaskHandler.of()</code>. If the handler is lost, you can still find a task under a given scheduler by using the Scheduler&#8217;s <code>com.hazelcast.scheduledexecutor.IScheduledExecutorService.getAllScheduledFutures()</code>.</p>
</div>
<div class="paragraph">
<p>Last but not least, similar to <a href="#executor-service">executor service</a>, the scheduled executor service allows Stateful tasks to be scheduled. Stateful tasks, are tasks that require any kind of state during their runtime, which must also be durable along with the task in the event of a lost partition.</p>
</div>
<div class="paragraph">
<p>Stateful tasks can be created by implementing the <code>com.hazelcast.scheduledexecutor.StatefulTask</code> interface, providing implementation details for saving the state and loading it back. If a partition is lost, then the re-scheduled task will load the previously saved state before its execution.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As with the tasks, Objects stored in the state Map need to be Hazelcast serializable.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuring-scheduled-executor-service"><a class="anchor" href="#configuring-scheduled-executor-service"></a><a class="link" href="#configuring-scheduled-executor-service">10.3.1. Configuring Scheduled Executor Service</a></h4>
<div class="paragraph">
<p>This section presents example configurations for scheduled executor service along with the descriptions of its configuration elements and attributes.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;scheduled-executor-service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myScheduledExecSvc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;pool-size&gt;</span>16<span class="tag">&lt;/pool-size&gt;</span>
        <span class="tag">&lt;durability&gt;</span>1<span class="tag">&lt;/durability&gt;</span>
        <span class="tag">&lt;capacity&gt;</span>100<span class="tag">&lt;/capacity&gt;</span>
        <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
<span class="tag">&lt;/scheduled-executor-service&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/ScheduledExecutorConfiguration.java[tag=sec]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following are the descriptions of each configuration element and attribute:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Name of the scheduled executor.</p>
</li>
<li>
<p><code>pool-size</code>: Number of executor threads per member for the executor.</p>
</li>
<li>
<p><code>capacity</code>: Maximum number of tasks that a scheduler can have per partition. Attempt to schedule more, will result in <code>RejectedExecutionException</code>. To free up the capacity, tasks should get disposed by the user.</p>
</li>
<li>
<p><code>durability</code>: Durability of the executor.</p>
</li>
<li>
<p><code>quorum-ref</code>: Name of quorum configuration that you want this Scheduled Executor Service to use. Please see the <a href="#split-brain-protection-for-ischeduled-executor-service">Split-Brain Protection for IScheduled Executor Service section</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="scheduled-exec-srv-examples"><a class="anchor" href="#scheduled-exec-srv-examples"></a><a class="link" href="#scheduled-exec-srv-examples">10.3.2. Examples</a></h4>
<div class="paragraph">
<p>Scheduling a callable that computes the cluster size in <code>10 seconds</code> from now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">static</span> <span class="type">class</span> <span class="class">DelayedClusterSizeTask</span> <span class="directive">implements</span> <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">Integer</span>&gt;, HazelcastInstanceAware, <span class="predefined-type">Serializable</span> {

    <span class="directive">private</span> <span class="directive">transient</span> HazelcastInstance instance;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> call()
            <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> instance.getCluster().getMembers().size();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setHazelcastInstance(HazelcastInstance hazelcastInstance) {
        <span class="local-variable">this</span>.instance = hazelcastInstance;
    }
}

HazelcastInstance hazelcast = Hazelcast.newHazelcastInstance();
IScheduledExecutorService executorService = hazelcast.getScheduledExecutorService(<span class="string"><span class="delimiter">&quot;</span><span class="content">myScheduler</span><span class="delimiter">&quot;</span></span>);
IScheduledFuture&lt;<span class="predefined-type">Integer</span>&gt; future = executorService.schedule(
        <span class="keyword">new</span> DelayedClusterSizeTask(), <span class="integer">10</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);

<span class="type">int</span> membersCount = future.get(); <span class="comment">// Block until we get the result</span>
ScheduledTaskStatistics stats = future.getStats();
future.dispose(); <span class="comment">// Always dispose futures that are not in use any more, to release resources</span>
<span class="type">long</span> totalTaskRuns = stats.getTotalRuns(); <span class="comment">// = 1</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="split-brain-protection-for-ischeduled-executor-service"><a class="anchor" href="#split-brain-protection-for-ischeduled-executor-service"></a><a class="link" href="#split-brain-protection-for-ischeduled-executor-service">10.3.3. Split-Brain Protection for IScheduled Executor Service</a></h4>
<div class="paragraph">
<p>IScheduledExecutorService can be configured to check for a minimum number of available members before applying its operations (see <a href="#split-brain-protection">Split-Brain Protection</a>). This is a check to avoid performing successful queue operations on all parts of a cluster during a network partition.</p>
</div>
<div class="paragraph">
<p>Following is a list of methods that now support Split-Brain Protection checks. The list is grouped by quorum type.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WRITE, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>schedule</code></p>
</li>
<li>
<p><code>scheduleAtFixedRate</code></p>
</li>
<li>
<p><code>scheduleOnAllMembers</code></p>
</li>
<li>
<p><code>scheduleOnAllMembersAtFixedRate</code></p>
</li>
<li>
<p><code>scheduleOnKeyOwner</code></p>
</li>
<li>
<p><code>scheduleOnKeyOwnerAtFixedRate</code></p>
</li>
<li>
<p><code>scheduleOnMember</code></p>
</li>
<li>
<p><code>scheduleOnMemberAtFixedRate</code></p>
</li>
<li>
<p><code>scheduleOnMembers</code></p>
</li>
<li>
<p><code>scheduleOnMembersAtFixedRate</code></p>
</li>
<li>
<p><code>shutdown</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>READ, READ_WRITE:</p>
<div class="ulist">
<ul>
<li>
<p><code>getAllScheduledFutures</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Split-Brain Protection</strong></p>
</div>
<div class="paragraph">
<p>Split-Brain protection for Scheduled Executor Service can be configured programmatically using the method <a href="https://docs.hazelcast.org/docs/3.10/javadoc/com/hazelcast/config/ScheduledExecutorConfig.html"><code>setQuorumName()</code></a>, or declaratively using the element <code>quorum-ref</code>. Following is an example declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;scheduled-executor-service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myScheduledExecSvc</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    ...
        <span class="tag">&lt;quorum-ref&gt;</span>quorumname<span class="tag">&lt;/quorum-ref&gt;</span>
        ...
<span class="tag">&lt;/scheduled-executor-service&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of <code>quorum-ref</code> should be the quorum configuration name which you configured under the <code>quorum</code> element as explained in the <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="entry-processor"><a class="anchor" href="#entry-processor"></a><a class="link" href="#entry-processor">10.4. Entry Processor</a></h3>
<div class="paragraph">
<p>Hazelcast supports entry processing. An entry processor is a function that executes your code on a map entry in an atomic way.</p>
</div>
<div class="paragraph">
<p>An entry processor is a good option if you perform bulk processing on an <code>IMap</code>. Usually you perform a loop of keys - executing <code>IMap.get(key)</code>, mutating the value and finally putting the entry back in the map using <code>IMap.put(key,value)</code>.  If you perform this process from a client or from a member where the keys do not exist, you effectively perform two network hops for each update: the first to retrieve the data and the second to update the mutated value.</p>
</div>
<div class="paragraph">
<p>If you are doing the process described above, you should consider using entry processors. An entry processor executes a read and updates upon the member where the data resides.  This eliminates the costly network hops described above.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Entry processor is meant to process a single entry per call. Processing multiple entries and data structures in an entry processor is not supported as it may result in deadlocks.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that Hazelcast Jet is a good fit when you want to perform processing that involves multiple entries (aggregations, joins, etc.), or involves multiple computing steps to be made parallel. Hazelcast Jet contains an Entry Processor Sink to allow you to update Hazelcast IMDG data as a result of your Hazelcast Jet computation. Please refer to <a href="https://docs.hazelcast.org/docs/jet/latest/manual/index.html#connector-imdg">Hazelcast Jet&#8217;s Reference Manual</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="performing-fast-in-memory-map-operations"><a class="anchor" href="#performing-fast-in-memory-map-operations"></a><a class="link" href="#performing-fast-in-memory-map-operations">10.4.1. Performing Fast In-Memory Map Operations</a></h4>
<div class="paragraph">
<p>An entry processor enables fast in-memory operations on your map without you having to worry about locks or concurrency issues. You can apply it to a single map entry or to all map entries. Entry processors support choosing target entries using predicates. You do not need any explicit lock on entry thanks to the isolated threading model: Hazelcast runs the entry processor for all entries on a <code>partitionThread</code> so there will NOT be any interleaving of the entry processor and other mutations.</p>
</div>
<div class="paragraph">
<p>Hazelcast sends the entry processor to each cluster member and these members apply it to map entries. Therefore, if you add more members, your processing completes faster.</p>
</div>
<div class="sect4">
<h5 id="using-indexes"><a class="anchor" href="#using-indexes"></a><a class="link" href="#using-indexes">Using Indexes</a></h5>
<div class="paragraph">
<p>Entry processors can be used with predicates. Predicates help to process a subset of data by selecting eligible entries. This selection can happen either by doing a full-table scan or by using indexes. To accelerate entry selection step, you can consider to add indexes. If indexes are there, entry processor will automatically use them.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-object-in-memory-format"><a class="anchor" href="#using-object-in-memory-format"></a><a class="link" href="#using-object-in-memory-format">Using OBJECT In-Memory Format</a></h5>
<div class="paragraph">
<p>If entry processing is the major operation for a map and if the map consists of complex objects, you should use <code>OBJECT</code> as the <code>in-memory-format</code> to minimize serialization cost. By default, the entry value is stored as a byte array (<code>BINARY</code> format). When it is stored as an object (<code>OBJECT</code> format), then the entry processor is applied directly on the object. In that case, no serialization or deserialization is performed. However, if there is a defined event listener, a new entry value will be serialized when passing to the event publisher service.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When <code>in-memory-format</code> is <code>OBJECT</code>, the old value of the updated entry will be null.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="processing-entries"><a class="anchor" href="#processing-entries"></a><a class="link" href="#processing-entries">Processing Entries</a></h5>
<div class="paragraph">
<p>The methods below are in the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/core/IMap.html">IMap interface</a> for entry processing.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>executeOnKey</code> processes an entry mapped by a key.</p>
</li>
<li>
<p><code>executeOnKeys</code> processes entries mapped by a collection of keys.</p>
</li>
<li>
<p><code>submitToKey</code> processes an entry mapped by a key while listening to event status.</p>
</li>
<li>
<p><code>executeOnEntries</code> processes all entries in a map.</p>
</li>
<li>
<p><code>executeOnEntries</code> can also process all entries in a map with a defined predicate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using the <code>executeOnEntries</code> method, if the number of entries is high and you need the results, then returning null with the <code>process()</code> method is a good practice. This method is offered by the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/map/EntryProcessor.html">EntryProcessor interface</a>. By returning null, results of the processing is not stored in the map and thus out of memory errors are eliminated.</p>
</div>
<div class="paragraph">
<p>If you want to execute a task on a single key, you can also use <code>executeOnKeyOwner</code> provided by <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/core/IExecutorService.html#executeOnKeyOwner-java.lang.Runnable-java.lang.Object-">IExecutorService</a>. However, in this case you need to perform a lock and serialization.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Entry processors run via Operation Threads that are dedicated to specific partitions.  Therefore, with long running entry processor executions, other partition operations such as <code>map.put(key)</code> cannot be processed. With this in mind, it is a good practice to make your entry processor executions as quick as possible.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="respecting-locks-on-single-keys"><a class="anchor" href="#respecting-locks-on-single-keys"></a><a class="link" href="#respecting-locks-on-single-keys">Respecting Locks on Single Keys</a></h5>
<div class="paragraph">
<p>The entry processor respects locks ONLY when its executions are performed on a single key. As explained in the above section, the entry processor has the following methods to process a single key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Object</span> executeOnKey(K key, EntryProcessor entryProcessor);
ICompletableFuture submitToKey(K key, EntryProcessor entryProcessor);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Therefore, if you want to to perform an entry processor execution on a single key using one of these methods and that key has a lock on it, the execution will wait until the lock on that key is removed.</p>
</div>
</div>
<div class="sect4">
<h5 id="processing-backup-entries"><a class="anchor" href="#processing-backup-entries"></a><a class="link" href="#processing-backup-entries">Processing Backup Entries</a></h5>
<div class="paragraph">
<p>If your code modifies the data, then you should also provide a processor for backup entries. This is required to prevent the primary map entries from having different values than the backups because it causes the entry processor to be applied both on the primary and backup entries. The interface <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/map/EntryBackupProcessor.html">EntryBackupProcessor</a> offers the method <code>processBackup</code> for this purpose.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is possible that an entry processor could see that a key exists though its backup processor may not find it at the run time due to an unsent backup of a previous operation, e.g., a previous put operation. In those situations, Hazelcast internally/eventually will synchronize those owner and backup partitions so you will not lose any data. When coding an <code>EntryBackupProcessor</code>, you should take that case into account, otherwise <code>NullPointerException</code> can be seen since <code>Map.Entry.getValue()</code> may return <code>null</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-an-entry-processor"><a class="anchor" href="#creating-an-entry-processor"></a><a class="link" href="#creating-an-entry-processor">10.4.2. Creating an Entry Processor</a></h4>
<div class="paragraph">
<p>The class <code>IncrementingEntryProcessor</code> creates an entry processor to process the map
entries. It implements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the map interfaces <code>EntryProcessor</code> and <code>EntryBackupProcessor</code>.</p>
</li>
<li>
<p><code>java.io.Serializable</code> interface.</p>
</li>
<li>
<p><code>EntryProcessor</code> methods <code>process</code> and <code>getBackupProcessor</code>.</p>
</li>
<li>
<p><code>EntryBackupProcessor</code> method <code>processBackup</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/IncrementingEntryProcessor.java[tag=iep]</code></pre>
</div>
</div>
<div class="paragraph">
<p>A sample usage is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">myMap</span><span class="delimiter">&quot;</span></span> );
<span class="keyword">for</span> ( <span class="type">int</span> i = <span class="integer">0</span>; i &lt; <span class="integer">100</span>; i++ ) {
    map.put( i, i );
}
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Object</span>&gt; res = map.executeOnEntries( <span class="keyword">new</span> IncrementingEntryProcessor() );</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You should explicitly call the <code>setValue</code> method of <code>Map.Entry</code> when modifying data in the entry processor. Otherwise, the entry processor will be accepted as read-only.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An entry processor instance is not thread safe. If you are storing a partition specific state between invocations, be sure to register this in a thread-local.  An entry processor instance can be used by multiple partition threads.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="abstract-entry-processor"><a class="anchor" href="#abstract-entry-processor"></a><a class="link" href="#abstract-entry-processor">10.4.3. Abstract Entry Processor</a></h4>
<div class="paragraph">
<p>You can use the <code>AbstractEntryProcessor</code> class when the same processing will be performed both on the primary and backup map entries, i.e., the same logic applies to them. If you use entry processor, you need to apply the same logic to the backup entries separately. The <code>AbstractEntryProcessor</code> class makes this primary/backup processing easier.</p>
</div>
<div class="paragraph">
<p>You can use the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/map/AbstractEntryProcessor.html"><code>AbstractEntryProcessor</code> class</a> to create your own abstract entry processor. The method <code>getBackupProcessor</code> in this class returns an <code>EntryBackupProcessor</code> instance. This means the same processing will be applied to both the primary and backup entries. If you want to apply the processing only upon the primary entries, make the <code>getBackupProcessor</code> method return null.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Beware of the null issue described above. Due to a yet unsent backup from a previous operation, an <code>EntryBackupProcessor</code> may temporarily receive <code>null</code> from <code>Map.Entry.getValue()</code> even though the value actually exists in the map. If you decide to use <code>AbstractEntryProcessor</code>, make sure your code logic is not sensitive to null values, or you may encounter <code>NullPointerException</code> during runtime.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="entry-processor-performance-optimizations"><a class="anchor" href="#entry-processor-performance-optimizations"></a><a class="link" href="#entry-processor-performance-optimizations">10.4.4. Entry Processor Performance Optimizations</a></h4>
<div class="paragraph">
<p>By default the entry processor executes on a partition thread. A partition thread is responsible for handling
one or more partitions. The design of entry processor assumes users have fast user code execution of the <code>process()</code> method.
In the pathological case where the code is very heavy and executes in multi-milliseconds, this may create a bottleneck.</p>
</div>
<div class="paragraph">
<p>We have a slow user code detector which can be used to log a warning controlled by the following system properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.slow.operation.detector.enabled</code> (default: true)</p>
</li>
<li>
<p><code>hazelcast.slow.operation.detector.threshold.millis</code> (default: 10000)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The defaults catch extremely slow operations but you should set this much lower, say to 1ms, at development time to catch entry processors that could be problematic in production. These are good candidates for our optimizations.</p>
</div>
<div class="paragraph">
<p>We have two optimizations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Offloadable</code> which moves execution off the partition thread to an executor thread</p>
</li>
<li>
<p><code>ReadOnly</code> which means we can avoid taking a lock on the key</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These are enabled very simply by implementing these interfaces in your <code>EntryProcessor</code>.</p>
</div>
<div class="paragraph">
<p>As of 3.9, these optimizations apply to the following IMap methods only:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>executeOnKey(Object, EntryProcessor)</code></p>
</li>
<li>
<p><code>submitToKey(Object, EntryProcessor)</code></p>
</li>
<li>
<p><code>submitToKey(Object, EntryProcessor, ExecutionCallback)</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="offloadable-entry-processor"><a class="anchor" href="#offloadable-entry-processor"></a><a class="link" href="#offloadable-entry-processor">Offloadable Entry Processor</a></h5>
<div class="paragraph">
<p>If an entry processor implements the <code>Offloadable</code> interface, the <code>process()</code> method will be executed in the executor
specified by the <code>Offloadable&#8217;s `getExecutorName()</code> method.</p>
</div>
<div class="paragraph">
<p>Offloading will unblock the partition thread allowing the user to profit from much higher throughput.
The key will be locked for the time span of the processing in order to not generate a write conflict.</p>
</div>
<div class="paragraph">
<p>In this case the threading looks as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>partition thread (fetch entry &amp; lock key)</p>
</li>
<li>
<p>execution thread (process(entry) method)</p>
</li>
<li>
<p>partition thread (set new value &amp; unlock key, or just unlock key if the entry has not been modified)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The method <code>getExecutorName()</code> method may also return two constants defined in the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/core/Offloadable.html"><code>Offloadable</code> interface</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NO_OFFLOADING: Processing will not be offloaded if the method <code>getExecutorName()</code> returns this constant; it will be executed as if it does not implement the <code>Offloadable</code> interface.</p>
</li>
<li>
<p>OFFLOADABLE_EXECUTOR: Processing will be offloaded to the default <code>ExecutionService.OFFLOADABLE_EXECUTOR</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that if the method <code>getExecutorName()</code> cannot find an executor whose name matches the one called by this method, then the default executor service is used. Here is the configuration for the "default" executor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;executor-service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;pool-size&gt;</span>16<span class="tag">&lt;/pool-size&gt;</span>
    <span class="tag">&lt;queue-capacity&gt;</span>0<span class="tag">&lt;/queue-capacity&gt;</span>
<span class="tag">&lt;/executor-service&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An example of an Offloadable called "OffloadedInventoryEntryProcessor" would be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;executor-service</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OffloadedInventoryEntryProcessor</span></span><span class="error">&gt;</span>
    <span class="tag">&lt;pool-size&gt;</span>30<span class="tag">&lt;/pool-size&gt;</span>
    <span class="tag">&lt;queue-capacity&gt;</span>0<span class="tag">&lt;/queue-capacity&gt;</span>
<span class="tag">&lt;/executor-service&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember to set the <code>pool-size</code> (count of executor threads per member) according to your execution needs. Please refer to the <a href="#configuring-executor-service">Configuring Executor Service section</a> for the configuration details.</p>
</div>
</div>
<div class="sect4">
<h5 id="readonly-entry-processor"><a class="anchor" href="#readonly-entry-processor"></a><a class="link" href="#readonly-entry-processor">ReadOnly Entry Processor</a></h5>
<div class="paragraph">
<p>By default, an entry processor will not run if the key is locked.
It will wait until the key has been unlocked (it applies to the <code>executeOnKey</code>, <code>submitToKey</code> methods, that were mentioned before).</p>
</div>
<div class="paragraph">
<p>If the entry processor implements the <code>ReadOnly</code> interface without implementing the <code>Offloadable</code> interface, the processing will not
be offloaded to an external executor. However, the entry processor will not observe if the key of the processed entry is
locked, nor will try to acquire the lock since the entry processor will not do any modifications.</p>
</div>
<div class="paragraph">
<p>If the entry processor implements <code>ReadOnly</code> and modifies the entry, an <code>UnsupportedOperationException</code> will be thrown.</p>
</div>
</div>
<div class="sect4">
<h5 id="readonly-and-offloadable-entry-processor"><a class="anchor" href="#readonly-and-offloadable-entry-processor"></a><a class="link" href="#readonly-and-offloadable-entry-processor">ReadOnly and Offloadable Entry Processor</a></h5>
<div class="paragraph">
<p>If the entry processor implements both <code>ReadOnly</code> and <code>Offloadable</code> interfaces, we will observe the combination of both
optimizations described above.</p>
</div>
<div class="paragraph">
<p>The <code>process()</code> method will be executed in the executor specified by the <code>Offloadable&#8217;s `getExecutorName()</code> method.
Also, the entry processor will not observe if the key of the processed entry is locked, nor will try to acquire the
lock since the entry processor will not do any modifications.</p>
</div>
<div class="paragraph">
<p>In this case the threading looks as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>partition thread (fetch entry)</p>
</li>
<li>
<p>execution thread (process(entry))</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In this case the <code>EntryProcessor.getBackupProcessor()</code> has to return null; otherwise an <code>IllegalArgumentException</code>
exception is thrown.</p>
</div>
<div class="paragraph">
<p>If the entry processor implements <code>ReadOnly</code> and modifies the entry, an <code>UnsupportedOperationException</code> will be thrown.</p>
</div>
<div class="paragraph">
<p>Putting it all together:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_computing.adoc - include::{javasource}/distributedcomputing/OffloadableReadOnlyEntryProcessor.java[tag=oroep]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="distributed-query"><a class="anchor" href="#distributed-query"></a><a class="link" href="#distributed-query">11. Distributed Query</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Distributed queries access data from multiple data sources stored on either the same or different members.</p>
</div>
<div class="paragraph">
<p>Hazelcast partitions your data and spreads it across cluster of members. You can iterate over the map entries and look for certain entries (specified by predicates) you are interested in. However, this is not very efficient because you will have to bring the entire entry set and iterate locally. Instead, Hazelcast allows you to run distributed queries on your distributed map.</p>
</div>
<div class="sect2">
<h3 id="how-distributed-query-works"><a class="anchor" href="#how-distributed-query-works"></a><a class="link" href="#how-distributed-query-works">11.1. How Distributed Query Works</a></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The requested predicate is sent to each member in the cluster.</p>
</li>
<li>
<p>Each member looks at its own local entries and filters them according to the predicate. At this stage, key/value pairs of the entries are deserialized and then passed to the predicate.</p>
</li>
<li>
<p>The predicate requester merges all the results coming from each member into a single set.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Distributed query is highly scalable. If you add new members to the cluster, the partition count for each member is reduced and thus the time spent by each member on iterating its entries is reduced. In addition, the pool of partition threads evaluates the entries concurrently in each member and the network traffic is also reduced since only filtered data is sent to the requester.</p>
</div>
<div class="paragraph">
<p>Hazelcast offers the following APIs for distributed query purposes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Criteria API</p>
</li>
<li>
<p>Distributed SQL Query</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="employee-map-query-example"><a class="anchor" href="#employee-map-query-example"></a><a class="link" href="#employee-map-query-example">11.1.1. Employee Map Query Example</a></h4>
<div class="paragraph">
<p>Assume that you have an "employee" map containing values of <code>Employee</code> objects, as coded below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> name;
    <span class="directive">private</span> <span class="type">int</span> age;
    <span class="directive">private</span> <span class="type">boolean</span> active;
    <span class="directive">private</span> <span class="type">double</span> salary;

    <span class="directive">public</span> Employee(<span class="predefined-type">String</span> name, <span class="type">int</span> age, <span class="type">boolean</span> active, <span class="type">double</span> salary) {
        <span class="local-variable">this</span>.name = name;
        <span class="local-variable">this</span>.age = age;
        <span class="local-variable">this</span>.active = active;
        <span class="local-variable">this</span>.salary = salary;
    }

    <span class="directive">public</span> Employee() {
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">int</span> getAge() {
        <span class="keyword">return</span> age;
    }

    <span class="directive">public</span> <span class="type">double</span> getSalary() {
        <span class="keyword">return</span> salary;
    }

    <span class="directive">public</span> <span class="type">boolean</span> isActive() {
        <span class="keyword">return</span> active;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s look for the employees who are active and have an age less than 30 using the aforementioned APIs (Criteria API and Distributed SQL Query). The following subsections describe each query mechanism for this example.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using Portable objects, if one field of an object exists on one member but does not exist on another one, Hazelcast does not throw an unknown field exception.
Instead, Hazelcast treats that predicate, which tries to perform a query on an unknown field, as an always false predicate.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="querying-with-criteria-api"><a class="anchor" href="#querying-with-criteria-api"></a><a class="link" href="#querying-with-criteria-api">11.1.2. Querying with Criteria API</a></h4>
<div class="paragraph">
<p>Criteria API is a programming interface offered by Hazelcast that is similar to the Java Persistence Query Language (JPQL). Below is the code
for the <a href="#employee-map-query-example">above example query</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, Employee&gt; map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">employee</span><span class="delimiter">&quot;</span></span> );

EntryObject e = <span class="keyword">new</span> PredicateBuilder().getEntryObject();
<span class="predefined-type">Predicate</span> predicate = e.is( <span class="string"><span class="delimiter">&quot;</span><span class="content">active</span><span class="delimiter">&quot;</span></span> ).and( e.get( <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> ).lessThan( <span class="integer">30</span> ) );

<span class="predefined-type">Collection</span>&lt;Employee&gt; employees = map.values( predicate );</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example code, <code>predicate</code> verifies whether the entry is active and its <code>age</code> value is less than 30. This <code>predicate</code> is
applied to the <code>employee</code> map using the <code>map.values(predicate)</code> method. This method sends the predicate to all cluster members
and merges the results coming from them. Since the predicate is communicated between the members, it needs to
be serializable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Predicates can also be applied to <code>keySet</code>, <code>entrySet</code> and <code>localKeySet</code> of the Hazelcast distributed map.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="predicates-class-operators"><a class="anchor" href="#predicates-class-operators"></a><a class="link" href="#predicates-class-operators">Predicates Class Operators</a></h5>
<div class="paragraph">
<p>The <code>Predicates</code> class offered by Hazelcast includes many operators for your query requirements. Some of them are
explained below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>equal</code>: Checks if the result of an expression is equal to a given value.</p>
</li>
<li>
<p><code>notEqual</code>: Checks if the result of an expression is not equal to a given value.</p>
</li>
<li>
<p><code>instanceOf</code>: Checks if the result of an expression has a certain type.</p>
</li>
<li>
<p><code>like</code>: Checks if the result of an expression matches some string pattern. % (percentage sign) is the placeholder for many
characters,  (underscore) is placeholder for only one character.</p>
</li>
<li>
<p><code>greaterThan</code>: Checks if the result of an expression is greater than a certain value.</p>
</li>
<li>
<p><code>greaterEqual</code>: Checks if the result of an expression is greater than or equal to a certain value.</p>
</li>
<li>
<p><code>lessThan</code>: Checks if the result of an expression is less than a certain value.</p>
</li>
<li>
<p><code>lessEqual</code>: Checks if the result of an expression is less than or equal to a certain value.</p>
</li>
<li>
<p><code>between</code>: Checks if the result of an expression is between two values (this is inclusive).</p>
</li>
<li>
<p><code>in</code>: Checks if the result of an expression is an element of a certain collection.</p>
</li>
<li>
<p><code>isNot</code>: Checks if the result of an expression is false.</p>
</li>
<li>
<p><code>regex</code>: Checks if the result of an expression matches some regular expression.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please see the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/query/Predicates.html">Predicates Javadoc</a> for all predicates provided.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="combining-predicates-with-and-or-not"><a class="anchor" href="#combining-predicates-with-and-or-not"></a><a class="link" href="#combining-predicates-with-and-or-not">Combining Predicates with AND, OR, NOT</a></h5>
<div class="paragraph">
<p>You can combine predicates using the <code>and</code>, <code>or</code> and <code>not</code> operators, as shown in the below examples.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;Employee&gt; getWithNameAndAge( <span class="predefined-type">String</span> name, <span class="type">int</span> age ) {
    <span class="predefined-type">Predicate</span> namePredicate = Predicates.equal( <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, name );
    <span class="predefined-type">Predicate</span> agePredicate = Predicates.equal( <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, age );
    <span class="predefined-type">Predicate</span> predicate = Predicates.and( namePredicate, agePredicate );
    <span class="keyword">return</span> employeeMap.values( predicate );
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;Employee&gt; getWithNameOrAge( <span class="predefined-type">String</span> name, <span class="type">int</span> age ) {
    <span class="predefined-type">Predicate</span> namePredicate = Predicates.equal( <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, name );
    <span class="predefined-type">Predicate</span> agePredicate = Predicates.equal( <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, age );
    <span class="predefined-type">Predicate</span> predicate = Predicates.or( namePredicate, agePredicate );
    <span class="keyword">return</span> employeeMap.values( predicate );
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;Employee&gt; getNotWithName( <span class="predefined-type">String</span> name ) {
    <span class="predefined-type">Predicate</span> namePredicate = Predicates.equal( <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, name );
    <span class="predefined-type">Predicate</span> predicate = Predicates.not( namePredicate );
    <span class="keyword">return</span> employeeMap.values( predicate );
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="simplifying-with-predicatebuilder"><a class="anchor" href="#simplifying-with-predicatebuilder"></a><a class="link" href="#simplifying-with-predicatebuilder">Simplifying with PredicateBuilder</a></h5>
<div class="paragraph">
<p>You can simplify predicate usage with the <code>PredicateBuilder</code> class, which offers simpler predicate building. Please see the
below example code which selects all people with a certain name and age.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;Employee&gt; getWithNameAndAgeSimplified( <span class="predefined-type">String</span> name, <span class="type">int</span> age ) {
    EntryObject e = <span class="keyword">new</span> PredicateBuilder().getEntryObject();
    <span class="predefined-type">Predicate</span> agePredicate = e.get( <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> ).equal( age );
    <span class="predefined-type">Predicate</span> predicate = e.get( <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> ).equal( name ).and( agePredicate );
    <span class="keyword">return</span> employeeMap.values( predicate );
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="querying-with-sql"><a class="anchor" href="#querying-with-sql"></a><a class="link" href="#querying-with-sql">11.1.3. Querying with SQL</a></h4>
<div class="paragraph">
<p><code>com.hazelcast.query.SqlPredicate</code> takes the regular SQL <code>where</code> clause. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;Employee&gt; map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">employee</span><span class="delimiter">&quot;</span></span> );
<span class="predefined-type">Set</span>&lt;Employee&gt; employees = map.values( <span class="keyword">new</span> SqlPredicate( <span class="string"><span class="delimiter">&quot;</span><span class="content">active AND age &lt; 30</span><span class="delimiter">&quot;</span></span> ) );</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="supported-sql-syntax"><a class="anchor" href="#supported-sql-syntax"></a><a class="link" href="#supported-sql-syntax">Supported SQL Syntax</a></h5>
<div class="paragraph">
<p><strong>AND/OR:</strong> `&lt;expression&gt; AND &lt;expression&gt; AND &lt;expression&gt;&#8230;&#8203; `</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>active AND age&gt;30</code></p>
</li>
<li>
<p><code>active=false OR age = 45 OR name = 'Joe'</code></p>
</li>
<li>
<p><code>active AND ( age &gt; 20 OR salary &lt; 60000 )</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Equality:</strong> <code>=, !=, &lt;, &#8656;, &gt;, &gt;=</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;expression&gt; = value</code></p>
</li>
<li>
<p><code>age &#8656; 30</code></p>
</li>
<li>
<p><code>name = 'Joe'</code></p>
</li>
<li>
<p><code>salary != 50000</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>BETWEEN: </strong> <code>&lt;attribute&gt; [NOT] BETWEEN &lt;value1&gt; AND &lt;value2&gt;</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>age BETWEEN 20 AND 33 ( same as age &gt;= 20  AND age &#8656; 33 )</code></p>
</li>
<li>
<p><code>age NOT BETWEEN 30 AND 40 ( same as age &lt; 30 OR age &gt; 40 )</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>IN:</strong> <code>&lt;attribute&gt; [NOT] IN (val1, val2,&#8230;&#8203;)</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>age IN ( 20, 30, 40 )</code></p>
</li>
<li>
<p><code>age NOT IN ( 60, 70 )</code></p>
</li>
<li>
<p><code>active AND ( salary &gt;= 50000 OR ( age NOT BETWEEN 20 AND 30 ) )</code></p>
</li>
<li>
<p><code>age IN ( 20, 30, 40 ) AND salary BETWEEN ( 50000, 80000 )</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>LIKE:</strong> <code>&lt;attribute&gt; [NOT] LIKE "expression"</code></p>
</div>
<div class="paragraph">
<p>The <code>%</code> (percentage sign) is placeholder for multiple characters, an <code>_</code> (underscore) is placeholder for only one character.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name LIKE 'Jo%'</code> (true for 'Joe', 'Josh', 'Joseph' etc.)</p>
</li>
<li>
<p><code>name LIKE 'Jo_'</code> (true for 'Joe'; false for 'Josh')</p>
</li>
<li>
<p><code>name NOT LIKE 'Jo_'</code> (true for 'Josh'; false for 'Joe')</p>
</li>
<li>
<p><code>name LIKE 'J_s%'</code> (true for 'Josh', 'Joseph'; false 'John', 'Joe')</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>ILIKE:</strong> <code>&lt;attribute&gt; [NOT] ILIKE 'expression'</code></p>
</div>
<div class="paragraph">
<p>Similar to LIKE predicate but in a case-insensitive manner.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name ILIKE 'Jo%'</code> (true for 'Joe', 'joe', 'jOe','Josh','joSH', etc.)</p>
</li>
<li>
<p><code>name ILIKE 'Jo_'</code> (true for 'Joe' or 'jOE'; false for 'Josh')</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>REGEX</strong>: <code>&lt;attribute&gt; [NOT] REGEX 'expression'</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name REGEX 'abc-.*'</code> (true for 'abc-123'; false for 'abx-123')</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="querying-entry-keys-with-predicates"><a class="anchor" href="#querying-entry-keys-with-predicates"></a><a class="link" href="#querying-entry-keys-with-predicates">Querying Entry Keys with Predicates</a></h5>
<div class="paragraph">
<p>You can use <code>__key</code> attribute to perform a predicated search for entry keys. Please see the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, Person&gt; personMap = hazelcastInstance.getMap(persons);
personMap.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>, <span class="integer">35</span>, Gender.FEMALE));
personMap.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Andy</span><span class="delimiter">&quot;</span></span>,  <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Andy</span><span class="delimiter">&quot;</span></span>,  <span class="integer">37</span>, Gender.MALE));
personMap.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>,   <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>,   <span class="integer">22</span>, Gender.MALE));
[...]
<span class="predefined-type">Predicate</span> predicate = <span class="keyword">new</span> SqlPredicate(<span class="string"><span class="delimiter">&quot;</span><span class="content">__key like A%</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Collection</span>&lt;Person&gt; startingWithA = personMap.values(predicate);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the code creates a collection with the entries whose keys start with the letter "A.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="filtering-with-paging-predicates"><a class="anchor" href="#filtering-with-paging-predicates"></a><a class="link" href="#filtering-with-paging-predicates">11.1.4. Filtering with Paging Predicates</a></h4>
<div class="paragraph">
<p>Hazelcast provides paging for defined predicates. With its <code>PagingPredicate</code> class, you can
get a collection of keys, values, or entries page by page by filtering them with predicates and giving the size of the pages. Also, you
can sort the entries by specifying comparators.</p>
</div>
<div class="paragraph">
<p>In the example code below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>greaterEqual</code> predicate gets values from the "students" map. This predicate has a filter
to retrieve the objects with an "age" greater than or equal to 18.</p>
</li>
<li>
<p>Then a <code>PagingPredicate</code> is constructed in which the page size is 5, so there will be five objects in each page.
The first time the values are called creates the first page.</p>
</li>
<li>
<p>It gets subsequent pages with the <code>nextPage()</code>
method of <code>PagingPredicate</code> and querying the map again with the updated <code>PagingPredicate</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">Integer</span>, Student&gt; map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">students</span><span class="delimiter">&quot;</span></span> );
<span class="predefined-type">Predicate</span> greaterEqual = Predicates.greaterEqual( <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">18</span> );
PagingPredicate pagingPredicate = <span class="keyword">new</span> PagingPredicate( greaterEqual, <span class="integer">5</span> );
<span class="comment">// Retrieve the first page</span>
<span class="predefined-type">Collection</span>&lt;Student&gt; values = map.values( pagingPredicate );
...
<span class="comment">// Set up next page</span>
pagingPredicate.nextPage();
<span class="comment">// Retrieve next page</span>
values = map.values( pagingPredicate );
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a comparator is not specified for <code>PagingPredicate</code>, but you want to get a collection of keys or values page by page, this collection must be an instance of <code>Comparable</code> (i.e., it must implement <code>java.lang.Comparable</code>). Otherwise, the <code>java.lang.IllegalArgument</code> exception is thrown.</p>
</div>
<div class="paragraph">
<p>Starting with Hazelcast 3.6, you can also access a specific page more easily with the help of the method <code>setPage()</code>. This way, if you make a query for the hundredth page, for example, it will get all 100 pages at once instead of reaching the hundredth page one by one using the method <code>nextPage()</code>. Please note that this feature tires the memory and refer to the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/query/PagingPredicate.html">PagingPredicate Javadoc</a>.</p>
</div>
<div class="paragraph">
<p>Paging Predicate, also known as Order &amp; Limit, is not supported in Transactional Context.</p>
</div>
</div>
<div class="sect3">
<h4 id="filtering-with-partition-predicate"><a class="anchor" href="#filtering-with-partition-predicate"></a><a class="link" href="#filtering-with-partition-predicate">11.1.5. Filtering with Partition Predicate</a></h4>
<div class="paragraph">
<p>You can run queries on a single partition in your cluster using the partition predicate (<code>PartitionPredicate</code>).</p>
</div>
<div class="paragraph">
<p>It takes a predicate and partition key as parameters, gets the partition ID using the key and  runs that predicate only on the partition where that key belongs.</p>
</div>
<div class="paragraph">
<p>Please see the following code snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
Predicate predicate = <span class="keyword">new</span> PartitionPredicate&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt;(partitionKey, TruePredicate.INSTANCE);

<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Integer</span>&gt; values = map.values(predicate);
<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; keys = map.keySet(predicate);
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default there are 271 partitions, and using a regular predicate, each partition needs to be accessed. However, if the
partition predicate will only access a single partition, this can lead to a big performance gain.</p>
</div>
<div class="paragraph">
<p>For the partition predicate to work correctly, you need to know which partition your data belongs to so that you can send the
request to the correct partition. One of the ways of doing it is to make use of the <code>PartitionAware</code> interface when data is
inserted, thereby controlling the owning partition. Please see the <a href="#partitionaware ">PartitionAware section</a> for more information and examples.</p>
</div>
<div class="paragraph">
<p>A concrete example may be a webshop that sells phones and accessories. To find all the accessories of a phone,
a query could be executed that selects all accessories for that phone. This query is executed on all members in the cluster and
therefore could generate quite a lot of load. However, if we would store the accessories in the same partition as the phone, the
partition predicate could use the <code>partitionKey</code> of the phone to select the right partition and then it queries for
the accessories for that phone; and this reduces the load on the system and get faster query results.</p>
</div>
</div>
<div class="sect3">
<h4 id="indexing-queries"><a class="anchor" href="#indexing-queries"></a><a class="link" href="#indexing-queries">11.1.6. Indexing Queries</a></h4>
<div class="paragraph">
<p>Hazelcast distributed queries will run on each member in parallel and will return only the results to the caller.
Then, on the caller side, the results will be merged.</p>
</div>
<div class="paragraph">
<p>When a query runs on a
member, Hazelcast will iterate through all the owned entries and find the matching ones. This can be made faster by indexing
the mostly queried fields, just like you would do for your database. Indexing will add overhead for each <code>write</code>
operation but queries will be a lot faster. If you query your map a lot, make sure to add indexes for the most frequently
queried fields. For example, if you do an <code>active and age &lt; 30</code> query, make sure you add an index for the <code>active</code> and
<code>age</code> fields. The following example code does that by getting the map from the Hazelcast instance and adding indexes to the map with the IMap <code>addIndex</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">employees</span><span class="delimiter">&quot;</span></span> );
<span class="comment">// ordered, since we have ranged queries for this field</span>
map.addIndex( <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span> );
<span class="comment">// not ordered, because boolean field cannot have range</span>
map.addIndex( <span class="string"><span class="delimiter">&quot;</span><span class="content">active</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">false</span> );</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="indexing-ranged-queries"><a class="anchor" href="#indexing-ranged-queries"></a><a class="link" href="#indexing-ranged-queries">Indexing Ranged Queries</a></h5>
<div class="paragraph">
<p><code>IMap.addIndex(fieldName, ordered)</code> is used for adding index. For each indexed field, if you have ranged queries such as <code>age&gt;30</code>,
<code>age BETWEEN 40 AND 60</code>, then you should set the <code>ordered</code> parameter to <code>true</code>. Otherwise, set it to <code>false</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configuring-imap-indexes"><a class="anchor" href="#configuring-imap-indexes"></a><a class="link" href="#configuring-imap-indexes">Configuring IMap Indexes</a></h5>
<div class="paragraph">
<p>Also, you can define <code>IMap</code> indexes in configuration. An example is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;indexes&gt;</span>
    <span class="tag">&lt;index</span> <span class="attribute-name">ordered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>name<span class="tag">&lt;/index&gt;</span>
    <span class="tag">&lt;index</span> <span class="attribute-name">ordered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>age<span class="tag">&lt;/index&gt;</span>
  <span class="tag">&lt;/indexes&gt;</span>
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define <code>IMap</code> indexes using programmatic configuration, as in the example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">mapConfig.addMapIndexConfig( <span class="keyword">new</span> MapIndexConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">false</span> ) );
mapConfig.addMapIndexConfig( <span class="keyword">new</span> MapIndexConfig( <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is the Spring declarative configuration for the same sample.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hz:map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;hz:indexes&gt;</span>
    <span class="tag">&lt;hz:index</span> <span class="attribute-name">attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;hz:index</span> <span class="attribute-name">attribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ordered</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/hz:indexes&gt;</span>
<span class="tag">&lt;/hz:map&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Non-primitive types to be indexed should implement <strong><code>Comparable</code></strong>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Starting with Hazelcast 3.9, if you configure the data structure to use <a href="#configuring-high-density-memory-store">High-Density Memory Store</a> <strong>and</strong> indexes, the indexes are automatically stored in the High-Density Memory Store as well. This prevents from running into full GCs, when doing a lot of updates to index.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="copying-indexes"><a class="anchor" href="#copying-indexes"></a><a class="link" href="#copying-indexes">Copying Indexes</a></h5>
<div class="paragraph">
<p>The underlying data structures used by the indexes need to copy the query results to make sure that the results are correct. This copying process is performed either when reading the index from the data structure (on-read) or writing to it (on-write).</p>
</div>
<div class="paragraph">
<p>On-read copying means that, for each index-read operation, the result of the query is copied before it is sent to the caller. Depending on the query result&#8217;s size, this type of index copying may be slower since the result is stored in a map, i.e., all entries need to have the hash calculated before being stored. Unlike the index-read operations, each index-write operation is fast, since there will be no copying taking place. So, this option can be preferred in index-write intensive cases.</p>
</div>
<div class="paragraph">
<p>On-write copying means that each index-write operation completely copies the underlying map to provide the copy-on-write semantics and this may be a slow operation depending on the index size. Unlike index-write operations, each index-read operation is fast since the operation only includes accessing the map that stores the results and returning them to the caller.</p>
</div>
<div class="paragraph">
<p>Another option is never copying the results of a query to a separate map. This means the results backed by the underlying index-map can change after the query has been executed (such as an entry might have been added or removed from an index, or it might have been remapped). This option can be preferred if you expect "mostly correct" results, i.e., if it is not a problem when some entries returned in the query result set do not match the initial query criteria. This is the fastest option since there is no copying.</p>
</div>
<div class="paragraph">
<p>You can set one these options using the system property <code>hazelcast.index.copy.behavior</code>. The following values, which are explained in the above paragraphs, can be set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>COPY_ON_READ</code> (the default value)</p>
</li>
<li>
<p><code>COPY_ON_WRITE</code></p>
</li>
<li>
<p><code>NEVER</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Usage of this system property is supported for BINARY and OBJECT in-memory formats. Only in Hazelcast 3.8.7, it is also supported for NATIVE in-memory format.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="indexing-attributes-with-valueextractor"><a class="anchor" href="#indexing-attributes-with-valueextractor"></a><a class="link" href="#indexing-attributes-with-valueextractor">Indexing Attributes with ValueExtractor</a></h5>
<div class="paragraph">
<p>You can also define custom attributes that may be referenced in predicates, queries and indexes. Custom attributes can be defined by implementing a <code>ValueExtractor</code>. Please see the <a href="#custom-attributes">Custom Attributes section</a> for details.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-this-as-an-attribute"><a class="anchor" href="#using-this-as-an-attribute"></a><a class="link" href="#using-this-as-an-attribute">Using "this" as an Attribute</a></h5>
<div class="paragraph">
<p>You can use the keyword <code>this</code> as an attribute name while adding an index or creating a predicate. A basic usage is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">map.addIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">this</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);
<span class="predefined-type">Predicate</span>&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; lessEqual = Predicates.between(<span class="string"><span class="delimiter">&quot;</span><span class="content">this</span><span class="delimiter">&quot;</span></span>, <span class="integer">12</span>, <span class="integer">20</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another basic sample using <code>SqlPredicate</code> is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">new</span> SqlPredicate(<span class="string"><span class="delimiter">&quot;</span><span class="content">this = 'jones'</span><span class="delimiter">&quot;</span></span>)
<span class="keyword">new</span> SqlPredicate(<span class="string"><span class="delimiter">&quot;</span><span class="content">this.age &gt; 33</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The special attribute <code>this</code> acts on the value of a map entry. Typically, you do not need to specify it while accessing a property of an entry&#8217;s value, since its presence is implicitly assumed if the special attribute <a href="#querying-entry-keys-with-predicates">__key</a> is not specified.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-query-thread-pool"><a class="anchor" href="#configuring-query-thread-pool"></a><a class="link" href="#configuring-query-thread-pool">11.1.7. Configuring Query Thread Pool</a></h4>
<div class="paragraph">
<p>You can change the size of thread pool dedicated to query operations using the <code>pool-size</code> property. Each query consumes a single thread from a Generic Operations ThreadPool on each Hazelcast member - let&#8217;s call it the query-orchestrating thread.  That thread is blocked throughout the whole execution-span of a query on the member.</p>
</div>
<div class="paragraph">
<p>The query-orchestrating thread will use the threads from the query-thread pool in two cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if you run a <code>PagingPredicate</code> - since each page is run as a separate task,</p>
</li>
<li>
<p>if you set the system property <code>hazelcast.query.predicate.parallel.evaluation</code> to true - since the predicates are evaluated in parallel.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please see <a href="#filtering-with-paging-predicates">Filtering with Paging Predicates</a> and <a href="#system-properties">System Properties</a> sections for information on paging predicates and for description of the above system property.</p>
</div>
<div class="paragraph">
<p>Below is an example of that declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;executor-service name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hz:query</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;pool-size&gt;<span class="integer">100</span>&lt;/pool-size&gt;
&lt;/executor-service&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Below is the equivalent programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config cfg = <span class="keyword">new</span> Config();
cfg.getExecutorConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">hz:query</span><span class="delimiter">&quot;</span></span>).setPoolSize(<span class="integer">100</span>);</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="query-requests-from-clients"><a class="anchor" href="#query-requests-from-clients"></a><a class="link" href="#query-requests-from-clients">Query Requests from Clients</a></h5>
<div class="paragraph">
<p>When dealing with the query requests coming from the clients to your members, Hazelcast offers the following system properties to tune your thread pools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.clientengine.thread.count</code> which is the number of threads to process non-partition-aware client requests, like <code>map.size()</code> and executor tasks. Its default value is the number of cores multiplied by 20.</p>
</li>
<li>
<p><code>hazelcast.clientengine.query.thread.count</code> which is the number of threads to process query requests coming from the clients. Its default value is the number of cores.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If there are a lot of query request from the clients, you may want to increase the value of <code>hazelcast.clientengine.query.thread.count</code>. In addition to this tuning, you may also consider increasing the value of <code>hazelcast.clientengine.thread.count</code> if the CPU load in your system is not high and there is plenty of free memory.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="querying-in-collections-and-arrays"><a class="anchor" href="#querying-in-collections-and-arrays"></a><a class="link" href="#querying-in-collections-and-arrays">11.2. Querying in Collections and Arrays</a></h3>
<div class="paragraph">
<p>Hazelcast allows querying in collections and arrays.
Querying in collections and arrays is compatible with all Hazelcast serialization methods, including the Portable serialization.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the following data structure expressed in pseudo-code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Motorbike</span> {
    Wheel wheels[<span class="integer">2</span>];
}

<span class="type">class</span> <span class="class">Wheel</span> {
   <span class="predefined-type">String</span> name;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to query a single element of a collection/array, you can execute the following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// it matches all motorbikes where the zero wheel's name is 'front-wheel'</span>
<span class="predefined-type">Predicate</span> p = Predicates.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">wheels[0].name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">front-wheel</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Collection</span>&lt;Motorbike&gt; result = map.values(p);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to query a collection/array using the <code>any</code> semantic as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// it matches all motorbikes where any wheel's name is 'front-wheel'</span>
<span class="predefined-type">Predicate</span> p = Predicates.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">wheels[any].name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">front-wheel</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Collection</span>&lt;Motorbike&gt; result = map.values(p);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The exact same query may be executed using the <code>SQLPredicate</code> as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Predicate</span> p = <span class="keyword">new</span> SqlPredicate(<span class="string"><span class="delimiter">&quot;</span><span class="content">wheels[any].name = 'front-wheel'</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Collection</span>&lt;Motorbike&gt; result = map.values(p);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>[]</code> notation applies to both collections and arrays.</p>
</div>
<div class="sect3">
<h4 id="indexing-in-collections-and-arrays"><a class="anchor" href="#indexing-in-collections-and-arrays"></a><a class="link" href="#indexing-in-collections-and-arrays">11.2.1. Indexing in Collections and Arrays</a></h4>
<div class="paragraph">
<p>You can also create an index using a query in collections and arrays.</p>
</div>
<div class="paragraph">
<p>Please note that in order to leverage the index, the attribute name used in the query has to be the same as the one used
in the index definition.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume you have the following index definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;indexes&gt;
  &lt;index ordered=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>&gt;wheels[any].name&lt;/index&gt;
&lt;/indexes&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query will use the index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Predicate</span> p = Predicates.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">wheels[any].name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">front-wheel</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following query, however, will NOT leverage the index, since it does not use exactly the same attribute name that
was used in the index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Predicates.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">wheels[0].name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">front-wheel</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to use the index in the case mentioned above, you have to create another index, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;indexes&gt;
  &lt;index ordered=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>&gt;wheels[<span class="integer">0</span>].name&lt;/index&gt;
&lt;/indexes&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="corner-cases"><a class="anchor" href="#corner-cases"></a><a class="link" href="#corner-cases">11.2.2. Corner cases</a></h4>
<div class="paragraph">
<p>Handling of corner cases may be a bit different than in a programming language like <code>Java</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the following examples in order to understand the differences.
To make the analysis simpler, let&#8217;s assume that there is only one <code>Motorbike</code> object stored in a Hazelcast Map.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Id</th>
<th class="tableblock halign-left valign-top">Query</th>
<th class="tableblock halign-left valign-top">Data State</th>
<th class="tableblock halign-left valign-top">Extraction Result</th>
<th class="tableblock halign-left valign-top">Match</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Predicates.equal("wheels[7].name", "front-wheel")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wheels.size() == 1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Predicates.equal("wheels[7].name", null)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wheels.size() == 1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Predicates.equal("wheels[0].name", "front-wheel")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wheels[0].name == null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Predicates.equal("wheels[0].name", null)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wheels[0].name == null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Predicates.equal("wheels[0].name", "front-wheel")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wheels[0] == null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Predicates.equal("wheels[0].name", null)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wheels[0] == null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Predicates.equal("wheels[0].name", "front-wheel")</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wheels == null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Predicates.equal("wheels[0].name", null)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wheels == null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As you can see, <strong>no</strong> <code>NullPointerException`s or `IndexOutOfBoundException`s are thrown in the extraction process, even
though parts of the expression are `null</code>.</p>
</div>
<div class="paragraph">
<p>Looking at examples 4, 6 and 8, we can also easily notice that it is impossible to distinguish which part of the
expression was null.
If we execute the following query <code>wheels[1].name = null</code>, it may be evaluated to true because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>wheels</code> collection/array is null.</p>
</li>
<li>
<p><code>index == 1</code> is out of bound.</p>
</li>
<li>
<p><code>name</code> attribute of the wheels[1] object is <code>null</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to make the query unambiguous, extra conditions would have to be added, e.g.,
<code>wheels != null AND wheels[1].name = null</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-attributes"><a class="anchor" href="#custom-attributes"></a><a class="link" href="#custom-attributes">11.3. Custom Attributes</a></h3>
<div class="paragraph">
<p>It is possible to define a custom attribute that may be referenced in predicates, queries and indexes.</p>
</div>
<div class="paragraph">
<p>A custom attribute is a "synthetic" attribute that does not exist as a <code>field</code> or a <code>getter</code> in the object that it is extracted from.
Thus, it is necessary to define the policy on how the attribute is supposed to be extracted.
Currently the only way to extract a custom attribute is to implement a <code>com.hazelcast.query.extractor.ValueExtractor</code>
that encompasses the extraction logic.</p>
</div>
<div class="paragraph">
<p>Custom Attributes are compatible with all Hazelcast serialization methods, including the Portable serialization.</p>
</div>
<div class="sect3">
<h4 id="implementing-a-valueextractor"><a class="anchor" href="#implementing-a-valueextractor"></a><a class="link" href="#implementing-a-valueextractor">11.3.1. Implementing a ValueExtractor</a></h4>
<div class="paragraph">
<p>In order to implement a <code>ValueExtractor</code>, extend the abstract <code>com.hazelcast.query.extractor.ValueExtractor</code> class
and implement the <code>extract()</code> method. This method does not return any values since the extracted value is collected by the <code>ValueCollector</code>.
In order to return multiple results from a single extraction, invoke the <code>ValueCollector.collect()</code> method
multiple times, so that the collector collects all results.</p>
</div>
<div class="paragraph">
<p>Please refer to the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/query/extractor/ValueExtractor.html"><code>ValueExtractor</code></a> and <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/query/extractor/ValueCollector.html"><code>ValueCollector</code></a> Javadocs.</p>
</div>
<div class="sect4">
<h5 id="valueextractor-with-portable-serialization"><a class="anchor" href="#valueextractor-with-portable-serialization"></a><a class="link" href="#valueextractor-with-portable-serialization">ValueExtractor with Portable Serialization</a></h5>
<div class="paragraph">
<p>Portable serialization is a special kind of serialization where there is no need to have the class of the serialized object on the
classpath in order to read its attributes. That is the reason why the target object passed to the <code>ValueExtractor.extract()</code>
method will not be of the exact type that has been stored. Instead, an instance of a <code>com.hazelcast.query.extractor.ValueReader</code> will be passed.
<code>ValueReader</code> enables reading the attributes of a Portable object in a generic and type-agnostic way.
It contains two methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>read(String path, ValueCollector&lt;T&gt; collector)</code> - enables passing all results directly to the <code>ValueCollector</code>.</p>
</li>
<li>
<p><code>read(String path, ValueCallback&lt;T&gt; callback)</code> - enables filtering, transforming and grouping the result of the read operation and manually passing it to the <code>ValueCollector</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/query/extractor/ValueReader.html"><code>ValueReader</code></a> Javadoc.</p>
</div>
</div>
<div class="sect4">
<h5 id="returning-multiple-values-from-a-single-extraction"><a class="anchor" href="#returning-multiple-values-from-a-single-extraction"></a><a class="link" href="#returning-multiple-values-from-a-single-extraction">Returning Multiple Values from a Single Extraction</a></h5>
<div class="paragraph">
<p>It sounds counter-intuitive, but a single extraction may return multiple values when arrays or collections are
involved.
Let&#8217;s have a look at the following data structure in pseudo-code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Motorbike</span> {
    Wheel wheel[<span class="integer">2</span>];
}

<span class="type">class</span> <span class="class">Wheel</span> {
    <span class="predefined-type">String</span> name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s assume that we want to extract the names of all wheels from a single motorbike object. Each motorbike has two
wheels so there are two names for each bike. In order to return both values from the extraction operation, collect them
separately using the <code>ValueCollector</code>. Collecting multiple values in this way allows you to operate on these multiple
values as if they were single values during the evaluation of the predicates.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume that we registered a custom extractor with the name <code>wheelName</code> and executed the following query:
<code>wheelName = front-wheel</code>.</p>
</div>
<div class="paragraph">
<p>The extraction may return up to two wheel names for each <code>Motorbike</code> since each <code>Motorbike</code> has up to two wheels.
In such a case, it is enough if a single value evaluates the predicate&#8217;s condition to true to return a match, so
it will return a <code>Motorbike</code> if "any" of the wheels matches the expression.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="extraction-arguments"><a class="anchor" href="#extraction-arguments"></a><a class="link" href="#extraction-arguments">11.3.2. Extraction Arguments</a></h4>
<div class="paragraph">
<p>A <code>ValueExtractor</code> may use a custom argument if it is specified in the query.
The custom argument may be passed within the square brackets located after the name of the custom attribute,
e.g., <code>customAttribute[argument]</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the following query: <code>currency[incoming] == EUR</code>
The <code>currency</code> is a custom attribute that uses a <code>com.test.CurrencyExtractor</code> for extraction.</p>
</div>
<div class="paragraph">
<p>The string <code>incoming</code> is an argument that will be passed to the <code>ArgumentParser</code> during the extraction.
The parser will parse the string according to the parser&#8217;s custom logic and it will return a parsed object.
The parsed object may be a single object, array, collection, or any arbitrary object.
It is up to the `ValueExtractor&#8217;s implementor to understand the semantics of the parsed argument object.</p>
</div>
<div class="paragraph">
<p>For now it is <strong>not</strong> possible to register a custom <code>ArgumentParser</code>, thus a default parser is used.
It follows a <code>pass-through</code> semantic, which means that the string located in the square brackets is passed "as is" to
the <code>ValueExtractor.extract()</code> method.</p>
</div>
<div class="paragraph">
<p>Please note that using square brackets within the argument string is not allowed.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-a-custom-attribute-programmatically"><a class="anchor" href="#configuring-a-custom-attribute-programmatically"></a><a class="link" href="#configuring-a-custom-attribute-programmatically">11.3.3. Configuring a Custom Attribute Programmatically</a></h4>
<div class="paragraph">
<p>The following snippet demonstrates how to define a custom attribute using a <code>ValueExtractor</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MapAttributeConfig attributeConfig = <span class="keyword">new</span> MapAttributeConfig();
attributeConfig.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">currency</span><span class="delimiter">&quot;</span></span>);
attributeConfig.setExtractor(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.bank.CurrencyExtractor</span><span class="delimiter">&quot;</span></span>);

MapConfig mapConfig = <span class="keyword">new</span> MapConfig();
mapConfig.addMapAttributeConfig(attributeConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>currency</code> is the name of the custom attribute that will be extracted using the <code>CurrencyExtractor</code> class.</p>
</div>
<div class="paragraph">
<p>Keep in mind that an extractor may not be added after the map has been instantiated.
All extractors have to be defined upfront in the map&#8217;s initial configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-a-custom-attribute-declaratively"><a class="anchor" href="#configuring-a-custom-attribute-declaratively"></a><a class="link" href="#configuring-a-custom-attribute-declaratively">11.3.4. Configuring a Custom Attribute Declaratively</a></h4>
<div class="paragraph">
<p>The following snippet demonstrates how to define a custom attribute in the Hazelcast XML Configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">trades</span><span class="delimiter">&quot;</span></span>&gt;
   &lt;attributes&gt;
       &lt;attribute extractor=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.bank.CurrencyExtractor</span><span class="delimiter">&quot;</span></span>&gt;currency&lt;/attribute&gt;
   &lt;/attributes&gt;
&lt;/map&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Analogous to the example above, <code>currency</code> is the name of the custom attribute that will be extracted using the
<code>CurrencyExtractor</code> class.</p>
</div>
<div class="paragraph">
<p>Please note that an attribute name may begin with an ASCII letter [A-Za-z] or digit [0-9] and may contain
ASCII letters [A-Za-z], digits [0-9] or underscores later on.</p>
</div>
</div>
<div class="sect3">
<h4 id="indexing-custom-attributes"><a class="anchor" href="#indexing-custom-attributes"></a><a class="link" href="#indexing-custom-attributes">11.3.5. Indexing Custom Attributes</a></h4>
<div class="paragraph">
<p>You can create an index using a custom attribute.</p>
</div>
<div class="paragraph">
<p>The name of the attribute used in the index definition has to match the one used in the attributes configuration.</p>
</div>
<div class="paragraph">
<p>Defining indexes with extraction arguments is allowed, as shown in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;indexes&gt;
    &lt;!-- custom attribute without an extraction argument --&gt;
    &lt;index ordered=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;currency&lt;/index&gt;

    &lt;!-- custom attribute using an extraction argument --&gt;
    &lt;index ordered=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;currency[incoming]&lt;/index&gt;
&lt;/indexes&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mapreduce"><a class="anchor" href="#mapreduce"></a><a class="link" href="#mapreduce">11.4. MapReduce</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MapReduce is deprecated since Hazelcast 3.8. You can use <a href="#fast-aggregations">Fast-Aggregations</a> and <a href="https://jet.hazelcast.org/">Hazelcast Jet</a> for map aggregations and general data processing, respectively. Please see the <a href="#mapreduce-deprecation">MapReduce Deprecation section</a> for more details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You have likely heard about MapReduce ever since Google released its <a href="http://research.google.com/archive/mapreduce.html">research white paper</a>  on this concept. With Hadoop as the most common and well known implementation, MapReduce gained a broad audience and made it into all kinds of business applications dominated by data warehouses.</p>
</div>
<div class="paragraph">
<p>MapReduce is a software framework for processing large amounts of data in a distributed way. Therefore, the processing is normally spread over several machines. The basic idea behind MapReduce is that source data is mapped into a collection of key-value pairs and reducing those pairs, grouped by key, in a second
step towards the final result.</p>
</div>
<div class="paragraph">
<p>The main idea can be summarized with the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Read the source data.</p>
</li>
<li>
<p>Map the data to one or multiple key-value pairs.</p>
</li>
<li>
<p>Reduce all pairs with the same key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Use Cases</strong></p>
</div>
<div class="paragraph">
<p>The best known examples for MapReduce algorithms are text processing tools, such as counting the word frequency in large texts or websites. Apart from that, there are more interesting examples of use cases listed below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log Analysis</p>
</li>
<li>
<p>Data Querying</p>
</li>
<li>
<p>Aggregation and summing</p>
</li>
<li>
<p>Distributed Sort</p>
</li>
<li>
<p>ETL (Extract Transform Load)</p>
</li>
<li>
<p>Credit and Risk management</p>
</li>
<li>
<p>Fraud detection</p>
</li>
<li>
<p>and more.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="understanding-mapreduce"><a class="anchor" href="#understanding-mapreduce"></a><a class="link" href="#understanding-mapreduce">11.4.1. Understanding MapReduce</a></h4>
<div class="paragraph">
<p>This section will give deeper insight into the MapReduce pattern and will help you understand the semantics behind the different MapReduce phases and how they are implemented in Hazelcast.</p>
</div>
<div class="paragraph">
<p>In addition to this, the following sections compare Hadoop and Hazelcast MapReduce implementations to help adopters with Hadoop backgrounds quickly get familiar with Hazelcast MapReduce.</p>
</div>
<div class="sect4">
<h5 id="mapreduce-workflow-example"><a class="anchor" href="#mapreduce-workflow-example"></a><a class="link" href="#mapreduce-workflow-example">MapReduce Workflow Example</a></h5>
<div class="paragraph">
<p>The flowchart below demonstrates the basic workflow of the word count example (distributed occurrences analysis) mentioned in the <a href="#mapreduce">MapReduce section</a> introduction. From left to right, it iterates over all the entries of a data structure (in this case an IMap). In the mapping phase, it splits the sentence into single words and emits a key-value pair per word: the word is the key, 1 is the value. In the next phase, values are collected (grouped) and transported to their
corresponding reducers, where they are eventually reduced to a single key-value pair, the value being the number of occurrences of the word. At the last step, the different reducer results are grouped up to the final result and returned to the requester.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/MapReduceWorkflow.png" alt="MapReduce Workflow Example">
</div>
</div>
<div class="paragraph">
<p>In pseudo code, the corresponding map and reduce function would look like the following. A Hazelcast code example will be shown in the next section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">map( key:<span class="predefined-type">String</span>, document:<span class="predefined-type">String</span> ):<span class="predefined-type">Void</span> -&gt;
  <span class="keyword">for</span> each w:word in document:
    emit( w, <span class="integer">1</span> )

reduce( word:<span class="predefined-type">String</span>, counts:<span class="predefined-type">List</span>[Int] ):Int -&gt;
  <span class="keyword">return</span> sum( counts )</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapreduce-phases"><a class="anchor" href="#mapreduce-phases"></a><a class="link" href="#mapreduce-phases">MapReduce Phases</a></h5>
<div class="paragraph">
<p>As seen in the workflow example, a MapReduce process consists of multiple phases. The original MapReduce pattern describes two phases (map, reduce) and one optional phase (combine). In Hazelcast, these phases either only exist virtually to explain the data flow, or are executed in parallel during the real operation while the general idea is still persisting.</p>
</div>
<div class="paragraph">
<p>(K x V)\* &#8594; (L x W)*</p>
</div>
<div class="paragraph">
<p>[(k*1*, v*1*), &#8230;&#8203;, (k*n*, v*n*)] &#8594; [(l*1*, w*1*), &#8230;&#8203;, (l*m*, w*m*)]</p>
</div>
<div class="paragraph">
<p><strong>Mapping Phase</strong></p>
</div>
<div class="paragraph">
<p>The mapping phase iterates all key-value pairs of any kind of legal input source. The mapper then analyzes the input pairs and emits zero or more new key-value pairs.</p>
</div>
<div class="paragraph">
<p>K x V &#8594; (L x W)*</p>
</div>
<div class="paragraph">
<p>(k, v) &#8594; [(l*1*, w*1*), &#8230;&#8203;, (l*n*, w*n*)]</p>
</div>
<div class="paragraph">
<p><strong>Combine Phase</strong></p>
</div>
<div class="paragraph">
<p>In the combine phase, multiple key-value pairs with the same key are collected and combined to an intermediate result before being sent to the reducers. <strong>Combine phase is also optional in Hazelcast, but is highly recommended to lower the traffic.</strong></p>
</div>
<div class="paragraph">
<p>In terms of the word count example, this can be explained using the sentences "Saturn is a planet but the Earth is a planet, too". As shown above, we would send two key-value pairs (planet, 1). The registered combiner now collects those two pairs and combines them into an intermediate result of (planet, 2). Instead of two key-value
pairs sent through the wire, there is now only one for the key "planet".</p>
</div>
<div class="paragraph">
<p>The pseudo code for a combiner is similar to the reducer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">combine( word:<span class="predefined-type">String</span>, counts:<span class="predefined-type">List</span>[Int] ):<span class="predefined-type">Void</span> -&gt;
  emit( word, sum( counts ) )</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Grouping / Shuffling Phase</strong></p>
</div>
<div class="paragraph">
<p>The grouping or shuffling phase only exists virtually in Hazelcast since it is not a real phase; emitted key-value pairs with the same key are always transferred to the same reducer in the same job. They are grouped together, which is equivalent to the shuffling phase.</p>
</div>
<div class="paragraph">
<p><strong>Reducing Phase</strong></p>
</div>
<div class="paragraph">
<p>In the reducing phase, the collected intermediate key-value pairs are reduced by their keys to build the final by-key result. This value can be a sum of all the emitted values of the same key, an average value, or something completely different, depending on the use case.</p>
</div>
<div class="paragraph">
<p>Here is a reduced representation of this phase.</p>
</div>
<div class="paragraph">
<p>L x W\* &#8594; X*</p>
</div>
<div class="paragraph">
<p>(l, [w*1*, &#8230;&#8203;, w*n*]) &#8594; [x*1*, &#8230;&#8203;, x*n*]</p>
</div>
<div class="paragraph">
<p><strong>Producing the Final Result</strong></p>
</div>
<div class="paragraph">
<p>This is not a real MapReduce phase, but it is the final step in Hazelcast after all reducers are notified that reducing has finished. The original job initiator then requests all reduced results and builds the final result.</p>
</div>
</div>
<div class="sect4">
<h5 id="additional-mapreduce-resources"><a class="anchor" href="#additional-mapreduce-resources"></a><a class="link" href="#additional-mapreduce-resources">Additional MapReduce Resources</a></h5>
<div class="paragraph">
<p>The Internet is full of useful resources for finding deeper information on MapReduce. Below is a short collection of more introduction material. In addition, there are books written about all kinds of MapReduce patterns and how to write a MapReduce function for your use case. To name them all is out of the scope of this documentation, but here are some resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://research.google.com/archive/mapreduce.html">http://research.google.com/archive/mapreduce.html</a></p>
</li>
<li>
<p><a href="http://en.wikipedia.org/wiki/MapReduce">http://en.wikipedia.org/wiki/MapReduce</a></p>
</li>
<li>
<p><a href="http://hci.stanford.edu/courses/cs448g/a2/files/map_reduce_tutorial.pdf">http://hci.stanford.edu/courses/cs448g/a2/files/map_reduce_tutorial.pdf</a></p>
</li>
<li>
<p><a href="http://ksat.me/map-reduce-a-really-simple-introduction-kloudo/">http://ksat.me/map-reduce-a-really-simple-introduction-kloudo/</a></p>
</li>
<li>
<p><a href="http://www.slideshare.net/franebandov/an-introduction-to-mapreduce-6789635">http://www.slideshare.net/franebandov/an-introduction-to-mapreduce-6789635</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-the-mapreduce-api"><a class="anchor" href="#using-the-mapreduce-api"></a><a class="link" href="#using-the-mapreduce-api">11.4.2. Using the MapReduce API</a></h4>
<div class="paragraph">
<p>This section explains the basics of the Hazelcast MapReduce framework. While walking through the different API classes, we will build the <a href="#understanding-mapreduce">word count example that was discussed earlier</a> and create it step by step.</p>
</div>
<div class="paragraph">
<p>The Hazelcast API for MapReduce operations consists of a fluent DSL-like configuration syntax to build and submit jobs. <code>JobTracker</code> is the basic entry point to all MapReduce operations and is retrieved from <code>com.hazelcast.core.HazelcastInstance</code> by calling <code>getJobTracker</code> and supplying the name of the required <code>JobTracker</code> configuration. The configuration for `JobTracker`s will be discussed later; for now we focus on the API itself.
In addition, the complete submission part of the API is built to support a fully reactive way of programming.</p>
</div>
<div class="paragraph">
<p>To give an easy introduction to people used to Hadoop, we created the class names to be as familiar as possible to their counterparts on Hadoop. That means while most users will recognize a lot of similar sounding classes, the way to configure the jobs is more fluent due to the DSL-like styled API.</p>
</div>
<div class="paragraph">
<p>While building the example, we will go through as many options as possible, e.g., we will create a specialized <code>JobTracker</code> configuration (at the end). Special <code>JobTracker</code> configuration is not required, because for all other Hazelcast features you can use "default" as the configuration name. However, special configurations offer better options to predict behavior of the framework execution.</p>
</div>
<div class="paragraph">
<p>The full example is available <a href="http://github.com/noctarius/hz-map-reduce">here</a> as a ready to run Maven project.</p>
</div>
<div class="sect4">
<h5 id="retrieving-a-jobtracker-instance"><a class="anchor" href="#retrieving-a-jobtracker-instance"></a><a class="link" href="#retrieving-a-jobtracker-instance">Retrieving a JobTracker Instance</a></h5>
<div class="paragraph">
<p><code>JobTracker</code> creates Job instances, whereas every instance of <code>com.hazelcast.mapreduce.Job</code> defines a single MapReduce configuration. The same Job can be submitted multiple times regardless of whether it is executed in parallel or after the previous execution is finished.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
After retrieving the <code>JobTracker</code>, be aware that it should only be used with data structures derived from the same HazelcastInstance. Otherwise, you can get unexpected behavior.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To retrieve a <code>JobTracker</code> from Hazelcast, we will start by using the "default" configuration for convenience reasons to show the basic way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JobTracker jobTracker = hazelcastInstance.getJobTracker( <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>JobTracker</code> is retrieved using the same kind of entry point as most other Hazelcast features. After building the cluster connection, you use the created HazelcastInstance to request the configured (or default) <code>JobTracker</code> from Hazelcast.</p>
</div>
<div class="paragraph">
<p>The next step will be to create a new <code>Job</code> and configure it to execute our first MapReduce request against cluster data.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-a-job"><a class="anchor" href="#creating-a-job"></a><a class="link" href="#creating-a-job">Creating a Job</a></h5>
<div class="paragraph">
<p>As mentioned in the previous section, you create a Job using the retrieved <code>JobTracker</code> instance. A Job defines exactly one configuration of a MapReduce task. Mapper, combiner and reducers will be defined per job. However, since the Job instance is only a configuration, it can be submitted multiple times, regardless of whether executions happen in parallel or one after the other.</p>
</div>
<div class="paragraph">
<p>A submitted job is always identified using a unique combination of the `JobTracker&#8217;s name and a jobId generated on submit-time. The way to retrieve the jobId will be shown in one of the later sections.</p>
</div>
<div class="paragraph">
<p>To create a Job, a second class <code>com.hazelcast.mapreduce.KeyValueSource</code> is necessary. We will have a deeper look at the <code>KeyValueSource</code> class in the next section. <code>KeyValueSource</code> is used to wrap any kind of data or data structure into a well defined set of key-value pairs.</p>
</div>
<div class="paragraph">
<p>The example code below is a direct follow up to the example in <a href="#retrieving-a-jobtracker-instance">Retrieving a JobTracker Instance</a>. It reuses the already created HazelcastInstance and <code>JobTracker</code> instances.</p>
</div>
<div class="paragraph">
<p>The example starts by retrieving an instance of our data map and then it creates the Job instance. Implementations used to configure the Job will be discussed while walking further through the API documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since the Job class is highly dependent upon generics to support type safety, the generics change over time and may not be assignment compatible to old variable types. To make use of the full potential of the fluent API, we recommend you use fluent method chaining as shown in this example to prevent the need for too many variables.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">articles</span><span class="delimiter">&quot;</span></span> );
KeyValueSource&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; source = KeyValueSource.fromMap( map );
Job&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; job = jobTracker.newJob( source );

ICompletableFuture&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt;&gt; future = job
    .mapper( <span class="keyword">new</span> TokenizerMapper() )
    .combiner( <span class="keyword">new</span> WordCountCombinerFactory() )
    .reducer( <span class="keyword">new</span> WordCountReducerFactory() )
    .submit();

<span class="comment">// Attach a callback listener</span>
future.andThen( buildCallback() );

<span class="comment">// Wait and retrieve the result</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt; result = future.get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>As seen above, we create the Job instance and define a mapper, combiner and reducer. Then we submit the request to the cluster. The <code>submit</code> method returns an ICompletableFuture that can be used to attach our callbacks or to wait for the result to be processed in a blocking fashion.</p>
</div>
<div class="paragraph">
<p>There are more options available for job configurations, such as defining a general chunk size or on what keys the operation will operate. For more information, please refer to the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/mapreduce/Job.html">Hazelcast source code for Job.java</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-key-value-input-sources-with-keyvaluesource"><a class="anchor" href="#creating-key-value-input-sources-with-keyvaluesource"></a><a class="link" href="#creating-key-value-input-sources-with-keyvaluesource">Creating Key-Value Input Sources with KeyValueSource</a></h5>
<div class="paragraph">
<p><code>KeyValueSource</code> can either wrap Hazelcast data structures (like IMap, MultiMap, IList, ISet) into key-value pair input sources, or build your own custom key-value input source. The latter option makes it possible to feed Hazelcast MapReduce with all kinds of data, such as just-in-time downloaded web page contents or data files. People familiar with Hadoop will recognize similarities with the Input class.</p>
</div>
<div class="paragraph">
<p>You can imagine a <code>KeyValueSource</code> as a bigger <code>java.util.Iterator</code> implementation. Whereas most methods must be implemented, implementing the <code>getAllKeys</code> method is optional. If implementation is able to gather all keys upfront, it should be implemented and <code>isAllKeysSupported</code> must return <code>true</code>. That way, Job configured KeyPredicates are able to evaluate keys upfront before sending them to the cluster. Otherwise they are serialized and transferred as well, to be evaluated at execution time.</p>
</div>
<div class="paragraph">
<p>As shown in the example above, the abstract <code>KeyValueSource</code> class provides a number of static methods to easily wrap Hazelcast data structures into <code>KeyValueSource</code> implementations already provided by Hazelcast. The data structures' generics are inherited by the resulting <code>KeyValueSource</code> instance. For data structures like IList or ISet, the key type is always String. While mapping, the key is the data structure&#8217;s name, whereas
the value type and value itself are inherited from the IList or ISet itself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// KeyValueSource from com.hazelcast.core.IMap</span>
IMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-map</span><span class="delimiter">&quot;</span></span> );
KeyValueSource&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; source = KeyValueSource.fromMap( map );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// KeyValueSource from com.hazelcast.core.MultiMap</span>
MultiMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; multiMap = hazelcastInstance.getMultiMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-multimap</span><span class="delimiter">&quot;</span></span> );
KeyValueSource&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; source = KeyValueSource.fromMultiMap( multiMap );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// KeyValueSource from com.hazelcast.core.IList</span>
IList&lt;<span class="predefined-type">String</span>&gt; list = hazelcastInstance.getList( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-list</span><span class="delimiter">&quot;</span></span> );
KeyValueSource&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; source = KeyValueSource.fromList( list );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// KeyValueSource from com.hazelcast.core.ISet</span>
ISet&lt;<span class="predefined-type">String</span>&gt; set = hazelcastInstance.getSet( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-set</span><span class="delimiter">&quot;</span></span> );
KeyValueSource&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; source = KeyValueSource.fromSet( set );</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>PartitionIdAware</strong></p>
</div>
<div class="paragraph">
<p>The <code>com.hazelcast.mapreduce.PartitionIdAware</code> interface can be implemented by the <code>KeyValueSource</code> implementation if the underlying data set is aware of the Hazelcast partitioning schema (as it is for all internal data structures). If this interface is implemented, the same <code>KeyValueSource</code> instance is reused multiple times for all partitions on the cluster member. As a consequence, the <code>close</code> and <code>open</code> methods are also executed
multiple times but once per partitionId.</p>
</div>
</div>
<div class="sect4">
<h5 id="implementing-mapping-logic-with-mapper"><a class="anchor" href="#implementing-mapping-logic-with-mapper"></a><a class="link" href="#implementing-mapping-logic-with-mapper">Implementing Mapping Logic with Mapper</a></h5>
<div class="paragraph">
<p>Using the <code>Mapper</code> interface, you will implement the mapping logic. Mappers can transform, split, calculate and aggregate data from data sources. In Hazelcast you can also integrate data from more than the KeyValueSource data source by implementing <code>com.hazelcast.core.HazelcastInstanceAware</code> and requesting additional maps, multimaps, list and/or sets.</p>
</div>
<div class="paragraph">
<p>The mappers <code>map</code> function is called once per available entry in the data structure. If you work on distributed data structures that operate in a partition-based fashion, multiple mappers work in parallel on the different cluster members on the members' assigned partitions. Mappers then prepare and maybe transform the input key-value pair and emit zero or more key-value pairs for the reducing phase.</p>
</div>
<div class="paragraph">
<p>For our word count example, we retrieve an input document (a text document) and we transform it by splitting the text into the available words. After that, as discussed in the <a href="#mapreduce-workflow-example">pseudo code</a>, we emit every single word with a key-value pair with the word as the key and 1 as the value.</p>
</div>
<div class="paragraph">
<p>A common implementation of that <code>Mapper</code> might look like the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TokenizerMapper</span> <span class="directive">implements</span> Mapper&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>, <span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt; {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Long</span> ONE = <span class="predefined-type">Long</span>.valueOf( <span class="integer">1L</span> );

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> map(<span class="predefined-type">String</span> key, <span class="predefined-type">String</span> document, <span class="predefined-type">Context</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt; context) {
        <span class="predefined-type">StringTokenizer</span> tokenizer = <span class="keyword">new</span> <span class="predefined-type">StringTokenizer</span>( document.toLowerCase() );
        <span class="keyword">while</span> ( tokenizer.hasMoreTokens() ) {
            context.emit( tokenizer.nextToken(), ONE );
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code splits the mapped texts into their tokens, iterates over the tokenizer as long as there are more tokens and emits a pair per word. Note that we&#8217;re not yet collecting multiple occurrences of the same word, we just fire every word on its own.</p>
</div>
<div class="paragraph">
<p><strong>LifecycleMapper / LifecycleMapperAdapter</strong></p>
</div>
<div class="paragraph">
<p>The LifecycleMapper interface or its adapter class LifecycleMapperAdapter can be used to make the Mapper implementation lifecycle aware. That means it will be notified when mapping of a partition or set of data begins and when the last entry was mapped.</p>
</div>
<div class="paragraph">
<p>Only special algorithms might need those additional lifecycle events to prepare, clean up, or emit additional values.</p>
</div>
</div>
<div class="sect4">
<h5 id="minimizing-cluster-traffic-with-combiner"><a class="anchor" href="#minimizing-cluster-traffic-with-combiner"></a><a class="link" href="#minimizing-cluster-traffic-with-combiner">Minimizing Cluster Traffic with Combiner</a></h5>
<div class="paragraph">
<p>As stated in the introduction, a Combiner is used to minimize traffic between the different cluster members when transmitting mapped values from mappers to the reducers. It does this by aggregating multiple values for the same emitted key. This is a fully optional operation, but using it is highly recommended.</p>
</div>
<div class="paragraph">
<p>Combiners can be seen as an intermediate reducer. The calculated value is always assigned back to the key for which the combiner initially was created. Since combiners are created per emitted key, the Combiner implementation itself is not defined in the jobs configuration; instead, a CombinerFactory that is able to create the expected Combiner instance is created.</p>
</div>
<div class="paragraph">
<p>Because Hazelcast MapReduce is executing the mapping and reducing phases in parallel, the Combiner implementation must be able to deal with chunked data. Therefore, you must reset its internal state whenever you call <code>finalizeChunk</code>. Calling the <code>finalizeChunk</code> method creates a chunk of intermediate data to be grouped (shuffled) and sent to the reducers.</p>
</div>
<div class="paragraph">
<p>Combiners can override <code>beginCombine</code> and <code>finalizeCombine</code> to perform preparation or cleanup work.</p>
</div>
<div class="paragraph">
<p>For our word count example, we are going to have a simple CombinerFactory and Combiner implementation similar to the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">WordCountCombinerFactory</span>
    <span class="directive">implements</span> CombinerFactory&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>, <span class="predefined-type">Long</span>&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Combiner&lt;<span class="predefined-type">Long</span>, <span class="predefined-type">Long</span>&gt; newCombiner( <span class="predefined-type">String</span> key ) {
        <span class="keyword">return</span> <span class="keyword">new</span> WordCountCombiner();
    }

    <span class="directive">private</span> <span class="type">class</span> <span class="class">WordCountCombiner</span> <span class="directive">extends</span> Combiner&lt;<span class="predefined-type">Long</span>, <span class="predefined-type">Long</span>&gt; {
        <span class="directive">private</span> <span class="type">long</span> sum = <span class="integer">0</span>;

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> combine( <span class="predefined-type">Long</span> value ) {
            sum++;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Long</span> finalizeChunk() {
            <span class="keyword">return</span> sum;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> reset() {
            sum = <span class="integer">0</span>;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Combiner must be able to return its current value as a chunk and reset the internal state by setting <code>sum</code> back to 0. Since combiners are always called from a single thread, no synchronization or volatility of the variables is necessary.</p>
</div>
</div>
<div class="sect4">
<h5 id="doing-algorithm-work-with-reducer"><a class="anchor" href="#doing-algorithm-work-with-reducer"></a><a class="link" href="#doing-algorithm-work-with-reducer">Doing Algorithm Work with Reducer</a></h5>
<div class="paragraph">
<p>Reducers do the last bit of algorithm work. This can be aggregating values, calculating averages, or any other work that is expected from the algorithm.</p>
</div>
<div class="paragraph">
<p>Since values arrive in chunks, the <code>reduce</code> method is called multiple times for every emitted value of the creation key. This also can happen multiple times per chunk if no Combiner implementation was configured for a job configuration.</p>
</div>
<div class="paragraph">
<p>Unlike combiners, a reducer&#8217;s <code>finalizeReduce</code> method is only called once per reducer (which means once per key). Therefore, a reducer does not need to reset its internal state at any time.</p>
</div>
<div class="paragraph">
<p>Reducers can override <code>beginReduce</code> to perform preparation work.</p>
</div>
<div class="paragraph">
<p>For our word count example, the implementation will look similar to the following code example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">WordCountReducerFactory</span> <span class="directive">implements</span> ReducerFactory&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>, <span class="predefined-type">Long</span>&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Reducer&lt;<span class="predefined-type">Long</span>, <span class="predefined-type">Long</span>&gt; newReducer( <span class="predefined-type">String</span> key ) {
        <span class="keyword">return</span> <span class="keyword">new</span> WordCountReducer();
    }

    <span class="directive">private</span> <span class="type">class</span> <span class="class">WordCountReducer</span> <span class="directive">extends</span> Reducer&lt;<span class="predefined-type">Long</span>, <span class="predefined-type">Long</span>&gt; {
        <span class="directive">private</span> <span class="directive">volatile</span> <span class="type">long</span> sum = <span class="integer">0</span>;

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> reduce( <span class="predefined-type">Long</span> value ) {
            sum += value.longValue();
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Long</span> finalizeReduce() {
            <span class="keyword">return</span> sum;
        }
    }
}</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="reducers-switching-threads"><a class="anchor" href="#reducers-switching-threads"></a><a class="link" href="#reducers-switching-threads">Reducers Switching Threads</a></h6>
<div class="paragraph">
<p>Unlike combiners, reducers tend to switch threads if running out of data to prevent blocking threads from the <code>JobTracker</code> configuration. They are rescheduled at a later point when new data to be processed arrives, but are unlikely to be executed on the same thread as before. As of Hazelcast version 3.3.3 the guarantee for memory visibility on the new thread is ensured by the framework. This means the previous requirement for making fields volatile is dropped.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="modifying-the-result-with-collator"><a class="anchor" href="#modifying-the-result-with-collator"></a><a class="link" href="#modifying-the-result-with-collator">Modifying the Result with Collator</a></h5>
<div class="paragraph">
<p>A Collator is an optional operation that is executed on the job emitting member and is able to modify the finally reduced result before returned to the user&#8217;s codebase. Only special use cases are likely to use collators.</p>
</div>
<div class="paragraph">
<p>For an imaginary use case, we might want to know how many words were all over in the documents we analyzed. For this case, a Collator implementation can be given to the <code>submit</code> method of the Job instance.</p>
</div>
<div class="paragraph">
<p>A collator would look like the following snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">WordCountCollator</span> <span class="directive">implements</span> <span class="predefined-type">Collator</span>&lt;<span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt;, <span class="predefined-type">Long</span>&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Long</span> collate( <span class="predefined-type">Iterable</span>&lt;<span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt;&gt; values ) {
        <span class="type">long</span> sum = <span class="integer">0</span>;

        <span class="keyword">for</span> ( <span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt; entry : values ) {
            sum += entry.getValue().longValue();
        }
        <span class="keyword">return</span> sum;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The definition of the input type is a bit strange, but because Combiner and Reducer implementations are optional, the input type heavily depends on the state of the data. As stated above, collators are non-typical use cases and the generics of the framework always help in finding the correct signature.</p>
</div>
</div>
<div class="sect4">
<h5 id="preselecting-keys-with-keypredicate"><a class="anchor" href="#preselecting-keys-with-keypredicate"></a><a class="link" href="#preselecting-keys-with-keypredicate">Preselecting Keys with KeyPredicate</a></h5>
<div class="paragraph">
<p>You can use <code>KeyPredicate</code> to pre-select whether or not a key should be selected for mapping in the mapping phase. If the <code>KeyValueSource</code> implementation is able to know all keys prior to execution, the keys are filtered before the operations are divided among the different cluster members.</p>
</div>
<div class="paragraph">
<p>A <code>KeyPredicate</code> can also be used to select only a special range of data, e.g., a time frame, or in similar use cases.</p>
</div>
<div class="paragraph">
<p>A basic <code>KeyPredicate</code> implementation that only maps keys containing the word "hazelcast" might look like the following code example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">WordCountKeyPredicate</span> <span class="directive">implements</span> KeyPredicate&lt;<span class="predefined-type">String</span>&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> evaluate( <span class="predefined-type">String</span> s ) {
        <span class="keyword">return</span> s != <span class="predefined-constant">null</span> &amp;&amp; s.toLowerCase().contains( <span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast</span><span class="delimiter">&quot;</span></span> );
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="job-monitoring-with-trackablejob"><a class="anchor" href="#job-monitoring-with-trackablejob"></a><a class="link" href="#job-monitoring-with-trackablejob">Job Monitoring with TrackableJob</a></h5>
<div class="paragraph">
<p>You can retrieve a <code>TrackableJob</code> instance after submitting a job. It is requested from the <code>JobTracker</code> using the unique jobId (per <code>JobTracker</code>). You can use it get runtime statistics of the job. The information available is limited to the number of processed (mapped) records and the processing state of the different partitions or members (if <code>KeyValueSource</code> is not PartitionIdAware).</p>
</div>
<div class="paragraph">
<p>To retrieve the jobId after submission of the job, use <code>com.hazelcast.mapreduce.JobCompletableFuture</code> instead of the <code>com.hazelcast.core.ICompletableFuture</code> as the variable type for the returned future.</p>
</div>
<div class="paragraph">
<p>The example code below gives a quick introduction on how to retrieve the instance and the runtime data. For more information, please have a look at the Javadoc corresponding your running Hazelcast version.</p>
</div>
<div class="paragraph">
<p>The example performs the following steps to get the job instance.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It gets the map with the hazelcastInstance <code>getMap</code> method.</p>
</li>
<li>
<p>From the map, it gets the source with the KeyValueSource <code>fromMap</code> method.</p>
</li>
<li>
<p>From the source, it gets a job with the JobTracker <code>newJob</code> method.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">articles</span><span class="delimiter">&quot;</span></span> );
KeyValueSource&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; source = KeyValueSource.fromMap( map );
Job&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; job = jobTracker.newJob( source );

JobCompletableFuture&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt;&gt; future = job
    .mapper( <span class="keyword">new</span> TokenizerMapper() )
    .combiner( <span class="keyword">new</span> WordCountCombinerFactory() )
    .reducer( <span class="keyword">new</span> WordCountReducerFactory() )
    .submit();

<span class="predefined-type">String</span> jobId = future.getJobId();
TrackableJob trackableJob = jobTracker.getTrackableJob(jobId);

JobProcessInformation stats = trackableJob.getJobProcessInformation();
<span class="type">int</span> processedRecords = stats.getProcessedRecords();
log( <span class="string"><span class="delimiter">&quot;</span><span class="content">ProcessedRecords: </span><span class="delimiter">&quot;</span></span> + processedRecords );

JobPartitionState<span class="type">[]</span> partitionStates = stats.getPartitionStates();
<span class="keyword">for</span> ( JobPartitionState partitionState : partitionStates ) {
    log( <span class="string"><span class="delimiter">&quot;</span><span class="content">PartitionOwner: </span><span class="delimiter">&quot;</span></span> + partitionState.getOwner()
          + <span class="string"><span class="delimiter">&quot;</span><span class="content">, Processing state: </span><span class="delimiter">&quot;</span></span> + partitionState.getState().name() );
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Caching of the JobProcessInformation does not work on Java native clients since current values are retrieved while retrieving the instance to minimize traffic between executing member and client.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="configuring-jobtracker"><a class="anchor" href="#configuring-jobtracker"></a><a class="link" href="#configuring-jobtracker">Configuring JobTracker</a></h5>
<div class="paragraph">
<p>You configure <code>JobTracker</code> configuration to set up behavior of the Hazelcast MapReduce framework.</p>
</div>
<div class="paragraph">
<p>Every <code>JobTracker</code> is capable of running multiple MapReduce jobs at once; one configuration is meant as a shared resource for all jobs created by the same <code>JobTracker</code>. The configuration gives full control over the expected load behavior and thread counts to be used.</p>
</div>
<div class="paragraph">
<p>The following snippet shows a typical <code>JobTracker</code> configuration. The configuration properties are discussed below the example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;jobtracker name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;max-thread-size&gt;<span class="integer">0</span>&lt;/max-thread-size&gt;
  &lt;!-- <span class="predefined-type">Queue</span> size <span class="integer">0</span> means number of partitions * <span class="integer">2</span> --&gt;
  &lt;queue-size&gt;<span class="integer">0</span>&lt;/queue-size&gt;
  &lt;retry-count&gt;<span class="integer">0</span>&lt;/retry-count&gt;
  &lt;chunk-size&gt;<span class="integer">1000</span>&lt;/chunk-size&gt;
  &lt;communicate-stats&gt;<span class="predefined-constant">true</span>&lt;/communicate-stats&gt;
  &lt;topology-changed-strategy&gt;CANCEL_RUNNING_OPERATION&lt;/topology-changed-strategy&gt;
&lt;/jobtracker&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>max-thread-size</code>: Maximum thread pool size of the JobTracker.</p>
</li>
<li>
<p><code>queue-size</code>: Maximum number of tasks that are able to wait to be processed. A value of 0 means an unbounded queue. Very low numbers can prevent successful execution since the job might not be correctly scheduled or intermediate chunks might be lost.</p>
</li>
<li>
<p><code>retry-count</code>: Currently not used. Reserved for later use where the framework will automatically try to restart/retry operations from an available save point.</p>
</li>
<li>
<p><code>chunk-size</code>: Number of emitted values before a chunk is sent to the reducers. If your emitted values are big or you want to better balance your work, you might want to change this to a lower or higher value. A value of 0 means immediate transmission, but remember that low values mean higher traffic costs. A very high value might cause an OutOfMemoryError to occur if the emitted values do not fit into heap memory before
being sent to the reducers. To prevent this, you might want to use a combiner to pre-reduce values on mapping members.</p>
</li>
<li>
<p><code>communicate-stats</code>: Specifies whether the statistics (for example, statistics about processed entries) are transmitted to the job emitter. This can show progress to a user inside of an UI system, but it produces additional traffic. If not needed, you might want to deactivate this.</p>
</li>
<li>
<p><code>topology-changed-strategy</code>: Specifies how the MapReduce framework reacts on topology changes while executing a job. Currently, only CANCEL_RUNNING_OPERATION is fully supported, which throws an exception to the job emitter (will throw a <code>com.hazelcast.mapreduce.TopologyChangedException</code>).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-mapreduce-architecture"><a class="anchor" href="#hazelcast-mapreduce-architecture"></a><a class="link" href="#hazelcast-mapreduce-architecture">11.4.3. Hazelcast MapReduce Architecture</a></h4>
<div class="paragraph">
<p>This section explains some of the internals of the MapReduce framework. This is more advanced information. If you&#8217;re not interested in how it works internally, you might want to skip this section.</p>
</div>
<div class="sect4">
<h5 id="member-interoperation-example"><a class="anchor" href="#member-interoperation-example"></a><a class="link" href="#member-interoperation-example">Member Interoperation Example</a></h5>
<div class="paragraph">
<p>To understand the following technical internals, we first have a short look at what happens in terms of an example workflow.</p>
</div>
<div class="paragraph">
<p>As a simple example, think of an <code>IMap&lt;String, Integer&gt;</code> and emitted keys having the same types. Imagine you have a cluster with three members and you initiate the MapReduce job on the first member. After you requested the JobTracker from your running/connected Hazelcast, we submit the task and retrieve the ICompletableFuture, which gives us a chance to wait for the result to be calculated or to add a callback (and being more reactive).</p>
</div>
<div class="paragraph">
<p>The example expects that the chunk size is 0 or 1, so an emitted value is directly sent to the reducers. Internally, the job is prepared, started and executed on all members as shown below. The first member acts as the job owner (job emitter).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Member1 starts MapReduce job
Member1 emits key=Foo, value=<span class="integer">1</span>
Member1 does PartitionService::getKeyOwner(Foo) =&gt; results in Member3

Member2 emits key=Foo, value=<span class="integer">14</span>
Member2 asks jobOwner (Member1) <span class="keyword">for</span> keyOwner of Foo =&gt; results in Member3

Member1 sends chunk <span class="keyword">for</span> key=Foo to Member3

Member3 receives chunk <span class="keyword">for</span> key=Foo and looks <span class="keyword">if</span> there is already a Reducer,
      <span class="keyword">if</span> not creates one <span class="keyword">for</span> key=Foo
Member3 processes chunk <span class="keyword">for</span> key=Foo

Member2 sends chunk <span class="keyword">for</span> key=Foo to Member3

Member3 receives chunk <span class="keyword">for</span> key=Foo and looks <span class="keyword">if</span> there is already a Reducer and uses
      the previous one
Member3 processes chunk <span class="keyword">for</span> key=Foo

Member1 send LastChunk information to Member3 because processing local values finished

Member2 emits key=Foo, value=<span class="integer">27</span>
Member2 has cached keyOwner of Foo =&gt; results in Member3
Member2 sends chunk <span class="keyword">for</span> key=Foo to Member3

Member3 receives chunk <span class="keyword">for</span> key=Foo and looks <span class="keyword">if</span> there is already a Reducer and uses
      the previous one
Member3 processes chunk <span class="keyword">for</span> key=Foo

Member2 send LastChunk information to Member3 because processing local values finished

Member3 finishes reducing <span class="keyword">for</span> key=Foo

Member1 registers its local partitions are processed
Member2 registers its local partitions are processed

Member1 sees all partitions processed and requests reducing from all members

Member1 merges all reduced results together in a <span class="directive">final</span> structure and returns it</code></pre>
</div>
</div>
<div class="paragraph">
<p>The flow is quite complex but extremely powerful since everything is executed in parallel. Reducers do not wait until all values are emitted, but they immediately begin to reduce (when the first chunk for an emitted key arrives).</p>
</div>
</div>
<div class="sect4">
<h5 id="internal-mapreduce-packages"><a class="anchor" href="#internal-mapreduce-packages"></a><a class="link" href="#internal-mapreduce-packages">Internal MapReduce Packages</a></h5>
<div class="paragraph">
<p>Beginning with the package level, there is one basic package: <code>com.hazelcast.mapreduce</code>. This includes the external API and the <strong>impl</strong> package, which itself contains the internal implementation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>impl</strong> package contains all the default <code>KeyValueSource</code> implementations and abstract base and support classes for the exposed API.</p>
</li>
<li>
<p>The <strong>client</strong> package contains all classes that are needed on the client and member sides when a client offers a MapReduce job.</p>
</li>
<li>
<p>The <strong>notification</strong> package contains all "notification" or event classes that notify other members about progress on operations.</p>
</li>
<li>
<p>The <strong>operation</strong> package contains all operations that are used by the workers or job owner to coordinate work and sync partition or reducer processing.</p>
</li>
<li>
<p>The <strong>task</strong> package contains all classes that execute the actual MapReduce operation. It features the supervisor, mapping phase implementation and mapping/reducing tasks.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="mapreduce-job-walk-through"><a class="anchor" href="#mapreduce-job-walk-through"></a><a class="link" href="#mapreduce-job-walk-through">MapReduce Job Walk-Through</a></h5>
<div class="paragraph">
<p>Now to the technical walk-through: A MapReduce Job is always retrieved from a named <code>JobTracker</code>, which is implemented in <code>NodeJobTracker</code> (extends <code>AbstractJobTracker</code>) and is configured using the configuration DSL. All of the internal implementation is completely ICompletableFuture-driven and mostly non-blocking in design.</p>
</div>
<div class="paragraph">
<p>On submit, the Job creates a unique UUID which afterwards acts as a jobId and is combined with the JobTracker&#8217;s name to be uniquely identifiable inside the cluster. Then, the preparation is sent around the cluster and every member prepares its execution by creating a JobSupervisor, MapCombineTask and ReducerTask. The job-emitting JobSupervisor gains special capabilities to synchronize and control JobSupervisors on other members for the same job.</p>
</div>
<div class="paragraph">
<p>If preparation is finished on all members, the job itself is started by executing a StartProcessingJobOperation on every member. This initiates a MappingPhase implementation (defaults to KeyValueSourceMappingPhase) and starts the actual mapping on the members.</p>
</div>
<div class="paragraph">
<p>The mapping process is currently a single threaded operation per member, but will be extended to run in parallel on multiple partitions (configurable per Job) in future versions. The Mapper is now called on every available value on the partition and eventually emits values. For every emitted value, either a configured CombinerFactory is called to create a Combiner or a cached one is used (or the default CollectingCombinerFactory is used to create Combiners). When the chunk limit is reached on a member, a IntermediateChunkNotification is prepared by collecting emitted keys to their corresponding members. This is either done by asking the job owner to assign members or by an already cached assignment. In later versions, a PartitionStrategy might also be configurable.</p>
</div>
<div class="paragraph">
<p>The IntermediateChunkNotification is then sent to the reducers (containing only values for this member) and is offered to the ReducerTask. On every offer, the ReducerTask checks if it is already running and if not, it submits itself to the configured ExecutorService (from the JobTracker configuration).</p>
</div>
<div class="paragraph">
<p>If reducer queue runs out of work, the ReducerTask is removed from the ExecutorService to not block threads but eventually will be resubmitted on next chunk of work.</p>
</div>
<div class="paragraph">
<p>On every phase, the partition state is changed to keep track of the currently running operations. A JobPartitionState can be in one of the following states with self-explanatory titles: <code>[WAITING, MAPPING, REDUCING, PROCESSED, CANCELLED]</code>. If you have a deeper interest of these states, look at the Javadoc.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Member asks for new partition to process: WAITING &#8658; MAPPING</p>
</li>
<li>
<p>Member emits first chunk to a reducer: MAPPING &#8658; REDUCING</p>
</li>
<li>
<p>All members signal that they finished mapping phase and reducing is finished, too: REDUCING &#8658; PROCESSED</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Eventually, all JobPartitionStates reach the state of PROCESSED. Then, the job emitter&#8217;s JobSupervisor asks all members for their reduced results and executes a potentially offered Collator. With this Collator, the overall result is calculated before it removes itself from the JobTracker, doing some final cleanup and returning the result to the requester (using the internal TrackableJobFuture).</p>
</div>
<div class="paragraph">
<p>If a job is cancelled while execution, all partitions are immediately set to the CANCELLED state and a CancelJobSupervisorOperation is executed on all members to kill the running processes.</p>
</div>
<div class="paragraph">
<p>While the operation is running in addition to the default operations, some more operations like
ProcessStatsUpdateOperation (updates processed records statistics) or NotifyRemoteExceptionOperation (notifies the members that the sending member encountered an unrecoverable situation and the Job needs to
be cancelled, e.g., NullPointerException inside of a Mapper, are executed against the job owner to keep track of the process.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mapreduce-deprecation"><a class="anchor" href="#mapreduce-deprecation"></a><a class="link" href="#mapreduce-deprecation">11.4.4. MapReduce Deprecation</a></h4>
<div class="paragraph">
<p>This section informs Hazelcast users about the MapReduce deprecation, it&#8217;s motivation and replacements.</p>
</div>
<div class="sect4">
<h5 id="motivation"><a class="anchor" href="#motivation"></a><a class="link" href="#motivation">Motivation</a></h5>
<div class="paragraph">
<p>We&#8217;ve decided to deprecate the MapReduce framework in Hazelcast IMDG 3.8. The MapReduce framework provided the distributed computing model and it was used to back the old Aggregations system. Unfortunately the implementation didn&#8217;t live up to the expectations and adoption wasn&#8217;t high, so it never got out of Beta status. Apart from that the current shift in development away from M/R-like processing to a more near-realtime, streaming approach left us with the decision to deprecate and finally remove the MapReduce framework from Hazelcast IMDG. With that said, we want to introduce the successors and replacements; Fast Aggregations on top of Query infrastructure and the Hazelcast Jet distributed computing platform.</p>
</div>
</div>
<div class="sect4">
<h5 id="built-in-aggregations"><a class="anchor" href="#built-in-aggregations"></a><a class="link" href="#built-in-aggregations">Built-In Aggregations</a></h5>
<div class="paragraph">
<p>MapReduce is a very powerful tool, however it&#8217;s demanding in terms of space, time and bandwidth. We realized that we don&#8217;t need so much power when we simply want to find out a simple metric such as the number of entries matching a predicate. Therefore, the built-in aggregations were rebuilt on top of the existing Query infrastructure (count, sum, min, max, mean, variance) which automatically leverages any matching query index. The aggregations are computed in tho phases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1st phase: on each member (scatter)</p>
</li>
<li>
<p>2nd phase: one member aggregates responses from members (gather)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is not as flexible as a full-blown M/R system due to the 2nd phase being single-member and the input can be massive in some use cases. The member doing the 2nd step needs enough capacity to hold all intermediate results from all members from the 1st step, but in practice it is sufficient for many aggregation tasks like "find average" or "find highest" and other common examples.</p>
</div>
<div class="paragraph">
<p>The benefits are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Improved performance</p>
</li>
<li>
<p>Simplified API</p>
</li>
<li>
<p>Utilization of existing indexes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can refer to <a href="#fast-aggregations">Fast Aggregations</a> for examples. If you need a more powerful tool like MapReduce, then there is Hazelcast Jet!</p>
</div>
</div>
<div class="sect4">
<h5 id="distributed-computation-with-jet"><a class="anchor" href="#distributed-computation-with-jet"></a><a class="link" href="#distributed-computation-with-jet">Distributed Computation with Jet</a></h5>
<div class="paragraph">
<p>Hazelcast Jet is the new distributed computing framework build on top of Hazelcast IMDG. It uses directed acyclic graphs (DAG) to model relationships between individual steps in the data processing pipeline.
Conceptually speaking, the MapReduce model simply states that distributed computation on a large dataset can be boiled down to two kinds of computation steps - a map step and a reduce step. One pair of map and reduce does one level of aggregation over data. Complex computations typically require multiple such steps. Multiple M/R-steps essentially form a DAG of operations, so that a DAG execution model boils down to a generalization of the MapReduce model.
Therefore it is always possible to rewrite a MapReduce application to Hazelcast Jet DAG or "pipeline of tasks" without conceptual changes.</p>
</div>
<div class="paragraph">
<p>Benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>M/R steps are completely isolated (by definition). With the whole computation modeled as a DAG, the Jet scheduler can optimize the operation pipeline</p>
</li>
<li>
<p>Hazelcast Jet provides a convenient high-level API (distributed j.u.stream). The code stays compact but also offers a more concrete API to leverage the full power of DAGs.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="moving-mapreduce-tasks-to-hazelcast-jet"><a class="anchor" href="#moving-mapreduce-tasks-to-hazelcast-jet"></a><a class="link" href="#moving-mapreduce-tasks-to-hazelcast-jet">Moving MapReduce Tasks to Hazelcast Jet</a></h6>
<div class="paragraph">
<p>We&#8217;ll use the example of the "word count" application which summarizes a set of documents into a mapping from each word to the total number of its occurrences in the documents. This involves both a mapping stage where one document is transformed into a stream of words and a reducing stage that performs a COUNT DISTINCT operation on the stream and populates a Hazelcast IMap with the results.</p>
</div>
<div class="paragraph">
<p>This is the word count code in MapReduce (also available on <a href="https://github.com/hazelcast/hazelcast-jet-code-samples/blob/v0.4/batch/mapreduce-migration/src/main/java/WordCountCoreApi.java">hazelcast-jet-code-samples</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JobTracker t = hz.getJobTracker(<span class="string"><span class="delimiter">&quot;</span><span class="content">word-count</span><span class="delimiter">&quot;</span></span>);
IMap&lt;<span class="predefined-type">Long</span>, <span class="predefined-type">String</span>&gt; documents = hz.getMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">documents</span><span class="delimiter">&quot;</span></span>);
LongSumAggregation&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; aggr = <span class="keyword">new</span> LongSumAggregation&lt;&gt;();
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt; counts =
        t.newJob(KeyValueSource.fromMap(documents))
         .mapper((<span class="predefined-type">Long</span> x, <span class="predefined-type">String</span> document, <span class="predefined-type">Context</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt; ctx) -&gt;
                 Stream.of(document.toLowerCase().split(<span class="string"><span class="delimiter">&quot;</span><span class="char">\\</span><span class="content">W+</span><span class="delimiter">&quot;</span></span>))
                       .filter(w -&gt; !w.isEmpty())
                       .forEach(w -&gt; ctx.emit(w, <span class="integer">1L</span>)))
         .combiner(aggr.getCombinerFactory())
         .reducer(aggr.getReducerFactory())
         .submit()
         .get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Jet&#8217;s Core API is strictly lower-level than MapReduce&#8217;s because it can be used to build the entire infrastructure that can drive MapReduce&#8217;s mapper, combiner and reducer, fully preserving the semantics of the MapReduce job. However, this approach to migrating your code to Jet is not a good option because the MapReduce API enforces a quite suboptimal computation model.
The simplest approach is implementing the job in terms of Jet&#8217;s java.util.stream support (Jet JUS for short):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IStreamMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; documents = jet.getMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">documents</span><span class="delimiter">&quot;</span></span>);
IMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt; counts = documents
        .stream()
        .flatMap(m -&gt; Stream.of(m.getValue().toLowerCase().split(<span class="string"><span class="delimiter">&quot;</span><span class="char">\\</span><span class="content">W+</span><span class="delimiter">&quot;</span></span>))
                            .filter(w -&gt; !w.isEmpty()))
        .collect(DistributedCollectors.toIMap(w -&gt; w, w -&gt; <span class="integer">1L</span>, (left, right) -&gt; left + right));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can be taken as a general template to express a MapReduce job in terms of Jet JUS: the logic of the mapper is inside flatMap and the logic of both the combiner and the reducer is inside collect. Jet will automatically apply the optimization where the data stream is first "combined" locally on each member, then the partial results "reduced" in the final step, after sending across the network.</p>
</div>
<div class="paragraph">
<p>Keep in mind that MapReduce and java.util.stream use the same terminology, but with quite different meaning: in JUS the final step is called "combine" (MapReduce calls it "reduce") and the middle step is called "reduce" (MapReduce calls this one "combine"). MapReduce&#8217;s "combine" collapses the stream in fixed-size batches, whereas in Jet JUS "reduce" collapses the complete local dataset and sends just a single item per distinct key to the final step. In Jet JUS, the final "combine" step combines just one partial result per member into the total result, whereas in MR the final step "reduces" all the one-per-batch items to the final result. Therefore, in Jet there are only O(distinct-key-count) items sent over the network whereas in MapReduce it is still O(total-item-count) with just a linear scaling factor equal to the configured batch size.</p>
</div>
<div class="paragraph">
<p>A complete example of the word count done with the Streams API can be found in the hazelcast-jet-code-samples
repository, located in the "java.util.stream/wordcount-j.u.s" module in the file WordCount.java. A minor difference is that the code on GitHub stores the documents line by line, with the effect of a finer-grained distribution across the cluster.</p>
</div>
<div class="paragraph">
<p>To better understand how the JUS pipeline is executed by Jet, take a look at the file WordCount.java in the "core/wordcount" module, which builds the same DAG as the Jet JUS implementation, but using the Jet Core API. Here is a somewhat simplified DAG from this sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">DAG dag = <span class="keyword">new</span> DAG();
Vertex source = dag.newVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">source</span><span class="delimiter">&quot;</span></span>, Processors.readMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">documents</span><span class="delimiter">&quot;</span></span>))
                   .localParallelism(<span class="integer">1</span>);
Vertex map = dag.newVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span>, Processors.flatMap(
           (<span class="predefined-type">String</span> document) -&gt; traverseArray(document.split(<span class="string"><span class="delimiter">&quot;</span><span class="char">\\</span><span class="content">W+</span><span class="delimiter">&quot;</span></span>))));
Vertex reduce = dag.newVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">reduce</span><span class="delimiter">&quot;</span></span>, Processors.groupAndAccumulate(
           () -&gt; <span class="integer">0L</span>, (count, x) -&gt; count + <span class="integer">1</span>));
Vertex combine = dag.newVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">combine</span><span class="delimiter">&quot;</span></span>, Processors.groupAndAccumulate(
           Entry::getKey,
           () -&gt; <span class="integer">0L</span>,
           (<span class="predefined-type">Long</span> count, Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt; wordAndCount) -&gt;
                     count + wordAndCount.getValue())
);
Vertex sink = dag.newVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">sink</span><span class="delimiter">&quot;</span></span>, writeMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">counts</span><span class="delimiter">&quot;</span></span>));

dag.edge(between(source, map))
   .edge(between(map, reduce).partitioned(wholeItem(), HASH_CODE))
   .edge(between(reduce, combine).partitioned(entryKey()).distributed())
   .edge(between(combine, sink));</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is a simple cascade of vertices: source &#8594; map &#8594; reduce &#8594; combine &#8594; sink and matches quite closely the workflow of a MapReduce job. On each member, a distinct slice of data (IMap partitions stored locally) is ingested by the source vertex and sent to map on the local member. The output of map are words and they travel over a partitioned edge to reduce. Note that, as opposed to MapReduce, a single instance of a processor doesn&#8217;t count occurrences of just one word, but is responsible for entire partitions. There are only as many processors as configured by the localParallelism property. This is one of several examples where Jet&#8217;s DAG exposes performance-critical attributes of the computation to the user.</p>
</div>
<div class="paragraph">
<p>Another example of this can be seen in arguments passed to partitioned(wholeItem(), HASH_CODE). The user has precise control over the partitioning key as well as the algorithm used to map the key to a partition ID. In this case we use the whole item (the word) as the key and apply the fast HASH_CODE strategy, which derives the partition ID from the object&#8217;s hashCode().</p>
</div>
<div class="paragraph">
<p>The reduce &#8594; combine edge is both partitioned and distributed. Whereas each cluster member has its own reduce processor for any given word, there is only one combine processor in the entire cluster for a given word. This is where network traffic happens: reduce sends its local results for a word to that one combine processor in the cluster. Note that here we didn&#8217;t specify HASH_CODE: it is not guaranteed to be safe on a distributed edge because on the target member the hashcode can come out differently. For many value classes (like String and Integer) it is guaranteed to work, though, because their hashCode  explicitly specifies the function used. By default Jet applies the slower but safer Hazelcast strategy: 1. serialize, 2. compute the MurmurHash3 of the resulting blob. It is up to the user to ensure that the faster strategy is safe, or to provide a custom strategy.</p>
</div>
<div class="paragraph">
<p>In the above example we can see many out-of-the-box processors being used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>readMap to ingest the data from an IMap</p>
</li>
<li>
<p>flatMap to perform a flat-map operation on incoming items (closely corresponds to MapReduce&#8217;s mapper)</p>
</li>
<li>
<p>groupAndAccumulate to perform the reduction and combining</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are some more in the Processors class.
For even more flexibility we&#8217;ll now show how you can implement a processor on your own (also available in the Code Samples repository):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MapReduce</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        Jet.newJetInstance();
        JetInstance jet = Jet.newJetInstance();
        <span class="keyword">try</span> {
            DAG dag = <span class="keyword">new</span> DAG();
            Vertex source = dag.newVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">source</span><span class="delimiter">&quot;</span></span>, readMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">sourceMap</span><span class="delimiter">&quot;</span></span>));
            Vertex map = dag.newVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span>, MapP::<span class="keyword">new</span>);
            Vertex reduce = dag.newVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">reduce</span><span class="delimiter">&quot;</span></span>, ReduceP::<span class="keyword">new</span>);
            Vertex combine = dag.newVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">combine</span><span class="delimiter">&quot;</span></span>, CombineP::<span class="keyword">new</span>);
            Vertex sink = dag.newVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">sink</span><span class="delimiter">&quot;</span></span>, writeMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">sinkMap</span><span class="delimiter">&quot;</span></span>));
            dag.edge(between(source, map))
               .edge(between(map, reduce).partitioned(wholeItem(), HASH_CODE))
               .edge(between(reduce, combine).partitioned(entryKey()).distributed())
               .edge(between(combine, sink.localParallelism(<span class="integer">1</span>)));
            jet.newJob(dag).execute().get();
        } <span class="keyword">finally</span> {
            Jet.shutdownAll();
        }
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">MapP</span> <span class="directive">extends</span> AbstractProcessor {
        <span class="directive">private</span> <span class="directive">final</span> FlatMapper&lt;Entry&lt;<span class="predefined-type">Long</span>, <span class="predefined-type">String</span>&gt;, <span class="predefined-type">String</span>&gt; flatMapper = flatMapper(
                (Entry&lt;<span class="predefined-type">Long</span>, <span class="predefined-type">String</span>&gt; e) -&gt; <span class="keyword">new</span> WordTraverser(e.getValue())
        );

        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="type">boolean</span> tryProcess0(<span class="annotation">@Nonnull</span> <span class="predefined-type">Object</span> item) {
            <span class="keyword">return</span> flatMapper.tryProcess((Entry&lt;<span class="predefined-type">Long</span>, <span class="predefined-type">String</span>&gt;) item);
        }
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">WordTraverser</span> <span class="directive">implements</span> Traverser&lt;<span class="predefined-type">String</span>&gt; {

        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">StringTokenizer</span> tokenizer;

        WordTraverser(<span class="predefined-type">String</span> document) {
            <span class="local-variable">this</span>.tokenizer = <span class="keyword">new</span> <span class="predefined-type">StringTokenizer</span>(document.toLowerCase());
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> next() {
            <span class="keyword">return</span> tokenizer.hasMoreTokens() ? tokenizer.nextToken() : <span class="predefined-constant">null</span>;
        }
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">ReduceP</span> <span class="directive">extends</span> AbstractProcessor {
        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt; wordToCount = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
        <span class="directive">private</span> <span class="directive">final</span> Traverser&lt;Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt;&gt; resultTraverser =
                lazy(() -&gt; traverseIterable(wordToCount.entrySet()));

        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="type">boolean</span> tryProcess0(<span class="annotation">@Nonnull</span> <span class="predefined-type">Object</span> item) {
            wordToCount.compute((<span class="predefined-type">String</span>) item, (x, count) -&gt; <span class="integer">1</span> + (count != <span class="predefined-constant">null</span> ? count : <span class="integer">0L</span>));
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> complete() {
            <span class="keyword">return</span> emitCooperatively(resultTraverser);
        }
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">CombineP</span> <span class="directive">extends</span> AbstractProcessor {
        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt; wordToCount = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
        <span class="directive">private</span> <span class="directive">final</span> Traverser&lt;Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt;&gt; resultTraverser =
                lazy(() -&gt; traverseIterable(wordToCount.entrySet()));

        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="type">boolean</span> tryProcess0(<span class="annotation">@Nonnull</span> <span class="predefined-type">Object</span> item) {
            <span class="directive">final</span> Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt; e = (Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Long</span>&gt;) item;
            wordToCount.compute(e.getKey(),
                    (x, count) -&gt; e.getValue() + (count != <span class="predefined-constant">null</span> ? count : <span class="integer">0L</span>));
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> complete() {
            <span class="keyword">return</span> emitCooperatively(resultTraverser);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One of the challenges of implementing a custom Processor is cooperativeness: it must back off as soon as there is no more room in the output buffer (the outbox). This example shows how to make use of another line of convenience provided at this lower level, which takes care of almost all the mechanics involved. One gotcha is that a simple for-loop must be converted to a stateful iterator-style object, like WordTraverser in the above code. To make this conversion as painless as possible we chose to not require a Java Iterator, but defined our own Traverser interface with just a single method to implement. This means that Traverser is a functional interface and can often be implemented with a one-liner lambda.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jet-compared-with-new-aggregations"><a class="anchor" href="#jet-compared-with-new-aggregations"></a><a class="link" href="#jet-compared-with-new-aggregations">Jet Compared with New Aggregations</a></h5>
<div class="paragraph">
<p>Hazelcast has native support for aggregation operations on the contents of its distributed data structures. They operate on the assumption that the aggregating function is commutative and associative, which allows the two-tiered approach where first the local data is aggregated, then all the local subresults sent to one member, where they are combined and returned to the user. This approach works quite well as long as the result is of manageable size. Many interesting aggregations produce an O(1) result and for those, the native aggregations are a good match.</p>
</div>
<div class="paragraph">
<p>The main area where native aggregations may not be sufficient are operations that group the data by key and produce results of size O(keyCount). The architecture of Hazelcast aggregations is not well adapted to this use case, although it will still work even for moderately-sized results (up to 100 MB, as a ballpark figure). Beyond these numbers, and whenever something more than a single aggregation step is needed, Jet becomes the preferred choice. In the mentioned use case Jet helps because it doesn&#8217;t send entire hashtables in serialized form and materialize all the results on the user&#8217;s machine, but rather streams the key-value pairs directly into a target IMap. Since it is a distributed structure, it doesn&#8217;t focus its load on a single member.</p>
</div>
<div class="paragraph">
<p>Jet&#8217;s DAG paradigm offers much more than the basic map-reduce-combine cascade. Among other setups it can compose several such cascades and also perform co-grouping, joining and many other operations in complex combinations.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="aggregators"><a class="anchor" href="#aggregators"></a><a class="link" href="#aggregators">11.5. Aggregators</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This feature has been deprecated. Please use the <a href="#fast-aggregations">Fast-Aggregations</a> instead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Based on the Hazelcast MapReduce framework, Aggregators are ready-to-use data aggregations. These are typical operations like
sum up values, finding minimum or maximum values, calculating averages and other operations that you would expect
in the relational database world.</p>
</div>
<div class="paragraph">
<p>Aggregation operations are implemented, as mentioned above, on top of the MapReduce framework. All operations can be
achieved using pure MapReduce calls. However, using the Aggregation feature is more convenient for a big set of standard operations.</p>
</div>
<div class="sect3">
<h4 id="aggregations-basics"><a class="anchor" href="#aggregations-basics"></a><a class="link" href="#aggregations-basics">11.5.1. Aggregations Basics</a></h4>
<div class="paragraph">
<p>This section will quickly guide you through the basics of the Aggregations framework and some of its available classes.
We also will implement a first base example.</p>
</div>
<div class="sect4">
<h5 id="aggregations-and-map-interfaces"><a class="anchor" href="#aggregations-and-map-interfaces"></a><a class="link" href="#aggregations-and-map-interfaces">Aggregations and Map Interfaces</a></h5>
<div class="paragraph">
<p>Aggregations are available on both types of map interfaces, <code>com.hazelcast.core.IMap</code> and <code>com.hazelcast
.core.MultiMap</code>, using
the <code>aggregate</code> methods. Two overloaded methods are available that customize resource management of the
underlying MapReduce framework by supplying a custom configured
<code>com.hazelcast.mapreduce.JobTracker</code> instance. To find out how to
configure the MapReduce framework, please see <a href="#configuring-jobtracker">Configuring JobTracker</a>. We will
later see another way to configure the automatically used MapReduce framework if no special <code>JobTracker</code> is supplied.</p>
</div>
</div>
<div class="sect4">
<h5 id="aggregations-and-java"><a class="anchor" href="#aggregations-and-java"></a><a class="link" href="#aggregations-and-java">Aggregations and Java</a></h5>
<div class="paragraph">
<p>To make Aggregations more convenient to use and future proof, the API is heavily optimized for Java 8 and future versions.
The API is still fully compatible with any Java version Hazelcast supports (Java 6 and Java 7). The biggest difference is how you
work with the Java generics: on Java 6 and 7, the process to resolve generics is not as strong as on Java 8 and
future Java versions. In addition, the whole Aggregations API has full Java 8 Project Lambda (or Closure,
<a href="https://jcp.org/en/jsr/detail?id=335">JSR 335</a>) support.</p>
</div>
<div class="paragraph">
<p>For illustration of the differences in Java 6 and 7 in comparison to Java 8, we will have a quick look at code
examples for both. After that, we will focus on using Java 8 syntax to keep examples short and easy to understand. We will see some hints about what the code looks like in Java 6 or 7.</p>
</div>
<div class="paragraph">
<p>The first example will produce the sum of some <code>int</code> values stored in a Hazelcast IMap. This example does not use much of the functionality of the Aggregations framework, but it will show the main difference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; personAgeMapping = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">person-age</span><span class="delimiter">&quot;</span></span> );
<span class="keyword">for</span> ( <span class="type">int</span> i = <span class="integer">0</span>; i &lt; <span class="integer">1000</span>; i++ ) {
    <span class="predefined-type">String</span> lastName = RandomUtil.randomLastName();
    <span class="type">int</span> age = RandomUtil.randomAgeBetween( <span class="integer">20</span>, <span class="integer">80</span> );
    personAgeMapping.put( lastName, <span class="predefined-type">Integer</span>.valueOf( age ) );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With our demo data prepared, we can see how to produce the sums in different Java versions.</p>
</div>
</div>
<div class="sect4">
<h5 id="aggregations-and-java-6-or-java-7"><a class="anchor" href="#aggregations-and-java-6-or-java-7"></a><a class="link" href="#aggregations-and-java-6-or-java-7">Aggregations and Java 6 or Java 7</a></h5>
<div class="paragraph">
<p>Since Java 6 and 7 are not as strong on resolving generics as Java 8, you need to be a bit more verbose
with the code you write. You might also consider using raw types but breaking the type safety to ease this process.</p>
</div>
<div class="paragraph">
<p>For a short introduction on what the following code example means, look at the source code comments. We will later dig deeper into
the different options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// No filter applied, select all entries</span>
Supplier&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; supplier = Supplier.all();
<span class="comment">// Choose the sum aggregation</span>
Aggregation&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; aggregation = Aggregations.integerSum();
<span class="comment">// Execute the aggregation</span>
<span class="type">int</span> sum = personAgeMapping.aggregate( supplier, aggregation );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aggregations-and-java-8"><a class="anchor" href="#aggregations-and-java-8"></a><a class="link" href="#aggregations-and-java-8">Aggregations and Java 8</a></h5>
<div class="paragraph">
<p>With Java 8, the Aggregations API looks simpler because Java 8 can resolve the generic parameters for us. That means
the above lines of Java 6/7 example code will end up in just one easy line on Java 8.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> sum = personAgeMapping.aggregate( Supplier.all(), Aggregations.integerSum() );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="aggregations-and-the-mapreduce-framework"><a class="anchor" href="#aggregations-and-the-mapreduce-framework"></a><a class="link" href="#aggregations-and-the-mapreduce-framework">Aggregations and the MapReduce Framework</a></h5>
<div class="paragraph">
<p>As mentioned before, the Aggregations implementation is based on the Hazelcast MapReduce framework and therefore you might find
overlaps in their APIs. One overload of the <code>aggregate</code> method can be supplied with
a <code>JobTracker</code>, which is part of the MapReduce framework.</p>
</div>
<div class="paragraph">
<p>If you implement your own aggregations, you will use a mixture of the Aggregations and
the MapReduce API. If you do so, e.g., to make the life of colleagues easier,
please read the <a href="#implementing-aggregations">Implementing Aggregations section</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-the-aggregations-api"><a class="anchor" href="#using-the-aggregations-api"></a><a class="link" href="#using-the-aggregations-api">11.5.2. Using the Aggregations API</a></h4>
<div class="paragraph">
<p>We now look into what can be achieved using the
Aggregations API. To work on some deeper examples, let&#8217;s quickly have a look at the available classes and interfaces and
discuss their usage.</p>
</div>
<div class="sect4">
<h5 id="supplier"><a class="anchor" href="#supplier"></a><a class="link" href="#supplier">Supplier</a></h5>
<div class="paragraph">
<p>The <code>com.hazelcast.mapreduce.aggregation.Supplier</code> provides filtering and data extraction to the aggregation operation.
This class already provides a few different static methods to achieve the most common cases. <code>Supplier.all()</code>
accepts all incoming values and does not apply any data extraction or transformation upon them before supplying them to
the aggregation function itself.</p>
</div>
<div class="paragraph">
<p>For filtering data sets, you have two different options by default:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can either supply a <code>com.hazelcast.query.Predicate</code> if you want to filter on values and/or keys, or</p>
</li>
<li>
<p>You can supply a <code>com.hazelcast.mapreduce.KeyPredicate</code> if you can decide directly on the data
key without the need to deserialize the value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As mentioned above, all APIs are fully Java 8 and Lambda compatible. Let&#8217;s have a look on how we can do basic filtering using
those two options.</p>
</div>
<div class="sect5">
<h6 id="basic-filtering-with-keypredicate"><a class="anchor" href="#basic-filtering-with-keypredicate"></a><a class="link" href="#basic-filtering-with-keypredicate">Basic Filtering with KeyPredicate</a></h6>
<div class="paragraph">
<p>First, we have a look at a <code>KeyPredicate</code> and we only accept people whose last name is "Jones".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Supplier&lt;...&gt; supplier = Supplier.fromKeyPredicate(
    lastName -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Jones</span><span class="delimiter">&quot;</span></span>.equalsIgnoreCase( lastName )
);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">JonesKeyPredicate</span> <span class="directive">implements</span> KeyPredicate&lt;<span class="predefined-type">String</span>&gt; {
  <span class="directive">public</span> <span class="type">boolean</span> evaluate( <span class="predefined-type">String</span> key ) {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Jones</span><span class="delimiter">&quot;</span></span>.equalsIgnoreCase( key );
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="filtering-on-values-with-predicate"><a class="anchor" href="#filtering-on-values-with-predicate"></a><a class="link" href="#filtering-on-values-with-predicate">Filtering on Values with Predicate</a></h6>
<div class="paragraph">
<p>Using the standard Hazelcast <code>Predicate</code> interface, we can also filter based on the value of a data entry. In the following example, you can
only select values that are divisible by 4 without a remainder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Supplier&lt;...&gt; supplier = Supplier.fromPredicate(
    entry -&gt; entry.getValue() % <span class="integer">4</span> == <span class="integer">0</span>
);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">DivisiblePredicate</span> <span class="directive">implements</span> <span class="predefined-type">Predicate</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; {
  <span class="directive">public</span> <span class="type">boolean</span> apply( <span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; entry ) {
    <span class="keyword">return</span> entry.getValue() % <span class="integer">4</span> == <span class="integer">0</span>;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="extracting-and-transforming-data"><a class="anchor" href="#extracting-and-transforming-data"></a><a class="link" href="#extracting-and-transforming-data">Extracting and Transforming Data</a></h6>
<div class="paragraph">
<p>As well as filtering, <code>Supplier</code> can also extract or transform data before providing it
to the aggregation operation itself. The following example shows how to transform an input value to a string.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Supplier&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; supplier = Supplier.all(
    value -&gt; <span class="predefined-type">Integer</span>.toString(value)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see a Java 6/7 example in the <a href="#aggregations-examples">Aggregations Examples section</a>.</p>
</div>
<div class="paragraph">
<p>Apart from the fact we transformed the input value of type <code>int</code> (or Integer) to a string, we can see that the generic information
of the resulting <code>Supplier</code> has changed as well. This indicates that we now have an aggregation working on string values.</p>
</div>
</div>
<div class="sect5">
<h6 id="chaining-multiple-filtering-rules"><a class="anchor" href="#chaining-multiple-filtering-rules"></a><a class="link" href="#chaining-multiple-filtering-rules">Chaining Multiple Filtering Rules</a></h6>
<div class="paragraph">
<p>Another feature of <code>Supplier</code> is its ability to chain multiple filtering rules. Let&#8217;s combine all of the
above examples into one rule set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Supplier&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; supplier =
    Supplier.fromKeyPredicate(
        lastName -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Jones</span><span class="delimiter">&quot;</span></span>.equalsIgnoreCase( lastName ),
        Supplier.fromPredicate(
            entry -&gt; entry.getValue() % <span class="integer">4</span> == <span class="integer">0</span>,
            Supplier.all( value -&gt; <span class="predefined-type">Integer</span>.toString(value) )
        )
    );</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="implementing-supplier-with-special-requirements"><a class="anchor" href="#implementing-supplier-with-special-requirements"></a><a class="link" href="#implementing-supplier-with-special-requirements">Implementing Supplier with Special Requirements</a></h6>
<div class="paragraph">
<p>You might prefer or need to implement your <code>Supplier</code> based on special
requirements. This is a very basic task. The <code>Supplier</code> abstract class has just one method: the <code>apply</code> method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Due to a limitation of the Java Lambda API, you cannot implement abstract classes using Lambdas. Instead it is
recommended that you create a standard named class.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">MyCustomSupplier</span> <span class="directive">extends</span> Supplier&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; {
  <span class="directive">public</span> <span class="predefined-type">String</span> apply( <span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; entry ) {
    <span class="predefined-type">Integer</span> value = entry.getValue();
    <span class="keyword">if</span> (value == <span class="predefined-constant">null</span>) {
      <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
    <span class="keyword">return</span> value % <span class="integer">4</span> == <span class="integer">0</span> ? <span class="predefined-type">String</span>.valueOf( value ) : <span class="predefined-constant">null</span>;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Supplier</code> <code>apply</code> methods are expected to return null whenever the input value should not be mapped to the aggregation
process. This can be used, as in the example above, to implement filter rules directly. Implementing filters using the
<code>KeyPredicate</code> and <code>Predicate</code> interfaces might be more convenient.</p>
</div>
<div class="paragraph">
<p>To use your own <code>Supplier</code>, just pass it to the aggregate method or use it in combination with other `Supplier`s.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> sum = personAgeMapping.aggregate( <span class="keyword">new</span> MyCustomSupplier(), Aggregations.count() );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Supplier&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; supplier =
    Supplier.fromKeyPredicate(
        lastName -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Jones</span><span class="delimiter">&quot;</span></span>.equalsIgnoreCase( lastName ),
        <span class="keyword">new</span> MyCustomSupplier()
     );
<span class="type">int</span> sum = personAgeMapping.aggregate( supplier, Aggregations.count() );</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="defining-the-aggregation-operation"><a class="anchor" href="#defining-the-aggregation-operation"></a><a class="link" href="#defining-the-aggregation-operation">Defining the Aggregation Operation</a></h5>
<div class="paragraph">
<p>The <code>com.hazelcast.mapreduce.aggregation.Aggregation</code> interface defines the aggregation operation itself. It contains a set of
MapReduce API implementations like <code>Mapper</code>, <code>Combiner</code>, <code>Reducer</code> and <code>Collator</code>. These implementations are normally unique to
the chosen <code>Aggregation</code>. This interface can also be implemented with your aggregation operations based on MapReduce calls. For
more information, refer to <a href="#implementing-aggregations">Implementing Aggregations section</a>.</p>
</div>
<div class="paragraph">
<p>The <code>com.hazelcast.mapreduce.aggregation.Aggregations</code> class provides a common predefined set of aggregations. This class
contains type safe aggregations of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Average (Integer, Long, Double, BigInteger, BigDecimal)</p>
</li>
<li>
<p>Sum (Integer, Long, Double, BigInteger, BigDecimal)</p>
</li>
<li>
<p>Min (Integer, Long, Double, BigInteger, BigDecimal, Comparable)</p>
</li>
<li>
<p>Max (Integer, Long, Double, BigInteger, BigDecimal, Comparable)</p>
</li>
<li>
<p>DistinctValues</p>
</li>
<li>
<p>Count</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those aggregations are similar to their counterparts on relational databases and can be equated to SQL statements as set out
below.</p>
</div>
<div class="paragraph">
<p><strong>Average:</strong></p>
</div>
<div class="paragraph">
<p>Calculates an average value based on all selected values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">map.aggregate( Supplier.all( person -&gt; person.getAge() ),
               Aggregations.integerAvg() );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT AVG(person.age) FROM person;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Sum:</strong></p>
</div>
<div class="paragraph">
<p>Calculates a sum based on all selected values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">map.aggregate( Supplier.all( person -&gt; person.getAge() ),
               Aggregations.integerSum() );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT SUM(person.age) FROM person;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Minimum (Min):</strong></p>
</div>
<div class="paragraph">
<p>Finds the minimal value over all selected values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">map.aggregate( Supplier.all( person -&gt; person.getAge() ),
               Aggregations.integerMin() );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT MIN(person.age) FROM person;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Maximum (Max):</strong></p>
</div>
<div class="paragraph">
<p>Finds the maximal value over all selected values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">map.aggregate( Supplier.all( person -&gt; person.getAge() ),
               Aggregations.integerMax() );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT MAX(person.age) FROM person;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Distinct Values:</strong></p>
</div>
<div class="paragraph">
<p>Returns a collection of distinct values over the selected values</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">map.aggregate( Supplier.all( person -&gt; person.getAge() ),
               Aggregations.distinctValues() );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT DISTINCT person.age FROM person;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Count:</strong></p>
</div>
<div class="paragraph">
<p>Returns the element count over all selected values</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">map.aggregate( Supplier.all(), Aggregations.count() );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SELECT COUNT(*) FROM person;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="extracting-attribute-values-with-propertyextractor"><a class="anchor" href="#extracting-attribute-values-with-propertyextractor"></a><a class="link" href="#extracting-attribute-values-with-propertyextractor">Extracting Attribute Values with PropertyExtractor</a></h5>
<div class="paragraph">
<p>We used the <code>com.hazelcast.mapreduce.aggregation.PropertyExtractor</code> interface before when we had a look at the example
on how to use a <code>Supplier</code> to <a href="#extracting-and-transforming-data">transform a value to another type</a>. It can also be used to extract attributes from values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Person</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> firstName;
  <span class="directive">private</span> <span class="predefined-type">String</span> lastName;
  <span class="directive">private</span> <span class="type">int</span> age;

  <span class="comment">// getters and setters</span>
}

PropertyExtractor&lt;Person, <span class="predefined-type">Integer</span>&gt; propertyExtractor = (person) -&gt; person.getAge();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">AgeExtractor</span> <span class="directive">implements</span> PropertyExtractor&lt;Person, <span class="predefined-type">Integer</span>&gt; {
  <span class="directive">public</span> <span class="predefined-type">Integer</span> extract( Person value ) {
    <span class="keyword">return</span> value.getAge();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we extract the value from the person&#8217;s age attribute. The value type changes from Person to <code>Integer</code> which is reflected in the generics information to stay type safe.</p>
</div>
<div class="paragraph">
<p>You can use `PropertyExtractor`s for any kind of transformation of data. You might even want to have multiple
transformation steps chained one after another.</p>
</div>
</div>
<div class="sect4">
<h5 id="configuring-aggregations"><a class="anchor" href="#configuring-aggregations"></a><a class="link" href="#configuring-aggregations">Configuring Aggregations</a></h5>
<div class="paragraph">
<p>As stated before, the easiest way to configure the resources used by the underlying MapReduce framework is to supply a <code>JobTracker</code>
to the aggregation call itself by passing it to either <code>IMap.aggregate()</code> or <code>MultiMap.aggregate()</code>.</p>
</div>
<div class="paragraph">
<p>There is another way to implicitly configure the underlying used <code>JobTracker</code>. If no specific <code>JobTracker</code> was
passed for the aggregation call, internally one will be created using the following naming specifications:</p>
</div>
<div class="paragraph">
<p>For <code>IMap</code> aggregation calls the naming specification is created as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hz::aggregation-map-</code> and the concatenated name of the map.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For <code>MultiMap</code> it is very similar:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hz::aggregation-multimap-</code> and the concatenated name of the MultiMap.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Knowing the specification of the name, we can configure the <code>JobTracker</code> as expected
(as described in <a href="#retrieving-a-jobtracker-instance">Retrieving a JobTracker Instance</a>) using the naming spec we just learned. For more information on configuration of the
<code>JobTracker</code>, please see <a href="#configuring-jobtracker">Configuring Jobtracker</a>.</p>
</div>
<div class="paragraph">
<p>To finish this section, let&#8217;s have a quick example for the above naming specs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">mymap</span><span class="delimiter">&quot;</span></span> );

<span class="comment">// The internal JobTracker name resolves to 'hz::aggregation-map-mymap'</span>
map.aggregate( ... );</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MultiMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; multimap = hazelcastInstance.getMultiMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">mymultimap</span><span class="delimiter">&quot;</span></span> );

<span class="comment">// The internal JobTracker name resolves to 'hz::aggregation-multimap-mymultimap'</span>
multimap.aggregate( ... );</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aggregations-examples"><a class="anchor" href="#aggregations-examples"></a><a class="link" href="#aggregations-examples">11.5.3. Aggregations Examples</a></h4>
<div class="paragraph">
<p>For the final example, imagine you are working for an international company and you have an employee database stored in Hazelcast
<code>IMap</code> with all employees worldwide and a <code>MultiMap</code> for assigning employees to their certain locations or offices. In addition,
there is another <code>IMap</code> that holds the salary per employee.</p>
</div>
<div class="sect4">
<h5 id="setting-up-the-data-model"><a class="anchor" href="#setting-up-the-data-model"></a><a class="link" href="#setting-up-the-data-model">Setting up the Data Model</a></h5>
<div class="paragraph">
<p>Let&#8217;s have a look at our data model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Employee</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> firstName;
  <span class="directive">private</span> <span class="predefined-type">String</span> lastName;
  <span class="directive">private</span> <span class="predefined-type">String</span> companyName;
  <span class="directive">private</span> <span class="predefined-type">String</span> address;
  <span class="directive">private</span> <span class="predefined-type">String</span> city;
  <span class="directive">private</span> <span class="predefined-type">String</span> county;
  <span class="directive">private</span> <span class="predefined-type">String</span> state;
  <span class="directive">private</span> <span class="type">int</span> zip;
  <span class="directive">private</span> <span class="predefined-type">String</span> phone1;
  <span class="directive">private</span> <span class="predefined-type">String</span> phone2;
  <span class="directive">private</span> <span class="predefined-type">String</span> email;
  <span class="directive">private</span> <span class="predefined-type">String</span> web;

  <span class="comment">// getters and setters</span>
}

<span class="type">class</span> <span class="class">SalaryMonth</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
  <span class="directive">private</span> Month month;
  <span class="directive">private</span> <span class="type">int</span> salary;

  <span class="comment">// getters and setters</span>
}

<span class="type">class</span> <span class="class">SalaryYear</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> email;
  <span class="directive">private</span> <span class="type">int</span> year;
  <span class="directive">private</span> <span class="predefined-type">List</span>&lt;SalaryMonth&gt; months;

  <span class="comment">// getters and setters</span>

  <span class="directive">public</span> <span class="type">int</span> getAnnualSalary() {
    <span class="type">int</span> sum = <span class="integer">0</span>;
    <span class="keyword">for</span> ( SalaryMonth salaryMonth : getMonths() ) {
      sum += salaryMonth.getSalary();
    }
    <span class="keyword">return</span> sum;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two <code>IMap`s and the `MultiMap</code> are keyed by the string of email. They are defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, Employee&gt; employees = hz.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">employees</span><span class="delimiter">&quot;</span></span> );
IMap&lt;<span class="predefined-type">String</span>, SalaryYear&gt; salaries = hz.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">salaries</span><span class="delimiter">&quot;</span></span> );
MultiMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; officeAssignment = hz.getMultiMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">office-employee</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>So far, we know all the important information to work out some example aggregations. We will look into some deeper implementation
details and how we can work around some current limitations that will be eliminated in future versions of the API.</p>
</div>
</div>
<div class="sect4">
<h5 id="average-aggregation-example"><a class="anchor" href="#average-aggregation-example"></a><a class="link" href="#average-aggregation-example">Average Aggregation Example</a></h5>
<div class="paragraph">
<p>Let&#8217;s start with a very basic example. We want to know the average salary of all of our employees. To do this,
we need a <code>PropertyExtractor</code> and the average aggregation for type <code>Integer</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, SalaryYear&gt; salaries = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">salaries</span><span class="delimiter">&quot;</span></span> );
PropertyExtractor&lt;SalaryYear, <span class="predefined-type">Integer</span>&gt; extractor =
    (salaryYear) -&gt; salaryYear.getAnnualSalary();
<span class="type">int</span> avgSalary = salaries.aggregate( Supplier.all( extractor ),
                                    Aggregations.integerAvg() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it. Internally, we created a MapReduce task based on the predefined aggregation and fired it up immediately. Currently all
aggregation calls are blocking operations, so it is not yet possible to execute the aggregation in a reactive way (using
<code>com.hazelcast.core.ICompletableFuture</code>), but this will be part of an upcoming version.</p>
</div>
</div>
<div class="sect4">
<h5 id="map-join-example"><a class="anchor" href="#map-join-example"></a><a class="link" href="#map-join-example">Map Join Example</a></h5>
<div class="paragraph">
<p>The following example is a little more complex. We only want to have our US-based employees selected into the average
salary calculation, so we need to execute a join operation between the employees and salaries maps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">USEmployeeFilter</span> <span class="directive">implements</span> KeyPredicate&lt;<span class="predefined-type">String</span>&gt;, HazelcastInstanceAware {
  <span class="directive">private</span> <span class="directive">transient</span> HazelcastInstance hazelcastInstance;

  <span class="directive">public</span> <span class="type">void</span> setHazelcastInstance( HazelcastInstance hazelcastInstance ) {
    <span class="local-variable">this</span>.hazelcastInstance = hazelcastInstance;
  }

  <span class="directive">public</span> <span class="type">boolean</span> evaluate( <span class="predefined-type">String</span> email ) {
    IMap&lt;<span class="predefined-type">String</span>, Employee&gt; employees = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">employees</span><span class="delimiter">&quot;</span></span> );
    Employee employee = employees.get( email );
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">US</span><span class="delimiter">&quot;</span></span>.equals( employee.getCountry() );
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>HazelcastInstanceAware</code> interface, we get the current instance of Hazelcast injected into our filter and we can perform data
joins on other data structures of the cluster. We now only select employees that work as part of our US offices into the
aggregation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, SalaryYear&gt; salaries = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">salaries</span><span class="delimiter">&quot;</span></span> );
PropertyExtractor&lt;SalaryYear, <span class="predefined-type">Integer</span>&gt; extractor =
    (salaryYear) -&gt; salaryYear.getAnnualSalary();
<span class="type">int</span> avgSalary = salaries.aggregate( Supplier.fromKeyPredicate(
                                        <span class="keyword">new</span> USEmployeeFilter(), extractor
                                    ), Aggregations.integerAvg() );</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="grouping-example"><a class="anchor" href="#grouping-example"></a><a class="link" href="#grouping-example">Grouping Example</a></h5>
<div class="paragraph">
<p>For our next example, we will do some grouping based on the different worldwide offices. Currently, a group aggregator is not yet
available, so we need a small workaround to achieve this goal. (In later versions of the Aggregations API this will not be
required because it will be available out-of-the-box in a much more convenient way.)</p>
</div>
<div class="paragraph">
<p>Again, let&#8217;s start with our filter. This time, we want to filter based on an office name and we need to do some data joins
to achieve this kind of filtering.</p>
</div>
<div class="paragraph">
<p><strong>A short tip:</strong> to minimize the data transmission on the aggregation we can use
<a href="#data-affinity">Data Affinity</a> rules to influence the partitioning of data. Be aware that this is an expert feature of Hazelcast.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">OfficeEmployeeFilter</span> <span class="directive">implements</span> KeyPredicate&lt;<span class="predefined-type">String</span>&gt;, HazelcastInstanceAware {
  <span class="directive">private</span> <span class="directive">transient</span> HazelcastInstance hazelcastInstance;
  <span class="directive">private</span> <span class="predefined-type">String</span> office;

  <span class="comment">// Deserialization Constructor</span>
  <span class="directive">public</span> OfficeEmployeeFilter() {
  }

  <span class="directive">public</span> OfficeEmployeeFilter( <span class="predefined-type">String</span> office ) {
    <span class="local-variable">this</span>.office = office;
  }

  <span class="directive">public</span> <span class="type">void</span> setHazelcastInstance( HazelcastInstance hazelcastInstance ) {
    <span class="local-variable">this</span>.hazelcastInstance = hazelcastInstance;
  }

  <span class="directive">public</span> <span class="type">boolean</span> evaluate( <span class="predefined-type">String</span> email ) {
    MultiMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; officeAssignment = hazelcastInstance
        .getMultiMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">office-employee</span><span class="delimiter">&quot;</span></span> );

    <span class="keyword">return</span> officeAssignment.containsEntry( office, email );
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can execute our aggregations. As mentioned before, we currently need to do the grouping on our own by executing multiple
aggregations in a row.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; avgSalariesPerOffice = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt;();

IMap&lt;<span class="predefined-type">String</span>, SalaryYear&gt; salaries = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">salaries</span><span class="delimiter">&quot;</span></span> );
MultiMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; officeAssignment =
    hazelcastInstance.getMultiMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">office-employee</span><span class="delimiter">&quot;</span></span> );

PropertyExtractor&lt;SalaryYear, <span class="predefined-type">Integer</span>&gt; extractor =
    (salaryYear) -&gt; salaryYear.getAnnualSalary();

<span class="keyword">for</span> ( <span class="predefined-type">String</span> office : officeAssignment.keySet() ) {
  OfficeEmployeeFilter filter = <span class="keyword">new</span> OfficeEmployeeFilter( office );
  <span class="type">int</span> avgSalary = salaries.aggregate( Supplier.fromKeyPredicate( filter, extractor ),
                                      Aggregations.integerAvg() );

  avgSalariesPerOffice.put( office, avgSalary );
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="simple-count-example"><a class="anchor" href="#simple-count-example"></a><a class="link" href="#simple-count-example">Simple Count Example</a></h5>
<div class="paragraph">
<p>We want to end this section by executing one final and easy aggregation. We
want to know how many employees we currently have on a worldwide basis. Before reading the next lines of example code, you
can try to do it on your own to see if you understood how to execute aggregations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, Employee&gt; employees = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">employees</span><span class="delimiter">&quot;</span></span> );
<span class="type">int</span> count = employees.size();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ok, after the quick joke of the previous two code lines, we look at the real two code lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, Employee&gt; employees = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">employees</span><span class="delimiter">&quot;</span></span> );
<span class="type">int</span> count = employees.aggregate( Supplier.all(), Aggregations.count() );</code></pre>
</div>
</div>
<div class="paragraph">
<p>We now have an overview of how to use aggregations in real life situations. If you want to do your colleagues a favor, you
might want to write your own additional set of aggregations. If so, then read the next section, <a href="#implementing-aggregations">Implementing Aggregations</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="implementing-aggregations"><a class="anchor" href="#implementing-aggregations"></a><a class="link" href="#implementing-aggregations">11.5.4. Implementing Aggregations</a></h4>
<div class="paragraph">
<p>This section explains how to implement your own aggregations in your own application. It
is an advanced section, so if you do not intend to implement your own aggregation, you might want to
stop reading here and come back later when you need to know how to implement your own
aggregation.</p>
</div>
<div class="paragraph">
<p>An <code>Aggregation</code> implementation is defining a MapReduce task, but with a small difference: the <code>Mapper</code>
is always expected to work on a <code>Supplier</code> that filters and/or transforms the mapped input value to some output value.</p>
</div>
<div class="sect4">
<h5 id="aggregation-methods"><a class="anchor" href="#aggregation-methods"></a><a class="link" href="#aggregation-methods">Aggregation Methods</a></h5>
<div class="paragraph">
<p>The main interface for making your own aggregation is <code>com.hazelcast.mapreduce.aggregation.Aggregation</code>. It consists of four
methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">interface</span> <span class="class">Aggregation</span>&lt;<span class="predefined-type">Key</span>, Supplied, <span class="predefined-type">Result</span>&gt; {
  Mapper getMapper(Supplier&lt;<span class="predefined-type">Key</span>, ?, Supplied&gt; supplier);
  CombinerFactory getCombinerFactory();
  ReducerFactory getReducerFactory();
  <span class="predefined-type">Collator</span>&lt;<span class="predefined-type">Map</span>.Entry, <span class="predefined-type">Result</span>&gt; getCollator();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getMapper</code> and <code>getReducerFactory</code> methods should return non-null values. <code>getCombinerFactory</code> and <code>getCollator</code> are
optional operations and you do not need to implement them. You can decide to implement them depending on the use case you want
to achieve.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fast-aggregations"><a class="anchor" href="#fast-aggregations"></a><a class="link" href="#fast-aggregations">11.6. Fast-Aggregations</a></h3>
<div class="paragraph">
<p>Fast-Aggregations functionality is the successor of the <a href="#aggregators">Aggregators</a>.
They are equivalent to the MapReduce Aggregators in most of the use cases, but instead of running on the MapReduce engine they run on the Query infrastructure.
Their performance is tens to hundreds times better since they run in parallel for each partition and are highly optimized for speed and low memory consumption.</p>
</div>
<div class="sect3">
<h4 id="aggregator-api"><a class="anchor" href="#aggregator-api"></a><a class="link" href="#aggregator-api">11.6.1. Aggregator API</a></h4>
<div class="paragraph">
<p>The Fast-Aggregation consists of three phases represented by three methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>accumulate()</code>,</p>
</li>
<li>
<p><code>combine()</code>,</p>
</li>
<li>
<p><code>aggregate()</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are also two callbacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>onAccumulationFinished()</code> called when the accumulation phase finishes.</p>
</li>
<li>
<p><code>onCombinationFinished()</code> called when the combination phase finishes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These callbacks enable releasing the state that might have been initialized and stored in the Aggregator - to reduce the network traffic.</p>
</div>
<div class="paragraph">
<p>Each phase is described below and you can also refer to the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/aggregation/Aggregator.html">Aggregator Javadoc</a> for the API&#8217;s details.</p>
</div>
<div class="paragraph">
<p><strong>Accumulation:</strong></p>
</div>
<div class="paragraph">
<p>During the accumulation phase each Aggregator accumulates all entries passed to it by the query engine.
It accumulates only those pieces of information that are required to calculate the aggregation result in the last phase - that&#8217;s implementation specific.</p>
</div>
<div class="paragraph">
<p>In case of the <code>DoubleAverage</code> aggregation the Aggregator would accumulate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the sum of the elements it accumulated</p>
</li>
<li>
<p>the count of the elements it accumulated</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Combination:</strong></p>
</div>
<div class="paragraph">
<p>Since Fast-Aggregation is executed in parallel on each partition of the cluster, the results need to be combined after the accumulation phase in order to be able to calculate the final result.</p>
</div>
<div class="paragraph">
<p>In case of the <code>DoubleAverage</code> aggregation, the aggregator would sum up all the sums of the elements and all the counts.</p>
</div>
<div class="paragraph">
<p><strong>Aggregation:</strong></p>
</div>
<div class="paragraph">
<p>Aggregation is the last phase that calculates the final result from the results accumulated and combined in the preceding phases.</p>
</div>
<div class="paragraph">
<p>In case of the <code>DoubleAverage</code> aggregation, the Aggregator would just divide the sum of the elements by their count (if non-zero).</p>
</div>
</div>
<div class="sect3">
<h4 id="fast-aggregations-and-map-interfaces"><a class="anchor" href="#fast-aggregations-and-map-interfaces"></a><a class="link" href="#fast-aggregations-and-map-interfaces">11.6.2. Fast-Aggregations and Map Interfaces</a></h4>
<div class="paragraph">
<p>Fast-Aggregations are available on <code>com.hazelcast.core.IMap</code> only. IMap offers the method <code>aggregate</code> to apply the aggregation logic on the map entries. This method can be called with or without a predicate. You can refer to its <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/core/IMap.html#aggregate-com.hazelcast.aggregation.Aggregator-">Javadoc</a> to see the method details.</p>
</div>
</div>
<div class="sect3">
<h4 id="sample-implementation"><a class="anchor" href="#sample-implementation"></a><a class="link" href="#sample-implementation">11.6.3. Sample Implementation</a></h4>
<div class="paragraph">
<p>Here&#8217;s a sample implementation of the Aggregator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_query.adoc - include::{javasource}/distributedquery/SimpleFastAggregationsDemo.java[tag=fademo]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>accumulate()</code> method calculates the sum and the count of the elements.</p>
</li>
<li>
<p>the <code>combine()</code> method combines the results from all the accumulations.</p>
</li>
<li>
<p>the <code>aggregate()</code> method calculates the final result.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="built-in-aggregations-2"><a class="anchor" href="#built-in-aggregations-2"></a><a class="link" href="#built-in-aggregations-2">11.6.4. Built-In Aggregations</a></h4>
<div class="paragraph">
<p>The <code>com.hazelcast.aggregation.Aggregators</code> class provides a wide variety of built-in Aggregators.
The full list is presented below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>count</p>
</li>
<li>
<p>distinct</p>
</li>
<li>
<p>bigDecimal sum/avg/min/max</p>
</li>
<li>
<p>bigInteger sum/avg/min/max</p>
</li>
<li>
<p>double sum/avg/min/max</p>
</li>
<li>
<p>integer sum/avg/min/max</p>
</li>
<li>
<p>long sum/avg/min/max</p>
</li>
<li>
<p>number avg</p>
</li>
<li>
<p>comparable min/max</p>
</li>
<li>
<p>fixedPointSum, floatingPointSum</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the any of these Aggregators, instantiate them using the <code>Aggregators</code> factory class.</p>
</div>
<div class="paragraph">
<p>Each built-in Aggregator can also navigate to an attribute of the object passed to the <code>accumulate()</code> method (via reflection). For example, <code>Aggregators.distinct("address.city")</code> will extract the <code>address.city</code> attribute from the object passed to the Aggregator and accumulate the extracted value.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-options"><a class="anchor" href="#configuration-options"></a><a class="link" href="#configuration-options">11.6.5. Configuration Options</a></h4>
<div class="paragraph">
<p>On each partition, after the entries have been passed to the aggregator, the accumulation runs in parallel.
It means that each aggregator is cloned and receives a sub-set of the entries received from a partition.
Then, it runs the accumulation phase in all of the cloned aggregators - at the end, the result is combined into a single accumulation result.
It speeds up the processing by at least the factor of two - even in case of simple aggregations. If the accumulation logic is more "heavy", the speed-up may be more significant.</p>
</div>
<div class="paragraph">
<p>In order to switch the accumulation into a sequential mode just set the <code>hazelcast.aggregation.accumulation.parallel.evaluation</code> property to <code>false</code> (it&#8217;s set to <code>true</code> by default).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="projections"><a class="anchor" href="#projections"></a><a class="link" href="#projections">11.7. Projections</a></h3>
<div class="paragraph">
<p>There are cases where instead of sending all the data returned by a query from a member, you want to transform (strip down) each result object in order to avoid redundant network traffic.</p>
</div>
<div class="paragraph">
<p>For example, you select all employees based on some criteria, but you just want to return their name instead of the whole Employee object. It is easily doable with the Projection API.</p>
</div>
<div class="sect3">
<h4 id="projection-api"><a class="anchor" href="#projection-api"></a><a class="link" href="#projection-api">11.7.1. Projection API</a></h4>
<div class="paragraph">
<p>The Projection API provides the method <code>transform()</code> which is called on each result object. Its result is then gathered as the final query result entity. You can refer to the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/projection/Projection.html">Projection Javadoc</a> for the API&#8217;s details.</p>
</div>
<div class="sect4">
<h5 id="projections-and-map-interfaces"><a class="anchor" href="#projections-and-map-interfaces"></a><a class="link" href="#projections-and-map-interfaces">Projections and Map Interfaces</a></h5>
<div class="paragraph">
<p>Projections are available on <code>com.hazelcast.core.IMap</code> only. IMap offers the method <code>project</code> to apply the projection logic on the map entries. This method can be called with or without a predicate. You can refer to its <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/core/IMap.html#project-com.hazelcast.projection.Projection-">Javadoc</a> to see the method details.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sample-implementation-2"><a class="anchor" href="#sample-implementation-2"></a><a class="link" href="#sample-implementation-2">11.7.2. Sample implementation</a></h4>
<div class="paragraph">
<p>Let&#8217;s consider the following domain object stored in an IMap:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> Employee() {
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> firstName) {
        <span class="local-variable">this</span>.name = name;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To return just the names of the Employees, you can run the query in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; names = employees.project(<span class="keyword">new</span> Projection&lt;<span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, Employee&gt;, <span class="predefined-type">String</span>&gt;() {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> transform(<span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, Employee&gt; entry) {
        <span class="keyword">return</span> entry.getValue().getName();
    }
}, somePredicate);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="built-in-projections"><a class="anchor" href="#built-in-projections"></a><a class="link" href="#built-in-projections">11.7.3. Built-In Projections</a></h4>
<div class="paragraph">
<p>The <code>com.hazelcast.projection.Projections</code> class provides two built-in Projections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>singleAttribute</p>
</li>
<li>
<p>multiAttribute</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>singleAttribute</code> Projection enables extracting a single attribute from an object (via reflection). For example, <code>Projection.singleAttribute("address.city")</code> will extract the <code>address.city</code> attribute from the object passed to the Projection.</p>
</div>
<div class="paragraph">
<p>The <code>multiAttribute</code> Projection enables extracting multiples attributes from an object (via reflection). For example, <code>Projection.multiAttribute("address.city", "postalAddress.city")</code> will extract both attributes from the object passed to the Projection and return them in an <code>Object[]</code> array.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="continuous-query-cache"><a class="anchor" href="#continuous-query-cache"></a><a class="link" href="#continuous-query-cache">11.8. Continuous Query Cache</a></h3>
<div class="paragraph">
<p>A continuous query cache is used to cache the result of a continuous query. After the construction of a continuous query cache, all changes on the underlying <code>IMap</code> are immediately reflected to this cache as a stream of events. Therefore, this cache will be an always up-to-date view of the <code>IMap</code>. You can create a continuous query cache either on the client or member.</p>
</div>
<div class="sect3">
<h4 id="keeping-query-results-local-and-ready"><a class="anchor" href="#keeping-query-results-local-and-ready"></a><a class="link" href="#keeping-query-results-local-and-ready">11.8.1. Keeping Query Results Local and Ready</a></h4>
<div class="paragraph">
<p>A continuous query cache is beneficial when you need to query the distributed <code>IMap</code> data in a very frequent and fast way. By using a continuous query cache, the result of the query will always be ready and local to the application.</p>
</div>
</div>
<div class="sect3">
<h4 id="accessing-continuous-query-cache-from-member"><a class="anchor" href="#accessing-continuous-query-cache-from-member"></a><a class="link" href="#accessing-continuous-query-cache-from-member">11.8.2. Accessing Continuous Query Cache from Member</a></h4>
<div class="paragraph">
<p>The following code snippet shows how you can access a continuous query cache from a member.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_query.adoc - include::{javasource}/distributedquery/CQC.java[tag=cqc]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="accessing-continuous-query-cache-from-client-side"><a class="anchor" href="#accessing-continuous-query-cache-from-client-side"></a><a class="link" href="#accessing-continuous-query-cache-from-client-side">11.8.3. Accessing Continuous Query Cache from Client Side</a></h4>
<div class="paragraph">
<p>The following code snippet shows how you can access a continuous query cache from the client side.
The difference in this code from the member side code above is that you configure and instantiate
a client instance instead of a member instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in distributed_query.adoc - include::{javasource}/distributedquery/CQCClient.java[tag=cqcclient]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="features-of-continuous-query-cache"><a class="anchor" href="#features-of-continuous-query-cache"></a><a class="link" href="#features-of-continuous-query-cache">11.8.4. Features of Continuous Query Cache</a></h4>
<div class="paragraph">
<p>The following features of continuous query cache are valid for both the member and client.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The initial query that is run on the existing <code>IMap</code> data during the continuous query cache construction can be enabled/disabled according to the supplied predicate via <code>QueryCacheConfig.setPopulate()</code>.</p>
</li>
<li>
<p>Continuous query cache allows you to run queries with indexes and perform event batching and coalescing.</p>
</li>
<li>
<p>A continuous query cache is evictable. Note that a continuous query cache has a default maximum capacity of 10000. If you need a non-evictable cache, you should configure the eviction via <code>QueryCacheConfig.setEvictionConfig()</code>.</p>
</li>
<li>
<p>A listener can be added to a continuous query cache using <code>QueryCache.addEntryListener()</code>.</p>
</li>
<li>
<p><code>IMap</code> events are reflected in continuous query cache in the same order as they were generated on map entries. Since events are created on entries stored in partitions, ordering of events is maintained based on the ordering within the partition. You can add listeners to capture lost events using <code>EventLostListener</code> and you can recover lost events with the method <code>QueryCache.tryRecover()</code>.
Recovery of lost events largely depends on the size of the buffer on Hazelcast members. Default buffer size is 16 per partition; i.e. 16 events per partition can be maintained in the buffer. If the event generation is high, setting the buffer size to a higher number will provide better chances of recovering lost events. You can set buffer size with <code>QueryCacheConfig.setBufferSize()</code>. You can use the following example code for a recovery case.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QueryCache queryCache = map.getQueryCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">cache-name</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> SqlPredicate(<span class="string"><span class="delimiter">&quot;</span><span class="content">this &gt; 20</span><span class="delimiter">&quot;</span></span>), <span class="predefined-constant">true</span>);
queryCache.addEntryListener(<span class="keyword">new</span> EventLostListener() {
<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> eventLost(EventLostEvent event) {
       queryCache.tryRecover();
      }
}, <span class="predefined-constant">false</span>);</code></pre>
</div>
</div>
</li>
<li>
<p>You can populate a continuous query cache with only the keys of its entries and retrieve the subsequent values directly via <code>QueryCache.get()</code> from the underlying <code>IMap</code>. This helps to decrease the initial population time when the values are very large.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-continuous-query-cache"><a class="anchor" href="#configuring-continuous-query-cache"></a><a class="link" href="#configuring-continuous-query-cache">11.8.5. Configuring Continuous Query Cache</a></h4>
<div class="paragraph">
<p>You can configure continuous query cache declaratively or programmatically; the latter is mostly explained in the previous section. The parent configuration element is <code>&lt;query-caches&gt;</code> which should be placed within your <code>&lt;map&gt;</code> configuration. You can create your query caches using the  <code>&lt;query-cache&gt;</code> sub-element under <code>&lt;query-caches&gt;</code>.</p>
</div>
<div class="paragraph">
<p>The following is an example declarative configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;map&gt;
   &lt;query-caches&gt;
      &lt;query-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">myContQueryCache</span><span class="delimiter">&quot;</span></span>&gt;
         &lt;include-value&gt;<span class="predefined-constant">true</span>&lt;/include-value&gt;
         &lt;predicate type=<span class="string"><span class="delimiter">&quot;</span><span class="content">class-name</span><span class="delimiter">&quot;</span></span>&gt;com.hazelcast.examples.ExamplePredicate&lt;/predicate&gt;
         &lt;entry-listeners&gt;
            &lt;entry-listener&gt;...&lt;/entry-listener&gt;
         &lt;/entry-listeners&gt;
         &lt;in-memory-format&gt;BINARY&lt;/in-memory-format&gt;
         &lt;populate&gt;<span class="predefined-constant">true</span>&lt;/populate&gt;
                  &lt;coalesce&gt;<span class="predefined-constant">false</span>&lt;/coalesce&gt;
                  &lt;batch-size&gt;<span class="integer">2</span>&lt;/batch-size&gt;
                  &lt;delay-seconds&gt;<span class="integer">3</span>&lt;/delay-seconds&gt;
                  &lt;buffer-size&gt;<span class="integer">32</span>&lt;/buffer-size&gt;
                  &lt;eviction size=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTRY_COUNT</span><span class="delimiter">&quot;</span></span> eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">LFU</span><span class="delimiter">&quot;</span></span>/&gt;
                  &lt;indexes&gt;
                         &lt;index ordered=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;...&lt;/index&gt;
                  &lt;/indexes&gt;
           &lt;/query-cache&gt;
    &lt;/query-caches&gt;
&lt;/map&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the descriptions of configuration elements and attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Name of your continuous query cache.</p>
</li>
<li>
<p><code>include-value</code>: Specifies whether the value will be cached too. Its default value is true.</p>
</li>
<li>
<p><code>predicate</code>: Predicate to filter events which will be applied to the query cache.</p>
</li>
<li>
<p><code>entry-listeners</code>: Adds listeners (listener classes) for your query cache entries. Please see the <a href="#registering-map-listeners">Registering Map Listeners section</a>.</p>
</li>
<li>
<p><code>in-memory-format</code>: Type of the data to be stored in your query cache. Please see the <a href="#setting-in-memory-format">Setting In-Memory Format section</a>. Its default value is BINARY.</p>
</li>
<li>
<p><code>populate</code>: Specifies whether the initial population of your query cache is enabled. Its default value is true.</p>
</li>
<li>
<p><code>coalesce</code>: Specifies whether the coalescing of your query cache is enabled. Its default value is false.</p>
</li>
<li>
<p><code>delay-seconds</code>: Minimum time in seconds that an event waits in the member&#8217;s buffer. Its default value is 0.</p>
</li>
<li>
<p><code>batch-size</code>: Batch size used to determine the number of events sent in a batch to your query cache. Its default value is 1.</p>
</li>
<li>
<p><code>buffer-size</code>: Maximum number of events which can be stored in a partition buffer. Its default value is 16.</p>
</li>
<li>
<p><code>eviction</code>: Configuration for the eviction of your query cache. Please see the <a href="#configuring-map-eviction">Configuring Map Eviction section</a>.</p>
</li>
<li>
<p><code>indexes</code>: Indexes for your query cache defined by using this element&#8217;s <code>&lt;index&gt;</code> sub-elements. Please see the <a href="#configuring-imap-indexes">Configuring IMap Indexes section</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please take the following configuration considerations and publishing logic into account:</p>
</div>
<div class="paragraph">
<p>If  <code>delay-seconds</code> is equal to or smaller than <strong>0</strong>, then <code>batch-size</code> loses its function. Each time there is an event, all the entries in the buffer are pushed to the subscriber.</p>
</div>
<div class="paragraph">
<p>If <code>delay-seconds</code> is bigger than <strong>0</strong>, the following logic applies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>coalesce</code> is set to <strong>true</strong>, the buffer is checked for an event with the same key; if so, it is overridden by the current event. Then:</p>
<div class="ulist">
<ul>
<li>
<p>The current size of the buffer is checked: if the current size of the buffer is equal to or larger than <code>batch-size</code>, then the events counted as much as the <code>batch-size</code> are pushed to the subscriber. Otherwise, no events are sent.</p>
</li>
<li>
<p>After finishing with checking <code>batch-size</code>, the <code>delay-seconds</code> is checked. The buffer is scanned from the oldest to youngest entries; all the entries that are older than <code>delay-seconds</code> are pushed to the subscriber.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions"><a class="anchor" href="#transactions"></a><a class="link" href="#transactions">12. Transactions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains the usage of Hazelcast in a transactional context. It describes the Hazelcast transaction types and how they work, how to provide XA (e<strong>X</strong>tended <strong>A</strong>rchiteture) transactions and how to integrate Hazelcast with J2EE containers.</p>
</div>
<div class="sect2">
<h3 id="creating-a-transaction-interface"><a class="anchor" href="#creating-a-transaction-interface"></a><a class="link" href="#creating-a-transaction-interface">12.1. Creating a Transaction Interface</a></h3>
<div class="paragraph">
<p>You create a <code>TransactionContext</code> object to begin, commit and rollback a transaction. You can obtain transaction-aware instances of queues, maps, sets, lists and multimaps via <code>TransactionContext</code>, work with them and commit/rollback in one shot. You can see the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/transaction/TransactionContext.html">TransactionContext API here</a>.</p>
</div>
<div class="paragraph">
<p>Hazelcast supports two types of transactions: ONE_PHASE and TWO_PHASE. The type of transaction controls what happens when a member crashes while a transaction is committing. The default behavior is TWO_PHASE.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Starting with Hazelcast 3.6, the transaction type <code>LOCAL</code> has been deprecated. Please use <code>ONE_PHASE</code> for the Hazelcast releases 3.6 and higher.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ONE_PHASE</strong>: By selecting this transaction type, you execute the transactions with a single phase that is committing the changes. Since a preparing phase does not exist, the conflicts are not detected. When a conflict happens while committing the changes, e.g., due to a member crash, not all the changes are written and this leaves the system in an inconsistent state.</p>
</li>
<li>
<p><strong>TWO_PHASE</strong>: When you select this transaction type, Hazelcast first tries to execute the prepare phase. This phase fails if there are any conflicts. Once the prepare phase is successful, Hazelcast executes the commit phase (writing the changes). Before TWO_PHASE commits, Hazelcast copies the commit log to other members, so in case of a member failure, another member can complete the commit.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in transactions.adoc - include::{javasource}/transactions/TransactionalMember.java[tag=trx]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a transaction, operations will not be executed immediately. Their changes will be local to the <code>TransactionContext</code> until committed. However, they will ensure the changes via locks.</p>
</div>
<div class="paragraph">
<p>For the above example, when <code>map.put</code> is executed, no data will be put in the map but the key will be locked against changes. While committing, operations will be executed, the value will be put to the map and the key will be unlocked.</p>
</div>
<div class="paragraph">
<p>The isolation level in Hazelcast Transactions is <code>READ_COMMITTED</code> on the level of a single partition. If you are in a transaction, you can read the data in your transaction and the data that is already committed. If you are not in a transaction, you can only read the committed data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The REPEATABLE_READ isolation level can also be exercised using the method <code>getForUpdate()</code> of <code>TransactionalMap</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The isolation levels might be broken if the objects involved in the transaction span multiple partitions. A reader which is not in a transaction can then temporarily observe partially committed data.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="queue-set-list-vs-map-multimap"><a class="anchor" href="#queue-set-list-vs-map-multimap"></a><a class="link" href="#queue-set-list-vs-map-multimap">12.1.1. Queue/Set/List vs. Map/Multimap</a></h4>
<div class="paragraph">
<p>Hazelcast implements queue/set/list operations differently than map/multimap operations. For queue operations (offer, poll), offered and/or polled objects are copied to the owner member in order to safely commit/rollback. For map/multimap, Hazelcast first acquires the locks for the write operations (put, remove) and holds the differences (what is added/removed/updated) locally for each transaction. When the transaction is set to commit, Hazelcast will release the locks and apply the differences. When rolling back, Hazelcast will release the locks and discard the differences.</p>
</div>
<div class="paragraph">
<p><code>MapStore</code> and <code>QueueStore</code> do not participate in transactions. Hazelcast will suppress exceptions thrown by the store in a transaction. Please refer to the <a href="#providing-xa-transactions">XA Transactions section</a> for further information.</p>
</div>
</div>
<div class="sect3">
<h4 id="one_phase-vs-two_phase"><a class="anchor" href="#one_phase-vs-two_phase"></a><a class="link" href="#one_phase-vs-two_phase">12.1.2. ONE_PHASE vs. TWO_PHASE</a></h4>
<div class="paragraph">
<p>As discussed in <a href="#creating-a-transaction-interface">Creating a Transaction Interface</a>, when you choose ONE_PHASE as the transaction type, Hazelcast tracks all changes you make locally in a commit log, i.e., a list of changes. In this case, all the other members are asked to agree that the commit can succeed and once they agree, Hazelcast starts to write the changes.
However, if the member that initiates the commit crashes after it has written to at least one member (but has not completed writing to all other members), your system may be left in an inconsistent state.</p>
</div>
<div class="paragraph">
<p>On the other hand, if you choose TWO_PHASE as the transaction type, the commit log is again tracked locally but it is copied to another cluster member. Therefore, when a failure happens, e.g., the member initiating the commit crashes, you still have the commit log in another member and that member can complete the commit. However, copying the commit log to another member makes the TWO_PHASE approach slow.</p>
</div>
<div class="paragraph">
<p>Consequently, it is recommended that you choose ONE_PHASE as the transaction type if you want better performance, and that you choose TWO_PHASE if reliability of your system is more important than the performance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It should be noted that in split-brain situations or during a member failure, Hazelcast might not be able to always hold ACID guarantees.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="providing-xa-transactions"><a class="anchor" href="#providing-xa-transactions"></a><a class="link" href="#providing-xa-transactions">12.2. Providing XA Transactions</a></h3>
<div class="paragraph">
<p>XA describes the interface between the global transaction manager and the local resource manager. XA allows multiple resources (such as databases, application servers, message queues, transactional caches, etc.) to be accessed within the same transaction, thereby preserving the ACID properties across applications. XA uses a two-phase commit to ensure that all resources either commit or rollback any particular transaction consistently (all do the same).</p>
</div>
<div class="paragraph">
<p>When you implement the <code>XAResource</code> interface, Hazelcast provides XA transactions. You can obtain the <code>HazelcastXAResource</code> instance via the <code>HazelcastInstance getXAResource</code> method. You can see the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/transaction/HazelcastXAResource.html">HazelcastXAResource API here</a>.</p>
</div>
<div class="paragraph">
<p>Below is example code that uses JTA API for transaction management.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in transactions.adoc - include::{javasource}/transactions/XATransaction.java[tag=xa]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hazelcast-jcache"><a class="anchor" href="#hazelcast-jcache"></a><a class="link" href="#hazelcast-jcache">13. Hazelcast JCache</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the basics of JCache, the standardized Java caching layer API. The JCache
caching API is specified by the Java Community Process (JCP) as Java Specification Request (JSR) 107.</p>
</div>
<div class="paragraph">
<p>Caching keeps data in memory that either are slow to calculate/process or originate from another underlying backend system.
Caching is used to prevent additional request round trips for frequently used data. In both cases, caching can be used to
gain performance or decrease application latencies.</p>
</div>
<div class="sect2">
<h3 id="jcache-overview"><a class="anchor" href="#jcache-overview"></a><a class="link" href="#jcache-overview">13.1. JCache Overview</a></h3>
<div class="paragraph">
<p>Starting with Hazelcast 3.3.1, Hazelcast offers a specification-compliant JCache implementation. To show our commitment to this
important specification that the Java world was waiting for over a decade, we did not just provide a simple wrapper around our existing
APIs; we implemented a caching structure from the ground up to optimize the behavior to the needs of JCache.
The Hazelcast JCache implementation is 100% TCK (Technology Compatibility Kit) compliant and therefore passes all specification
requirements.</p>
</div>
<div class="paragraph">
<p>In addition to the given specification, we added some features like asynchronous versions of almost all
operations to give the user extra power.</p>
</div>
<div class="paragraph">
<p>This chapter gives a basic understanding of how to configure your application and how to setup Hazelcast to be your JCache
provider. It also shows examples of basic JCache usage as well as the additionally offered features that are not part of JSR-107.
To gain a full understanding of the JCache functionality and provided guarantees of different operations, read
the specification document (which is also the main documentation for functionality) at the specification page of <a href="https://www.jcp.org/en/jsr/detail?id=107">JSR-107</a>.</p>
</div>
<div class="sect3">
<h4 id="supported-jcache-versions"><a class="anchor" href="#supported-jcache-versions"></a><a class="link" href="#supported-jcache-versions">13.1.1. Supported JCache Versions</a></h4>
<div class="paragraph">
<p>Two versions of the JCache specification have been released:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The original release, version 1.0.0, was released in March 2014. Hazelcast versions 3.3.1 up to 3.9.2 (included) implement version 1.0.0 of the JCache specification.</p>
</li>
<li>
<p>A maintenance release, version 1.1.0 was released in December 2017. Hazelcast version 3.9.3 and higher implement JCache specification version 1.1.0.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JCache 1.1.0 is backwards compatible with JCache 1.0.0. As a maintenance release, it introduces clarifications and bug fixes in the specification, reference implementation
and TCK, without introducing any additional features.</p>
</div>
</div>
<div class="sect3">
<h4 id="upgrading-from-jcache-1-0-0-to-1-1-0"><a class="anchor" href="#upgrading-from-jcache-1-0-0-to-1-1-0"></a><a class="link" href="#upgrading-from-jcache-1-0-0-to-1-1-0">13.1.2. Upgrading from JCache 1.0.0 to 1.1.0</a></h4>
<div class="paragraph">
<p>When upgrading from a Hazelcast version which implements JCache 1.0.0 to a version that implements version 1.1.0 of the specification, some behavioral differences must be taken into account:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invoking <code>CacheManager.getCacheNames</code> on a closed <code>CacheManager</code> will return an empty iterator under JCache 1.0.0, while under JCache 1.1.0 will throw an <code>IllegalStateException</code>.</p>
</li>
<li>
<p>Runtime type checking is removed from <code>CacheManager.getCache(String)</code>, so when using JCache 1.1.0 one may obtain a <code>Cache</code> by name even when its configured key/value types are not known.</p>
</li>
<li>
<p>Statistics effects of <code>Cache.putIfAbsent</code> on misses and hits are properly applied when using JCache 1.1.0, while under JCache 1.0.0 misses and hits were not updated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that these behavioral differences apply on the Hazelcast member that executes the operation. Thus when performing a rolling member upgrade from a JCache 1.0.0-compliant Hazelcast version to a newer Hazelcast version that supports JCache 1.1.0, operations executed on the new members will exhibit JCache 1.1.0 behavior while those executed on old members will implement JCache 1.0.0 behavior.</p>
</div>
<div class="paragraph">
<p>The complete list of issues addressed in JCache specification version 1.1.0 is <a href="https://github.com/jsr107/jsr107spec/milestone/2?closed=1">available on Github</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jcache-setup-and-configuration"><a class="anchor" href="#jcache-setup-and-configuration"></a><a class="link" href="#jcache-setup-and-configuration">13.2. JCache Setup and Configuration</a></h3>
<div class="paragraph">
<p>This section shows what is necessary to provide the JCache API and the Hazelcast JCache implementation for your application. In
addition, it demonstrates the different configuration options and describes the configuration properties.</p>
</div>
<div class="sect3">
<h4 id="setting-up-your-application"><a class="anchor" href="#setting-up-your-application"></a><a class="link" href="#setting-up-your-application">13.2.1. Setting up Your Application</a></h4>
<div class="paragraph">
<p>To provide your application with this JCache functionality, your application needs the JCache API inside its classpath. This API is the bridge between the specified JCache standard and the implementation provided by Hazelcast.</p>
</div>
<div class="paragraph">
<p>The method of integrating the JCache API JAR into the application classpath depends on the build system used. For Maven, Gradle, SBT,
Ivy and many other build systems, all using Maven-based dependency repositories, perform the integration by adding
the Maven coordinates to the build descriptor.</p>
</div>
<div class="paragraph">
<p>As already mentioned, you have to add JCache
coordinates next to the default Hazelcast coordinates that might be already part of the application.</p>
</div>
<div class="paragraph">
<p>For Maven users, the coordinates look like the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;dependency&gt;
  &lt;groupId&gt;javax.cache&lt;/groupId&gt;
  &lt;artifactId&gt;cache-api&lt;/artifactId&gt;
  &lt;version&gt;<span class="float">1.1</span><span class="float">.0</span>&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>With other build systems, you might need to describe the coordinates in a different way.</p>
</div>
<div class="sect4">
<h5 id="activating-hazelcast-as-jcache-provider"><a class="anchor" href="#activating-hazelcast-as-jcache-provider"></a><a class="link" href="#activating-hazelcast-as-jcache-provider">Activating Hazelcast as JCache Provider</a></h5>
<div class="paragraph">
<p>To activate Hazelcast as the JCache provider implementation, add either <code>hazelcast-all.jar</code> or
<code>hazelcast.jar</code> to the classpath (if not already available) by either one of the following Maven snippets.</p>
</div>
<div class="paragraph">
<p>If you use <code>hazelcast-all.jar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;dependency&gt;
  &lt;groupId&gt;com.hazelcast&lt;/groupId&gt;
  &lt;artifactId&gt;hazelcast-all&lt;/artifactId&gt;
  &lt;version&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">your Hazelcast version, e.g. 3.10</span><span class="delimiter">&quot;</span></span>&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>hazelcast.jar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;dependency&gt;
  &lt;groupId&gt;com.hazelcast&lt;/groupId&gt;
  &lt;artifactId&gt;hazelcast&lt;/artifactId&gt;
  &lt;version&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">your Hazelcast version, e.g. 3.10</span><span class="delimiter">&quot;</span></span>&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The users of other build systems have to adjust the definition of the dependency to their needs.</p>
</div>
</div>
<div class="sect4">
<h5 id="connecting-clients-to-remote-member"><a class="anchor" href="#connecting-clients-to-remote-member"></a><a class="link" href="#connecting-clients-to-remote-member">Connecting Clients to Remote Member</a></h5>
<div class="paragraph">
<p>When the users want to use Hazelcast clients to connect to a remote cluster, the <code>hazelcast-client.jar</code> dependency is also required
on the client side applications. This JAR is already included in <code>hazelcast-all.jar</code>. Or, you can add it to the classpath using the following
Maven snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;dependency&gt;
  &lt;groupId&gt;com.hazelcast&lt;/groupId&gt;
  &lt;artifactId&gt;hazelcast-client&lt;/artifactId&gt;
  &lt;version&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">your Hazelcast version, e.g. 3.10</span><span class="delimiter">&quot;</span></span>&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For other build systems, for instance, ANT, the users have to download these dependencies from either the JSR-107 specification and
Hazelcast community website (<a href="https://hazelcast.org/">http://www.hazelcast.org</a>) or from the Maven repository search page
(<a href="http://search.maven.org">http://search.maven.org</a>).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example-jcache-application"><a class="anchor" href="#example-jcache-application"></a><a class="link" href="#example-jcache-application">13.2.2. Example JCache Application</a></h4>
<div class="paragraph">
<p>Before moving on to configuration, let&#8217;s have a look at a basic introductory example. The following code shows how to use the Hazelcast JCache integration
inside an application in an easy but typesafe way.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in jcache/setup.adoc - include::{javasource}/jcache/SampleJCacheApplication.java[tag=jcacheapp]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although the example is simple, let&#8217;s go through the code lines one by one.</p>
</div>
<div class="sect4">
<h5 id="getting-the-hazelcast-jcache-implementation"><a class="anchor" href="#getting-the-hazelcast-jcache-implementation"></a><a class="link" href="#getting-the-hazelcast-jcache-implementation">Getting the Hazelcast JCache Implementation</a></h5>
<div class="paragraph">
<p>First of all, we retrieve the <code>javax.cache.spi.CachingProvider</code> using the static method from
<code>javax.cache.Caching.getCachingManager()</code>, which automatically picks up Hazelcast as the underlying JCache implementation, if
available in the classpath. This way, the Hazelcast implementation of a <code>CachingProvider</code> will automatically start a new Hazelcast
member or client (depending on the chosen provider type) and pick up the configuration from either the command line parameter
or from the classpath. We will show how to use an existing <code>HazelcastInstance</code> later in this chapter; for now, we keep it simple.</p>
</div>
</div>
<div class="sect4">
<h5 id="setting-up-the-jcache-entry-point"><a class="anchor" href="#setting-up-the-jcache-entry-point"></a><a class="link" href="#setting-up-the-jcache-entry-point">Setting up the JCache Entry Point</a></h5>
<div class="paragraph">
<p>In the next line, we ask the <code>CachingProvider</code> to return a <code>javax.cache.CacheManager</code>. This is the general application&#8217;s entry
point into JCache. The <code>CacheManager</code> creates and manages named caches.</p>
</div>
</div>
<div class="sect4">
<h5 id="configuring-the-cache-before-creating-it"><a class="anchor" href="#configuring-the-cache-before-creating-it"></a><a class="link" href="#configuring-the-cache-before-creating-it">Configuring the Cache Before Creating It</a></h5>
<div class="paragraph">
<p>The next few lines create a simple <code>javax.cache.configuration.MutableConfiguration</code> to configure the cache before actually
creating it. In this case, we only configure the key and value types to make the cache typesafe which is highly recommended and
checked on retrieval of the cache.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-the-cache"><a class="anchor" href="#creating-the-cache"></a><a class="link" href="#creating-the-cache">Creating the Cache</a></h5>
<div class="paragraph">
<p>To create the cache, we call <code>javax.cache.CacheManager.createCache()</code> with a name for the cache and the previously created
configuration; the call returns the created cache. If you need to retrieve a previously created cache, you can use the corresponding method overload <code>javax.cache.CacheManager.getCache()</code>. If the cache was created using type parameters, you must retrieve the cache afterward using the type checking version of <code>getCache</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="get-put-and-getandput"><a class="anchor" href="#get-put-and-getandput"></a><a class="link" href="#get-put-and-getandput">get, put and getAndPut</a></h5>
<div class="paragraph">
<p>The following lines are simple <code>put</code> and <code>get</code> calls from the <code>java.util.Map</code> interface. The
<code>javax.cache.Cache.put()</code> has a <code>void</code> return type and does not return the previously assigned value of the key. To imitate the
<code>java.util.Map.put()</code> method, the JCache cache has a method called <code>getAndPut</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-for-jcache"><a class="anchor" href="#configuring-for-jcache"></a><a class="link" href="#configuring-for-jcache">13.2.3. Configuring for JCache</a></h4>
<div class="paragraph">
<p>Hazelcast JCache provides two different methods for cache configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>programmatically: the typical Hazelcast way, using the Config API seen above</p>
</li>
<li>
<p>declaratively: using <code>hazelcast.xml</code> or <code>hazelcast-client.xml</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="jcache-declarative-configuration"><a class="anchor" href="#jcache-declarative-configuration"></a><a class="link" href="#jcache-declarative-configuration">JCache Declarative Configuration</a></h5>
<div class="paragraph">
<p>You can declare your JCache cache configuration using the <code>hazelcast.xml</code> or <code>hazelcast-client.xml</code> configuration files. Using this declarative configuration makes creating the <code>javax.cache.Cache</code> fully transparent and automatically ensures internal thread safety. You do not need a call to <code>javax.cache.Cache.createCache()</code> in this case: you can retrieve the cache using
<code>javax.cache.Cache.getCache()</code> overloads and by passing in the name defined in the configuration for the cache.</p>
</div>
<div class="paragraph">
<p>To retrieve the cache that you defined in the declaration files, you need only perform a simple call (example below) because the cache is created automatically by the implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CachingProvider cachingProvider = Caching.getCachingProvider();
CacheManager cacheManager = cachingProvider.getCacheManager();
Cache&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; cache = cacheManager
    .getCache( <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Object</span>.class, <span class="predefined-type">Object</span>.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this section only describes the JCache provided standard properties. For the Hazelcast specific properties, please see the <a href="#icache-configuration">ICache Configuration section</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;key-type <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Object</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;value-type <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Object</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;statistics-enabled&gt;<span class="predefined-constant">false</span>&lt;/statistics-enabled&gt;
  &lt;management-enabled&gt;<span class="predefined-constant">false</span>&lt;/management-enabled&gt;

  &lt;read-through&gt;<span class="predefined-constant">true</span>&lt;/read-through&gt;
  &lt;write-through&gt;<span class="predefined-constant">true</span>&lt;/write-through&gt;
  &lt;cache-loader-factory
     <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.cache.MyCacheLoaderFactory</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;cache-writer-factory
     <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.cache.MyCacheWriterFactory</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;expiry-policy-factory
     <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.cache.MyExpiryPolicyFactory</span><span class="delimiter">&quot;</span></span> /&gt;

  &lt;cache-entry-listeners&gt;
    &lt;cache-entry-listener old-value-required=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> synchronous=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;cache-entry-listener-factory
         <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.cache.MyEntryListenerFactory</span><span class="delimiter">&quot;</span></span> /&gt;
      &lt;cache-entry-event-filter-factory
         <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.cache.MyEntryEventFilterFactory</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;/cache-entry-listener&gt;
    ...
  &lt;/cache-entry-listeners&gt;
&lt;/cache&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>key-type#class-name</code>: Fully qualified class name of the cache key type. Its default value is <code>java.lang.Object</code>.</p>
</li>
<li>
<p><code>value-type#class-name</code>: Fully qualified class name of the cache value type. Its default value is <code>java.lang.Object</code>.</p>
</li>
<li>
<p><code>statistics-enabled</code>: If set to true, statistics like cache hits and misses are collected. Its default value is false.</p>
</li>
<li>
<p><code>management-enabled</code>: If set to true, JMX beans are enabled and collected statistics are provided. It doesn&#8217;t automatically enable statistics collection. Its default value is false.</p>
</li>
<li>
<p><code>read-through</code>: If set to true, enables read-through behavior of the cache to an underlying configured <code>javax.cache.integration.CacheLoader</code> which is also known as lazy-loading. Its default value is false.</p>
</li>
<li>
<p><code>write-through</code>: If set to true, enables write-through behavior of the cache to an underlying configured <code>javax.cache.integration.CacheWriter</code> which passes any changed value to the external backend resource. Its default value is false.</p>
</li>
<li>
<p><code>cache-loader-factory#class-name</code>: Fully qualified class name of the <code>javax.cache.configuration.Factory</code> implementation providing a <code>javax.cache.integration.CacheLoader</code> instance to the cache.</p>
</li>
<li>
<p><code>cache-writer-factory#class-name</code>: Fully qualified class name of the <code>javax.cache.configuration.Factory</code> implementation providing a <code>javax.cache.integration.CacheWriter</code> instance to the cache.</p>
</li>
<li>
<p><code>expiry-policy-factory#-class-name</code>: Fully qualified class name of the <code>javax.cache.configuration.Factory</code> implementation providing a <code>javax.cache.expiry.ExpiryPolicy</code> instance to the cache.</p>
</li>
<li>
<p><code>cache-entry-listener</code>: A set of attributes and elements, explained below, to describe a <code>javax.cache.event.CacheEntryListener</code>.</p>
<div class="ulist">
<ul>
<li>
<p><code>cache-entry-listener#old-value-required</code>: If set to true, previously assigned values for the affected keys will be sent to the <code>javax.cache.event.CacheEntryListener</code> implementation. Setting this attribute to true creates additional traffic. Its default value is false.</p>
</li>
<li>
<p><code>cache-entry-listener#synchronous</code>: If set to true, the <code>javax.cache.event.CacheEntryListener</code> implementation will be called in a synchronous manner. Its default value is false.</p>
</li>
<li>
<p><code>cache-entry-listener/entry-listener-factory#class-name</code>: Fully qualified class name of the <code>javax.cache.configuration.Factory</code> implementation providing a <code>javax.cache.event.CacheEntryListener</code> instance.</p>
</li>
<li>
<p><code>cache-entry-listener/entry-event-filter-factory#class-name</code>: Fully qualified class name of the <code>javax.cache.configuration.Factory</code> implementation providing a <code>javax.cache.event.CacheEntryEventFilter</code> instance.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The JMX MBeans provided by Hazelcast JCache show statistics of the local member only.
To show the cluster-wide statistics, the user should collect statistic information from all members and accumulate them to
the overall statistics.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="jcache-programmatic-configuration"><a class="anchor" href="#jcache-programmatic-configuration"></a><a class="link" href="#jcache-programmatic-configuration">JCache Programmatic Configuration</a></h5>
<div class="paragraph">
<p>To configure the JCache programmatically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>either instantiate <code>javax.cache.configuration.MutableConfiguration</code> if you will use
only the JCache standard configuration,</p>
</li>
<li>
<p>or instantiate <code>com.hazelcast.config.CacheConfig</code> for a deeper Hazelcast integration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>com.hazelcast.config.CacheConfig</code> offers additional options that are specific to Hazelcast, such as asynchronous and synchronous backup counts.
Both classes share the same supertype interface <code>javax.cache.configuration.CompleteConfiguration</code> which is part of the JCache
standard.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To stay vendor independent, try to keep your code as near as possible to the standard JCache API. We recommend that you use declarative configuration and that you use the <code>javax.cache.configuration.Configuration</code> or <code>javax.cache.configuration.CompleteConfiguration</code> interfaces in
your code only when you need to pass the configuration instance throughout your code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you don&#8217;t need to configure Hazelcast specific properties, we recommend that you instantiate
<code>javax.cache.configuration.MutableConfiguration</code> and that you use the setters to configure Hazelcast as shown in the example in the
<a href="#example-jcache-application">Example JCache Application section</a>. Since the configurable properties are the same as the ones explained in the <a href="#jcache-declarative-configuration">JCache Declarative Configuration section</a>, they are not mentioned here. For Hazelcast specific properties, please read the <a href="#icache-configuration">ICache Configuration section</a> section.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jcache-providers"><a class="anchor" href="#jcache-providers"></a><a class="link" href="#jcache-providers">13.3. JCache Providers</a></h3>
<div class="paragraph">
<p>Use JCache providers to create caches for a specification compliant implementation. Those providers abstract the platform
specific behavior and bindings and provide the different JCache required features.</p>
</div>
<div class="paragraph">
<p>Hazelcast has two types of providers. Depending on your application setup and the cluster topology,
you can use the Client Provider (used by Hazelcast clients) or the Server Provider (used by cluster members).</p>
</div>
<div class="paragraph">
<p>For more information on cluster topologies and Hazelcast clients, please see the <a href="#hazelcast-topology">Hazelcast Topology section</a>.</p>
</div>
<div class="sect3">
<h4 id="configuring-jcache-provider"><a class="anchor" href="#configuring-jcache-provider"></a><a class="link" href="#configuring-jcache-provider">13.3.1. Configuring JCache Provider</a></h4>
<div class="paragraph">
<p>Configure the JCache <code>javax.cache.spi.CachingProvider</code> by either specifying the provider at the command line or by declaring the provider inside the Hazelcast configuration XML file. For more information on setting properties in this XML
configuration file, please see the <a href="#jcache-declarative-configuration">JCache Declarative Configuration section</a>.</p>
</div>
<div class="paragraph">
<p>Hazelcast implements a delegating <code>CachingProvider</code> that can automatically be configured for either client or member mode and that
delegates to the real underlying implementation based on the user&#8217;s choice. Hazelcast recommends that you use this <code>CachingProvider</code>
implementation.</p>
</div>
<div class="paragraph">
<p>The delegating `CachingProvider`s fully qualified class name is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">com.hazelcast.cache.HazelcastCachingProvider</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure the delegating provider at the command line, add the following parameter to the Java startup call, depending on the chosen provider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.jcache.provider.type=[client|server]</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the delegating <code>CachingProvider</code> is automatically picked up by the JCache SPI and provided as shown above. In cases where multiple <code>javax.cache.spi.CachingProvider</code> implementations reside on the classpath (like in some Application
Server scenarios), you can select a <code>CachingProvider</code> by explicitly calling <code>Caching.getCachingProvider()</code>
overloads and providing them using the canonical class name of the provider to be used. The class names of member and client providers
provided by Hazelcast are mentioned in the following two subsections.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hazelcast advises that you use the <code>Caching.getCachingProvider()</code> overloads to select a
<code>CachingProvider</code> explicitly. This ensures that uploading to later environments or Application Server versions doesn&#8217;t result in unexpected behavior like choosing a wrong <code>CachingProvider</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuring-jcache-with-client-provider"><a class="anchor" href="#configuring-jcache-with-client-provider"></a><a class="link" href="#configuring-jcache-with-client-provider">13.3.2. Configuring JCache with Client Provider</a></h4>
<div class="paragraph">
<p>For cluster topologies where Hazelcast light clients are used to connect to a remote Hazelcast cluster, use the Client Provider to configure JCache.</p>
</div>
<div class="paragraph">
<p>The Client Provider provides the same features as the Server Provider. However, it does not hold data on its own but instead delegates requests and calls to the remotely connected cluster.</p>
</div>
<div class="paragraph">
<p>The Client Provider can connect to multiple clusters at the same time. This can be achieved by scoping the client side
<code>CacheManager</code> with different Hazelcast configuration files. For more information, please see
<a href="#scoping-to-join-clusters">Scoping to Join Clusters</a>.</p>
</div>
<div class="paragraph">
<p>To request this <code>CachingProvider</code> using <code>Caching.getCachingProvider( String )</code> or
<code>Caching.getCachingProvider( String, ClassLoader )</code>, use the following fully qualified class name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">com.hazelcast.client.cache.impl.HazelcastClientCachingProvider</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-jcache-with-server-provider"><a class="anchor" href="#configuring-jcache-with-server-provider"></a><a class="link" href="#configuring-jcache-with-server-provider">13.3.3. Configuring JCache with Server Provider</a></h4>
<div class="paragraph">
<p>If a Hazelcast member is embedded into an application directly and the Hazelcast client is not used, the Server Provider is
required. In this case, the member itself becomes a part of the distributed cache and requests and operations are distributed
directly across the cluster by its given key.</p>
</div>
<div class="paragraph">
<p>The Server Provider provides the same features as the Client provider, but it keeps data in the local Hazelcast member and also distributes
non-owned keys to other direct cluster members.</p>
</div>
<div class="paragraph">
<p>Like the Client Provider, the Server Provider can connect to multiple clusters at the same time. This can be achieved by scoping the client side <code>CacheManager</code> with different Hazelcast configuration files. For more
information please see <a href="#scoping-to-join-clusters">Scoping to Join Clusters</a>.</p>
</div>
<div class="paragraph">
<p>To request this <code>CachingProvider</code> using <code>Caching.getCachingProvider( String )</code> or
<code>Caching.getCachingProvider( String, ClassLoader )</code>, use the following fully qualified class name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">com.hazelcast.cache.impl.HazelcastServerCachingProvider</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jcache-api"><a class="anchor" href="#jcache-api"></a><a class="link" href="#jcache-api">13.4. JCache API</a></h3>
<div class="paragraph">
<p>This section explains the JCache API by providing simple examples and use cases. While walking through the examples, we will have
a look at a couple of the standard API classes and see how these classes are used.</p>
</div>
<div class="sect3">
<h4 id="jcache-api-application-example"><a class="anchor" href="#jcache-api-application-example"></a><a class="link" href="#jcache-api-application-example">13.4.1. JCache API Application Example</a></h4>
<div class="paragraph">
<p>The code in this subsection creates a small account application by providing a caching layer over an imagined database abstraction. The
database layer will be simulated using single demo data in a simple DAO interface. To show the difference between the "database"
access and retrieving values from the cache, a small waiting time is used in the DAO implementation to simulate network and
database latency.</p>
</div>
<div class="sect4">
<h5 id="creating-user-class-example"><a class="anchor" href="#creating-user-class-example"></a><a class="link" href="#creating-user-class-example">Creating User Class Example</a></h5>
<div class="paragraph">
<p>Before we implement the JCache caching layer, let&#8217;s have a quick look at some basic
classes we need for this example.</p>
</div>
<div class="paragraph">
<p>The <code>User</code> class is the representation of a user table in the database. To keep it simple, it has just two properties:
<code>userId</code> and <code>username</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in jcache/api.adoc - include::{javasource}/jcache/User.java[tag=user]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="creating-dao-interface-example"><a class="anchor" href="#creating-dao-interface-example"></a><a class="link" href="#creating-dao-interface-example">Creating DAO Interface Example</a></h5>
<div class="paragraph">
<p>The DAO interface is also kept easy in this example. It provides a simple method to retrieve (find) a user by its <code>userId</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in jcache/api.adoc - include::{javasource}/jcache/UserDao.java[tag=userdao]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configuring-jcache-example"><a class="anchor" href="#configuring-jcache-example"></a><a class="link" href="#configuring-jcache-example">Configuring JCache Example</a></h5>
<div class="paragraph">
<p>To show most of the standard features, the configuration example is a little more complex.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create javax.cache.configuration.CompleteConfiguration subclass</span>
CompleteConfiguration&lt;<span class="predefined-type">Integer</span>, User&gt; config =
    <span class="keyword">new</span> MutableConfiguration&lt;<span class="predefined-type">Integer</span>, User&gt;()
        <span class="comment">// Configure the cache to be typesafe</span>
        .setTypes( <span class="predefined-type">Integer</span>.class, User.class )
        <span class="comment">// Configure to expire entries 30 secs after creation in the cache</span>
        .setExpiryPolicyFactory( FactoryBuilder.factoryOf(
            <span class="keyword">new</span> AccessedExpiryPolicy( <span class="keyword">new</span> <span class="predefined-type">Duration</span>( <span class="predefined-type">TimeUnit</span>.SECONDS, <span class="integer">30</span> ) )
        ) )
        <span class="comment">// Configure read-through of the underlying store</span>
        .setReadThrough( <span class="predefined-constant">true</span> )
        <span class="comment">// Configure write-through to the underlying store</span>
        .setWriteThrough( <span class="predefined-constant">true</span> )
        <span class="comment">// Configure the javax.cache.integration.CacheLoader</span>
        .setCacheLoaderFactory( FactoryBuilder.factoryOf(
            <span class="keyword">new</span> UserCacheLoader( userDao )
        ) )
        <span class="comment">// Configure the javax.cache.integration.CacheWriter</span>
        .setCacheWriterFactory( FactoryBuilder.factoryOf(
            <span class="keyword">new</span> UserCacheWriter( userDao )
        ) )
        <span class="comment">// Configure the javax.cache.event.CacheEntryListener with no</span>
        <span class="comment">// javax.cache.event.CacheEntryEventFilter, to include old value</span>
        <span class="comment">// and to be executed synchronously</span>
        .addCacheEntryListenerConfiguration(
            <span class="keyword">new</span> MutableCacheEntryListenerConfiguration&lt;<span class="predefined-type">Integer</span>, User&gt;(
                <span class="keyword">new</span> UserCacheEntryListenerFactory(),
                <span class="predefined-constant">null</span>, <span class="predefined-constant">true</span>, <span class="predefined-constant">true</span>
            )
        );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s go through this configuration line by line.</p>
</div>
<div class="sect5">
<h6 id="setting-the-cache-type-and-expire-policy"><a class="anchor" href="#setting-the-cache-type-and-expire-policy"></a><a class="link" href="#setting-the-cache-type-and-expire-policy">Setting the Cache Type and Expire Policy</a></h6>
<div class="paragraph">
<p>First, we set the expected types for the cache, which is already known from the previous example. On the next line, a
<code>javax.cache.expiry.ExpiryPolicy</code> is configured. Almost all integration <code>ExpiryPolicy</code> implementations are configured using
<code>javax.cache.configuration.Factory</code> instances. <code>Factory</code> and <code>FactoryBuilder</code> are explained later in this chapter.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring-read-through-and-write-through"><a class="anchor" href="#configuring-read-through-and-write-through"></a><a class="link" href="#configuring-read-through-and-write-through">Configuring Read-Through and Write-Through</a></h6>
<div class="paragraph">
<p>The next two lines configure the thread that will be read-through and write-through to the underlying backend resource that is configured
over the next few lines. The JCache API offers <code>javax.cache.integration.CacheLoader</code> and <code>javax.cache.integration.CacheWriter</code> to
implement adapter classes to any kind of backend resource, e.g., JPA, JDBC, or any other backend technology implementable in Java.
The interface provides the typical CRUD operations like <code>create</code>, <code>get</code>, <code>update</code>, <code>delete</code> and some bulk operation versions of those
common operations. We will look into the implementation of those implementations later.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring-entry-listeners"><a class="anchor" href="#configuring-entry-listeners"></a><a class="link" href="#configuring-entry-listeners">Configuring Entry Listeners</a></h6>
<div class="paragraph">
<p>The last configuration setting defines entry listeners based on sub-interfaces of <code>javax.cache.event.CacheEntryListener</code>. This
config does not use a <code>javax.cache.event.CacheEntryEventFilter</code> since the listener is meant to be fired on every change that
happens on the cache. Again we will look in the implementation of the listener in later in this chapter.</p>
</div>
</div>
<div class="sect5">
<h6 id="full-example-code"><a class="anchor" href="#full-example-code"></a><a class="link" href="#full-example-code">Full Example Code</a></h6>
<div class="paragraph">
<p>A full running example that is presented in this
subsection is available in the <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/jcache/src/main/java/com/hazelcast/examples/application">code samples repository</a>.
The application is built to be a command line app. It offers a small shell to accept different commands. After startup, you can
enter <code>help</code> to see all available commands and their descriptions.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jcache-base-classes"><a class="anchor" href="#jcache-base-classes"></a><a class="link" href="#jcache-base-classes">13.4.2. JCache Base Classes</a></h4>
<div class="paragraph">
<p>In the <a href="#example-jcache-application">Example JCache Application section</a>, we have already seen a couple of the base classes and explained how those work. The following are quick descriptions of them:</p>
</div>
<div class="paragraph">
<p><strong><code>javax.cache.Caching</code></strong>:</p>
</div>
<div class="paragraph">
<p>The access point into the JCache API. It retrieves the general <code>CachingProvider</code> backed by any compliant JCache
implementation, such as Hazelcast JCache.</p>
</div>
<div class="paragraph">
<p><strong><code>javax.cache.spi.CachingProvider</code></strong>:</p>
</div>
<div class="paragraph">
<p>The SPI that is implemented to bridge between the JCache API and the implementation itself. Hazelcast members and clients use different
providers chosen as seen in the <a href="#configuring-jcache-provider">Configuring JCache Provider section</a> which enable the JCache API to
interact with Hazelcast clusters.</p>
</div>
<div class="paragraph">
<p>When a <code>javax.cache.spi.CachingProvider.getCacheManager()</code> overload is used that takes a <code>java.lang.ClassLoader</code> argument, this
classloader will be part of the scope of the created <code>java.cache.Cache</code> and it is not possible to retrieve it on other members.
We advise not to use those overloads, as they are not meant to be used in distributed environments!</p>
</div>
<div class="paragraph">
<p><strong><code>javax.cache.CacheManager</code></strong>:</p>
</div>
<div class="paragraph">
<p>The <code>CacheManager</code> provides the capability to create new and manage existing JCache caches.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A <code>javax.cache.Cache</code> instance created with key and value types in the configuration
provides a type checking of those types at retrieval of the cache. For that reason, all non-types retrieval methods like
<code>getCache</code> throw an exception because types cannot be checked.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong><code>javax.cache.configuration.Configuration</code></strong>, <strong><code>javax.cache.configuration.MutableConfiguration</code></strong>:</p>
</div>
<div class="paragraph">
<p>These two classes are used to configure a cache prior to retrieving it from a <code>CacheManager</code>. The <code>Configuration</code> interface,
therefore, acts as a common super type for all compatible configuration classes such as <code>MutableConfiguration</code>.</p>
</div>
<div class="paragraph">
<p>Hazelcast itself offers a special implementation (<code>com.hazelcast.config.CacheConfig</code>) of the <code>Configuration</code> interface which
offers more options on the specific Hazelcast properties that can be set to configure features like synchronous and asynchronous
backups counts or selecting the underlying <a href="#setting-in-memory-format">in-memory format</a> of the cache. For more information on this
configuration class, please see the reference in <a href="#jcache-programmatic-configuration">JCache Programmatic Configuration section</a>.</p>
</div>
<div class="paragraph">
<p><strong><code>javax.cache.Cache</code></strong>:</p>
</div>
<div class="paragraph">
<p>This interface represents the cache instance itself. It is comparable to <code>java.util.Map</code> but offers special operations dedicated
to the caching use case. Therefore, for example <code>javax.cache.Cache.put()</code>, unlike <code>java.util.Map.put()</code>, does not return the old
value previously assigned to the given key.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bulk operations on the <code>Cache</code> interface guarantee atomicity per entry but not over
all given keys in the same bulk operations since no transactional behavior is applied over the whole batch process.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="implementing-factory-and-factorybuilder"><a class="anchor" href="#implementing-factory-and-factorybuilder"></a><a class="link" href="#implementing-factory-and-factorybuilder">13.4.3. Implementing Factory and FactoryBuilder</a></h4>
<div class="paragraph">
<p>The <code>javax.cache.configuration.Factory</code> implementations configure features like
<code>CacheEntryListener</code>, <code>ExpiryPolicy</code> and `CacheLoader`s or `CacheWriter`s. These factory implementations are required to distribute the
different features to members in a cluster environment like Hazelcast. Therefore, these factory implementations have to be serializable.</p>
</div>
<div class="paragraph">
<p><code>Factory</code> implementations are easy to do, as they follow the default Provider- or Factory-Pattern. The sample class
<code>UserCacheEntryListenerFactory</code> shown below implements a custom JCache <code>Factory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in jcache/api.adoc - include::{javasource}/jcache/UserCacheEntryListenerFactory.java[tag=ucelf]</code></pre>
</div>
</div>
<div class="paragraph">
<p>To simplify the process for the users, JCache API offers a set of helper methods collected in
<code>javax.cache.
configuration.FactoryBuilder</code>. In the above configuration example, <code>FactoryBuilder.factoryOf()</code> creates a
singleton factory for the given instance.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementing-cacheloader"><a class="anchor" href="#implementing-cacheloader"></a><a class="link" href="#implementing-cacheloader">13.4.4. Implementing CacheLoader</a></h4>
<div class="paragraph">
<p><code>javax.cache.integration.CacheLoader</code> loads cache entries from any external backend resource.</p>
</div>
<div class="sect4">
<h5 id="cache-read-through"><a class="anchor" href="#cache-read-through"></a><a class="link" href="#cache-read-through">Cache read-through</a></h5>
<div class="paragraph">
<p>If the cache is
configured to be <code>read-through</code>, then <code>CacheLoader.load()</code> is called transparently from the cache when the key or the value is not
yet found in the cache. If no value is found for a given key, it returns null.</p>
</div>
<div class="paragraph">
<p>If the cache is not configured to be <code>read-through</code>, nothing is loaded automatically. The user code must call <code>javax.cache.Cache.loadAll()</code> to load data for the given set of keys into the cache.</p>
</div>
<div class="paragraph">
<p>For the bulk load operation (<code>loadAll()</code>), some keys may not be found in the returned result set. In this case, a <code>javax.cache.integration.CompletionListener</code> parameter can be used as an asynchronous callback after all the key-value pairs are loaded because loading many key-value pairs can take lots of time.</p>
</div>
</div>
<div class="sect4">
<h5 id="cacheloader-example"><a class="anchor" href="#cacheloader-example"></a><a class="link" href="#cacheloader-example">CacheLoader Example</a></h5>
<div class="paragraph">
<p>Let&#8217;s look at the <code>UserCacheLoader</code> implementation. This implementation is quite straight forward.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It implements <code>CacheLoader</code>.</p>
</li>
<li>
<p>It overrides the <code>load</code> method to compute or retrieve the value corresponding to <code>key</code>.</p>
</li>
<li>
<p>It overrides the <code>loadAll</code> method to compute or retrieve the values corresponding to <code>keys</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An important note is that
any kind of exception has to be wrapped into <code>javax.cache.integration.CacheLoaderException</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in jcache/api.adoc - include::{javasource}/jcache/UserCacheLoader.java[tag=ucl]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cachewriter"><a class="anchor" href="#cachewriter"></a><a class="link" href="#cachewriter">13.4.5. CacheWriter</a></h4>
<div class="paragraph">
<p>You use a <code>javax.cache.integration.CacheWriter</code> to update an external backend resource. If the cache is configured to be
<code>write-through</code>, this process is executed transparently to the user&#8217;s code. Otherwise, there is currently no way to trigger
writing changed entries to the external resource to a user-defined point in time.</p>
</div>
<div class="paragraph">
<p>If bulk operations throw an exception, <code>java.util.Collection</code> has to be cleaned of all successfully written keys so
the cache implementation can determine what keys are written and can be applied to the cache state.</p>
</div>
<div class="paragraph">
<p>The following example performs the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It implements <code>CacheWriter</code>.</p>
</li>
<li>
<p>It overrides the <code>write</code> method to write the specified entry to the underlying store.</p>
</li>
<li>
<p>It overrides the <code>writeAll</code> method to write the specified entires to the underlying store.</p>
</li>
<li>
<p>It overrides the <code>delete</code> method to delete the key entry from the store.</p>
</li>
<li>
<p>It overrides the <code>deleteAll</code> method to delete the data and keys from the underlying store for the given collection of keys, if present.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in jcache/api.adoc - include::{javasource}/jcache/UserCacheWriter.java[tag=ucw]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, the implementation is pretty straightforward and also as above all exceptions thrown by the external resource, like
<code>java.sql.SQLException</code> has to be wrapped into a <code>javax.cache.integration.CacheWriterException</code>. Note this is a different
exception from the one thrown by <code>CacheLoader</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementing-entryprocessor"><a class="anchor" href="#implementing-entryprocessor"></a><a class="link" href="#implementing-entryprocessor">13.4.6. Implementing EntryProcessor</a></h4>
<div class="paragraph">
<p>With <code>javax.cache.processor.EntryProcessor</code>, you can apply an atomic function to a cache entry. In a distributed
environment like Hazelcast, you can move the mutating function to the member that owns the key. If the value
object is big, it might prevent traffic by sending the object to the mutator and sending it back to the owner to update it.</p>
</div>
<div class="paragraph">
<p>By default, Hazelcast JCache sends the complete changed value to the backup partition. Again, this can cause a lot of traffic if
the object is big. The Hazelcast ICache extension can also prevent this. Further information is available at
<a href="#implementing-backupawareentryprocessor">Implementing BackupAwareEntryProcessor</a>.</p>
</div>
<div class="paragraph">
<p>An arbitrary number of arguments can be passed to the <code>Cache.invoke()</code> and <code>Cache.invokeAll()</code> methods. All of those arguments need
to be fully serializable because in a distributed environment like Hazelcast, it is very likely that these arguments have to be passed around the cluster.</p>
</div>
<div class="paragraph">
<p>The following example performs the following tasks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It implements <code>EntryProcessor</code>.</p>
</li>
<li>
<p>It overrides the <code>process</code> method to process an entry.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in jcache/api.adoc - include::{javasource}/jcache/UserUpdateEntryProcessor.java[tag=uuep]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By executing the bulk <code>Cache.invokeAll()</code> operation, atomicity is only guaranteed for a
single cache entry. No transactional rules are applied to the bulk operation.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
JCache <code>EntryProcessor</code> implementations are not allowed to call
<code>javax.cache.Cache</code> methods. This prevents operations from deadlocking between different calls.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition, when using a <code>Cache.invokeAll()</code> method, a <code>java.util.Map</code> is returned that maps the key to its
<code>javax.cache.processor.EntryProcessorResult</code>, which itself wraps the actual result or a thrown
<code>javax.cache.processor.EntryProcessorException</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="cacheentrylistener"><a class="anchor" href="#cacheentrylistener"></a><a class="link" href="#cacheentrylistener">13.4.7. CacheEntryListener</a></h4>
<div class="paragraph">
<p>The <code>javax.cache.event.CacheEntryListener</code> implementation is straight forward. <code>CacheEntryListener</code> is a super-interface that is used as a marker for listener classes in JCache. The specification brings a set of sub-interfaces.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CacheEntryCreatedListener</code>: Fires after a cache entry is added (even on read-through by a <code>CacheLoader</code>) to the cache.</p>
</li>
<li>
<p><code>CacheEntryUpdatedListener</code>: Fires after an already existing cache entry updates.</p>
</li>
<li>
<p><code>CacheEntryRemovedListener</code>: Fires after a cache entry was removed (not expired) from the cache.</p>
</li>
<li>
<p><code>CacheEntryExpiredListener</code>: Fires after a cache entry has been expired. Expiry does not have to be a parallel process-- Hazelcast JCache implementation detects and removes expired entries periodically. Therefore, the expiration event may not be fired as soon as the entry expires. See <a href="#expirypolicy">ExpiryPolicy</a> for details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure <code>CacheEntryListener</code>, add a <code>javax.cache.configuration.CacheEntryListenerConfiguration</code> instance to
the JCache configuration class, as seen in the above example configuration. In addition, listeners can be configured to be
executed synchronously (blocking the calling thread) or asynchronously (fully running in parallel).</p>
</div>
<div class="paragraph">
<p>In this example application, the listener is implemented to print event information on the console. That visualizes what is going on in the cache. This application performs the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It implements the <code>CacheEntryCreatedListener.onCreated</code> method to call after an entry is created.</p>
</li>
<li>
<p>It implements the <code>CacheEntryUpdatedListener.onUpdated</code> method to call after an entry is updated.</p>
</li>
<li>
<p>It implements the <code>CacheEntryRemovedListener.onRemoved</code> method to call after an entry is removed.</p>
</li>
<li>
<p>It implements the <code>CacheEntryExpiredListener.onExpired</code> method to call after an entry expires.</p>
</li>
<li>
<p>It implements <code>printEvents</code> to print event information on the console.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in jcache/api.adoc - include::{javasource}/jcache/UserCacheEntryListener.java[tag=ucel]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="expirypolicy"><a class="anchor" href="#expirypolicy"></a><a class="link" href="#expirypolicy">13.4.8. ExpiryPolicy</a></h4>
<div class="paragraph">
<p>In JCache, <code>javax.cache.expiry.ExpiryPolicy</code> implementations are used to automatically expire cache entries based on different rules.</p>
</div>
<div class="paragraph">
<p>JCache does not require expired entries to be removed from the cache immediately. It only enforces that expired entries are not returned from cache.
Therefore, exact time of removal is implementation specific. Hazelcast complies JCache by checking the entries for expiration at the time of
get operations (lazy expiration). In addition to that, Hazelcast uses a periodic task to detect and remove expired entries as soon as possible (eager expiration).
Thanks to eager expiry, all expired entries are removed from the memory eventually even when they are not touched again. So the space
used by such entries are released as well.</p>
</div>
<div class="paragraph">
<p>For a detailed explanation of interaction between expiry policies and JCache API, please refer to the table in <code>Expiry Policies</code> section of <a href="https://www.jcp.org/en/jsr/detail?id=107">JCache documentation</a>.</p>
</div>
<div class="paragraph">
<p>Expiry timeouts are defined using <code>javax.cache.expiry.Duration</code>, which is a pair of <code>java.util.concurrent.TimeUnit</code>, that
describes a time unit and a long, defining the timeout value. The minimum allowed <code>TimeUnit</code> is <code>TimeUnit.MILLISECONDS</code>.
The long value <code>durationAmount</code> must be equal or greater than zero. A value of zero (or <code>Duration.ZERO</code>) indicates that the
cache entry expires immediately.</p>
</div>
<div class="paragraph">
<p>By default, JCache delivers a set of predefined expiry strategies in the standard API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AccessedExpiryPolicy</code>: Expires after a given set of time measured from creation of the cache entry. The expiry timeout is updated on accessing the key.</p>
</li>
<li>
<p><code>CreatedExpiryPolicy</code>: Expires after a given set of time measured from creation of the cache entry. The expiry timeout is never updated.</p>
</li>
<li>
<p><code>EternalExpiryPolicy</code>: Never expires. This is the default behavior, similar to <code>ExpiryPolicy</code> being set to null.</p>
</li>
<li>
<p><code>ModifiedExpiryPolicy</code>: Expires after a given set of time measured from creation of the cache entry. The expiry timeout is updated on updating the key.</p>
</li>
<li>
<p><code>TouchedExpiryPolicy</code>: Expires after a given set of time measured from creation of the cache entry. The expiry timeout is updated on accessing or updating the key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because <code>EternalExpiryPolicy</code> does not expire cache entries, it is still possible to evict values from memory if an underlying
<code>CacheLoader</code> is defined.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jcache-hazelcast-instance-integration"><a class="anchor" href="#jcache-hazelcast-instance-integration"></a><a class="link" href="#jcache-hazelcast-instance-integration">13.5. JCache - Hazelcast Instance Integration</a></h3>
<div class="paragraph">
<p>You can retrieve <code>javax.cache.Cache</code> instances using the interface <code>ICacheManager</code> of <code>HazelcastInstance</code>. This interface has the method <code>getCache(String name)</code> where <code>name</code> is the prefixed cache name. The prefixes in the cache name are URI and classloader prefixes, which are optional.</p>
</div>
<div class="paragraph">
<p>If you create a cache through a <code>ICacheManager</code> which has its own specified URI scope (and/or specified classloader),
it must be prepended to the pure cache name as a prefix while retrieving the cache through <code>getCache(String name)</code>.
Prefix generation for full cache name is exposed through
<code>com.hazelcast.cache.CacheUtil.getPrefixedCacheName(String name, java.net.URI uri, ClassLoader classloader)</code>.
If the URI scope and classloader is not specified, the pure cache name can be used directly while retrieving cache over <code>ICacheManager</code>.</p>
</div>
<div class="paragraph">
<p>If you have a cache which is not created, but is defined/exists (cache is specified in Hazelcast configuration but not created yet), you can retrieve this cache by its name.  This also triggers cache creation before retrieving it. This retrieval is supported through <code>HazelcastInstance</code>. However, <code>HazelcastInstance</code> <strong><strong>does not</strong></strong> support creating a cache by specifying configuration; this is supported by Hazelcast&#8217;s <code>ICacheManager</code> as it is.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If a valid (rather than <strong>1.0.0-PFD</strong> or <strong>0.x</strong> versions) JCache library does not exist on the classpath, <code>IllegalStateException</code> is thrown.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="jcache-and-hazelcast-instance-awareness"><a class="anchor" href="#jcache-and-hazelcast-instance-awareness"></a><a class="link" href="#jcache-and-hazelcast-instance-awareness">13.5.1. JCache and Hazelcast Instance Awareness</a></h4>
<div class="paragraph">
<p><code>HazelcastInstance</code> is injected into the following cache API interfaces (provided by <code>javax.cache.Cache</code> and <code>com.hazelcast.cache.ICache</code>)  if they implement <code>HazelcastInstanceAware</code> interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ExpiryPolicyFactory</code> and <code>ExpiryPolicy</code> [provided by <code>javax.cache.Cache</code>]</p>
</li>
<li>
<p><code>CacheLoaderFactory</code> and <code>CacheLoader</code> [provided by <code>javax.cache.Cache</code>]</p>
</li>
<li>
<p><code>CacheWriteFactory</code> and <code>CacheWriter</code> [provided by <code>javax.cache.Cache</code>]</p>
</li>
<li>
<p><code>EntryProcessor</code> [provided by <code>javax.cache.Cache</code>]</p>
</li>
<li>
<p><code>CacheEntryListener</code> (<code>CacheEntryCreatedListener</code>, <code>CacheEntryUpdatedListener</code>, <code>CacheEntryRemovedListener</code>, <code>CacheEntryExpiredListener</code>) [provided by <code>javax.cache.Cache</code>]</p>
</li>
<li>
<p><code>CacheEntryEventFilter</code> [provided by <code>javax.cache.Cache</code>]</p>
</li>
<li>
<p><code>CompletionListener</code> [provided by <code>javax.cache.Cache</code>]</p>
</li>
<li>
<p><code>CachePartitionLostListener</code> [provided by <code>com.hazelcast.cache.ICache</code>]</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hazelcast-jcache-extension-icache"><a class="anchor" href="#hazelcast-jcache-extension-icache"></a><a class="link" href="#hazelcast-jcache-extension-icache">13.6. Hazelcast JCache Extension - ICache</a></h3>
<div class="paragraph">
<p>Hazelcast provides extension methods to Cache API through the interface <code>com.hazelcast.cache.ICache</code>.</p>
</div>
<div class="paragraph">
<p>It has two sets of extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Asynchronous version of all cache operations. See <a href="#icache-async-methods">Async Operations</a>.</p>
</li>
<li>
<p>Cache operations with custom <code>ExpiryPolicy</code> parameter to apply on that specific operation. See <a href="#defining-a-custom-expirypolicy">Custom ExpiryPolicy</a>.</p>
</li>
</ul>
</div>
<hr>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ICache data structure can also be used by <a href="https://jet.hazelcast.org/">Hazelcast Jet</a> for Real-Time Stream Processing (by enabling the Event Journal on your cache) and Fast Batch Processing. Hazelcast Jet uses ICache as a source (reads data from ICache) and as a sink (writes data to ICache). Please see the <a href="https://jet.hazelcast.org/use-cases/fast-batch-processing/">Fast Batch Processing</a> and <a href="https://jet.hazelcast.org/use-cases/real-time-stream-processing/">Real-Time Stream Processing</a> use cases for Hazelcast Jet. Please also see <a href="https://docs.hazelcast.org/docs/jet/latest/manual/index.html#connector-imdg">here</a> in the Hazelcast Jet Reference Manual to learn how Jet uses ICache, i.e., how it can read from and write to ICache.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="scoping-to-join-clusters"><a class="anchor" href="#scoping-to-join-clusters"></a><a class="link" href="#scoping-to-join-clusters">13.6.1. Scoping to Join Clusters</a></h4>
<div class="paragraph">
<p>A <code>CacheManager</code>, started either as a client or as an embedded member, can be configured to start a new Hazelcast instance or reuse an already existing one to connect to a Hazelcast cluster. To achieve this, request
a <code>CacheManager</code> by passing a <code>java.net.URI</code> instance to <code>CachingProvider.getCacheManager()</code>. The <code>java.net.URI</code> instance must point to either a Hazelcast configuration or to the name of a named
<code>com.hazelcast.core.HazelcastInstance</code> instance. In addition to the above, the same can be achieved by passing Hazelcast-specific properties to <code>CachingProvider.getCacheManager(URI, ClassLoader, Properties)</code> as detailed in the sections that follow.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Multiple requests for the same <code>java.net.URI</code> result in returning a <code>CacheManager</code>
instance that shares the same <code>HazelcastInstance</code> as the <code>CacheManager</code> returned by the previous call.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="examples"><a class="anchor" href="#examples"></a><a class="link" href="#examples">Examples</a></h5>
<div class="paragraph">
<p>The following examples illustrate how <code>HazelcastInstance</code>s are created or reused during the creation of a new <code>CacheManager</code>. Complete reference on the <code>HazelcastInstance</code> lookup mechanism is provided in the sections that follow.</p>
</div>
<div class="sect5">
<h6 id="starting-the-default-code-cachemanager-code"><a class="anchor" href="#starting-the-default-code-cachemanager-code"></a><a class="link" href="#starting-the-default-code-cachemanager-code">Starting the Default <code>CacheManager</code></a></h6>
<div class="paragraph">
<p>Assuming no other <code>HazelcastInstance</code> exists in the same JVM, the <code>cacheManager</code> below will start a new <code>HazelcastInstance</code>, configured according to the configuration lookup rules as defined for <code>Hazelcast.newHazelcastInstance()</code> in case of an embedded member or <code>HazelcastClient.newHazelcastClient()</code> for a client-side <code>CacheManager</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CachingProvider caching = Caching.getCachingProvider();
CacheManager cacheManager = caching.getCacheManager();</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="reusing-existing-code-hazelcastinstance-code-with-the-default-code-cachemanager-code"><a class="anchor" href="#reusing-existing-code-hazelcastinstance-code-with-the-default-code-cachemanager-code"></a><a class="link" href="#reusing-existing-code-hazelcastinstance-code-with-the-default-code-cachemanager-code">Reusing Existing <code>HazelcastInstance</code> with the Default <code>CacheManager</code></a></h6>
<div class="paragraph">
<p>When using both Hazelcast-specific features and JCache, a <code>HazelcastInstance</code> might be already available to your JCache configuration. By configuring an instance name in <code>hazelcast.xml</code> in the classpath root, the <code>CacheManager</code> will locate the existing instance by name and reuse it.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.xml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
&lt;hazelcast xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.hazelcast.com/schema/config hazelcast-config-3.9.xsd</span><span class="delimiter">&quot;</span></span> xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.hazelcast.com/schema/config</span><span class="delimiter">&quot;</span></span> xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;instance-name&gt;hz-member-<span class="integer">1</span>&lt;/instance-name&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
</li>
<li>
<p><code>HazelcastInstance</code> &amp; <code>CacheManager</code> startup:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// start hazelcast, configured with default hazelcast.xml</span>
HazelcastInstance hz = Hazelcast.newHazelcastInstance();
<span class="comment">// start the default CacheManager -- it will locate the default hazelcast.xml configuration</span>
<span class="comment">// and identify the existing HazelcastInstance by its name</span>
CachingProvider caching = Caching.getCachingProvider();
CacheManager cacheManager = caching.getCacheManager();</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="starting-a-code-cachemanager-code-with-a-new-code-hazelcastinstance-code-configured-with-a-non-default-configuration-file"><a class="anchor" href="#starting-a-code-cachemanager-code-with-a-new-code-hazelcastinstance-code-configured-with-a-non-default-configuration-file"></a><a class="link" href="#starting-a-code-cachemanager-code-with-a-new-code-hazelcastinstance-code-configured-with-a-non-default-configuration-file">Starting a <code>CacheManager</code> with a New <code>HazelcastInstance</code> Configured with a Non-default Configuration File</a></h6>
<div class="paragraph">
<p>Given a configuration file named <code>hazelcast-jcache.xml</code> in the package <code>com.domain</code>, a <code>CacheManager</code> can be configured to start a new <code>HazelcastInstance</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By passing the <code>URI</code> to the configuration file as the <code>CacheManager&#8217;s `URI</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CachingProvider caching = Caching.getCachingProvider();
CacheManager cacheManager = caching.getCacheManager(<span class="keyword">new</span> <span class="predefined-type">URI</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/domain/hazelcast-jcache.xml</span><span class="delimiter">&quot;</span></span>), <span class="predefined-constant">null</span>);</code></pre>
</div>
</div>
</li>
<li>
<p>By specifying the configuration file location as a property:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> properties = HazelcastCachingProvider.propertiesByLocation(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/domain/aaa-hazelcast.xml</span><span class="delimiter">&quot;</span></span>);
CachingProvider caching = Caching.getCachingProvider();
CacheManager cacheManager = caching.getCacheManager(<span class="keyword">new</span> <span class="predefined-type">URI</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">any-uri-will-do</span><span class="delimiter">&quot;</span></span>), <span class="predefined-constant">null</span>, properties);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that if the Hazelcast configuration file does specify an instance name, then any <code>CacheManager</code>s referencing the same configuration file will locate by name and reuse the same <code>HazelcastInstance</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="reusing-an-existing-named-code-hazelcastinstance-code"><a class="anchor" href="#reusing-an-existing-named-code-hazelcastinstance-code"></a><a class="link" href="#reusing-an-existing-named-code-hazelcastinstance-code">Reusing an Existing Named <code>HazelcastInstance</code></a></h6>
<div class="paragraph">
<p>Assuming a <code>HazelcastInstance</code> named <code>hc-instance</code> is already started, it can be used as the <code>HazelcastInstance</code> to back a <code>CacheManager</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By using the instance&#8217;s name as the <code>CacheManager&#8217;s `URI</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CachingProvider caching = Caching.getCachingProvider();
CacheManager cacheManager = caching.getCacheManager(<span class="keyword">new</span> <span class="predefined-type">URI</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hc-instance</span><span class="delimiter">&quot;</span></span>), <span class="predefined-constant">null</span>);</code></pre>
</div>
</div>
</li>
<li>
<p>By specifying the instance name as a property:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Properties</span> properties = HazelcastCachingProvider.propertiesByInstanceName(<span class="string"><span class="delimiter">&quot;</span><span class="content">hc-instance</span><span class="delimiter">&quot;</span></span>);
CachingProvider caching = Caching.getCachingProvider();
CacheManager cacheManager = caching.getCacheManager(<span class="keyword">new</span> <span class="predefined-type">URI</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">any-uri-will-do</span><span class="delimiter">&quot;</span></span>), <span class="predefined-constant">null</span>, properties);</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="applying-configuration-scope"><a class="anchor" href="#applying-configuration-scope"></a><a class="link" href="#applying-configuration-scope">Applying Configuration Scope</a></h5>
<div class="paragraph">
<p>To connect or join different clusters, apply a configuration scope to the <code>CacheManager</code>. If the same <code>URI</code> is
used to request a <code>CacheManager</code> that was created previously, those <code>CacheManager</code>s share the same underlying <code>HazelcastInstance</code>.</p>
</div>
<div class="paragraph">
<p>To apply configuration scope you can do either one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>pass the path to the configuration file using the location property
<code>HazelcastCachingProvider#HAZELCAST_CONFIG_LOCATION</code> (which resolves to <code>hazelcast.config.location</code>) as a mapping inside a
<code>java.util.Properties</code> instance to the <code>CachingProvider.getCacheManager(uri, classLoader, properties)</code> call.</p>
</li>
<li>
<p>use directly the configuration path as the <code>CacheManager&#8217;s `URI</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If both <code>HazelcastCachingProvider#HAZELCAST_CONFIG_LOCATION</code> property is set and the <code>CacheManager</code> <code>URI</code> resolves to a valid config file location, then the property value will be used to obtain the configuration for the <code>HazelcastInstance</code> the first time a <code>CacheManager</code> is created for the given <code>URI</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example of using configuration scope:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CachingProvider cachingProvider = Caching.getCachingProvider();

<span class="comment">// Create Properties instance pointing to a Hazelcast config file</span>
<span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
<span class="comment">// &quot;scope-hazelcast.xml&quot; resides in package com.domain.config</span>
properties.setProperty( HazelcastCachingProvider.HAZELCAST_CONFIG_LOCATION,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/domain/config/scoped-hazelcast.xml</span><span class="delimiter">&quot;</span></span> );

<span class="predefined-type">URI</span> cacheManagerName = <span class="keyword">new</span> <span class="predefined-type">URI</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-cache-manager</span><span class="delimiter">&quot;</span></span> );
CacheManager cacheManager = cachingProvider
    .getCacheManager( cacheManagerName, <span class="predefined-constant">null</span>, properties );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example using <code>HazelcastCachingProvider.propertiesByLocation()</code> helper method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CachingProvider cachingProvider = Caching.getCachingProvider();

<span class="comment">// Create Properties instance pointing to a Hazelcast config file in root package</span>
<span class="predefined-type">String</span> configFile = <span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:scoped-hazelcast.xml</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Properties</span> properties = HazelcastCachingProvider
    .propertiesByLocation( configFile );

<span class="predefined-type">URI</span> cacheManagerName = <span class="keyword">new</span> <span class="predefined-type">URI</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-cache-manager</span><span class="delimiter">&quot;</span></span> );
CacheManager cacheManager = cachingProvider
    .getCacheManager( cacheManagerName, <span class="predefined-constant">null</span>, properties );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The retrieved <code>CacheManager</code> is scoped to use the <code>HazelcastInstance</code> that was just created and configured using the given XML
configuration file.</p>
</div>
<div class="paragraph">
<p>Available protocols for config file URL include <code>classpath</code> to point to a classpath location, <code>file</code> to point to a filesystem
location and <code>http</code> and <code>https</code> for remote web locations. In addition, everything that does not specify a protocol is recognized
as a placeholder that can be configured using a system property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> configFile = <span class="string"><span class="delimiter">&quot;</span><span class="content">my-placeholder</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Properties</span> properties = HazelcastCachingProvider
    .propertiesByLocation( configFile );</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can set this on the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dmy-placeholder=classpath:my-configs/scoped-hazelcast.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should consider the following rules about the Hazelcast instance name when you specify the configuration file location using <code>HazelcastCachingProvider#HAZELCAST_CONFIG_LOCATION</code> (which resolves to <code>hazelcast.config.location</code>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you also specified the <code>HazelcastCachingProvider#HAZELCAST_INSTANCE_NAME</code> (which resolves to <code>hazelcast.instance.name</code>) property, this property is used as the instance name even though you configured the instance name in the configuration file.</p>
</li>
<li>
<p>If you do not specify <code>HazelcastCachingProvider#HAZELCAST_INSTANCE_NAME</code> but you configure the instance name in the configuration file using the element <code>&lt;instance-name&gt;</code>, this element&#8217;s value will be used as the instance name.</p>
</li>
<li>
<p>If you do not specify an instance name via property or in the configuration file, the URL of the configuration file location is used as the instance name.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
No check is performed to prevent creating multiple <code>CacheManager</code>s with the same cluster
configuration on different configuration files. If the same cluster is referred from different configuration files, multiple
cluster members or clients are created.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The configuration file location will not be a part of the resulting identity of the
<code>CacheManager</code>. An attempt to create a <code>CacheManager</code> with a different set of properties but an already used name will result in
undefined behavior.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="binding-to-a-named-instance"><a class="anchor" href="#binding-to-a-named-instance"></a><a class="link" href="#binding-to-a-named-instance">Binding to a Named Instance</a></h5>
<div class="paragraph">
<p>You can bind <code>CacheManager</code> to an existing and named <code>HazelcastInstance</code> instance. If the <code>instanceName</code> is specified in <code>com.hazelcast.config.Config</code>, it can be used directly by passing it to <code>CachingProvider</code> implementation. Otherwise (<code>instanceName</code> not set or instance is a client instance) you must get the instance name from the <code>HazelcastInstance</code> instance via the <code>String getName()</code> method to pass the <code>CachingProvider</code> implementation. Please note that <code>instanceName</code> is not configurable for the client side <code>HazelcastInstance</code> instance and is auto-generated by using group name (if it is specified). In general, <code>String getName()</code> method over <code>HazelcastInstance</code> is safer and the preferable way to get the name of the instance. Multiple <code>CacheManager</code>s created using an equal <code>java.net.URI</code> will share the same <code>HazelcastInstance</code>.</p>
</div>
<div class="paragraph">
<p>A named scope is applied nearly the same way as the configuration scope. Pass the instance name using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>either the property <code>HazelcastCachingProvider#HAZELCAST_INSTANCE_NAME</code> (which resolves to <code>hazelcast.instance.name</code>) as a mapping inside a <code>java.util.Properties</code> instance to the <code>CachingProvider.getCacheManager(uri, classLoader, properties)</code> call.</p>
</li>
<li>
<p>or use the instance name when specifying the <code>CacheManager&#8217;s `URI</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a valid instance name is provided both as property and as <code>URI</code>, then the property value takes precedence and is used to resolve the <code>HazelcastInstance</code> the first time a <code>CacheManager</code> is created for the given <code>URI</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example of Named Instance Scope with specified name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
config.setInstanceName( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-named-hazelcast-instance</span><span class="delimiter">&quot;</span></span> );
<span class="comment">// Create a named HazelcastInstance</span>
Hazelcast.newHazelcastInstance( config );

CachingProvider cachingProvider = Caching.getCachingProvider();

<span class="comment">// Create Properties instance pointing to a named HazelcastInstance</span>
<span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
properties.setProperty( HazelcastCachingProvider.HAZELCAST_INSTANCE_NAME,
     <span class="string"><span class="delimiter">&quot;</span><span class="content">my-named-hazelcast-instance</span><span class="delimiter">&quot;</span></span> );

<span class="predefined-type">URI</span> cacheManagerName = <span class="keyword">new</span> <span class="predefined-type">URI</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-cache-manager</span><span class="delimiter">&quot;</span></span> );
CacheManager cacheManager = cachingProvider
    .getCacheManager( cacheManagerName, <span class="predefined-constant">null</span>, properties );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of Named Instance Scope with specified name passed as <code>URI</code> of the <code>CacheManager</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
config.setInstanceName( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-named-hazelcast-instance</span><span class="delimiter">&quot;</span></span> );
<span class="comment">// Create a named HazelcastInstance</span>
Hazelcast.newHazelcastInstance( config );

CachingProvider cachingProvider = Caching.getCachingProvider();
<span class="predefined-type">URI</span> cacheManagerName = <span class="keyword">new</span> <span class="predefined-type">URI</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-named-hazelcast-instance</span><span class="delimiter">&quot;</span></span> );
CacheManager cacheManager = cachingProvider
    .getCacheManager( cacheManagerName, <span class="predefined-constant">null</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of Named Instance Scope with auto-generated name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
<span class="comment">// Create a auto-generated named HazelcastInstance</span>
HazelcastInstance instance = Hazelcast.newHazelcastInstance( config );
<span class="predefined-type">String</span> instanceName = instance.getName();

CachingProvider cachingProvider = Caching.getCachingProvider();

<span class="comment">// Create Properties instance pointing to a named HazelcastInstance</span>
<span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
properties.setProperty( HazelcastCachingProvider.HAZELCAST_INSTANCE_NAME,
     instanceName );

<span class="predefined-type">URI</span> cacheManagerName = <span class="keyword">new</span> <span class="predefined-type">URI</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-cache-manager</span><span class="delimiter">&quot;</span></span> );
CacheManager cacheManager = cachingProvider
    .getCacheManager( cacheManagerName, <span class="predefined-constant">null</span>, properties );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of Named Instance Scope with auto-generated name on client instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
ClientNetworkConfig networkConfig = clientConfig.getNetworkConfig();
networkConfig.addAddress(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.2</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Create a client side HazelcastInstance</span>
HazelcastInstance instance = HazelcastClient.newHazelcastClient( clientConfig );
<span class="predefined-type">String</span> instanceName = instance.getName();

CachingProvider cachingProvider = Caching.getCachingProvider();

<span class="comment">// Create Properties instance pointing to a named HazelcastInstance</span>
<span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
properties.setProperty( HazelcastCachingProvider.HAZELCAST_INSTANCE_NAME,
     instanceName );

<span class="predefined-type">URI</span> cacheManagerName = <span class="keyword">new</span> <span class="predefined-type">URI</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-cache-manager</span><span class="delimiter">&quot;</span></span> );
CacheManager cacheManager = cachingProvider
    .getCacheManager( cacheManagerName, <span class="predefined-constant">null</span>, properties );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example using <code>HazelcastCachingProvider.propertiesByInstanceName()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
config.setInstanceName( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-named-hazelcast-instance</span><span class="delimiter">&quot;</span></span> );
<span class="comment">// Create a named HazelcastInstance</span>
Hazelcast.newHazelcastInstance( config );

CachingProvider cachingProvider = Caching.getCachingProvider();

<span class="comment">// Create Properties instance pointing to a named HazelcastInstance</span>
<span class="predefined-type">Properties</span> properties = HazelcastCachingProvider
    .propertiesByInstanceName( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-named-hazelcast-instance</span><span class="delimiter">&quot;</span></span> );

<span class="predefined-type">URI</span> cacheManagerName = <span class="keyword">new</span> <span class="predefined-type">URI</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">my-cache-manager</span><span class="delimiter">&quot;</span></span> );
CacheManager cacheManager = cachingProvider
    .getCacheManager( cacheManagerName, <span class="predefined-constant">null</span>, properties );</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>instanceName</code> will not be a part of the resulting identity of the <code>CacheManager</code>.
An attempt to create a <code>CacheManager</code> with a different set of properties but an already used name will result in undefined behavior.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="binding-to-an-existing-hazelcast-instance-object"><a class="anchor" href="#binding-to-an-existing-hazelcast-instance-object"></a><a class="link" href="#binding-to-an-existing-hazelcast-instance-object">Binding to an Existing Hazelcast Instance Object</a></h5>
<div class="paragraph">
<p>When an existing <code>HazelcastInstance</code> object is available, it can be passed to the <code>CacheManager</code> by setting the property <code>HazelcastCachingProvider#HAZELCAST_INSTANCE_ITSELF</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create a member HazelcastInstance</span>
HazelcastInstance instance = Hazelcast.newHazelcastInstance();

<span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
properties.put( HazelcastCachingProvider.HAZELCAST_INSTANCE_ITSELF,
     instance );

CachingProvider cachingProvider = Caching.getCachingProvider();
<span class="comment">// cacheManager initialized for uri will be bound to instance</span>
CacheManager cacheManager = cachingProvider.getCacheManager(uri, classLoader, properties);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="namespacing"><a class="anchor" href="#namespacing"></a><a class="link" href="#namespacing">13.6.2. Namespacing</a></h4>
<div class="paragraph">
<p>The <code>java.net.URI</code>s that don&#8217;t use the above-mentioned Hazelcast-specific schemes are recognized as namespacing. Those
<code>CacheManager</code>s share the same underlying default <code>HazelcastInstance</code> created (or set) by the <code>CachingProvider</code>, but they cache with the
same names and different namespaces on the <code>CacheManager</code> level, and therefore they won&#8217;t share the same data. This is useful where multiple
applications might share the same Hazelcast JCache implementation, e.g., on application or OSGi servers, but are developed by
independent teams. To prevent interfering on caches using the same name, every application can use its own namespace when
retrieving the <code>CacheManager</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example of using namespacing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CachingProvider cachingProvider = Caching.getCachingProvider();

<span class="predefined-type">URI</span> nsApp1 = <span class="keyword">new</span> <span class="predefined-type">URI</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">application-1</span><span class="delimiter">&quot;</span></span> );
CacheManager cacheManagerApp1 = cachingProvider.getCacheManager( nsApp1, <span class="predefined-constant">null</span> );

<span class="predefined-type">URI</span> nsApp2 = <span class="keyword">new</span> <span class="predefined-type">URI</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">application-2</span><span class="delimiter">&quot;</span></span> );
CacheManager cacheManagerApp2 = cachingProvider.getCacheManager( nsApp2, <span class="predefined-constant">null</span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>That way both applications share the same <code>HazelcastInstance</code> instance but not the same caches.</p>
</div>
</div>
<div class="sect3">
<h4 id="retrieving-an-icache-instance"><a class="anchor" href="#retrieving-an-icache-instance"></a><a class="link" href="#retrieving-an-icache-instance">13.6.3. Retrieving an ICache Instance</a></h4>
<div class="paragraph">
<p>Besides <a href="#scoping-to-join-clusters">Scoping to Join Clusters</a> and <a href="#namespacing">Namespacing</a>, which are implemented using the URI feature of the
specification, all other extended operations are required to retrieve the <code>com.hazelcast.cache.ICache</code> interface instance from
the JCache <code>javax.cache.Cache</code> instance. For Hazelcast, both interfaces are implemented on the same object instance. It
is recommended that you stay with the specification method to retrieve the <code>ICache</code> version, since <code>ICache</code> might be subject to change without notification.</p>
</div>
<div class="paragraph">
<p>To retrieve or unwrap the <code>ICache</code> instance, you can execute the following code example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CachingProvider cachingProvider = Caching.getCachingProvider();
CacheManager cacheManager = cachingProvider.getCacheManager();
Cache&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; cache = cacheManager.getCache( ... );

ICache&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt; unwrappedCache = cache.unwrap( ICache.class );</code></pre>
</div>
</div>
<div class="paragraph">
<p>After unwrapping the <code>Cache</code> instance into an <code>ICache</code> instance, you have access to all of the following operations, e.g.,
<a href="#icache-async-methods">ICache Async Methods</a> and <a href="#icache-convenience-methods">ICache Convenience Methods</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="icache-configuration"><a class="anchor" href="#icache-configuration"></a><a class="link" href="#icache-configuration">13.6.4. ICache Configuration</a></h4>
<div class="paragraph">
<p>As mentioned in the <a href="#jcache-declarative-configuration">JCache Declarative Configuration section</a>, the Hazelcast ICache extension offers
additional configuration properties over the default JCache configuration. These additional properties include internal storage format, backup counts, eviction policy and quorum reference.</p>
</div>
<div class="paragraph">
<p>The declarative configuration for ICache is a superset of the previously discussed JCache configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;cache&gt;
  &lt;!-- ... default cache configuration goes here ... --&gt;
  &lt;backup-count&gt;<span class="integer">1</span>&lt;/backup-count&gt;
  &lt;async-backup-count&gt;<span class="integer">1</span>&lt;/async-backup-count&gt;
  &lt;in-memory-format&gt;BINARY&lt;/in-memory-format&gt;
  &lt;eviction size=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTRY_COUNT</span><span class="delimiter">&quot;</span></span> eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">LRU</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;partition-lost-listeners&gt;
     &lt;partition-lost-listener&gt;CachePartitionLostListenerImpl&lt;/partition-lost-listener&gt;
 &lt;/partition-lost-listeners&gt;
 &lt;quorum-ref&gt;quorum-name&lt;/quorum-ref&gt;
 &lt;disable-per-entry-invalidation-events&gt;<span class="predefined-constant">true</span>&lt;/disable-per-entry-invalidation-events&gt;
&lt;/cache&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>backup-count</code>: Number of synchronous backups. Those backups are executed before the mutating cache operation is finished. The mutating operation is blocked. Its default value is 1.</p>
</li>
<li>
<p><code>async-backup-count</code>: Number of asynchronous backups. Those backups are executed asynchronously so the mutating operation is not blocked and it will be done immediately. Its default value is 0.</p>
</li>
<li>
<p><code>in-memory-format</code>: Internal storage format. For more information, please see the <a href="#setting-in-memory-format">in-memory format section</a>. Its default value is <code>BINARY</code>.</p>
</li>
<li>
<p><code>eviction</code>: Defines the used eviction strategies and sizes for the cache. For more information on eviction, please see the <a href="#jcache-eviction">JCache Eviction</a>.</p>
<div class="ulist">
<ul>
<li>
<p><code>size</code>: Maximum number of records or maximum size in bytes depending on the <code>max-size-policy</code> property. Size can be any integer between <code>0</code> and <code>Integer.MAX_VALUE</code>. The default <code>max-size-policy</code> is <code>ENTRY_COUNT</code> and its default size is <code>10.000</code>.</p>
</li>
<li>
<p><code>max-size-policy</code>: Maximum size. If maximum size is reached, the cache is evicted based on the eviction policy. Default <code>max-size-policy</code> is <code>ENTRY_COUNT</code> and its default size is <code>10.000</code>. The following eviction policies are available:</p>
<div class="ulist">
<ul>
<li>
<p><code>ENTRY_COUNT</code>: Maximum number of cache entries in the cache. <strong>Available on heap based cache record store only.</strong></p>
</li>
<li>
<p><code>USED_NATIVE_MEMORY_SIZE</code>: Maximum used native memory size in megabytes per cache for each Hazelcast instance. <strong>Available on High-Density Memory cache record store only.</strong></p>
</li>
<li>
<p><code>USED_NATIVE_MEMORY_PERCENTAGE</code>: Maximum used native memory size percentage per cache for each Hazelcast instance. <strong>Available on High-Density Memory cache record store only.</strong></p>
</li>
<li>
<p><code>FREE_NATIVE_MEMORY_SIZE</code>: Minimum free native memory size in megabytes for each Hazelcast instance. <strong>Available on High-Density Memory cache record store only.</strong></p>
</li>
<li>
<p><code>FREE_NATIVE_MEMORY_PERCENTAGE</code>: Minimum free native memory size percentage for each Hazelcast instance. <strong>Available on High-Density Memory cache record store only.</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>eviction-policy</code>: Eviction policy that compares values to find the best matching eviction candidate. Its default value is <code>LRU</code>.</p>
<div class="ulist">
<ul>
<li>
<p><code>LRU</code>: Less Recently Used - finds the best eviction candidate based on the lastAccessTime.</p>
</li>
<li>
<p><code>LFU</code>: Less Frequently Used - finds the best eviction candidate based on the number of hits.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>partition-lost-listeners</code> : Defines listeners for dispatching partition lost events for the cache. For more information, please see the <a href="#icache-partition-lost-listener">ICache Partition Lost Listener section</a>.</p>
</li>
<li>
<p><code>quorum-ref</code> : Name of quorum configuration that you want this cache to use.</p>
</li>
<li>
<p><code>disable-per-entry-invalidation-events</code> : Disables invalidation events for each entry; but full-flush invalidation events are still enabled. Full-flush invalidation means the invalidation of events for all entries when <code>clear</code> is called. Its default value is <code>false</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since <code>javax.cache.configuration.MutableConfiguration</code> misses the above additional configuration properties, Hazelcast ICache extension
provides an extended configuration class called <code>com.hazelcast.config.CacheConfig</code>. This class is an implementation of <code>javax.cache.configuration.CompleteConfiguration</code> and all the properties shown above can be configured
using its corresponding setter methods.</p>
</div>
<div class="paragraph">
<p>NOTE:At the client side, ICache can be configured only programmatically.</p>
</div>
</div>
<div class="sect3">
<h4 id="icache-async-methods"><a class="anchor" href="#icache-async-methods"></a><a class="link" href="#icache-async-methods">13.6.5. ICache Async Methods</a></h4>
<div class="paragraph">
<p>As another addition of Hazelcast ICache over the normal JCache specification, Hazelcast provides asynchronous versions of almost
all methods, returning a <code>com.hazelcast.core.ICompletableFuture</code>. By using these methods and the returned future objects, you can use JCache in a reactive way by registering zero or more callbacks on the future to prevent blocking the current thread.</p>
</div>
<div class="paragraph">
<p>The asynchronous versions of the methods append the phrase <code>Async</code> to the method name. The example code below uses the method <code>putAsync()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ICache&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; unwrappedCache = cache.unwrap( ICache.class );
ICompletableFuture&lt;<span class="predefined-type">String</span>&gt; future = unwrappedCache.getAndPutAsync( <span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span> );
future.andThen( <span class="keyword">new</span> ExecutionCallback&lt;<span class="predefined-type">String</span>&gt;() {
    <span class="directive">public</span> <span class="type">void</span> onResponse( <span class="predefined-type">String</span> response ) {
        <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">Previous value: </span><span class="delimiter">&quot;</span></span> + response );
    }

    <span class="directive">public</span> <span class="type">void</span> onFailure( <span class="predefined-type">Throwable</span> t ) {
        t.printStackTrace();
    }
} );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following methods
are available in asynchronous versions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>get(key)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>getAsync(key)</code></p>
</li>
<li>
<p><code>getAsync(key, expiryPolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>put(key, value)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>putAsync(key, value)</code></p>
</li>
<li>
<p><code>putAsync(key, value, expiryPolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>putIfAbsent(key, value)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>putIfAbsentAsync(key, value)</code></p>
</li>
<li>
<p><code>putIfAbsentAsync(key, value, expiryPolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>getAndPut(key, value)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>getAndPutAsync(key, value)</code></p>
</li>
<li>
<p><code>getAndPutAsync(key, value, expiryPolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>remove(key)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>removeAsync(key)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>remove(key, value)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>removeAsync(key, value)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>getAndRemove(key)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>getAndRemoveAsync(key)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>replace(key, value)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>replaceAsync(key, value)</code></p>
</li>
<li>
<p><code>replaceAsync(key, value, expiryPolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>replace(key, oldValue, newValue)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>replaceAsync(key, oldValue, newValue)</code></p>
</li>
<li>
<p><code>replaceAsync(key, oldValue, newValue, expiryPolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>getAndReplace(key, value)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>getAndReplaceAsync(key, value)</code></p>
</li>
<li>
<p><code>getAndReplaceAsync(key, value, expiryPolicy)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The methods with a given <code>javax.cache.expiry.ExpiryPolicy</code> are further discussed in the
<a href="#defining-a-custom-expirypolicy">Defining a Custom ExpiryPolicy</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Asynchronous versions of the methods are not compatible with synchronous events.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="defining-a-custom-expirypolicy"><a class="anchor" href="#defining-a-custom-expirypolicy"></a><a class="link" href="#defining-a-custom-expirypolicy">13.6.6. Defining a Custom ExpiryPolicy</a></h4>
<div class="paragraph">
<p>The JCache specification has an option to configure a single <code>ExpiryPolicy</code> per cache. Hazelcast ICache extension
offers the possibility to define a custom <code>ExpiryPolicy</code> per key by providing a set of method overloads with an <code>expirePolicy</code>
parameter, as in the list of asynchronous methods in the <a href="#icache-async-methods">Async Methods section</a>. This means that you can pass custom expiry policies to a cache operation.</p>
</div>
<div class="paragraph">
<p>Here is how an <code>ExpiryPolicy</code> is set on JCache configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CompleteConfiguration&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; config =
    <span class="keyword">new</span> MutableConfiguration&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;()
        .setExpiryPolicyFactory(
            AccessedExpiryPolicy.factoryOf( <span class="predefined-type">Duration</span>.ONE_MINUTE )
        );</code></pre>
</div>
</div>
<div class="paragraph">
<p>To pass a custom <code>ExpiryPolicy</code>, a set of overloads is provided. You can use them as shown in the following code example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ICache&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; unwrappedCache = cache.unwrap( ICache.class );
unwrappedCache.put( <span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> AccessedExpiryPolicy( <span class="predefined-type">Duration</span>.ONE_DAY ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ExpiryPolicy</code> instance can be pre-created, cached and re-used, but only for each cache instance. This is because <code>ExpiryPolicy</code>
implementations can be marked as <code>java.io.Closeable</code>. The following list shows the provided method overloads over <code>javax.cache.Cache</code>
by <code>com.hazelcast.cache.ICache</code> featuring the <code>ExpiryPolicy</code> parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>get(key)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>get(key, expiryPolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>getAll(keys)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>getAll(keys, expirePolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>put(key, value)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>put(key, value, expirePolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>getAndPut(key, value)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>getAndPut(key, value, expirePolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>putAll(map)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>putAll(map, expirePolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>putIfAbsent(key, value)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>putIfAbsent(key, value, expirePolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>replace(key, value)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>replace(key, value, expirePolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>replace(key, oldValue, newValue)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>replace(key, oldValue, newValue, expirePolicy)</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>getAndReplace(key, value)</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>getAndReplace(key, value, expirePolicy)</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Asynchronous method overloads are not listed here. Please see <a href="#icache-async-methods">ICache Async Methods</a> for the list of asynchronous method overloads.</p>
</div>
<div class="paragraph">
<p>ICache also offers <code>setExpiryPolicy(key, expirePolicy)</code> method to associate certain keys with custom expiry policies.
Per key expiry policies defined by this method take precedence over cache policies, but they are overridden by the expiry policies specified in above mentioned overloaded methods.</p>
</div>
</div>
<div class="sect3">
<h4 id="jcache-eviction"><a class="anchor" href="#jcache-eviction"></a><a class="link" href="#jcache-eviction">13.6.7. JCache Eviction</a></h4>
<div class="paragraph">
<p>Caches are generally not expected to grow to an infinite size. Implementing an <a href="#defining-a-custom-expirypolicy">expiry policy</a> is one way you can
prevent infinite growth, but sometimes it is hard to define a meaningful expiration timeout. Therefore, Hazelcast JCache provides the eviction feature. Eviction offers the possibility of removing entries based on the cache size or amount of used memory
(Hazelcast IMDG Enterprise Only) and not based on timeouts.</p>
</div>
<div class="sect4">
<h5 id="eviction-and-runtime"><a class="anchor" href="#eviction-and-runtime"></a><a class="link" href="#eviction-and-runtime">Eviction and Runtime</a></h5>
<div class="paragraph">
<p>Since a cache is designed for high throughput and fast reads, Hazelcast put a lot of effort into designing the eviction system to be as
predictable as possible. All built-in implementations provide an amortized O(1) runtime. The default operation runtime is
rendered as O(1), but it can be faster than the normal runtime cost if the algorithm finds an expired entry while sampling.</p>
</div>
</div>
<div class="sect4">
<h5 id="cache-types"><a class="anchor" href="#cache-types"></a><a class="link" href="#cache-types">Cache Types</a></h5>
<div class="paragraph">
<p>Most importantly, typical production systems have two common types of caches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Reference Caches</strong>: Caches for reference data are normally small and are used to speed up the de-referencing as a lookup table. Those
caches are commonly tend to be small and contain a previously known, fixed number of elements, e.g., states of the USA or
abbreviations of elements.</p>
</li>
<li>
<p><strong>Active DataSet Caches</strong>:  The other type of caches normally caches an active data set. These caches run to their maximum
size and evict the oldest or not frequently used entries to keep in memory bounds. They sit in front of a database or HTML
generators to cache the latest requested data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hazelcast JCache eviction supports both types of caches using a slightly different approach based on the configured maximum size
of the cache. For detailed information, please see the <a href="#eviction-algorithm">Eviction Algorithm section</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configuring-eviction-policies"><a class="anchor" href="#configuring-eviction-policies"></a><a class="link" href="#configuring-eviction-policies">Configuring Eviction Policies</a></h5>
<div class="paragraph">
<p>Hazelcast JCache provides two commonly known eviction policies, LRU and LFU, but loosens the rules for predictable runtime
behavior. LRU, normally recognized as <code>Least Recently Used</code>, is implemented as <code>Less Recently Used</code> and LFU known as <code>Least Frequently Used</code> is implemented as
<code>Less Frequently Used</code>. The details about this difference are explained in the
<a href="#eviction-algorithm">Eviction Algorithm section</a>.</p>
</div>
<div class="paragraph">
<p>Eviction Policies are configured by providing the corresponding abbreviation to the configuration as shown in the <a href="#icache-configuration">ICache Configuration section</a>. As already mentioned, two built-in policies are available:</p>
</div>
<div class="paragraph">
<p>To configure the use of the LRU (Less Recently Used) policy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;eviction size=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTRY_COUNT</span><span class="delimiter">&quot;</span></span> eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">LRU</span><span class="delimiter">&quot;</span></span> /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And to configure the use of the LFU (Less Frequently Used) policy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;eviction size=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTRY_COUNT</span><span class="delimiter">&quot;</span></span> eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">LFU</span><span class="delimiter">&quot;</span></span> /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default eviction policy is LRU. Therefore, Hazelcast JCache does not offer the possibility of performing no eviction.</p>
</div>
<div class="sect5">
<h6 id="custom-eviction-policies"><a class="anchor" href="#custom-eviction-policies"></a><a class="link" href="#custom-eviction-policies">Custom Eviction Policies</a></h6>
<div class="paragraph">
<p>Besides the out-of-the-box eviction policies LFU and LRU, you can also specify your custom eviction policies
through the eviction configuration either programmatically or declaratively.</p>
</div>
<div class="paragraph">
<p>You can provide your <code>com.hazelcast.cache.CacheEvictionPolicyComparator</code> implementation to compare <code>com.hazelcast.cache.CacheEntryView</code>s. Supplied <code>CacheEvictionPolicyComparator</code> is used to compare cache entry views to select the one with higher priority to evict.</p>
</div>
<div class="paragraph">
<p>Here is an example for custom eviction policy comparator implementation for JCache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyCacheEvictionPolicyComparator</span>
        <span class="directive">extends</span> CacheEvictionPolicyComparator&lt;<span class="predefined-type">Long</span>, <span class="predefined-type">String</span>&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> compare(CacheEntryView&lt;<span class="predefined-type">Long</span>, <span class="predefined-type">String</span>&gt; e1, CacheEntryView&lt;<span class="predefined-type">Long</span>, <span class="predefined-type">String</span>&gt; e2) {
        <span class="type">long</span> id1 = e1.getKey();
        <span class="type">long</span> id2 = e2.getKey();
        <span class="keyword">if</span> (id1 &gt; id2) {
            <span class="keyword">return</span> FIRST_ENTRY_HAS_HIGHER_PRIORITY_TO_BE_EVICTED; <span class="comment">// -1</span>
        } <span class="keyword">else</span> <span class="keyword">if</span> (id1 &lt; id2) {
            <span class="keyword">return</span> SECOND_ENTRY_HAS_HIGHER_PRIORITY_TO_BE_EVICTED; <span class="comment">// +1</span>
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> BOTH_OF_ENTRIES_HAVE_SAME_PRIORITY_TO_BE_EVICTED; <span class="comment">// 0</span>
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Custom eviction policy comparator can be specified through the eviction configuration
by giving the full class name of the <code>EvictionPolicyComparator</code> (<code>CacheEvictionPolicyComparator</code> for JCache and its Near Cache)
implementation or by specifying its instance itself.</p>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="paragraph">
<p>You can specify the full class name of custom <code>EvictionPolicyComparator</code> (<code>CacheEvictionPolicyComparator</code> for JCache and its Near Cache) implementation
through <code>EvictionConfig</code>. This approach is useful when eviction configuration is specified at the client side
and custom <code>EvictionPolicyComparator</code> implementation class itself does not exist at the client but at server side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CacheConfig cacheConfig = <span class="keyword">new</span> CacheConfig();
...
EvictionConfig evictionConfig =
    <span class="keyword">new</span> EvictionConfig(<span class="integer">50000</span>,
                       MaxSizePolicy.ENTRY_COUNT,
                       <span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.MyEvictionPolicyComparator</span><span class="delimiter">&quot;</span></span>);
cacheConfig.setEvictionConfig(evictionConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can specify the custom <code>EvictionPolicyComparator</code> (<code>CacheEvictionPolicyComparator</code> for JCache and its Near Cache) instance itself directly through <code>EvictionConfig</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CacheConfig cacheConfig = <span class="keyword">new</span> CacheConfig();
...
EvictionConfig evictionConfig =
    <span class="keyword">new</span> EvictionConfig(<span class="integer">50000</span>,
                       MaxSizePolicy.ENTRY_COUNT,
                       <span class="keyword">new</span> MyEvictionPolicyComparator());
cacheConfig.setEvictionConfig(evictionConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="paragraph">
<p>You can specify the full class name of custom <code>EvictionPolicyComparator</code> (<code>CacheEvictionPolicyComparator</code> for JCache and its Near Cache) implementation
in the <code>&lt;eviction&gt;</code> tag through <code>comparator-class-name</code> attribute in Hazelcast configuration XML file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheWithCustomEvictionPolicyComparator</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;eviction size=<span class="string"><span class="delimiter">&quot;</span><span class="content">50000</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTRY_COUNT</span><span class="delimiter">&quot;</span></span> comparator-<span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.MyEvictionPolicyComparator</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/cache&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Declarative for Spring:</strong></p>
</div>
<div class="paragraph">
<p>You can specify the full class name of custom <code>EvictionPolicyComparator</code> (<code>CacheEvictionPolicyComparator</code> for JCache and its Near Cache) implementation
in the <code>&lt;eviction&gt;</code> tag through <code>comparator-class-name</code> attribute in Hazelcast <strong>Spring</strong> configuration XML file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hz:cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheWithCustomEvictionPolicyComparator</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;hz:eviction size=<span class="string"><span class="delimiter">&quot;</span><span class="content">50000</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTRY_COUNT</span><span class="delimiter">&quot;</span></span> comparator-<span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.MyEvictionPolicyComparator</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/hz:cache&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can specify the custom <code>EvictionPolicyComparator</code> (<code>CacheEvictionPolicyComparator</code> for JCache and its Near Cache) bean in the <code>&lt;eviction&gt;</code> tag
by referencing through <code>comparator-bean</code> attribute in Hazelcast <strong>Spring</strong> configuration XML file</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hz:cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheWithCustomEvictionPolicyComparator</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;hz:eviction size=<span class="string"><span class="delimiter">&quot;</span><span class="content">50000</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTRY_COUNT</span><span class="delimiter">&quot;</span></span> comparator-bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">myEvictionPolicyComparatorBean</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/hz:cache&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="eviction-strategy"><a class="anchor" href="#eviction-strategy"></a><a class="link" href="#eviction-strategy">Eviction Strategy</a></h5>
<div class="paragraph">
<p>Eviction strategies implement the logic of selecting one or more eviction candidates from the underlying storage implementation and
passing them to the eviction policies. Hazelcast JCache provides an amortized O(1) cost implementation for this strategy to select a
fixed number of samples from the current partition that it is executed against.</p>
</div>
<div class="paragraph">
<p>The default implementation is <code>com.hazelcast.cache.impl.eviction.impl.strategy.sampling.SamplingBasedEvictionStrategy</code> which, as
mentioned, samples 15 random elements. A detailed description of the algorithm will be explained in the next section.</p>
</div>
</div>
<div class="sect4">
<h5 id="eviction-algorithm"><a class="anchor" href="#eviction-algorithm"></a><a class="link" href="#eviction-algorithm">Eviction Algorithm</a></h5>
<div class="paragraph">
<p>The Hazelcast JCache eviction algorithm is specially designed for the use case of high performance caches and with predictability
in mind. The built-in implementations provide an amortized O(1) runtime and therefore provide a highly predictable runtime behavior
which does not rely on any kind of background threads to handle the eviction. Therefore, the algorithm takes some assumptions into
account to prevent network operations and concurrent accesses.</p>
</div>
<div class="paragraph">
<p>As an explanation of how the algorithm works, let&#8217;s examine the following flowchart step by step.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/EvictionFlowchart.png" alt="Hazelcast JCache Eviction Algorithm">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A new cache is created. Without any special settings, the eviction is configured to kick in when the <strong>cache</strong> exceeds 10.000
elements and an LRU (Less Recently Used) policy is set up.</p>
</li>
<li>
<p>The user puts in a new entry, e.g., a key-value pair.</p>
</li>
<li>
<p>For every put, the eviction strategy evaluates the current cache size and decides if an eviction is necessary or not. If not, the entry is stored in step 10.</p>
</li>
<li>
<p>If eviction is required, a new sampling is started. The built-in sampler is implemented as a lazy iterator.</p>
</li>
<li>
<p>The sampling algorithm selects a random sample from the underlying data storage.</p>
</li>
<li>
<p>The eviction strategy tests whether the sampled entry is already expired (lazy expiration). If expired, the sampling stops and the entry is removed in step 9.</p>
</li>
<li>
<p>If not yet expired, the entry (eviction candidate) is compared to the last best matching candidate (based on the eviction policy) and the new best matching candidate is remembered.</p>
</li>
<li>
<p>The sampling is repeated 15 times and then the best matching eviction candidate is returned to the eviction strategy.</p>
</li>
<li>
<p>The expired or best matching eviction candidate is removed from the underlying data storage.</p>
</li>
<li>
<p>The new put entry is stored.</p>
</li>
<li>
<p>The put operation returns to the user.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that expiration based eviction does not only occur for the above scenario (Step 6). It is mentioned for the sake of explaining the eviction algorithm.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As seen in the flowchart, the general eviction operation is easy. As long as the cache does not reach its maximum capacity,
or you execute updates (put/replace), no eviction is executed.</p>
</div>
<div class="paragraph">
<p>To prevent network operations and concurrent access, as mentioned earlier, the cache size is estimated based on the size of the
currently handled partition. Due to the imbalanced partitions, the single partitions might start to evict
earlier than the other partitions.</p>
</div>
<div class="paragraph">
<p>As mentioned in the <a href="#cache-types">Cache Types section</a>, typically two types of caches are found in the production systems. For small caches,
referred to as <strong>Reference Caches</strong>, the eviction algorithm has a special set of rules depending on the maximum configured cache
size. Please see the <a href="#reference-caches">Reference Caches section</a> for details. The other type of cache is referred to as an <strong>Active DataSet Cache</strong>,
which in most cases makes heavy use of the eviction to keep the most active data set in the memory. Those kinds of caches use a very
simple but efficient way to estimate the cluster-wide cache size.</p>
</div>
<div class="paragraph">
<p>All of the following calculations have a well known set of fixed variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GlobalCapacity</code>: User defined maximum cache size (cluster-wide).</p>
</li>
<li>
<p><code>PartitionCount</code>: Number of partitions in the cluster (defaults to 271).</p>
</li>
<li>
<p><code>BalancedPartitionSize</code>: Number of elements in a balanced partition state, <code>BalancedPartitionSize := GlobalCapacity / PartitionCount</code>.</p>
</li>
<li>
<p><code>Deviation</code>: An approximated standard deviation (tests proofed it to be pretty near), <code>Deviation := sqrt(BalancedPartitionSize)</code>.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="reference-caches"><a class="anchor" href="#reference-caches"></a><a class="link" href="#reference-caches">Reference Caches</a></h6>
<div class="paragraph">
<p>A Reference Cache is typically small and the number of elements to store in the reference caches is normally
known prior to creating the cache. Typical examples of reference caches are lookup tables for abbreviations or the states of a
country. They tend to have a fixed but small element number and the eviction is an unlikely event and rather undesirable behavior.</p>
</div>
<div class="paragraph">
<p>Since an imbalanced partition is a worse problem in small and mid-sized caches than in caches with millions of entries, the normal
estimation rule (as discussed in a bit) is not applied to these kinds of caches. To prevent unwanted eviction on the small and
mid-sized caches, Hazelcast implements a special set of rules to estimate the cluster size.</p>
</div>
<div class="paragraph">
<p>To adjust the imbalance of partitions as found in the typical runtime, the actual calculated maximum cache size (known as the eviction
threshold) is slightly higher than the user defined size. That means more elements can be stored into the cache
than expected by the user. This needs to be taken into account especially for large objects, since those can easily exceed the
expected memory consumption!</p>
</div>
<div class="paragraph">
<p><strong>Small caches:</strong></p>
</div>
<div class="paragraph">
<p>If a cache is configured with no more than <code>4.000</code> elements, this cache is considered to be a small cache. The actual partition
size is derived from the number of elements (<code>GlobalCapacity</code>) and the deviation using the following formula:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MaxPartitionSize := Deviation * <span class="integer">5</span> + BalancedPartitionSize</code></pre>
</div>
</div>
<div class="paragraph">
<p>This formula ends up with big partition sizes which, summed up, exceed the expected maximum cache size (set by the user).
Since the small caches typically have a well known maximum number of elements, this is not a big
issue. Only if the small caches are used for a use case other than as a reference cache, this needs to be taken into account.</p>
</div>
<div class="paragraph">
<p><strong>Mid-sized caches</strong></p>
</div>
<div class="paragraph">
<p>A mid-sized cache is defined as a cache with a maximum number of elements that is bigger than <code>4.000</code> but not bigger than
<code>1.000.000</code> elements. The calculation of mid-sized caches is similar to that of the small caches but with a different
multiplier. To calculate the maximum number of elements per partition, the following formula is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MaxPartitionSize := Deviation * <span class="integer">3</span> + BalancedPartitionSize</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="active-dataset-caches"><a class="anchor" href="#active-dataset-caches"></a><a class="link" href="#active-dataset-caches">Active DataSet Caches</a></h6>
<div class="paragraph">
<p>For large caches, where the maximum cache size is bigger than <code>1.000.000</code> elements, there is no additional calculation needed. The maximum
partition size is considered to be equal to <code>BalancedPartitionSize</code> since statistically big partitions are expected to almost
balance themselves. Therefore, the formula is as easy as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MaxPartitionSize := BalancedPartitionSize</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="cache-size-estimation"><a class="anchor" href="#cache-size-estimation"></a><a class="link" href="#cache-size-estimation">Cache Size Estimation</a></h6>
<div class="paragraph">
<p>As mentioned earlier, Hazelcast JCache provides an estimation algorithm to prevent cluster-wide network operations, concurrent
access to other partitions and background tasks. It also offers a highly predictable operation runtime when the eviction is necessary.</p>
</div>
<div class="paragraph">
<p>The estimation algorithm is based on the previously calculated maximum partition size (please see the <a href="#reference-caches">Reference Caches section</a> and <a href="#active-dataset-caches">Active DataSet Caches section</a>) and is calculated
against the current partition only.</p>
</div>
<div class="paragraph">
<p>The algorithm to reckon the number of stored entries in the cache (cluster-wide) and decide if the eviction is necessary is shown in the
following pseudo-code example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">RequiresEviction[<span class="predefined-type">Boolean</span>] := CurrentPartitionSize &gt;= MaxPartitionSize</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jcache-near-cache"><a class="anchor" href="#jcache-near-cache"></a><a class="link" href="#jcache-near-cache">13.6.8. JCache Near Cache</a></h4>
<div class="paragraph">
<p>The Hazelcast JCache implementation supports a local Near Cache for remotely stored entries to increase the performance of local read operations. Please refer to the <a href="#near-cache">Near Cache section</a> for a detailed explanation of the Near Cache feature and its configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Near Cache for JCache is only available for clients, NOT members.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="icache-convenience-methods"><a class="anchor" href="#icache-convenience-methods"></a><a class="link" href="#icache-convenience-methods">13.6.9. ICache Convenience Methods</a></h4>
<div class="paragraph">
<p>In addition to the operations explained in <a href="#icache-async-methods">ICache Async Methods</a> and <a href="#defining-a-custom-expirypolicy">Defining a Custom ExpiryPolicy</a>, Hazelcast ICache also provides a set of convenience methods. These methods are not part of the JCache specification.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>size()</code>: Returns the total entry count of the distributed cache.</p>
</li>
<li>
<p><code>destroy()</code>: Destroys the cache and removes its data, which makes it different from the method <code>javax.cache.Cache.close()</code>; the <code>close</code> method closes the cache so no further operational methods (get, put, remove, etc. Please see Section 4.1.6 in JCache Specification which can be downloaded from <a href="http://download.oracle.com/otndocs/jcp/jcache-1_0-fr-eval-spec/index.html">here</a>) can be executed on it - data is not necessarily destroyed, if you get again the same <code>Cache</code> from the same <code>CacheManager</code>, the data will be there. In the case of <code>destroy()</code>, both the cache is destroyed and cache&#8217;s data is removed.</p>
</li>
<li>
<p><code>isDestroyed()</code>: Determines whether the ICache instance is destroyed or not.</p>
</li>
<li>
<p><code>getLocalCacheStatistics()</code>: Returns a <code>com.hazelcast.cache.CacheStatistics</code> instance, both on Hazelcast members and clients, providing the same statistics data as the JMX beans.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/cache/ICache.html">ICache Javadoc</a> to see all the methods provided by ICache.</p>
</div>
</div>
<div class="sect3">
<h4 id="implementing-backupawareentryprocessor"><a class="anchor" href="#implementing-backupawareentryprocessor"></a><a class="link" href="#implementing-backupawareentryprocessor">13.6.10. Implementing BackupAwareEntryProcessor</a></h4>
<div class="paragraph">
<p>Another feature, especially interesting for distributed environments like Hazelcast, is the JCache specified
<code>javax.cache.processor.EntryProcessor</code>. For more general information, please see the <a href="#implementing-entryprocessor">Implementing EntryProcessor section</a>.</p>
</div>
<div class="paragraph">
<p>Since Hazelcast provides backups of cached entries on other members, the default way to backup an object changed by an
<code>EntryProcessor</code> is to serialize the complete object and send it to the backup partition. This can be a huge network overhead for big objects.</p>
</div>
<div class="paragraph">
<p>Hazelcast offers a sub-interface for <code>EntryProcessor</code> called <code>com.hazelcast.cache.BackupAwareEntryProcessor</code>. This allows you to create or pass another <code>EntryProcessor</code> to run on backup
partitions and apply delta changes to the backup entries.</p>
</div>
<div class="paragraph">
<p>The backup partition <code>EntryProcessor</code> can either be the currently running processor (by returning <code>this</code>) or it can be
a specialized <code>EntryProcessor</code> implementation (different from the currently running one) that does different operations or leaves
out operations, e.g., sending emails.</p>
</div>
<div class="paragraph">
<p>If we again take the <code>EntryProcessor</code> example from the demonstration application provided in the <a href="#implementing-entryprocessor">Implementing EntryProcessor section</a>,
the changed code will look like the following snippet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserUpdateEntryProcessor</span>
    <span class="directive">implements</span> BackupAwareEntryProcessor&lt;<span class="predefined-type">Integer</span>, User, User&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> User process( MutableEntry&lt;<span class="predefined-type">Integer</span>, User&gt; entry, <span class="predefined-type">Object</span>... arguments )
        <span class="directive">throws</span> EntryProcessorException {

        <span class="comment">// Test arguments length</span>
        <span class="keyword">if</span> ( arguments.length &lt; <span class="integer">1</span> ) {
            <span class="keyword">throw</span> <span class="keyword">new</span> EntryProcessorException( <span class="string"><span class="delimiter">&quot;</span><span class="content">One argument needed: username</span><span class="delimiter">&quot;</span></span> );
        }

        <span class="comment">// Get first argument and test for String type</span>
        <span class="predefined-type">Object</span> argument = arguments[<span class="integer">0</span>];
        <span class="keyword">if</span> ( !( argument <span class="keyword">instanceof</span> <span class="predefined-type">String</span> ) ) {
            <span class="keyword">throw</span> <span class="keyword">new</span> EntryProcessorException(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">First argument has wrong type, required java.lang.String</span><span class="delimiter">&quot;</span></span> );
        }

        <span class="comment">// Retrieve the value from the MutableEntry</span>
        User user = entry.getValue();

        <span class="comment">// Retrieve the new username from the first argument</span>
        <span class="predefined-type">String</span> newUsername = ( <span class="predefined-type">String</span> ) arguments[<span class="integer">0</span>];

        <span class="comment">// Set the new username</span>
        user.setUsername( newUsername );

        <span class="comment">// Set the changed user to mark the entry as dirty</span>
        entry.setValue( user );

        <span class="comment">// Return the changed user to return it to the caller</span>
        <span class="keyword">return</span> user;
    }

    <span class="directive">public</span> EntryProcessor&lt;<span class="predefined-type">Integer</span>, User, User&gt; createBackupEntryProcessor() {
        <span class="keyword">return</span> <span class="local-variable">this</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the additional method <code>BackupAwareEntryProcessor.createBackupEntryProcessor()</code> to create or return the <code>EntryProcessor</code>
implementation to run on the backup partition (in the example above, the same processor again).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For the backup runs, the returned value from the backup processor is ignored and not
returned to the user.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="icache-partition-lost-listener"><a class="anchor" href="#icache-partition-lost-listener"></a><a class="link" href="#icache-partition-lost-listener">13.6.11. ICache Partition Lost Listener</a></h4>
<div class="paragraph">
<p>You can listen to <code>CachePartitionLostEvent</code> instances by registering an implementation
of <code>CachePartitionLostListener</code>, which is also a sub-interface of <code>java.util.EventListener</code>
from <code>ICache</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following example code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in jcache/icache.adoc - include::{javasource}/jcache/PartitionLostListenerUsage.java[tag=pllu]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within this example code, a <code>CachePartitionLostListener</code> implementation is registered to a cache and assumes that this cache is configured with one backup. For this particular cache and any of the partitions in the
system, if the partition owner member and its first backup member crash simultaneously, the
given <code>CachePartitionLostListener</code> receives a
corresponding <code>CachePartitionLostEvent</code>. If only a single member crashes in the cluster,
a <code>CachePartitionLostEvent</code> is not fired for this cache since backups for the partitions
owned by the crashed member are kept on other members.</p>
</div>
<div class="paragraph">
<p>Please refer to the <a href="#listening-for-partition-lost-events">Partition Lost Listener section</a> for more
information about partition lost detection and partition lost events.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-for-jcache-specification-compliance"><a class="anchor" href="#testing-for-jcache-specification-compliance"></a><a class="link" href="#testing-for-jcache-specification-compliance">13.7. Testing for JCache Specification Compliance</a></h3>
<div class="paragraph">
<p>Hazelcast JCache is fully compliant with the JSR 107 TCK (Technology Compatibility Kit), and therefore is officially a JCache
implementation.</p>
</div>
<div class="paragraph">
<p>You can test Hazelcast JCache for compliance by executing the TCK. Just perform the instructions below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Checkout branch <code>v1.1.0</code> of the TCK from <a href="https://github.com/jsr107/jsr107tck">https://github.com/jsr107/jsr107tck</a>.</p>
</li>
<li>
<p>Change the properties in <a href="https://github.com/jsr107/jsr107tck/blob/master/pom.xml"><code>pom.xml</code></a> as shown below. Alternatively, you can set the values of these properties directly on the maven command line without editing any files as shown in the command line example below.</p>
</li>
<li>
<p>Run the TCK using the command <code>mvn clean install</code>. This will run the tests using an embedded Hazelcast member.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;properties&gt;
  &lt;jcache.version&gt;<span class="float">1.1</span><span class="float">.0</span>&lt;/jcache.version&gt;
  &lt;project.build.sourceEncoding&gt;UTF-<span class="integer">8</span>&lt;/project.build.sourceEncoding&gt;
  &lt;project.reporting.outputEncoding&gt;UTF-<span class="integer">8</span>&lt;/project.reporting.outputEncoding&gt;

  &lt;CacheInvocationContextImpl&gt;
    javax.cache.annotation.impl.cdi.CdiCacheKeyInvocationContextImpl
  &lt;/CacheInvocationContextImpl&gt;

  &lt;domain-lib-dir&gt;<span class="error">$</span>{project.build.directory}/domainlib&lt;/domain-lib-dir&gt;
  &lt;domain-jar&gt;domain.jar&lt;/domain-jar&gt;


  &lt;!-- <span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span> --&gt;
  &lt;!-- Change the following properties on the command line
       to override with the coordinates <span class="keyword">for</span> your implementation--&gt;
  &lt;implementation-groupId&gt;com.hazelcast&lt;/implementation-groupId&gt;
  &lt;implementation-artifactId&gt;hazelcast&lt;/implementation-artifactId&gt;
  &lt;implementation-version&gt;<span class="float">3.10</span>&lt;/implementation-version&gt;

  &lt;!-- Change the following properties to your CacheManager and
       Cache implementation. Used by the unwrap tests. --&gt;
  &lt;CacheManagerImpl&gt;
    com.hazelcast.client.cache.impl.HazelcastServerCacheManager
  &lt;/CacheManagerImpl&gt;
  &lt;CacheImpl&gt;com.hazelcast.cache.ICache&lt;/CacheImpl&gt;
  &lt;CacheEntryImpl&gt;
    com.hazelcast.cache.impl.CacheEntry
  &lt;/CacheEntryImpl&gt;
  &lt;!-- <span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span><span class="error">#</span> --&gt;
&lt;/properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Complete command line example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span> git clone https:<span class="comment">//github.com/jsr107/jsr107tck</span>
(clones JSR107 TCK repository to local directory jsr107tck)

<span class="error">$</span> cd jsr107tck

<span class="error">$</span> git checkout v1<span class="float">.1</span><span class="float">.0</span>
(checkout v1<span class="float">.1</span><span class="float">.0</span> tag)

<span class="error">$</span> mvn -Dimplementation-groupId=com.hazelcast -Dimplementation-artifactId=hazelcast \
     -Dimplementation-version=<span class="float">3.10</span> \
     -DCacheManagerImpl=com.hazelcast.cache.impl.HazelcastServerCacheManager \
     -DCacheImpl=com.hazelcast.cache.ICache -DCacheEntryImpl=com.hazelcast.cache.impl.CacheEntry \
     clean install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please also see <a href="https://docs.google.com/document/d/1m8d1Z44IFGAd20bXEvT2G--vWXbxaJctk16M2rmbM24/edit?ts=59fdff73">TCK 1.1.0 User Guide</a> or <a href="https://docs.google.com/document/d/1w3Ugj_oEqjMlhpCkGQOZkd9iPf955ZWHAVdZzEwYYdU/edit">TCK 1.0.0 User Guide</a> for more information on the testing instructions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integrated-clustering"><a class="anchor" href="#integrated-clustering"></a><a class="link" href="#integrated-clustering">14. Integrated Clustering</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this chapter, we mention how Hazelcast is integrated with Hibernate 2nd level cache and Spring and how it helps with your Filter, Tomcat and Jetty based web session replications.</p>
</div>
<div class="sect2">
<h3 id="integration-with-hibernate-second-level-cache"><a class="anchor" href="#integration-with-hibernate-second-level-cache"></a><a class="link" href="#integration-with-hibernate-second-level-cache">14.1. Integration with Hibernate Second Level Cache</a></h3>
<div class="paragraph">
<p>Hazelcast provides its own distributed second level cache for your Hibernate entities, collections and queries. This feature is offered as a Hazelcast plugin. See <a href="#hazelcast-hibernate-2lc">Hazelcast Hibernate 2LC</a> for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="web-session-replications"><a class="anchor" href="#web-session-replications"></a><a class="link" href="#web-session-replications">14.2. Web Session Replications</a></h3>
<div class="paragraph">
<p>Hazelcast can cluster your web sessions using Servlet Filter, Tomcat and Jetty based solutions.</p>
</div>
<div class="paragraph">
<p>Follow the below links for more information on them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#filter-based-web-session-replication">Filter Based Web Session Replication</a></p>
</li>
<li>
<p><a href="#tomcat-based-web-session-replication">Tomcat Based Web Session Replication</a></p>
</li>
<li>
<p><a href="#jetty-based-web-session-replication">Jetty Based Web Session Replication</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="integration-with-java-ee"><a class="anchor" href="#integration-with-java-ee"></a><a class="link" href="#integration-with-java-ee">14.3. Integration with Java EE</a></h3>
<div class="paragraph">
<p>You can integrate Hazelcast into Java EE containers. This integration is offered as a Hazelcast plugin. See <a href="#hazelcast-jca-resource-adapter">Hazelcast JCA Resource Adapter section</a> and its own GitHub repository <a href="https://github.com/hazelcast/hazelcast-ra">here</a> for information on configuring the resource adapter, glassfish applications and JBoss web applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="integration-with-spring"><a class="anchor" href="#integration-with-spring"></a><a class="link" href="#integration-with-spring">14.4. Integration with Spring</a></h3>
<div class="paragraph">
<p>You can integrate Hazelcast with Spring and this section explains the configuration of Hazelcast within Spring context.</p>
</div>
<div class="paragraph">
<p>Supported Versions are Spring 2.5 and higher releases and the latest tested Spring version is 4.3.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Some old versions of Spring may require minor changes in the Hazelcast configuration. The code and configuration snippets provided in this section are tested using Spring 4.3.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuring-spring"><a class="anchor" href="#configuring-spring"></a><a class="link" href="#configuring-spring">14.4.1. Configuring Spring</a></h4>
<div class="paragraph">
<p><strong>Sample Code</strong>: See our <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/hazelcast-integration/spring-configuration">sample application</a> for Spring Configuration.</p>
</div>
<div class="sect4">
<h5 id="enabling-spring-integration"><a class="anchor" href="#enabling-spring-integration"></a><a class="link" href="#enabling-spring-integration">Enabling Spring Integration</a></h5>
<div class="paragraph">
<p><em>Classpath Configuration:</em></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To enable Spring integration, either <code>hazelcast-spring-&lt;version&gt;.jar</code> or <code>hazelcast-all-&lt;version&gt;.jar</code> must be in the classpath.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you use Maven, add the following lines to your <code>pom.xml</code>.</p>
</div>
<div class="paragraph">
<p>If you use <code>hazelcast-all.jar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;dependency&gt;
  &lt;groupId&gt;com.hazelcast&lt;/groupId&gt;
  &lt;artifactId&gt;hazelcast-all&lt;/artifactId&gt;
  &lt;version&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">your Hazelcast version, e.g. 3.8</span><span class="delimiter">&quot;</span></span>&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>hazelcast-spring.jar</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;dependency&gt;
  &lt;groupId&gt;com.hazelcast&lt;/groupId&gt;
  &lt;artifactId&gt;hazelcast-spring&lt;/artifactId&gt;
  &lt;version&gt;<span class="string"><span class="delimiter">&quot;</span><span class="content">your Hazelcast version, e.g. 3.8</span><span class="delimiter">&quot;</span></span>&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use other build systems, you have to adjust the definition of dependencies to your needs.</p>
</div>
</div>
<div class="sect4">
<h5 id="troubleshooting"><a class="anchor" href="#troubleshooting"></a><a class="link" href="#troubleshooting">Troubleshooting</a></h5>
<div class="paragraph">
<p>When the Spring Integration JARs are not correctly installed in the Java classpath, you may see either of the following exceptions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">org.xml.sax.SAXParseException; systemId: http:<span class="comment">//hazelcast.com/schema/spring/hazelcast-spring.xsd; lineNumber: 2; columnNumber: 35; s4s-elt-character: Non-whitespace characters are not allowed in schema elements other than 'xs:appinfo' and 'xs:documentation'. Saw '301 Moved Permanently'.</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">org.springframework.beans.factory.parsing.BeanDefinitionParsingException: <span class="predefined-type">Configuration</span> problem: Unable to locate <span class="predefined-type">Spring</span> NamespaceHandler <span class="keyword">for</span> XML schema namespace [http:<span class="comment">//www.hazelcast.com/schema/spring]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">org.xml.sax.SAXParseException; lineNumber: <span class="integer">25</span>; columnNumber: <span class="integer">33</span>; schema_reference<span class="float">.4</span>: Failed to read schema document <span class="string"><span class="delimiter">'</span><span class="content">http://www.hazelcast.com/schema/spring/hazelcast-spring.xsd</span><span class="delimiter">'</span></span>, because <span class="integer">1</span>) could not find the document; <span class="integer">2</span>) the document could not be read; <span class="integer">3</span>) the root element of the document is not &lt;xsd:schema&gt;.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, please ensure that the required classes are in the classpath, as explained above.</p>
</div>
</div>
<div class="sect4">
<h5 id="declaring-beans-by-spring-strong-beans-strong-namespace"><a class="anchor" href="#declaring-beans-by-spring-strong-beans-strong-namespace"></a><a class="link" href="#declaring-beans-by-spring-strong-beans-strong-namespace">Declaring Beans by Spring <strong>beans</strong> Namespace</a></h5>
<div class="paragraph">
<p><em>Bean Declaration:</em></p>
</div>
<div class="paragraph">
<p>You can declare Hazelcast Objects using the default Spring <strong>beans</strong> namespace. Example code for a Hazelcast Instance declaration is listed below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.core.Hazelcast</span><span class="delimiter">&quot;</span></span> <span class="class">factory</span>-method=<span class="string"><span class="delimiter">&quot;</span><span class="content">newHazelcastInstance</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;constructor-arg&gt;
    &lt;bean <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.config.Config</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;<span class="class">property</span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">groupConfig</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;bean <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.config.GroupConfig</span><span class="delimiter">&quot;</span></span>&gt;
          &lt;<span class="class">property</span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>/&gt;
          &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">pwd</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;/bean&gt;
      &lt;/property&gt;
      &lt;!-- and so on ... --&gt;
    &lt;/bean&gt;
  &lt;/constructor-arg&gt;
&lt;/bean&gt;

&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span> factory-bean=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> factory-method=<span class="string"><span class="delimiter">&quot;</span><span class="content">getMap</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;constructor-arg value=<span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="declaring-beans-by-strong-hazelcast-strong-namespace"><a class="anchor" href="#declaring-beans-by-strong-hazelcast-strong-namespace"></a><a class="link" href="#declaring-beans-by-strong-hazelcast-strong-namespace">Declaring Beans by <strong>hazelcast</strong> Namespace</a></h5>
<div class="paragraph">
<p>Hazelcast has its own namespace <strong>hazelcast</strong> for bean definitions. You can easily add the namespace declaration <strong>xmlns:hz="http://www.hazelcast.com/schema/spring"</strong> to the <code>beans</code> element in the context file so that <strong>hz</strong> namespace shortcut can be used as a bean declaration.</p>
</div>
<div class="paragraph">
<p>Here is an example schema definition for Hazelcast 3.3.x:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;beans xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       xmlns:hz=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.hazelcast.com/schema/spring</span><span class="delimiter">&quot;</span></span>
       xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans
                http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                http://www.hazelcast.com/schema/spring
                http://www.hazelcast.com/schema/spring/hazelcast-spring.xsd</span><span class="delimiter">&quot;</span></span>&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="supported-configurations-with-strong-hazelcast-strong-namespace"><a class="anchor" href="#supported-configurations-with-strong-hazelcast-strong-namespace"></a><a class="link" href="#supported-configurations-with-strong-hazelcast-strong-namespace">Supported Configurations with <strong>hazelcast</strong> Namespace</a></h5>
<div class="ulist">
<ul>
<li>
<p><strong>Configuring Hazelcast Instance</strong></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hz:hazelcast id=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;hz:config&gt;
    &lt;hz:group name=<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span> password=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;hz:network port=<span class="string"><span class="delimiter">&quot;</span><span class="content">5701</span><span class="delimiter">&quot;</span></span> port-auto-increment=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;hz:join&gt;
        &lt;hz:multicast enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                      multicast-group=<span class="string"><span class="delimiter">&quot;</span><span class="content">224.2.2.3</span><span class="delimiter">&quot;</span></span>
                      multicast-port=<span class="string"><span class="delimiter">&quot;</span><span class="content">54327</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;hz:tcp-ip enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
          &lt;hz:members&gt;<span class="float">10.10</span><span class="float">.1</span><span class="float">.2</span>, <span class="float">10.10</span><span class="float">.1</span><span class="float">.3</span>&lt;/hz:members&gt;
        &lt;/hz:tcp-ip&gt;
      &lt;/hz:join&gt;
    &lt;/hz:network&gt;
    &lt;hz:map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span>
            backup-count=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>
            max-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
            eviction-percentage=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>
            read-backup-data=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
            eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span>
            merge-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.map.merge.PassThroughMergePolicy</span><span class="delimiter">&quot;</span></span>/&gt;
  &lt;/hz:config&gt;
&lt;/hz:hazelcast&gt;</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Configuring Hazelcast Client</strong></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hz:client id=<span class="string"><span class="delimiter">&quot;</span><span class="content">client</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;hz:group name=<span class="string"><span class="delimiter">&quot;</span><span class="content">${cluster.group.name}</span><span class="delimiter">&quot;</span></span> password=<span class="string"><span class="delimiter">&quot;</span><span class="content">${cluster.group.password}</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;hz:network connection-attempt-limit=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>
              connection-attempt-period=<span class="string"><span class="delimiter">&quot;</span><span class="content">3000</span><span class="delimiter">&quot;</span></span>
              connection-timeout=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span>
              redo-operation=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
              smart-routing=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;hz:member&gt;<span class="float">10.10</span><span class="float">.1</span><span class="float">.2</span>:<span class="integer">5701</span>&lt;/hz:member&gt;
    &lt;hz:member&gt;<span class="float">10.10</span><span class="float">.1</span><span class="float">.3</span>:<span class="integer">5701</span>&lt;/hz:member&gt;
  &lt;/hz:network&gt;
&lt;/hz:client&gt;</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Hazelcast Supported Type Configurations and Examples</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>map</code></p>
</li>
<li>
<p><code>multiMap</code></p>
</li>
<li>
<p><code>replicatedmap</code></p>
</li>
<li>
<p><code>queue</code></p>
</li>
<li>
<p><code>topic</code></p>
</li>
<li>
<p><code>reliableTopic</code></p>
</li>
<li>
<p><code>set</code></p>
</li>
<li>
<p><code>list</code></p>
</li>
<li>
<p><code>executorService</code></p>
</li>
<li>
<p><code>durableExecutorService</code></p>
</li>
<li>
<p><code>scheduledExecutorService</code></p>
</li>
<li>
<p><code>ringbuffer</code></p>
</li>
<li>
<p><code>cardinalityEstimator</code></p>
</li>
<li>
<p><code>idGenerator</code></p>
</li>
<li>
<p><code>flakeIdGenerator</code></p>
</li>
<li>
<p><code>atomicLong</code></p>
</li>
<li>
<p><code>atomicReference</code></p>
</li>
<li>
<p><code>semaphore</code></p>
</li>
<li>
<p><code>countDownLatch</code></p>
</li>
<li>
<p><code>lock</code></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hz:map id=<span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">client</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span> lazy-init=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> /&gt;
&lt;hz:multiMap id=<span class="string"><span class="delimiter">&quot;</span><span class="content">multiMap</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">multiMap</span><span class="delimiter">&quot;</span></span>
    lazy-init=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> /&gt;
&lt;hz:replicatedMap id=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedmap</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">replicatedmap</span><span class="delimiter">&quot;</span></span> lazy-init=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> /&gt;
&lt;hz:queue id=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">client</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue</span><span class="delimiter">&quot;</span></span>
    lazy-init=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> depends-on=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:topic id=<span class="string"><span class="delimiter">&quot;</span><span class="content">topic</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">topic</span><span class="delimiter">&quot;</span></span>
    depends-on=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance, client</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:reliableTopic id=<span class="string"><span class="delimiter">&quot;</span><span class="content">reliableTopic</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">reliableTopic</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:set id=<span class="string"><span class="delimiter">&quot;</span><span class="content">set</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">set</span><span class="delimiter">&quot;</span></span> /&gt;
&lt;hz:list id=<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:executorService id=<span class="string"><span class="delimiter">&quot;</span><span class="content">executorService</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">client</span><span class="delimiter">&quot;</span></span>
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">executorService</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:durableExecutorService id=<span class="string"><span class="delimiter">&quot;</span><span class="content">durableExec</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">durableExec</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:scheduledExecutorService id=<span class="string"><span class="delimiter">&quot;</span><span class="content">scheduledExec</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">scheduledExec</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:ringbuffer id=<span class="string"><span class="delimiter">&quot;</span><span class="content">ringbuffer</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ringbuffer</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:cardinalityEstimator id=<span class="string"><span class="delimiter">&quot;</span><span class="content">cardinalityEstimator</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">cardinalityEstimator</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:idGenerator id=<span class="string"><span class="delimiter">&quot;</span><span class="content">idGenerator</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">idGenerator</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:flakeIdGenerator id=<span class="string"><span class="delimiter">&quot;</span><span class="content">flakeIdGenerator</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">flakeIdGenerator</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:atomicLong id=<span class="string"><span class="delimiter">&quot;</span><span class="content">atomicLong</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">atomicLong</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:atomicReference id=<span class="string"><span class="delimiter">&quot;</span><span class="content">atomicReference</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">atomicReference</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:semaphore id=<span class="string"><span class="delimiter">&quot;</span><span class="content">semaphore</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">semaphore</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:countDownLatch id=<span class="string"><span class="delimiter">&quot;</span><span class="content">countDownLatch</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>
    name=<span class="string"><span class="delimiter">&quot;</span><span class="content">countDownLatch</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;hz:lock id=<span class="string"><span class="delimiter">&quot;</span><span class="content">lock</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">lock</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Supported Spring Bean Attributes</strong></p>
<div class="paragraph">
<p>Hazelcast also supports <code>lazy-init</code>, <code>scope</code> and <code>depends-on</code> bean attributes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hz:hazelcast id=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> lazy-init=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> scope=<span class="string"><span class="delimiter">&quot;</span><span class="content">singleton</span><span class="delimiter">&quot;</span></span>&gt;
  ...
&lt;/hz:hazelcast&gt;
&lt;hz:client id=<span class="string"><span class="delimiter">&quot;</span><span class="content">client</span><span class="delimiter">&quot;</span></span> scope=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span> depends-on=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>&gt;
  ...
&lt;/hz:client&gt;</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Configuring MapStore and NearCache</strong></p>
<div class="paragraph">
<p>For map-store, you should set either the <strong>class-name</strong> or the <strong>implementation</strong> attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hz:config id=<span class="string"><span class="delimiter">&quot;</span><span class="content">config</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;hz:map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">map1</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;hz:map-store enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.DummyStore</span><span class="delimiter">&quot;</span></span>
            write-delay-seconds=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> /&gt;

        &lt;hz:near-cache time-to-live-seconds=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>
            max-idle-seconds=<span class="string"><span class="delimiter">&quot;</span><span class="content">60</span><span class="delimiter">&quot;</span></span> eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">LRU</span><span class="delimiter">&quot;</span></span> max-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span>
            invalidate-on-change=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;/hz:map&gt;

    &lt;hz:map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">map2</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;hz:map-store enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> implementation=<span class="string"><span class="delimiter">&quot;</span><span class="content">dummyMapStore</span><span class="delimiter">&quot;</span></span>
            write-delay-seconds=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;/hz:map&gt;
&lt;/hz:config&gt;

&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">dummyMapStore</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.DummyStore</span><span class="delimiter">&quot;</span></span> /&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enabling-springaware-objects"><a class="anchor" href="#enabling-springaware-objects"></a><a class="link" href="#enabling-springaware-objects">14.4.2. Enabling SpringAware Objects</a></h4>
<div class="paragraph">
<p>You can mark Hazelcast Distributed Objects with @SpringAware if the object wants:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to apply bean properties,</p>
</li>
<li>
<p>to apply factory callbacks such as <code>ApplicationContextAware</code>, <code>BeanNameAware</code>,</p>
</li>
<li>
<p>to apply bean post-processing annotations such as <code>InitializingBean</code>, <code>@PostConstruct</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hazelcast Distributed <code>ExecutorService</code>, or more generally any Hazelcast managed object, can benefit from these features. To enable SpringAware objects, you must first configure <code>HazelcastInstance</code> using <strong>hazelcast</strong> namespace as explained in <a href="#configuring-spring">Configuring Spring</a> and add <code>&lt;hz:spring-aware /&gt;</code> tag.</p>
</div>
<div class="sect4">
<h5 id="springaware-examples"><a class="anchor" href="#springaware-examples"></a><a class="link" href="#springaware-examples">SpringAware Examples</a></h5>
<div class="ulist">
<ul>
<li>
<p>Configure a Hazelcast Instance via Spring Configuration and define <strong>someBean</strong> as Spring Bean.</p>
</li>
<li>
<p>Add <code>&lt;hz:spring-aware /&gt;</code> to Hazelcast configuration to enable @SpringAware.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;beans xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       xmlns:context=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
       xmlns:hz=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.hazelcast.com/schema/spring</span><span class="delimiter">&quot;</span></span>
       xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans
                http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                http://www.springframework.org/schema/context
                http://www.springframework.org/schema/context/spring-context-3.0.xsd
                http://www.hazelcast.com/schema/spring
                http://www.hazelcast.com/schema/spring/hazelcast-spring.xsd</span><span class="delimiter">&quot;</span></span>&gt;

  &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>/&gt;

  &lt;<span class="namespace">hz</span>:<span class="namespace">hazelcast</span> <span class="namespace">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="namespace">hz</span>:<span class="namespace">config</span>&gt;
      &lt;<span class="namespace">hz</span>:<span class="namespace">spring</span>-<span class="namespace">aware</span> /&gt;
      &lt;<span class="namespace">hz</span>:<span class="namespace">group</span> <span class="namespace">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span> <span class="namespace">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>/&gt;
      &lt;<span class="namespace">hz</span>:<span class="namespace">network</span> <span class="namespace">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5701</span><span class="delimiter">&quot;</span></span> <span class="namespace">port</span>-<span class="namespace">auto</span>-<span class="namespace">increment</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;<span class="namespace">hz</span>:<span class="namespace">join</span>&gt;
          &lt;<span class="namespace">hz</span>:<span class="namespace">multicast</span> <span class="namespace">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> /&gt;
          &lt;<span class="namespace">hz</span>:<span class="namespace">tcp</span>-<span class="namespace">ip</span> <span class="namespace">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;<span class="namespace">hz</span>:<span class="namespace">members</span>&gt;<span class="float">10.10</span><span class="float">.1</span><span class="float">.2</span>, <span class="float">10.10</span><span class="float">.1</span><span class="float">.3</span>&lt;/<span class="namespace">hz</span>:<span class="namespace">members</span>&gt;
          &lt;/<span class="namespace">hz</span>:<span class="namespace">tcp</span>-<span class="namespace">ip</span>&gt;
        &lt;/<span class="namespace">hz</span>:<span class="namespace">join</span>&gt;
      &lt;/<span class="namespace">hz</span>:<span class="namespace">network</span>&gt;
      ...
    &lt;/<span class="namespace">hz</span>:<span class="namespace">config</span>&gt;
  &lt;/<span class="namespace">hz</span>:<span class="namespace">hazelcast</span>&gt;

  &lt;<span class="namespace">bean</span> <span class="namespace">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someBean</span><span class="delimiter">&quot;</span></span> <span class="namespace">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.examples.spring.SomeBean</span><span class="delimiter">&quot;</span></span>
      <span class="namespace">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">singleton</span><span class="delimiter">&quot;</span></span> /&gt;
  ...
&lt;/<span class="namespace">beans</span>&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Distributed Map SpringAware Example:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a class called <code>SomeValue</code> which contains Spring Bean definitions like <code>ApplicationContext</code> and <code>SomeBean</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringAware</span>
<span class="annotation">@Component</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">someValue</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Scope</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeValue</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span>, ApplicationContextAware {

    <span class="directive">private</span> <span class="directive">transient</span> ApplicationContext context;
    <span class="directive">private</span> <span class="directive">transient</span> SomeBean someBean;
    <span class="directive">private</span> <span class="directive">transient</span> <span class="type">boolean</span> init = <span class="predefined-constant">false</span>;

    <span class="directive">public</span> <span class="type">void</span> setApplicationContext( ApplicationContext applicationContext )
        <span class="directive">throws</span> BeansException {
        context = applicationContext;
    }

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> setSomeBean( SomeBean someBean)  {
        <span class="local-variable">this</span>.someBean = someBean;
    }

    <span class="annotation">@PostConstruct</span>
    <span class="directive">public</span> <span class="type">void</span> init() {
        someBean.doSomethingUseful();
        init = <span class="predefined-constant">true</span>;
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Get <code>SomeValue</code> Object from Context and put it into Hazelcast Distributed Map on the first member.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance =
    (HazelcastInstance) context.getBean( <span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> );
SomeValue value = (SomeValue) context.getBean( <span class="string"><span class="delimiter">&quot;</span><span class="content">someValue</span><span class="delimiter">&quot;</span></span> );
IMap&lt;<span class="predefined-type">String</span>, SomeValue&gt; map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span> );
map.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>, value );</code></pre>
</div>
</div>
</li>
<li>
<p>Read <code>SomeValue</code> Object from Hazelcast Distributed Map and assert that <code>init</code> method is called since it is annotated with <code>@PostConstruct</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance =
    (HazelcastInstance) context.getBean( <span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> );
IMap&lt;<span class="predefined-type">String</span>, SomeValue&gt; map = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span> );
SomeValue value = map.get( <span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span> );
Assert.assertTrue( value.init );</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>ExecutorService SpringAware Example:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a Callable Class called SomeTask which contains Spring Bean definitions like <code>ApplicationContext</code>, <code>SomeBean</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringAware</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeTask</span>
    <span class="directive">implements</span> <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">Long</span>&gt;, ApplicationContextAware, <span class="predefined-type">Serializable</span> {

    <span class="directive">private</span> <span class="directive">transient</span> ApplicationContext context;
    <span class="directive">private</span> <span class="directive">transient</span> SomeBean someBean;

    <span class="directive">public</span> <span class="predefined-type">Long</span> call() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> someBean.value;
    }

    <span class="directive">public</span> <span class="type">void</span> setApplicationContext( ApplicationContext applicationContext )
        <span class="directive">throws</span> BeansException {
        context = applicationContext;
    }

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> <span class="type">void</span> setSomeBean( SomeBean someBean ) {
        <span class="local-variable">this</span>.someBean = someBean;
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Submit <code>SomeTask</code> to two Hazelcast Members and assert that <code>someBean</code> is autowired.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance =
    (HazelcastInstance) context.getBean( <span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> );
SomeBean bean = (SomeBean) context.getBean( <span class="string"><span class="delimiter">&quot;</span><span class="content">someBean</span><span class="delimiter">&quot;</span></span> );

<span class="predefined-type">Future</span>&lt;<span class="predefined-type">Long</span>&gt; f = hazelcastInstance.getExecutorService(<span class="string"><span class="delimiter">&quot;</span><span class="content">executorService</span><span class="delimiter">&quot;</span></span>)
    .submit(<span class="keyword">new</span> SomeTask());
Assert.assertEquals(bean.value, f.get().longValue());

<span class="comment">// choose a member</span>
<span class="predefined-type">Member</span> member = hazelcastInstance.getCluster().getMembers().iterator().next();

<span class="predefined-type">Future</span>&lt;<span class="predefined-type">Long</span>&gt; f2 = (<span class="predefined-type">Future</span>&lt;<span class="predefined-type">Long</span>&gt;) hazelcast.getExecutorService(<span class="string"><span class="delimiter">&quot;</span><span class="content">executorService</span><span class="delimiter">&quot;</span></span>)
    .submitToMember(<span class="keyword">new</span> SomeTask(), member);
Assert.assertEquals(bean.value, f2.get().longValue());</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spring managed properties/fields are marked as <code>transient</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding-caching-to-spring"><a class="anchor" href="#adding-caching-to-spring"></a><a class="link" href="#adding-caching-to-spring">14.4.3. Adding Caching to Spring</a></h4>
<div class="paragraph">
<p><strong>Sample Code</strong>: Please see our sample application for <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/hazelcast-integration/spring-cache-manager">Spring Cache</a>.</p>
</div>
<div class="paragraph">
<p>As of version 3.1, Spring Framework provides support for adding caching into an existing Spring application. Spring 3.2 and later versions support JCache compliant caching providers. You can also use JCache caching backed by Hazelcast if your Spring version supports JCache.</p>
</div>
<div class="sect4">
<h5 id="declarative-spring-cache-configuration"><a class="anchor" href="#declarative-spring-cache-configuration"></a><a class="link" href="#declarative-spring-cache-configuration">Declarative Spring Cache Configuration</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;cache:annotation-driven cache-manager=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span> /&gt;

&lt;hz:hazelcast id=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>&gt;
  ...
&lt;/hz:hazelcast&gt;

&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.spring.cache.HazelcastCacheManager</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;<span class="class">constructor</span>-arg ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hazelcast uses its Map implementation for underlying cache. You can configure a map with your cache&#8217;s name if you want to set additional configuration such as <code>ttl</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;cache:annotation-driven cache-manager=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span> /&gt;

&lt;hz:hazelcast id=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;hz:config&gt;
    ...

    &lt;hz:map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span> time-to-live-seconds=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> in-memory-format=<span class="string"><span class="delimiter">&quot;</span><span class="content">BINARY</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;/hz:config&gt;
&lt;/hz:hazelcast&gt;

&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.spring.cache.HazelcastCacheManager</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;<span class="class">constructor</span>-arg ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">IDummyBean</span> {
    <span class="annotation">@Cacheable</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined-type">String</span> getCity();
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="defining-timeouts-for-cache-read-operation"><a class="anchor" href="#defining-timeouts-for-cache-read-operation"></a><a class="link" href="#defining-timeouts-for-cache-read-operation">Defining Timeouts for Cache Read Operation</a></h5>
<div class="paragraph">
<p>Starting with Hazelcast 3.8.4, you can define a timeout value for the get operations from your Spring cache. This may be useful for some cases, such as SLA requirements. Hazelcast provides a property to specify this timeout: <code>hazelcast.spring.cache.prop</code>. This can be specified as a Java property (using <code>-D</code>) or you can add this property to your Spring properties file (usually named as <code>application.properties</code>).</p>
</div>
<div class="paragraph">
<p>A sample usage is given below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">hazelcast.spring.cache.prop=defaultReadTimeout=<span class="integer">2</span>,cache1=<span class="integer">10</span>,cache2=<span class="integer">20</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The argument <code>defaultReadTimeout</code> applies to all of your Spring caches. If you want to define different timeout values for some specific Spring caches, you can provide them as a comma separated list as shown in the above sample usage. The values are in milliseconds. If you want to have no timeout for a cache, simply set it to <code>0</code> or a negative value.</p>
</div>
</div>
<div class="sect4">
<h5 id="declarative-hazelcast-jcache-based-caching-configuration"><a class="anchor" href="#declarative-hazelcast-jcache-based-caching-configuration"></a><a class="link" href="#declarative-hazelcast-jcache-based-caching-configuration">Declarative Hazelcast JCache Based Caching Configuration</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;cache:annotation-driven cache-manager=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span> /&gt;

&lt;hz:hazelcast id=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>&gt;
  ...
&lt;/hz:hazelcast&gt;

&lt;hz:cache-manager id=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcastJCacheCacheManager</span><span class="delimiter">&quot;</span></span> instance-ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcastJCacheCacheManager</span><span class="delimiter">&quot;</span></span>/&gt;

&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.cache.jcache.JCacheCacheManager</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="class">constructor</span>-arg ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcastJCacheCacheManager</span><span class="delimiter">&quot;</span></span> /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use JCache implementation in both member and client mode. A cache manager should be bound to an instance. Instance can be referenced by <code>instance-ref</code> attribute or provided by <code>hazelcast.instance.name</code> property which is passed to CacheManager. Instance should be specified using one of these methods.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Instance name provided in properties overrides <code>instance-ref</code> attribute.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can specify an URI for each cache manager with <code>uri</code> attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hz:cache-manager id=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager2</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">cacheManager2</span><span class="delimiter">&quot;</span></span> uri=<span class="string"><span class="delimiter">&quot;</span><span class="content">testURI</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;hz:properties&gt;
        &lt;hz:property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.instance.name</span><span class="delimiter">&quot;</span></span>&gt;named-spring-hz-instance&lt;/hz:property&gt;
        &lt;hz:property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">testProperty</span><span class="delimiter">&quot;</span></span>&gt;testValue&lt;/hz:property&gt;
    &lt;/hz:properties&gt;
&lt;/hz:cache-manager&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="annotation-based-spring-cache-configuration"><a class="anchor" href="#annotation-based-spring-cache-configuration"></a><a class="link" href="#annotation-based-spring-cache-configuration">Annotation-Based Spring Cache Configuration</a></h5>
<div class="paragraph">
<p>Annotation-Based Configuration does not require any XML definition. To perform Annotation-Based Configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement a <code>CachingConfiguration</code> class with related Annotations.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableCaching</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CachingConfiguration</span> <span class="directive">extends</span> CachingConfigurerSupport {
    <span class="annotation">@Bean</span>
    <span class="directive">public</span> CacheManager cacheManager() {
        ClientConfig config = <span class="keyword">new</span> ClientConfig();
        HazelcastInstance client = HazelcastClient.newHazelcastClient(config);
        <span class="keyword">return</span> <span class="keyword">new</span> com.hazelcast.spring.cache.HazelcastCacheManager(client);
    }
    <span class="annotation">@Bean</span>
    <span class="directive">public</span> <span class="predefined-type">KeyGenerator</span> keyGenerator() {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Launch Application Context and register <code>CachingConfiguration</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext();
context.register(CachingConfiguration.class);
context.refresh();</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about Spring Cache, please see <a href="http://static.springsource.org/spring/docs/3.1.x/spring-framework-reference/html/cache.html">Spring Cache Abstraction</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-hibernate-second-level-cache"><a class="anchor" href="#configuring-hibernate-second-level-cache"></a><a class="link" href="#configuring-hibernate-second-level-cache">14.4.4. Configuring Hibernate Second Level Cache</a></h4>
<div class="paragraph">
<p><strong>Sample Code</strong>: Please see our <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/hazelcast-integration/spring-hibernate-2ndlevel-cache">sample application</a> for Hibernate 2nd Level Cache Config.</p>
</div>
<div class="paragraph">
<p>If you are using Hibernate with Hazelcast as a second level cache provider, you can easily configure your
<code>LocalSessionFactoryBean</code> to use a Hazelcast instance by passing Hazelcast instance name. That way, you can use the
same <code>HazelcastInstance</code> as Hibernate L2 cache instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionFactory</span><span class="delimiter">&quot;</span></span>
      <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.hibernate3.LocalSessionFactoryBean</span><span class="delimiter">&quot;</span></span>
          <span class="class">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">singleton</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span>/&gt;
  &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernateProperties</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;props&gt;
          ...
          &lt;prop key=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.region.factory_class</span><span class="delimiter">&quot;</span></span>&gt;com.hazelcast.hibernate.HazelcastLocalCacheRegionFactory&lt;/prop&gt;
          &lt;prop key=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.cache.hazelcast.instance_name</span><span class="delimiter">&quot;</span></span>&gt;<span class="error">$</span>{hz.instance.name}&lt;/prop&gt;
      &lt;/props&gt;
  &lt;/property&gt;
  ...
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Hibernate RegionFactory Classes</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.hazelcast.hibernate.HazelcastLocalCacheRegionFactory</code></p>
</li>
<li>
<p><code>com.hazelcast.hibernate.HazelcastCacheRegionFactory</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to Hibernate <a href="https://github.com/hazelcast/hazelcast-hibernate#configuring-regionfactory">Configuring RegionFactory</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-hazelcast-transaction-manager"><a class="anchor" href="#configuring-hazelcast-transaction-manager"></a><a class="link" href="#configuring-hazelcast-transaction-manager">14.4.5. Configuring Hazelcast Transaction Manager</a></h4>
<div class="paragraph">
<p><strong>Sample Code</strong>: Please see our <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/hazelcast-integration/spring-transaction-manager">sample application</a> for Hazelcast Transaction Manager in our code samples repository.</p>
</div>
<div class="paragraph">
<p>Starting with Hazelcast 3.7, you can get rid of the boilerplate code to begin, commit or rollback transactions by using <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/spring/transaction/HazelcastTransactionManager.html">HazelcastTransactionManager</a>
which is a <code>PlatformTransactionManager</code> implementation to be used with Spring Transaction API.</p>
</div>
<div class="sect4">
<h5 id="sample-configuration-for-hazelcast-transaction-manager"><a class="anchor" href="#sample-configuration-for-hazelcast-transaction-manager"></a><a class="link" href="#sample-configuration-for-hazelcast-transaction-manager">Sample Configuration for Hazelcast Transaction Manager</a></h5>
<div class="paragraph">
<p>You need to register <code>HazelcastTransactionManager</code> as your transaction manager implementation and also you need to
register <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/spring/transaction/ManagedTransactionalTaskContext.html">ManagedTransactionalTaskContext</a>
to access transactional data structures within your service class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
&lt;hz:hazelcast id=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>&gt;
      ...
&lt;/hz:hazelcast&gt;
...
&lt;tx:annotation-driven transaction-manager=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.spring.transaction.HazelcastTransactionManager</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="class">constructor</span>-arg ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">instance</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/bean&gt;
&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionalContext</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.spring.transaction.ManagedTransactionalTaskContext</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="class">constructor</span>-arg ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/bean&gt;
&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">YOUR_SERVICE</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">YOUR_SERVICE_CLASS</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="class">property</span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionalTaskContext</span><span class="delimiter">&quot;</span></span> ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionalContext</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/bean&gt;
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sample-transactional-method"><a class="anchor" href="#sample-transactional-method"></a><a class="link" href="#sample-transactional-method">Sample Transactional Method</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ServiceWithTransactionalMethod</span> {

    <span class="directive">private</span> TransactionalTaskContext transactionalTaskContext;

    <span class="annotation">@Transactional</span>
    <span class="directive">public</span> <span class="type">void</span> transactionalPut(<span class="predefined-type">String</span> key, <span class="predefined-type">String</span> value) {
        transactionalTaskContext.getMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">testMap</span><span class="delimiter">&quot;</span></span>).put(key, value);
    }

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After marking your method as <code>Transactional</code> either declaratively or by annotation and accessing the data structure
through the <code>TransactionalTaskContext</code>, <code>HazelcastTransactionManager</code> will begin, commit or rollback the transaction for you.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="best-practices"><a class="anchor" href="#best-practices"></a><a class="link" href="#best-practices">14.4.6. Best Practices</a></h4>
<div class="paragraph">
<p>Spring tries to create a new <code>Map</code>/<code>Collection</code> instance and fill the new instance by iterating and converting values of the original <code>Map</code>/<code>Collection</code> (<code>IMap</code>, <code>IQueue</code>, etc.) to required types when generic type parameters of the original <code>Map</code>/<code>Collection</code> and the target property/attribute do not match.</p>
</div>
<div class="paragraph">
<p>Since Hazelcast `Map`s/`Collection`s are designed to hold very large data which a single machine cannot carry, iterating through whole values can cause out of memory errors.</p>
</div>
<div class="paragraph">
<p>To avoid this issue, the target property/attribute can be declared as un-typed <code>Map</code>/<code>Collection</code> as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SomeBean</span> {
    <span class="annotation">@Autowired</span>
    IMap map; <span class="comment">// instead of IMap&lt;K, V&gt; map</span>

    <span class="annotation">@Autowired</span>
    IQueue queue; <span class="comment">// instead of IQueue&lt;E&gt; queue</span>
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, parameters of injection methods (constructor, setter) can be un-typed as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SomeBean</span> {

    IMap&lt;K, V&gt; map;
    IQueue&lt;E&gt; queue;

    <span class="comment">// Instead of IMap&lt;K, V&gt; map</span>
    <span class="directive">public</span> SomeBean(IMap map) {
        <span class="local-variable">this</span>.map = map;
    }

    ...

    <span class="comment">// Instead of IQueue&lt;E&gt; queue</span>
    public <span class="type">void</span> setQueue(IQueue queue) {
        <span class="local-variable">this</span>.queue = queue;
    }
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more information please see <a href="https://jira.springsource.org/browse/SPR-3407">Spring issue-3407</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="storage"><a class="anchor" href="#storage"></a><a class="link" href="#storage">15. Storage</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes Hazelcast&#8217;s High-Density Memory Store and Hot Restart Persistence features along with their configurations and gives recommendations on the storage sizing.</p>
</div>
<div class="sect2">
<h3 id="high-density-memory-store"><a class="anchor" href="#high-density-memory-store"></a><a class="link" href="#high-density-memory-store">15.1. High-Density Memory Store</a></h3>
<div class="paragraph">
<p><strong class="navy">Hazelcast IMDG Enterprise HD</strong></p>
</div>
<div class="paragraph">
<p>By default, data structures in Hazelcast store data on heap in serialized form for highest data compaction; yet, these data structures are still subject to Java Garbage Collection (GC). Modern hardware has much more available memory. If you want to make use of that hardware and scale up by specifying higher heap sizes, GC becomes an increasing problem: the application faces long GC pauses that make the application unresponsive. Also, you may get out of memory errors if you fill your whole heap. Garbage collection, which is the automatic process that manages the application&#8217;s runtime memory, often forces you into configurations where multiple JVMs with small heaps (sizes of 2-4GB per member) run on a single physical hardware device to avoid garbage collection pauses. This results in oversized clusters to hold the data and leads to performance level requirements.</p>
</div>
<div class="paragraph">
<p>In <strong class="navy">Hazelcast IMDG Enterprise HD</strong>, the High-Density Memory Store is Hazelcast&#8217;s new enterprise in-memory storage solution. It solves garbage collection limitations so that applications can exploit hardware memory more efficiently without the need of oversized clusters. High-Density Memory Store is designed as a pluggable memory manager which enables multiple memory stores for different data structures. These memory stores are all accessible by a common access layer that scales up to terabytes of the main memory on a single JVM by minimizing the GC pressure. High-Density Memory Store enables predictable application scaling and boosts performance and latency while minimizing garbage collection pauses.</p>
</div>
<div class="paragraph">
<p>This foundation includes, but is not limited to, storing keys and values next to the heap in a native memory region.</p>
</div>
<div class="paragraph">
<p>High-Density Memory Store is currently provided for the following Hazelcast features and implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#using-high-density-memory-store-with-map">Map</a></p>
</li>
<li>
<p><a href="#icache-configuration">JCache Implementation</a></p>
</li>
<li>
<p><a href="#near-cache">Near Cache</a></p>
</li>
<li>
<p><a href="#hot-restart-persistence">Hot Restart Persistence</a></p>
</li>
<li>
<p><a href="#using-high-density-memory-store-with-java-client">Java Client</a>, when using the Near Cache for client</p>
</li>
<li>
<p><a href="https://github.com/hazelcast/hazelcast-wm#using-high-density-memory-store">Web Session Replications</a></p>
</li>
<li>
<p><a href="https://github.com/hazelcast/hazelcast-hibernate">Hibernate 2nd Level Caching</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring-high-density-memory-store"><a class="anchor" href="#configuring-high-density-memory-store"></a><a class="link" href="#configuring-high-density-memory-store">15.1.1. Configuring High-Density Memory Store</a></h4>
<div class="paragraph">
<p>To use the High-Density memory storage, the native memory usage must be enabled using the programmatic or declarative configuration.
Also, you can configure its size, memory allocator type, minimum block size, page size and metadata space percentage.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>size:</strong> Size of the total native memory to allocate in megabytes. Its default value is <strong>512 MB</strong>.</p>
</li>
<li>
<p><strong>allocator type</strong>: Type of the memory allocator. Available values are as follows:</p>
<div class="ulist">
<ul>
<li>
<p><strong>STANDARD</strong>: This option is used internally by Hazelcast&#8217;s POOLED allocator type or for debugging/testing purposes.</p>
<div class="ulist">
<ul>
<li>
<p>With this option, the memory is allocated or deallocated using your operating system&#8217;s default memory manager.</p>
</li>
<li>
<p>It uses GNU C Library&#8217;s standard <code>malloc()</code> and <code>free()</code> methods which are subject to contention on multithreaded/multicore systems.</p>
</li>
<li>
<p>Memory operations may become slower when you perform a lot of small allocations and deallocations.</p>
</li>
<li>
<p>It may cause large memory fragmentations, unless you use a method in the background that emphasizes fragmentation avoidance, such as <code>jemalloc()</code>. Note that a large memory fragmentation can trigger the Linux Out of Memory Killer if there is no swap space enabled in your system. Even if the swap space is enabled, the killer can be again triggered if there is not enough swap space left.</p>
</li>
<li>
<p>If you still want to use the operating system&#8217;s default memory management, you can set the allocator type to STANDARD in your native memory configuration.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>POOLED</strong>: This is the default option, Hazelcast&#8217;s own pooling memory allocator.</p>
<div class="ulist">
<ul>
<li>
<p>With this option, memory blocks are managed using internal memory pools.</p>
</li>
<li>
<p>It allocates memory blocks, each of which has a 4MB page size by default, and splits them into chunks or merges them to create larger chunks when required. Sizing of these chunks follows the <a href="https://en.wikipedia.org/wiki/Buddy_memory_allocation">buddy memory allocation</a> algorithm, i.e. power-of-two sizing.</p>
</li>
<li>
<p>It never frees memory blocks back to the operating system. It marks disposed memory blocks as available to be used later, meaning that these blocks are reusable.</p>
</li>
<li>
<p>Memory allocation and deallocation operations (except the ones requiring larger sizes than the page size) do not interact with the operating system mostly.</p>
</li>
<li>
<p>For memory allocation, it tries to find the requested memory size inside the internal memory pools. If it cannot be found, then it interacts with the operating system.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>minimum block size:</strong> Minimum size of the blocks in bytes to split and fragment a page block to assign to an allocation request. It is used only by the <strong>POOLED</strong> memory allocator. Its default value is <strong>16 bytes</strong>.</p>
</li>
<li>
<p><strong>page size:</strong> Size of the page in bytes to allocate memory as a block. It is used only by the <strong>POOLED</strong> memory allocator. Its default value is <code>1 &lt;&lt; 22</code> = <strong>4194304 Bytes</strong>, about <strong>4 MB</strong>.</p>
</li>
<li>
<p><strong>metadata space percentage:</strong> Defines the percentage of the allocated native memory that is used for internal memory structures by the High-Density Memory for tracking the used and available memory blocks. It is used only by the <strong>POOLED</strong> memory allocator. Its default value is <strong>12.5</strong>. Please note that when the memory runs out, you will get a <code>NativeOutOfMemoryException</code>;  if your store has a big size of entries, you should consider increasing this percentage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is the programmatic configuration example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in storage.adoc - include::{javasource}/storage/SampleHDConfiguration.java[tag=hdconf]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is the declarative configuration example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;<span class="directive">native</span>-memory allocator-type=<span class="string"><span class="delimiter">&quot;</span><span class="content">POOLED</span><span class="delimiter">&quot;</span></span> enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
     &lt;size unit=<span class="string"><span class="delimiter">&quot;</span><span class="content">MEGABYTES</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">512</span><span class="delimiter">&quot;</span></span>/&gt;
     &lt;min-block-size&gt;<span class="integer">16</span>&lt;/min-block-size&gt;
     &lt;page-size&gt;<span class="integer">4194304</span>&lt;/page-size&gt;
     &lt;metadata-space-percentage&gt;<span class="float">12.5</span>&lt;/metadata-space-percentage&gt;
&lt;/<span class="directive">native</span>-memory&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can check whether there is enough free physical memory for the requested number of bytes using the system property <code>hazelcast.hidensity.check.freememory</code>. Please see the <a href="#system-properties">System Properties appendix</a> on how to use Hazelcast system properties.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sizing-practices"><a class="anchor" href="#sizing-practices"></a><a class="link" href="#sizing-practices">15.2. Sizing Practices</a></h3>
<div class="paragraph">
<p>Data in Hazelcast is both active data and backup data for high availability, so the total memory footprint is the size of active data plus the size of backup data. If you use a single backup, it means the total memory footprint is two times the active data (active data + backup data). If you use, for example, two backups, then the total memory footprint is three times the active data (active data + backup data + backup data).</p>
</div>
<div class="paragraph">
<p>If you use only heap memory, each Hazelcast member with a 4 GB heap should accommodate a maximum of 3.5 GB of total data (active and backup). If you use the High-Density Memory Store, up to 75% of the configured physical memory footprint may be used for active and backup data, with headroom of 25% for normal memory fragmentation. In both cases, however, you should also keep some memory headroom available to handle any member failure or explicit member shutdown. When a member leaves the cluster, the data previously owned by the newly offline member will be distributed among the remaining members. For this reason, we recommend that you plan to use only 60% of available memory, with 40% headroom to handle member failure or shutdown.</p>
</div>
</div>
<div class="sect2">
<h3 id="hot-restart-persistence"><a class="anchor" href="#hot-restart-persistence"></a><a class="link" href="#hot-restart-persistence">15.3. Hot Restart Persistence</a></h3>
<div class="paragraph">
<p><strong class="navy">Hazelcast IMDG Enterprise HD</strong></p>
</div>
<div class="paragraph">
<p>This chapter explains the Hazelcast&#8217;s Hot Restart Persistence feature, introduced with Hazelcast 3.6. Hot Restart Persistence provides fast cluster restarts by storing the states of the cluster members on the disk. This feature is currently provided for the Hazelcast map data structure and the Hazelcast JCache implementation.</p>
</div>
<div class="sect3">
<h4 id="hot-restart-persistence-overview"><a class="anchor" href="#hot-restart-persistence-overview"></a><a class="link" href="#hot-restart-persistence-overview">15.3.1. Hot Restart Persistence Overview</a></h4>
<div class="paragraph">
<p>Hot Restart Persistence enables you to get your cluster up and running swiftly after a cluster restart. A restart can be caused by a planned shutdown (including rolling upgrades) or a sudden cluster-wide crash, e.g., power outage. For Hot Restart Persistence, required states for Hazelcast clusters and members are introduced. Please refer to the <a href="#managing-cluster-and-member-states">Managing Cluster and Member States section</a> for information on the cluster and member states. The purpose of the Hot Restart Persistence is to provide a maintenance window for member operations and restart the cluster in a fast way. It is not meant to recover the catastrophic shutdown of one member.</p>
</div>
</div>
<div class="sect3">
<h4 id="hot-restart-types"><a class="anchor" href="#hot-restart-types"></a><a class="link" href="#hot-restart-types">15.3.2. Hot Restart Types</a></h4>
<div class="paragraph">
<p>The Hot Restart feature is supported for the following restart types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Restart after a planned shutdown</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>The cluster is shut down completely and restarted with the exact same previous setup and data.</p>
<div class="paragraph">
<p>You can shut down the cluster completely using the method <code>HazelcastInstance.getCluster().shutdown()</code> or you can manually change the cluster state to <code>PASSIVE</code> and then shut down each member one by one. When you send the command to shut the cluster down, i.e. <code>HazelcastInstance.getCluster().shutdown()</code>, the members that are not in the <code>PASSIVE</code> state temporarily change their states to <code>PASSIVE</code>. Then, each member shuts itself down by calling the method <code>HazelcastInstance.shutdown()</code>.</p>
</div>
<div class="paragraph">
<p>Difference between explicitly changing state to <code>PASSIVE</code> before shutdown and shutting down cluster directly via <code>HazelcastInstance.getCluster().shutdown()</code> is, on latter case when cluster is restarted, cluster state will be in the latest state before shutdown. That means if cluster is <code>ACTIVE</code> before shutdown, cluster state will automatically become <code>ACTIVE</code> after restart is completed.</p>
</div>
</li>
<li>
<p>Rolling restart: The cluster is restarted intentionally member by member. For example, this could be done to install an operating system patch or new hardware.</p>
<div class="paragraph">
<p>To be able to shut down the cluster member by member as part of a planned restart, each member in the cluster should be in the <code>FROZEN</code> or <code>PASSIVE</code> state. After the cluster state is changed to <code>FROZEN</code> or <code>PASSIVE</code>, you can manually shut down each member by calling the method <code>HazelcastInstance.shutdown()</code>. When that member is restarted, it will rejoin the running cluster. After all members are restarted, the cluster state can be changed back to <code>ACTIVE</code>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Restart after a cluster crash</strong>: The cluster is restarted after all its members crashed at the same time due to a power outage, networking interruptions, etc.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="restart-process"><a class="anchor" href="#restart-process"></a><a class="link" href="#restart-process">15.3.3. Restart Process</a></h4>
<div class="paragraph">
<p>During the restart process, each member waits to load data until all the members in the partition table are started. During this process, no operations are allowed. Once all cluster members are started, Hazelcast changes the cluster state to <code>PASSIVE</code> and starts to load data. When all data is loaded, Hazelcast changes the cluster state to its previous known state before shutdown and starts to accept the operations which are allowed by the restored cluster state.</p>
</div>
<div class="paragraph">
<p>If a member fails to either start, join the cluster in time (within the timeout), or load its data, then that member will be terminated immediately. After the problems causing the failure are fixed, that member can be restarted. If the cluster start cannot be completed in time, then all members will fail to start. Please refer to the <a href="#configuring-hot-restart">Configuring Hot Restart section</a> for defining timeouts.</p>
</div>
<div class="paragraph">
<p>In the case of a restart after a cluster crash, the Hot Restart feature realizes that it was not a clean shutdown and Hazelcast tries to restart the cluster with the last saved data following the process explained above. In some cases, specifically when the cluster crashes while it has an ongoing partition migration process, currently it is not possible to restore the last saved state.</p>
</div>
<div class="sect4">
<h5 id="restart-of-a-member-in-running-cluster"><a class="anchor" href="#restart-of-a-member-in-running-cluster"></a><a class="link" href="#restart-of-a-member-in-running-cluster">Restart of a Member in Running Cluster</a></h5>
<div class="paragraph">
<p>Assume the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have a cluster consisting of members A, B and C with Hot Restart enabled, which is initially stable.</p>
</li>
<li>
<p>Member B is killed.</p>
</li>
<li>
<p>Member B restarts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since only a single member has failed, the cluster performed the standard High Availability routine by recovering member B&#8217;s data from backups and redistributing the data among the remaining members (the members A and B in this case). Member B&#8217;s persisted Hot Restart data is completely irrelevant.</p>
</div>
<div class="paragraph">
<p>Furthermore, when a member starts with existing Hot Restart data, it expects to find itself within a cluster that has been shut down as a whole and is now restarting as a whole. Since the reality is that the cluster has been running all along, member B&#8217;s persisted cluster state does not match the actual state. Therefore, member B aborts initialization and shuts down.</p>
</div>
<div class="paragraph">
<p>As another scenario, assume the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have a cluster consisting of members A, B and C with Hot Restart enabled, which is initially stable.</p>
</li>
<li>
<p>Member B is killed.</p>
</li>
<li>
<p>Member B&#8217;s Hot Restart <a href="#configuring-hot-restart">base directory (<code>base-dir</code>)</a> must be deleted.</p>
</li>
<li>
<p>Member B restarts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now member B joins the cluster as a fresh, empty member. The cluster will assign some partitions to it, unrelated to the partitions it owned before going down.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="force-start"><a class="anchor" href="#force-start"></a><a class="link" href="#force-start">15.3.4. Force Start</a></h4>
<div class="paragraph">
<p>A member can crash permanently and then be unable to recover from the failure. In that case, restart process cannot be completed since some of the members do not start or fail to load their own data. In that case, you can force the cluster to clean its persisted data and make a fresh start. This process is called <strong>force start</strong>.</p>
</div>
<div class="paragraph">
<p>Assume the following which is a valid scenario to use force start:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have a cluster consisting of members A and B which is initially stable.</p>
</li>
<li>
<p>Cluster transitions into <code>FROZEN</code> or <code>PASSIVE</code> state.</p>
</li>
<li>
<p>Cluster gracefully shuts down.</p>
</li>
<li>
<p>Member A restarts, but member B does not.</p>
</li>
<li>
<p>Member A uses its Hot Restart data to initiate the Hot Restart procedure.</p>
</li>
<li>
<p>Since it knows the cluster originally contained member B as well, it waits for it to join.</p>
</li>
<li>
<p>This never happens.</p>
</li>
<li>
<p>Now you have the choice to Force Start the cluster without member B.</p>
</li>
<li>
<p>Cluster discards all Hot Restart data and starts empty.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can trigger the force start process using the Management Center, REST API and cluster management scripts.</p>
</div>
<div class="paragraph">
<p>Please note that force start is a destructive process, which results in deletion of persisted Hot Restart data.</p>
</div>
<div class="paragraph">
<p>Please refer to the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#hot-restart">Hot Restart functionality</a> of the Management Center section to learn how you can perform a force start using the Management Center.</p>
</div>
</div>
<div class="sect3">
<h4 id="partial-start"><a class="anchor" href="#partial-start"></a><a class="link" href="#partial-start">15.3.5. Partial Start</a></h4>
<div class="paragraph">
<p>When one or more members fail to start or have incorrect Hot Restart data (stale or corrupted data) or fail to load their Hot Restart data, cluster will become incomplete and restart mechanism cannot proceed. One solution is to use <a href="#force-start">Force Start</a> and make a fresh start with existing members. Another solution is to do a partial start.</p>
</div>
<div class="paragraph">
<p>Partial start means that the cluster will start with an incomplete member set. Data belonging to those missing members will be assumed lost and Hazelcast will try to recover missing data using the restored backups. For example, if you have minimum two backups configured for all maps and caches, then a partial start up to two missing members will be safe against data loss. If there are more than two missing members or there are maps/caches with less than two backups, then data loss is expected.</p>
</div>
<div class="paragraph">
<p>Partial start is controlled by <code>cluster-data-recovery-policy</code> configuration parameter and is not allowed by default. To enable partial start, one of the configuration values <code>PARTIAL_RECOVERY_MOST_RECENT</code> or <code>PARTIAL_RECOVERY_MOST_COMPLETE</code> should be set. Please see <a href="#configuring-hot-restart">Configuring Hot Restart section</a> for details.</p>
</div>
<div class="paragraph">
<p>When partial start is enabled, Hazelcast can perform a partial start automatically or manually, in case of some members are unable to restart successfully. Partial start proceeds automatically when some members fail to start and join to the cluster in <code>validation-timeout-seconds</code>. After the <code>validation-timeout-seconds</code> duration is passed, Hot Restart chooses to perform partial start with the members present in the cluster. Moreover, partial start can be requested manually using the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#hot-restart">Management Center</a>, <a href="#using-rest-api-for-cluster-management">REST API</a> and <a href="#example-usages-for-cluster-sh">cluster management scripts</a> before the <code>validation-timeout-seconds</code> duration passes.</p>
</div>
<div class="paragraph">
<p>The other situation to decide to perform a partial start is failures during the data load phase. When Hazelcast learns data load result of all members which have passed the validation step, it automatically performs a partial start with the ones which have successfully restored their Hot Restart data. Please note that partial start does not expect every member to succeed in the data load step. It completes the process when it learns data load result for every member and there is at least one member which has successfully restored its Hot Restart data. Relatedly, if it cannot learn data load result of all members before <code>data-load-timeout-seconds</code> duration, it proceeds with the ones which have already completed the data load process.</p>
</div>
<div class="paragraph">
<p>Selection of members to perform partial start among live members is done according to the <code>cluster-data-recovery-policy</code> configuration. Set of members which are not selected by the <code>cluster-data-recovery-policy</code> are called <code>Excluded members</code> and they are instructed to perform <a href="#force-start">force start</a>. Excluded members are allowed to join cluster only when they clean their Hot Restart data and make a fresh-new start. This is a completely automatic process. For instance, if you start the missing members after partial start is completed, they clean their Hot Restart data and join to the cluster.</p>
</div>
<div class="paragraph">
<p>Please note that partial start is a destructive process. Once it is completed, it cannot be repeated with a new configuration. For this reason, one may need to perform the partial start process manually. Automatic behavior of partial start relies on <code>validation-timeout-seconds</code> and <code>data-load-timeout-seconds</code> configuration values. If you need to control the process manually, <code>validation-timeout-seconds</code> and <code>data-load-timeout-seconds</code> properties can be set to very big values so that Hazelcast cannot make progress on timeouts automatically. Then, the overall process can be managed manually via aforementioned methods, i.e. Management Center, REST API and cluster management scripts.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-hot-restart"><a class="anchor" href="#configuring-hot-restart"></a><a class="link" href="#configuring-hot-restart">15.3.6. Configuring Hot Restart</a></h4>
<div class="paragraph">
<p>You can configure Hot Restart feature programmatically or declaratively. There are two steps of configuration:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enabling and configuring the Hot Restart feature globally in your Hazelcast configuration: This is done using the configuration element <code>hot-restart-persistence</code>. Please see the <a href="#global-hot-restart-configuration">Global Hot Restart Configuration section</a> below.</p>
</li>
<li>
<p>Enabling and configuring the Hazelcast data structures to use the Hot Restart feature: This is done using the configuration element <code>hot-restart</code>. Please see the <a href="#per-data-structure-hot-restart-configuration">Per Data Structure Hot Restart Configuration section</a> below.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="global-hot-restart-configuration"><a class="anchor" href="#global-hot-restart-configuration"></a><a class="link" href="#global-hot-restart-configuration">Global Hot Restart Configuration</a></h5>
<div class="paragraph">
<p>This is where you configure the Hot Restart feature itself using the <code>hot-restart-persistence</code> element. The following are the descriptions of its attribute and sub-elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Attribute of the <code>hot-restart-persistence</code> element which specifies whether the feature is globally enabled in your Hazelcast configuration. Set this attribute to <code>true</code> if you want any of your data structures to use the Hot Restart feature.</p>
</li>
<li>
<p><code>base-dir</code>: Specifies the directory where the Hot Restart data will be stored. The default value for <code>base-dir</code> is <code>hot-restart</code>. You can use the default value, or you can specify the value of another folder containing the Hot Restart configuration, but it is mandatory that <code>base-dir</code> element has a value. This directory will be created automatically if it does not exist.
A single <code>base-dir</code> can be used only and only by a single Hazelcast member, it cannot be shared by multiple members. An attempt to use the same <code>base-dir</code> by multiple members will make these members abort the startup process except one which wins the ownership of the directory.</p>
</li>
<li>
<p><code>backup-dir</code>: Specifies the directory under which Hot Restart snapshots (Hot Backups) will be stored. Please see the <a href="#hot-backup">Hot Backup section</a> for more information.</p>
</li>
<li>
<p><code>parallelism</code>: Level of parallelism in Hot Restart Persistence. There will be this many IO threads, each writing in parallel to its own files. During the Hot Restart procedure, this many IO threads will be reading the files and this many rebuilder threads will be rebuilding the Hot Restart metadata. The default value for this property is 1. This is a good default in most but not all cases. You should measure the raw IO throughput of your infrastructure and test with different values of parallelism. In some cases such as dedicated hardware higher parallelism can yield more throughput of Hot Restart. In other cases such as running on EC2, it can yield diminishing returns - more thread scheduling, more contention on IO and less efficient garbage collection.</p>
</li>
<li>
<p><code>validation-timeout-seconds</code>: Validation timeout for the Hot Restart process when validating the cluster members expected to join and the partition table on the whole cluster.</p>
</li>
<li>
<p><code>data-load-timeout-seconds</code>: Data load timeout for the Hot Restart process. All members in the cluster should finish restoring their local data before this timeout.</p>
</li>
<li>
<p><code>cluster-data-recovery-policy</code>: Specifies the data recovery policy that will be respected during Hot Restart cluster start. Valid values are;</p>
<div class="ulist">
<ul>
<li>
<p><code>FULL_RECOVERY_ONLY</code>: Starts the cluster only when all expected members are present and correct. Otherwise, it fails. This is the default value.</p>
</li>
<li>
<p><code>PARTIAL_RECOVERY_MOST_RECENT</code>: Starts the cluster with the members which have most up-to-date partition table and successfully restored their data. All other members will leave the cluster and force start themselves. If no member restores its data successfully, cluster start fails.</p>
</li>
<li>
<p><code>PARTIAL_RECOVERY_MOST_COMPLETE</code>: Starts the cluster with the largest group of members which have the same partition table version and successfully restored their data. All other members will leave the cluster and force start themselves. If no member restores its data successfully, cluster start fails.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="per-data-structure-hot-restart-configuration"><a class="anchor" href="#per-data-structure-hot-restart-configuration"></a><a class="link" href="#per-data-structure-hot-restart-configuration">Per Data Structure Hot Restart Configuration</a></h5>
<div class="paragraph">
<p>This is where you configure the data structures of your choice, so that they can have the Hot Restart feature. This is done using the <code>hot-restart</code> configuration element. As it is explained in the <a href="#hot-restart-persistence">introduction</a> paragraph, Hot Restart feature is currently supported by Hazelcast map data structure and JCache implementation (<code>map</code> and <code>cache</code>), each of which has the <code>hot-restart</code> configuration element. The following are the descriptions of this element&#8217;s attribute and sub-element:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Attribute of the <code>hot-restart</code> element which specifies whether the Hot Restart feature is enabled for the related data structure. Its default value is <code>false</code>.</p>
</li>
<li>
<p><code>fsync</code>: Turning on <code>fsync</code> guarantees that data is persisted to the disk device when a write operation returns successful response to the caller. By default, <code>fsync</code> is turned off (<code>false</code>). That means data will be persisted to the disk device eventually, instead of on every disk write. This generally provides a better performance.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="hot-restart-configuration-examples"><a class="anchor" href="#hot-restart-configuration-examples"></a><a class="link" href="#hot-restart-configuration-examples">Hot Restart Configuration Examples</a></h5>
<div class="paragraph">
<p>The following are example configurations for a Hazelcast map and JCache implementation.</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration</strong>:</p>
</div>
<div class="paragraph">
<p>An example configuration is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
   ...
   &lt;hot-restart-persistence enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
           &lt;base-dir&gt;/mnt/hot-restart&lt;/base-dir&gt;
           &lt;parallelism&gt;<span class="integer">1</span>&lt;/parallelism&gt;
           &lt;validation-timeout-seconds&gt;<span class="integer">120</span>&lt;/validation-timeout-seconds&gt;
           &lt;data-load-timeout-seconds&gt;<span class="integer">900</span>&lt;/data-load-timeout-seconds&gt;
           &lt;cluster-data-recovery-policy&gt;FULL_RECOVERY_ONLY&lt;/cluster-data-recovery-policy&gt;
   &lt;/hot-restart-persistence&gt;
   ...
   &lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-map</span><span class="delimiter">&quot;</span></span>&gt;
           &lt;hot-restart enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
                   &lt;fsync&gt;<span class="predefined-constant">false</span>&lt;/fsync&gt;
           &lt;/hot-restart&gt;
   &lt;/map&gt;
   ...
   &lt;cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-cache</span><span class="delimiter">&quot;</span></span>&gt;
           &lt;hot-restart enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
                   &lt;fsync&gt;<span class="predefined-constant">false</span>&lt;/fsync&gt;
           &lt;/hot-restart&gt;
   &lt;/cache&gt;
   ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration</strong>:</p>
</div>
<div class="paragraph">
<p>The programmatic equivalent of the above declarative configuration is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in storage.adoc - include::{javasource}/storage/SampleHotRestartConfiguration.java[tag=hrconf]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="moving-copying-hot-restart-data"><a class="anchor" href="#moving-copying-hot-restart-data"></a><a class="link" href="#moving-copying-hot-restart-data">15.3.7. Moving/Copying Hot Restart Data</a></h4>
<div class="paragraph">
<p>After Hazelcast member owning the Hot Restart data is shutdown, Hot Restart <code>base-dir</code> can be copied/moved to a different server (which may have different IP address and/or different number of CPU cores) and Hazelcast member can be restarted using the existing Hot Restart data on that new server. Having a new IP address does not affect Hot Restart, since it does not rely on the IP address of the server but instead uses <code>Member</code> UUID as a unique identifier.</p>
</div>
<div class="paragraph">
<p>This flexibility provides;
- ability to replace one or more faulty servers with new ones easily without touching remaining cluster
- ability to use Hot Restart on cloud environments easily. Sometimes cloud providers do not preserve IP addresses on restart or after shutdown. Also it is possible to startup whole cluster on a different set of machines.
- ability to copy production data to test environment, so that a more functional test cluster can bet setup</p>
</div>
<div class="paragraph">
<p>Unfortunately having different number of CPU cores is not that straightforward. Hazelcast partition threads, by default, will use a heuristic from the number of cores, e.g., <code># of partition threads = # of CPU cores</code>. When Hazelcast member is started on a server with a different CPU core count, number of Hazelcast partition threads will change and that will make Hot Restart fail during startup. Solution is to explicitly set number of Hazelcast partition threads (<code>hazelcast.operation.thread.count</code> system property) and Hot Restart <code>parallelism</code> configuration and use the same parameters on the new server. For setting system properties see <a href="#system-properties">System Properties appendix</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hot-restart-persistence-design-details"><a class="anchor" href="#hot-restart-persistence-design-details"></a><a class="link" href="#hot-restart-persistence-design-details">15.3.8. Hot Restart Persistence Design Details</a></h4>
<div class="paragraph">
<p>Hazelcast&#8217;s Hot Restart Persistence uses the log-structured storage approach. The following is a top-level design description:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The only kind of update operation on persistent data is <em>appending</em>.</p>
</li>
<li>
<p>What is appended are facts about events that happened to the data model represented by the store; either a new value was assigned to a key or a key was removed.</p>
</li>
<li>
<p>Each record associated with a key makes stale the previous record that was associated with that key.</p>
</li>
<li>
<p>Stale records contribute to the amount of <em>garbage</em> present in the persistent storage.</p>
</li>
<li>
<p>Measures are taken to remove garbage from the storage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This kind of design focuses almost all of the system&#8217;s complexity into the garbage collection (GC) process, stripping down the client&#8217;s operation to the bare necessity of guaranteeing persistent behavior: a simple file append operation. Consequently, the latency of operations is close to the theoretical minimum in almost all cases. Complications arise only during prolonged periods of maximum load; this is where the details of the GC process begin to matter.</p>
</div>
</div>
<div class="sect3">
<h4 id="concurrent-incremental-generational-gc"><a class="anchor" href="#concurrent-incremental-generational-gc"></a><a class="link" href="#concurrent-incremental-generational-gc">15.3.9. Concurrent, Incremental, Generational GC</a></h4>
<div class="paragraph">
<p>In order to maintain the lowest possible footprint in the update operation latency, the following properties are built into the garbage collection process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A dedicated thread performs the GC. In Hazelcast terms, this thread is called the Collector and the application thread is called the Mutator.</p>
</li>
<li>
<p>On each update there is metadata to be maintained; this is done asynchronously by the Collector thread. The Mutator enqueues update events to the Collector&#8217;s work queue.</p>
</li>
<li>
<p>The Collector keeps draining its work queue at all times, including the time it goes through the GC cycle. Updates are taken into account at each stage in the GC cycle, preventing the copying of already dead records into compacted files.</p>
</li>
<li>
<p>All GC-induced I/O competes for the same resources as the Mutator&#8217;s update operations. Therefore, measures are taken to minimize the impact of I/O done during GC:</p>
<div class="ulist">
<ul>
<li>
<p>data is never read from files, but from RAM;</p>
</li>
<li>
<p>a heuristic scheme is employed which minimizes the number of bytes written to disk for each kilobyte of reclaimed garbage;</p>
</li>
<li>
<p>measures are also taken to achieve a good interleaving of Collector and Mutator operations, minimizing latency outliers perceived by the Mutator.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="i-o-minimization-scheme"><a class="anchor" href="#i-o-minimization-scheme"></a><a class="link" href="#i-o-minimization-scheme">I/O Minimization Scheme</a></h5>
<div class="paragraph">
<p>The success of this scheme is subject to a bet on the Weak Generational Garbage Hypothesis, which states that a new record entering the system is likely to become garbage soon. In other words, a key updated now is more likely than average to be updated again soon.</p>
</div>
<div class="paragraph">
<p>The scheme was taken from the seminal Sprite LFS paper, <a href="http://www.cs.berkeley.edu/~brewer/cs262/LFS.pdf">Rosenblum, Ousterhout, <em>The Design and Implementation of a Log-Structured File System</em></a>. The following is an outline of the paper:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Data is not written to one huge file, but to many files of moderate size (8 MB) called "chunks".</p>
</li>
<li>
<p>Garbage is collected incrementally, i.e. by choosing several chunks, then copying all their live data to new chunks, then deleting the old ones.</p>
</li>
<li>
<p>I/O is minimized using a collection technique which results in a bimodal distribution of chunks with respect to their garbage content: most files are either almost all live data or they are all garbage.</p>
</li>
<li>
<p>The technique consists of two main principles:</p>
<div class="ulist">
<ul>
<li>
<p>Chunks are selected based on their <em>Cost-Benefit factor</em> (see below).</p>
</li>
<li>
<p>Records are sorted by age before copying to new chunks.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cost-benefit-factor"><a class="anchor" href="#cost-benefit-factor"></a><a class="link" href="#cost-benefit-factor">Cost-Benefit Factor</a></h5>
<div class="paragraph">
<p>The Cost-Benefit factor of a chunk consists of two components multiplied together:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The ratio of benefit (amount of garbage that can be collected) to I/O cost (amount of live data to be written).</p>
</li>
<li>
<p>The age of the data in the chunk, measured as the age of the youngest record it contains.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The essence is in the second component: given equal amount of garbage in all chunks, it will make the young ones less attractive to the Collector. Assuming the generational garbage hypothesis, this will allow the young chunks to quickly accumulate more garbage. On the flip side, it will also ensure that even files with little garbage are eventually garbage collected. This removes garbage which would otherwise linger on, thinly spread across many chunk files.</p>
</div>
<div class="paragraph">
<p>Sorting records by age will group young records together in a single chunk and will do the same for older records. Therefore the chunks will either tend to keep their data live for a longer time, or quickly become full of garbage.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hot-restart-performance-considerations"><a class="anchor" href="#hot-restart-performance-considerations"></a><a class="link" href="#hot-restart-performance-considerations">15.3.10. Hot Restart Performance Considerations</a></h4>
<div class="paragraph">
<p>In this section you can find performance test summaries which are results of benchmark tests performed with a single Hazelcast member running on a physical server and on AWS R3.</p>
</div>
<div class="sect4">
<h5 id="performance-on-a-physical-server"><a class="anchor" href="#performance-on-a-physical-server"></a><a class="link" href="#performance-on-a-physical-server">Performance on a Physical Server</a></h5>
<div class="paragraph">
<p>The member has the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An IMap data structure with High-Density Memory Store.</p>
</li>
<li>
<p>Its data size is changed for each test, started from 10 GB to 500 GB (each map entry has a value of 1 KB).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The tests investigate the write and read performance of Hot Restart Persistence and are performed on HP ProLiant servers with RHEL 7 operating system using Hazelcast Simulator.</p>
</div>
<div class="paragraph">
<p>The following are the specifications of the server hardware used for the test:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU: 2x Intel&#174; Xeon&#174; CPU E5-2687W v3 @ 3.10GHz  with 10 cores per processor. Total 20 cores, 40 with hyper threading enabled.</p>
</li>
<li>
<p>Memory: 768GB 2133 MHz memory 24x HP 32GB 4Rx4 PC4-2133P-L Kit</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following are the storage media used for the test:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A hot-pluggable 2.5 inch HDD with 1 TB capacity and 10K RPM.</p>
</li>
<li>
<p>An SSD, Light Endurance PCle Workload Accelerator.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The below table shows the test results.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/HotRestartPerf.png" alt="Hot Restart Perf">
</div>
</div>
</div>
<div class="sect4">
<h5 id="performance-on-aws-r3"><a class="anchor" href="#performance-on-aws-r3"></a><a class="link" href="#performance-on-aws-r3">Performance on AWS R3</a></h5>
<div class="paragraph">
<p>The member has the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An IMap data structure with High-Density Memory Store.</p>
</li>
<li>
<p>IMap has 40 million distinct keys, each map entry is 1 KB.</p>
</li>
<li>
<p>High-Density Memory Store is 59 GiB whose 19% is metadata.</p>
</li>
<li>
<p>Hot Restart is configured with <code>fsync</code> turned off.</p>
</li>
<li>
<p>Data size reloaded on restart is 38 GB.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The tests investigate the write and read performance of Hot Restart Persistence and are performed on R3.2xlarge and R3.4xlarge EC2 instances using Hazelcast Simulator.</p>
</div>
<div class="paragraph">
<p>The following are the AWS storage types used for the test:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Elastic Block Storage (EBS) General Purpose SSD (GP2).</p>
</li>
<li>
<p>Elastic Block Storage with Provisioned IOPS (IO1). Provisioned 10,000 IOPS on a 340 GiB volume, enabled EBS-optimized on instance.</p>
</li>
<li>
<p>SSD-backed instance store.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The below table shows the test results.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/HotRestartPerf2.png" alt="Hot Restart Perf2">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hot-backup"><a class="anchor" href="#hot-backup"></a><a class="link" href="#hot-backup">15.3.11. Hot Backup</a></h4>
<div class="paragraph">
<p>During Hot Restart operations you can take a snapshot of the Hot Restart Store at a certain point in time. This is useful when you wish to bring up a new cluster with the same data or parts of the data. The new cluster can then be used to share load with the original cluster, to perform testing, QA or reproduce an issue on production data.</p>
</div>
<div class="paragraph">
<p>Simple file copying of a currently running cluster does not suffice and can produce inconsistent snapshots with problems such as resurrection of deleted values or missing values.</p>
</div>
<div class="sect4">
<h5 id="configuring-hot-backup"><a class="anchor" href="#configuring-hot-backup"></a><a class="link" href="#configuring-hot-backup">Configuring Hot Backup</a></h5>
<div class="paragraph">
<p>To create snapshots you must first configure the Hot Restart backup directory. You can configure the directory programmatically or declaratively using the following configuration element:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>backup-dir</code>: This element is included in the <code>hot-restart-persistence</code> and denotes the destination under which backups will be stored. If this element is not defined, hot backup will be disabled. If a directory is defined which does not exist, it will be created on the first backup. To avoid clashing data on multiple backups, each backup has a unique sequence ID which determines the name of the directory which will contain all Hot Restart data. This unique directory is created as a subdirectory of the configured <code>backup-dir</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following are examples configurations for Hot backup.</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration</strong>:</p>
</div>
<div class="paragraph">
<p>An example configuration is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
   ...
   &lt;hot-restart-persistence enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
           ...
           &lt;backup-dir&gt;/mnt/hot-backup&lt;/backup-dir&gt;
           ...
   &lt;/hot-restart-persistence&gt;
   ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration</strong>:</p>
</div>
<div class="paragraph">
<p>The programmatic equivalent of the above declarative configuration is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HotRestartPersistenceConfig hotRestartPersistenceConfig = <span class="keyword">new</span> HotRestartPersistenceConfig();
hotRestartPersistenceConfig.setBackupDir(<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/mnt/hot-backup</span><span class="delimiter">&quot;</span></span>));
...
config.setHotRestartPersistenceConfig(hotRestartPersistenceConfig);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using-hot-backup"><a class="anchor" href="#using-hot-backup"></a><a class="link" href="#using-hot-backup">Using Hot Backup</a></h5>
<div class="paragraph">
<p>Once configured, you can initiate a new backup via API or from the Management Center. The backup is started transactionally and cluster-wide. This means that either all or none of the members will start the same backup. The member which receives the backup request will determine a new backup sequence ID and send that information to all members. If all members respond that no other backup is currently in progress and that no other backup request has already been made, then the coordinating member will command the other members to start the actual backup process. This will create a directory under the configured <code>backup-dir</code> with the name <code>backup-&lt;backupSeq&gt;</code> and start copying the data from the original store.</p>
</div>
<div class="paragraph">
<p>The backup process is initiated nearly instantaneously on all members. Note that since there is no limitation as to when the backup process is initiated, it may be initiated during membership changes, partition table changes or during normal data update. Some of these operations may not be completed fully yet, which means that some members will backup some data while some members will backup a previous version of the same data. This will usually be solved by the anti-entropy mechanism on the new cluster which will reconcile different versions of the same data. Please check the <a href="#achieving-high-consistency-of-backup-data">Achieving High Consistency of Backup Data section</a> for more information.</p>
</div>
<div class="paragraph">
<p>The duration of the backup process and the disk data usage drastically depends on what is supported by the system and the configuration. Please check the <a href="#achieving-high-performance-of-backup-process">Achieving high performance of backup process section</a> for more information on achieving better resource usage of the backup process.</p>
</div>
<div class="paragraph">
<p>Following is an example of how to trigger the Hot Backup via API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HotRestartService service = instance.getCluster().getHotRestartService();
service.backup();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>backupSeq</code> is generated by the hot backup process, but you can define your own backup sequences as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HotRestartService service = instance.getCluster().getHotRestartService();
<span class="type">long</span> backupSeq = ...
service.backup(backupSeq);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that the backup will fail if any member contains a backup directory with the name <code>backup-&lt;backupSeq&gt;</code>, where <code>backupSeq</code> is the given sequence.</p>
</div>
</div>
<div class="sect4">
<h5 id="starting-the-cluster-from-a-hot-backup"><a class="anchor" href="#starting-the-cluster-from-a-hot-backup"></a><a class="link" href="#starting-the-cluster-from-a-hot-backup">Starting the Cluster From a Hot Backup</a></h5>
<div class="paragraph">
<p>As mentioned in the previous section, hot backup process creates subdirectories named <code>backup-&lt;backupSeq&gt;</code> under the configured <a href="#configuring-hot-backup">hot backup directory</a> (i.e., <code>backup-dir</code>). When starting your cluster with data from a hot backup, you need to set the <a href="#global-hot-restart-configuration">base directory</a> (i.e., <code>base-dir</code>) to the desired backup subdirectory.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you have configured your hot backup directory as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
   ...
   &lt;hot-restart-persistence enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
           ...
           &lt;backup-dir&gt;/mnt/hot-backup&lt;/backup-dir&gt;
           ...
   &lt;/hot-restart-persistence&gt;
   ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And let&#8217;s say you have a subdirectory named <code>backup-2018Oct24</code> under the backup directory <code>/mnt/hot-backup</code>. When you want to start your cluster with data from this backup (<code>backup-2018Oct24</code>), here is the configuration you should have for the <code>base-dir</code> while starting the cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
   ...
   &lt;hot-restart-persistence enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
           ...
           &lt;base-dir&gt;backup-<span class="integer">2018</span>Oct24&lt;/base-dir&gt;
           &lt;parallelism&gt;<span class="integer">1</span>&lt;/parallelism&gt;
           ...
           ...
   &lt;/hot-restart-persistence&gt;
   ...
   &lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-map</span><span class="delimiter">&quot;</span></span>&gt;
           &lt;hot-restart enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
                   &lt;fsync&gt;<span class="predefined-constant">false</span>&lt;/fsync&gt;
           &lt;/hot-restart&gt;
   &lt;/map&gt;
   ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="achieving-high-consistency-of-backup-data"><a class="anchor" href="#achieving-high-consistency-of-backup-data"></a><a class="link" href="#achieving-high-consistency-of-backup-data">Achieving High Consistency of Backup Data</a></h5>
<div class="paragraph">
<p>The backup is initiated nearly simultaneously on all members but you can encounter some inconsistencies in the data. This is because some members might have and some might not have received updated values yet from executed operations, because the system could be undergoing partition and membership changes or because there are some transactions which have not yet been committed.</p>
</div>
<div class="paragraph">
<p>To achieve a high consistency of data on all members, the cluster should be put to <code>PASSIVE</code> state for the duration of the call to the backup method. See the <a href="#cluster-member-states">Cluster Member States section</a> on information on how to do this. The cluster does not need to be in <code>PASSIVE</code> state for the entire duration of the backup process, though. Because of the design, only partition metadata is copied synchronously during the invocation of the backup method. Once the backup method has returned all cluster metadata has been copied and the exact partition data which needs to be copied will have been marked. After that, the backup process continues asynchronously and you can return the cluster to the <code>ACTIVE</code> state and resume operations.</p>
</div>
</div>
<div class="sect4">
<h5 id="achieving-high-performance-of-backup-process"><a class="anchor" href="#achieving-high-performance-of-backup-process"></a><a class="link" href="#achieving-high-performance-of-backup-process">Achieving High Performance of Backup Process</a></h5>
<div class="paragraph">
<p>Because of the design of Hot Restart Store, we can use hard links to achieve backups/snapshots of the store. The hot backup process will use hard links whenever possible because they provide big performance benefits and because the backups share disk usage.</p>
</div>
<div class="paragraph">
<p>The performance benefit comes from the fact that Hot Restart file contents are not being duplicated (thus using disk and IO resources) but rather a new file name is created for the same contents on disk (another pointer to the same inode). Since all backups and stores share the same inode, disk usage drops.</p>
</div>
<div class="paragraph">
<p>The bigger the percentage of stable data in the Hot Restart Store (data not undergoing changes), the more files will each backup share with the operational Hot Restart Store and the less disk space it will be using. For the hot backup to use hard links, you must be running Hazelcast members on JDK 7 or higher and must satisfy all requirements for the <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#createLink(java.nio.file.Path,%20java.nio.file.Path)"><code>Files.createLink()</code> method</a> to be supported.</p>
</div>
<div class="paragraph">
<p>The backup process will initially attempt to create a new hard link and if that fails for any reason it will continue by copying the data. Subsequent backups will also attempt to use hard links.</p>
</div>
</div>
<div class="sect4">
<h5 id="backup-process-progress-and-completion"><a class="anchor" href="#backup-process-progress-and-completion"></a><a class="link" href="#backup-process-progress-and-completion">Backup Process Progress and Completion</a></h5>
<div class="paragraph">
<p>Only cluster and distributed object metadata is copied synchronously during the invocation of the backup method. The rest of the Hot Restart Store containing partition data will be copied asynchronously after the method call has ended. You can track the progress by API or view it from the Management Center.</p>
</div>
<div class="paragraph">
<p>An example of how to track the progress via API is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HotRestartService service = instance.getCluster().getHotRestartService();
BackupTaskStatus status = service.getBackupTaskStatus();
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The returned object contains local member backup status:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the backup state (NOT_STARTED, IN_PROGRESS, FAILURE, SUCCESS)</p>
</li>
<li>
<p>the completed count</p>
</li>
<li>
<p>the total count</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The completed and total count can provide you a way to track the percentage of the copied data. Currently the count defines the number of copied and total local member Hot Restart Stores (defined by <code>HotRestartPersistenceConfig.setParallelism()</code>) but this can change at a later point to provide greater resolution.</p>
</div>
<div class="paragraph">
<p>Besides tracking the Hot Restart status by API, you can view the status in the Management Center and you can inspect the on-disk files for each member. Each member creates an <code>inprogress</code> file which is created in each of the copied Hot Restart Stores. This means that the backup is currently in progress. As the backup task completes the backup operation, the file will be removed. If an error occurs during the backup task, the <code>inprogress</code> file will be renamed to <code>failure</code> and it will contain a stack trace of the exception.</p>
</div>
</div>
<div class="sect4">
<h5 id="backup-task-interruption-and-cancellation"><a class="anchor" href="#backup-task-interruption-and-cancellation"></a><a class="link" href="#backup-task-interruption-and-cancellation">Backup Task Interruption and Cancellation</a></h5>
<div class="paragraph">
<p>Once the backup method call has returned and asynchronous copying of the partition data has started, the backup task can be interrupted. This is helpful in situations where the backup task has started at an inconvenient time. For instance, the backup task could be automatized and it could be accidentally triggered during high load on the Hazelcast instances, causing the performance of the Hazelcast instances to drop.</p>
</div>
<div class="paragraph">
<p>The backup task mainly uses disk IO, consumes little CPU and it generally does not last for a long time (although you should test it with your environment to determine the exact impact). Nevertheless, you can abort the backup tasks on all members via a cluster-wide interrupt operation. This operation can be triggered programmatically or from the Management Center.</p>
</div>
<div class="paragraph">
<p>An example of programmatic interruption is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HotRestartService service = instance.getCluster().getHotRestartService();
service.interruptBackupTask();
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method will send an interrupt to all members. The interrupt is ignored if the backup task is currently not in progress so you can safely call this method even though it has previously been called or when some members have already completed their local backup tasks.</p>
</div>
<div class="paragraph">
<p>You can also interrupt the local member backup task as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HotRestartService service = instance.getCluster().getHotRestartService();
service.interruptLocalBackupTask();
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The backup task will stop as soon as possible and it will not remove the disk contents of the backup directory meaning that you must remove it manually.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hazelcast-striim-hot-cache"><a class="anchor" href="#hazelcast-striim-hot-cache"></a><a class="link" href="#hazelcast-striim-hot-cache">15.4. Hazelcast Striim Hot Cache</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise</strong></p>
</div>
<div class="paragraph">
<p>With Hazelcast Striim Hot Cache, you can reduce the latency of propagation of data from your backend database into your Hazelcast cache to milliseconds. You have the flexibility to run multiple applications off a single database, keeping Hazelcast cache refreshes current while adhering to low latency SLAs.</p>
</div>
<div class="paragraph">
<p>This joint solution with Hazelcast&#8217;s in-memory data grid uses Striim&#8217;s Change Data Capture (CDC) to solve the cache consistency problems.</p>
</div>
<div class="paragraph">
<p>When you have an application that needs to retrieve and store information in a database, you can use a Hazelcast in-memory cache for rapid access to data. There may be some other applications that make database updates; in this case, your application may show out-of-date or invalid information.</p>
</div>
<div class="paragraph">
<p>Hazelcast Striim Hot Cache solves this by using streaming CDC to synchronize the cache with the database in real time. This ensures that both the cache and your application always have the most current data.</p>
</div>
<div class="paragraph">
<p>Through CDC, Striim is able to recognize which tables and key values have changed. It immediately captures these changes with their table and key, and pushes the changes into the cache using the Hazelcast Striim writer.</p>
</div>
<div class="paragraph">
<p>To learn more, please see the <a href="http://www.striim.com/blog/newsroom/press/hazelcast-striim-hot-cache/">full press release</a>, visit the Hazelcast Striim Hot Cache <a href="https://hazelcast.com/products/solutions/hazelcast-striim-hot-cache/">product page</a>, or download a fully loaded evaluation copy of <a href="http://www.striim.com/download-striim-for-hazelcast-hot-cache/">Striim for Hazelcast Hot Cache</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hazelcast-clients"><a class="anchor" href="#hazelcast-clients"></a><a class="link" href="#hazelcast-clients">16. Hazelcast Clients</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides information about Hazelcast&#8217;s client and language implementations; the following are covered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java, C++ and .NET clients</p>
</li>
<li>
<p>Memcache and REST clients</p>
</li>
<li>
<p>Other client and language implementations: Python, Node.js, Scala and Go.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Feature Comparison for Hazelcast Clients:</strong></p>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://hazelcast.org/clients-languages/">Feature Comparison Matrix</a> to see the features implemented across the clients and language APIs.</p>
</div>
<div class="paragraph">
<p><strong>Sample Codes for Clients:</strong></p>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/clients">Client Code Samples</a>.</p>
</div>
<div class="sect2">
<h3 id="java-client"><a class="anchor" href="#java-client"></a><a class="link" href="#java-client">16.1. Java Client</a></h3>
<div class="paragraph">
<p>The Java client is the most full featured Hazelcast native client. It is offered both with Hazelcast IMDG and Hazelcast IMDG Enterprise. The main idea behind the Java client is to provide the same Hazelcast functionality by proxying each operation through a Hazelcast member. It can access and change distributed data and it can listen to distributed events of an already established Hazelcast cluster from another Java application.</p>
</div>
<div class="paragraph">
<p>Please also check the <a href="#other-client-and-language-implementations">Other Client and Language Implementations</a>.</p>
</div>
<div class="paragraph">
<p>Hundreds or even thousands of clients can be connected to the cluster. By default, there are <code>core count * 20</code> threads on the server side that will handle all the requests, e.g., if the server has 4 cores, there will be 40 threads.</p>
</div>
<div class="paragraph">
<p>Imagine a trading application where all the trading data are stored and managed in a Hazelcast cluster with tens of members. Swing/Web applications at the traders' desktops can use clients to access and modify the data in the Hazelcast cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting with Hazelcast 3.5, a new Java Native Client Library is introduced in the release package. This library contains clients which use the new Hazelcast Open Binary Client Protocol.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For 3.5.x releases: You can use the new client experimentally with the library <code>hazelcast-client-new</code>. This library does not exist for the releases before 3.5. Please do not use this library with the Hazelcast clusters from 3.6.x and higher releases since it is not compatible with those releases.</p>
</li>
<li>
<p>For 3.6.x releases: You can use the new client with the library <code>hazelcast-client</code>. The old client&#8217;s library is <code>hazelcast-client-legacy</code> and you can still use it.</p>
</li>
<li>
<p>For 3.7.x and higher releases: There is no more old client for these releases. The only one is the <code>hazelcast-client</code> library, which includes clients implemented with the Hazelcast Open Binary Client Protocol.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="getting-started-with-java-client"><a class="anchor" href="#getting-started-with-java-client"></a><a class="link" href="#getting-started-with-java-client">16.1.1. Getting Started with Java Client</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You do not need to set a license key for your Java clients for which you want to use Hazelcast IMDG Enterprise features. Hazelcast IMDG Enterprise license keys are required only for members.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should include two dependencies in your classpath to start using the Hazelcast client: <code>hazelcast.jar</code> and <code>hazelcast-client.jar</code>.</p>
</div>
<div class="paragraph">
<p>After adding these dependencies, you can start using the Hazelcast client as if you are using the Hazelcast API. The differences are discussed in the below sections.</p>
</div>
<div class="paragraph">
<p>If you prefer to use maven, add the following lines to your <code>pom.xml</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;dependency&gt;
    &lt;groupId&gt;com.hazelcast&lt;/groupId&gt;
    &lt;artifactId&gt;hazelcast-client&lt;/artifactId&gt;
    &lt;version&gt;<span class="error">$</span>LATEST_VERSION<span class="error">$</span>&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.hazelcast&lt;/groupId&gt;
    &lt;artifactId&gt;hazelcast&lt;/artifactId&gt;
    &lt;version&gt;<span class="error">$</span>LATEST_VERSION<span class="error">$</span>&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="client-api"><a class="anchor" href="#client-api"></a><a class="link" href="#client-api">Client API</a></h5>
<div class="paragraph">
<p>The first step is configuration. You can configure the Java client declaratively or programmatically. We will use the programmatic approach throughout this tutorial. Please refer to the <a href="#configuring-java-client">Java Client Declarative Configuration section</a> for details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
clientConfig.getGroupConfig().setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>);
clientConfig.getNetworkConfig().addAddress(<span class="string"><span class="delimiter">&quot;</span><span class="content">10.90.0.1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">10.90.0.2:5702</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second step is to initialize the HazelcastInstance to be connected to the cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance client = HazelcastClient.newHazelcastClient(clientConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>This client interface is your gateway to access all Hazelcast distributed objects.</strong></p>
</div>
<div class="paragraph">
<p>Let&#8217;s create a map and populate it with some data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IMap&lt;<span class="predefined-type">String</span>, Customer&gt; mapCustomers = client.getMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>); <span class="comment">//creates the map proxy</span>

mapCustomers.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Customer(<span class="string"><span class="delimiter">&quot;</span><span class="content">Joe</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Smith</span><span class="delimiter">&quot;</span></span>));
mapCustomers.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Customer(<span class="string"><span class="delimiter">&quot;</span><span class="content">Ali</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Selam</span><span class="delimiter">&quot;</span></span>));
mapCustomers.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Customer(<span class="string"><span class="delimiter">&quot;</span><span class="content">Avi</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Noyan</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a final step, if you are done with your client, you can shut it down as shown below. This will release all the used resources and will close connections to the cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.shutdown();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="java-client-operation-modes"><a class="anchor" href="#java-client-operation-modes"></a><a class="link" href="#java-client-operation-modes">Java Client Operation Modes</a></h5>
<div class="paragraph">
<p>The client has two operation modes because of the distributed nature of the data and cluster.</p>
</div>
<div class="paragraph">
<p><strong>Smart Client</strong>: In smart mode, clients connect to each cluster member. Since each data partition uses the well known and consistent hashing algorithm, each client can send an operation to the relevant cluster member, which increases the overall throughput and efficiency. Smart mode is the default mode.</p>
</div>
<div class="paragraph">
<p><strong>Dummy Client</strong>: For some cases, the clients can be required to connect to a single member instead of to each member in the cluster. Firewalls, security, or some custom networking issues can be the reason for these cases.</p>
</div>
<div class="paragraph">
<p>In dummy client mode, the client will only connect to one of the configured addresses. This single member will behave as a gateway to the other members. For any operation requested from the client, it will redirect the request to the relevant member and return the response back to the client returned from this member.</p>
</div>
</div>
<div class="sect4">
<h5 id="handling-failures"><a class="anchor" href="#handling-failures"></a><a class="link" href="#handling-failures">Handling Failures</a></h5>
<div class="paragraph">
<p>There are two main failure cases and configurations you can perform to achieve proper behavior.</p>
</div>
<div class="paragraph">
<p><strong>Handling Client Connection Failure:</strong></p>
</div>
<div class="paragraph">
<p>While the client is trying to connect initially to one of the members in the <code>ClientNetworkConfig.addressList</code>, all the members might be not available. Instead of giving up, throwing an exception and stopping the client, the client will retry as many as <code>connectionAttemptLimit</code> times.</p>
</div>
<div class="paragraph">
<p>You can configure <code>connectionAttemptLimit</code> for the number of times you want the client to retry connecting. Please see <a href="#setting-connection-attempt-limit">Setting Connection Attempt Limit</a>.</p>
</div>
<div class="paragraph">
<p>The client executes each operation through the already established connection to the cluster. If this connection(s) disconnects or drops, the client will try to reconnect as configured.</p>
</div>
<div class="paragraph">
<p><strong>Handling Retry-able Operation Failure:</strong></p>
</div>
<div class="paragraph">
<p>While sending the requests to related members, operations can fail due to various reasons. Read-only operations are retried by default. If you want to enable retry for the other operations, you can set the <code>redoOperation</code> to <code>true</code>. Please see <a href="#enabling-redo-operation">Enabling Redo Operation</a>.</p>
</div>
<div class="paragraph">
<p>You can set a timeout for retrying the operations sent to a member. This can be provided by using the property <code>hazelcast.client.invocation.timeout.seconds</code> in <code>ClientProperties</code>. The client will retry an operation within this given period, of course, if it is a read-only operation or you enabled the <code>redoOperation</code> as stated in the above paragraph. This timeout value is important when there is a failure resulted by either of the following causes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Member throws an exception.</p>
</li>
<li>
<p>Connection between the client and member is closed.</p>
</li>
<li>
<p>Client&#8217;s heartbeat requests are timed out.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please see the <a href="#client-system-properties">Client System Properties section</a> for the description of the property <code>hazelcast.client.invocation.timeout.seconds</code>.</p>
</div>
<div class="paragraph">
<p>When any failure happens between a client and member (such as an exception at the member side, connection issues, etc.), an operation is retried if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it is certain that it has not run on the member yet, or</p>
</li>
<li>
<p>if it is idempotent such as a read-only operation, i.e., retrying does not have a side effect.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If it is not certain whether the operation has run on the member, then the non-idempotent operations are not retried. However, as explained in the first paragraph of this section, you can force all client operations to be retried (<code>redoOperation</code>) when there is a failure between the client and member. But in this case, you should know that some operations may run multiple times causing conflicts. For example, assume that your client sent a <code>queue.offer</code> operation to the member and then the connection is lost. Since there will be no respond for this operation, you will not know whether it has run on the member or not. If you enabled <code>redoOperation</code>, it means this operation may run again, which may cause two sane objects in the queue.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-supported-distributed-data-structures"><a class="anchor" href="#using-supported-distributed-data-structures"></a><a class="link" href="#using-supported-distributed-data-structures">Using Supported Distributed Data Structures</a></h5>
<div class="paragraph">
<p>Most of the Distributed Data Structures are supported by the Java client. When you use clients in other languages, you should check for the exceptions.</p>
</div>
<div class="paragraph">
<p>As a general rule, you configure these data structures on the server side and access them through a proxy on the client side.</p>
</div>
<div class="sect5">
<h6 id="using-map-with-java-client"><a class="anchor" href="#using-map-with-java-client"></a><a class="link" href="#using-map-with-java-client">Using Map with Java Client</a></h6>
<div class="paragraph">
<p>You can use any <a href="#map">Distributed Map</a> object with the client, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Imap&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; map = client.getMap(<span class="error"></span>myMap<span class="error"></span>);

map.put(<span class="integer">1</span>, <span class="error"></span>Ali<span class="error"></span>);
<span class="predefined-type">String</span> value= map.get(<span class="integer">1</span>);
map.remove(<span class="integer">1</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Locality is ambiguous for the client, so <code>addLocalEntryListener</code> and <code>localKeySet</code> are not supported. Please see the <a href="#map">Distributed Map section</a> for more information.</p>
</div>
</div>
<div class="sect5">
<h6 id="using-multimap-with-java-client"><a class="anchor" href="#using-multimap-with-java-client"></a><a class="link" href="#using-multimap-with-java-client">Using MultiMap with Java Client</a></h6>
<div class="paragraph">
<p>A MultiMap usage example is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MultiMap&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; multiMap = client.getMultiMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">myMultiMap</span><span class="delimiter">&quot;</span></span>);

multiMap.put(<span class="integer">1</span>,<span class="error"></span>ali<span class="error"></span>);
multiMap.put(<span class="integer">1</span>,<span class="error"></span>veli<span class="error"></span>);

<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; values = multiMap.get(<span class="integer">1</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>addLocalEntryListener</code>, <code>localKeySet</code> and  <code>getLocalMultiMapStats</code> are not supported because locality is ambiguous for the client. Please see the <a href="#multimap ">Distributed MultiMap section</a> for more information.</p>
</div>
</div>
<div class="sect5">
<h6 id="using-queue-with-java-client"><a class="anchor" href="#using-queue-with-java-client"></a><a class="link" href="#using-queue-with-java-client">Using Queue with Java Client</a></h6>
<div class="paragraph">
<p>A sample usage is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IQueue&lt;<span class="predefined-type">String</span>&gt; myQueue = client.getQueue(<span class="error"></span>theQueue<span class="error"></span>);
myQueue.offer(<span class="error"></span>ali<span class="error"></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getLocalQueueStats</code> is not supported because locality is ambiguous for the client. Please see the <a href="#queue">Distributed Queue section</a> for more information.</p>
</div>
</div>
<div class="sect5">
<h6 id="using-topic-with-java-client"><a class="anchor" href="#using-topic-with-java-client"></a><a class="link" href="#using-topic-with-java-client">Using Topic with Java Client</a></h6>
<div class="paragraph">
<p><code>getLocalTopicStats</code> is not supported because locality is ambiguous for the client.</p>
</div>
</div>
<div class="sect5">
<h6 id="using-other-supported-distributed-structures"><a class="anchor" href="#using-other-supported-distributed-structures"></a><a class="link" href="#using-other-supported-distributed-structures">Using Other Supported Distributed Structures</a></h6>
<div class="paragraph">
<p>The distributed data structures listed below are also supported by the client. Since their logic is the same in both the member side and client side, you can refer to their sections as listed below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#replicated-map">Replicated Map</a></p>
</li>
<li>
<p><a href="#mapreduce">MapReduce</a></p>
</li>
<li>
<p><a href="#list">List</a></p>
</li>
<li>
<p><a href="#set">Set</a></p>
</li>
<li>
<p><a href="#iatomiclong">IAtomicLong</a></p>
</li>
<li>
<p><a href="#iatomicreference">IAtomicReference</a></p>
</li>
<li>
<p><a href="#icountdownlatch">ICountDownLatch</a></p>
</li>
<li>
<p><a href="#isemaphore">ISemaphore</a></p>
</li>
<li>
<p><a href="#idgenerator">IdGenerator</a></p>
</li>
<li>
<p><a href="#flakeidgenerator">FlakeIdGenerator</a></p>
</li>
<li>
<p><a href="#lock">Lock</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using-client-services"><a class="anchor" href="#using-client-services"></a><a class="link" href="#using-client-services">Using Client Services</a></h5>
<div class="paragraph">
<p>Hazelcast provides the services discussed below for some common functionalities on the client side.</p>
</div>
<div class="sect5">
<h6 id="using-distributed-executor-service"><a class="anchor" href="#using-distributed-executor-service"></a><a class="link" href="#using-distributed-executor-service">Using Distributed Executor Service</a></h6>
<div class="paragraph">
<p>The distributed executor service is for distributed computing. It can be used to execute tasks on the cluster on a designated partition or on all the partitions. It can also be used to process entries. Please see the <a href="#executor-service">Distributed Executor Service section</a> for more information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">IExecutorService executorService = client.getExecutorService(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After getting an instance of <code>IExecutorService</code>, you can use the instance as the interface with the one provided on the server side. Please see the <a href="#distributed-computing">Distributed Computing chapter</a> for detailed usage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This service is only supported by the Java client.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="listening-to-client-connection"><a class="anchor" href="#listening-to-client-connection"></a><a class="link" href="#listening-to-client-connection">Listening to Client Connection</a></h6>
<div class="paragraph">
<p>If you need to track clients and you want to listen to their connection events, you can use the <code>clientConnected</code> and <code>clientDisconnected</code> methods of the <code>ClientService</code> class. This class must be run on the <strong>member</strong> side. The following is an example code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in hazelcast_clients.adoc - include::{javasource}/clients/ListeningClients.java[tag=lc]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="finding-the-partition-of-a-key"><a class="anchor" href="#finding-the-partition-of-a-key"></a><a class="link" href="#finding-the-partition-of-a-key">Finding the Partition of a Key</a></h6>
<div class="paragraph">
<p>You use partition service to find the partition of a key. It will return all partitions. See the example code below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">PartitionService partitionService = client.getPartitionService();

<span class="comment">//partition of a key</span>
Partition partition = partitionService.getPartition(key);

<span class="comment">//all partitions</span>
<span class="predefined-type">Set</span>&lt;Partition&gt; partitions = partitionService.getPartitions();</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="handling-lifecycle"><a class="anchor" href="#handling-lifecycle"></a><a class="link" href="#handling-lifecycle">Handling Lifecycle</a></h6>
<div class="paragraph">
<p>Lifecycle handling performs the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check if the client is running.</p>
</li>
<li>
<p>Shut down the client gracefully.</p>
</li>
<li>
<p>Terminate the client ungracefully (forced shutdown).</p>
</li>
<li>
<p>Add/remove lifecycle listeners.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">LifecycleService lifecycleService = client.getLifecycleService();

<span class="keyword">if</span>(lifecycleService.isRunning()){
    <span class="comment">//it is running</span>
}

<span class="comment">//shutdown client gracefully</span>
lifecycleService.shutdown();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="client-listeners"><a class="anchor" href="#client-listeners"></a><a class="link" href="#client-listeners">Client Listeners</a></h5>
<div class="paragraph">
<p>You can configure listeners to listen to various event types on the client side. You can configure global events not relating to any distributed object through <a href="#configuring-client-listeners">Client ListenerConfig</a>. You should configure distributed object listeners like map entry listeners or list item listeners through their proxies. You can refer to the related sections under each distributed data structure in this reference manual.</p>
</div>
</div>
<div class="sect4">
<h5 id="client-transactions"><a class="anchor" href="#client-transactions"></a><a class="link" href="#client-transactions">Client Transactions</a></h5>
<div class="paragraph">
<p>Transactional distributed objects are supported on the client side. Please see the <a href="#transactions ">Transactions chapter</a> on how to use them.</p>
</div>
</div>
<div class="sect4">
<h5 id="async-start-and-reconnect-modes"><a class="anchor" href="#async-start-and-reconnect-modes"></a><a class="link" href="#async-start-and-reconnect-modes">Async Start and Reconnect Modes</a></h5>
<div class="paragraph">
<p>Java client can be configured to connect to a cluster in an async manner during the client start and reconnecting after a cluster disconnect. Both of these options are configured via <code>ClientConnectionStrategyConfig</code>.</p>
</div>
<div class="paragraph">
<p>Async client start is configured by setting the configuration element <code>async-start</code> to <code>true</code>. This configuration will change the behavior of <code>HazelcastClient.newHazelcastClient()</code> call. It&#8217;ll return a client instance without waiting to establish a cluster connection.
Until the client connects to cluster, it will throw <code>HazelcastClientOfflineException</code> on any network dependent operations hence they won&#8217;t block. If you want to check or wait the client to complete its cluster connection, you can use the built-in lifecycle listener:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientStateListener clientStateListener = <span class="keyword">new</span> ClientStateListener(clientConfig);
HazelcastInstance client = HazelcastClient.newHazelcastClient(clientConfig);

<span class="comment">//Client started but may not be connected to cluster yet.</span>

<span class="comment">//check connection status</span>
clientStateListener.isConnected();

<span class="comment">//blocks until client completes connect to cluster</span>
<span class="keyword">if</span> (clientStateListener.awaitConnected()) {
        <span class="comment">//connected successfully</span>
} <span class="keyword">else</span> {
        <span class="comment">//client failed to connect to cluster</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java client can also be configured to specify how it reconnects after a cluster disconnection. There are three options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A client can reject to reconnect to the cluster and trigger the client shutdown process.</p>
</li>
<li>
<p>Client can open a connection to the cluster by blocking all waiting invocations.</p>
</li>
<li>
<p>Client can open a connection to the cluster without blocking the waiting invocations. All invocations will receive <code>HazelcastClientOfflineException</code> during the establishment of cluster connection. If cluster connection is failed to connect, then client shutdown will be triggered.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can refer to the <a href="#configuring-client-connection-strategy">Configuring Client Connection Strategy section</a> to learn how to configure these.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-java-client"><a class="anchor" href="#configuring-java-client"></a><a class="link" href="#configuring-java-client">16.1.2. Configuring Java Client</a></h4>
<div class="paragraph">
<p>You can configure Hazelcast Java Client declaratively (XML), programmatically (API), or using client system properties.</p>
</div>
<div class="paragraph">
<p>For declarative configuration, the Hazelcast client looks at the following places for the client configuration file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>System property</strong>: The client first checks if <code>hazelcast.client.config</code> system property is set to a file path, e.g., <code>-Dhazelcast.client.config=C:/myhazelcast.xml</code>.</p>
</li>
<li>
<p><strong>Classpath</strong>: If config file is not set as a system property, the client checks the classpath for <code>hazelcast-client.xml</code> file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the client does not find any configuration file, it starts with the default configuration (<code>hazelcast-client-default.xml</code>) located in the <code>hazelcast-client.jar</code> library. Before configuring the client, please try to work with the default configuration to see if it works for you. The default should be just fine for most users. If not, then consider custom configuration for your environment.</p>
</div>
<div class="paragraph">
<p>If you want to specify your own configuration file to create a <code>Config</code> object, the Hazelcast client supports the following.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Config cfg = new XmlClientConfigBuilder(xmlFileName).build();</code></p>
</li>
<li>
<p><code>Config cfg = new XmlClientConfigBuilder(inputStream).build();</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For programmatic configuration of the Hazelcast Java Client, just instantiate a <code>ClientConfig</code> object and configure the desired aspects. An example is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
clientConfig.setGroupConfig(<span class="keyword">new</span> GroupConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">dev-pass);
clientConfig.setLoadBalancer(yourLoadBalancer);
...
...</span></span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="client-network"><a class="anchor" href="#client-network"></a><a class="link" href="#client-network">Client Network</a></h5>
<div class="paragraph">
<p>All network related configuration of Hazelcast Java Client is performed via the <code>network</code> element in the declarative configuration file, or in the class <code>ClientNetworkConfig</code> when using programmatic configuration. Let&#8217;s first give the examples for these two approaches. Then we will look at its sub-elements and attributes.</p>
</div>
<div class="sect5">
<h6 id="declarative-client-network-configuration"><a class="anchor" href="#declarative-client-network-configuration"></a><a class="link" href="#declarative-client-network-configuration">Declarative Client Network Configuration</a></h6>
<div class="paragraph">
<p>Here is an example of configuring network for Java Client declaratively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast-client xsi:schemaLocation=
    <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.hazelcast.com/schema/client-config hazelcast-client-config-&lt;version&gt;.xsd</span><span class="delimiter">&quot;</span></span>
                  xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.hazelcast.com/schema/client-config</span><span class="delimiter">&quot;</span></span>
                  xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>&gt;
...
&lt;network&gt;
  &lt;cluster-members&gt;
    &lt;address&gt;<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>&lt;/address&gt;
    &lt;address&gt;<span class="float">127.0</span><span class="float">.0</span><span class="float">.2</span>&lt;/address&gt;
  &lt;/cluster-members&gt;
  &lt;outbound-ports&gt;
     &lt;ports&gt;<span class="integer">34600</span>&lt;/ports&gt;
     &lt;ports&gt;<span class="integer">34700</span>-<span class="integer">34710</span>&lt;/ports&gt;
  &lt;/outbound-ports&gt;
  &lt;smart-routing&gt;<span class="predefined-constant">true</span>&lt;/smart-routing&gt;
  &lt;redo-operation&gt;<span class="predefined-constant">true</span>&lt;/redo-operation&gt;
  &lt;socket-interceptor enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="type">class</span>-<span class="class">name</span>&gt;com.hazelcast.XYZ&lt;/<span class="type">class</span>-<span class="class">name</span>&gt;
    &lt;properties&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-host</span><span class="delimiter">&quot;</span></span>&gt;kerb-host-name&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-config-file</span><span class="delimiter">&quot;</span></span>&gt;kerb.conf&lt;/property&gt;
    &lt;/properties&gt;
   &lt;/socket-interceptor&gt;
  &lt;aws enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> connection-timeout-seconds=<span class="string"><span class="delimiter">&quot;</span><span class="content">11</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;inside-aws&gt;<span class="predefined-constant">false</span>&lt;/inside-aws&gt;
    &lt;access-key&gt;my-access-key&lt;/access-key&gt;
    &lt;secret-key&gt;my-secret-key&lt;/secret-key&gt;
    &lt;iam-role&gt;s3access&lt;/iam-role&gt;
    &lt;region&gt;us-west-<span class="integer">1</span>&lt;/region&gt;
    &lt;host-header&gt;ec2.amazonaws.com&lt;/host-header&gt;
    &lt;security-group-name&gt;hazelcast-sg&lt;/security-group-name&gt;
    &lt;tag-key&gt;type&lt;/tag-key&gt;
    &lt;tag-value&gt;hz-members&lt;/tag-value&gt;
  &lt;/aws&gt;
&lt;/network&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="programmatic-client-network-configuration"><a class="anchor" href="#programmatic-client-network-configuration"></a><a class="link" href="#programmatic-client-network-configuration">Programmatic Client Network Configuration</a></h6>
<div class="paragraph">
<p>Here is an example of configuring network for Java Client programmatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in hazelcast_clients.adoc - include::{javasource}/clients/SampleClientConfiguration.java[tag=scc]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configuring-address-list"><a class="anchor" href="#configuring-address-list"></a><a class="link" href="#configuring-address-list">Configuring Address List</a></h6>
<div class="paragraph">
<p>Address List is the initial list of cluster addresses to which the client will connect. The client uses this list to find an alive member. Although it may be enough to give only one address of a member in the cluster (since all members communicate with each other), it is recommended that you give the addresses for all the members.</p>
</div>
<div class="paragraph">
<p><strong>Declarative</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast-client&gt;
  ...
  &lt;network&gt;
    &lt;cluster-members&gt;
      &lt;address&gt;<span class="float">10.1</span><span class="float">.1</span><span class="float">.21</span>&lt;/address&gt;
      &lt;address&gt;<span class="float">10.1</span><span class="float">.1</span><span class="float">.22</span>:<span class="integer">5703</span>&lt;/address&gt;
    &lt;/cluster-members&gt;
  ...
  &lt;/network&gt;
...
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
ClientNetworkConfig networkConfig = clientConfig.getNetworkConfig();
networkConfig.addAddress(<span class="string"><span class="delimiter">&quot;</span><span class="content">10.1.1.21</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">10.1.1.22:5703</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the port part is omitted, then 5701, 5702 and 5703 will be tried in random order.</p>
</div>
<div class="paragraph">
<p>You can provide multiple addresses with ports provided or not, as seen above. The provided list is shuffled and tried in random order. Its default value is <strong>localhost</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="setting-outbound-ports"><a class="anchor" href="#setting-outbound-ports"></a><a class="link" href="#setting-outbound-ports">Setting Outbound Ports</a></h6>
<div class="paragraph">
<p>You may want to restrict outbound ports to be used by Hazelcast-enabled applications. To fulfill this requirement, you can configure Hazelcast Java client to use only defined outbound ports. The following are example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;network&gt;
  &lt;outbound-ports&gt;
    &lt;!-- ports between <span class="integer">34700</span> and <span class="integer">34710</span> --&gt;
    &lt;ports&gt;<span class="integer">34700</span>-<span class="integer">34710</span>&lt;/ports&gt;
    &lt;!-- comma separated ports --&gt;
    &lt;ports&gt;<span class="integer">34700</span>,<span class="integer">34701</span>,<span class="integer">34702</span>,<span class="integer">34703</span>&lt;/ports&gt;
    &lt;ports&gt;<span class="integer">34700</span>,<span class="integer">34705</span>-<span class="integer">34710</span>&lt;/ports&gt;
  &lt;/outbound-ports&gt;
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
NetworkConfig networkConfig = config.getNetworkConfig();
<span class="comment">// ports between 34700 and 34710</span>
networkConfig.addOutboundPortDefinition(<span class="string"><span class="delimiter">&quot;</span><span class="content">34700-34710</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// comma separated ports</span>
networkConfig.addOutboundPortDefinition(<span class="string"><span class="delimiter">&quot;</span><span class="content">34700,34701,34702,34703</span><span class="delimiter">&quot;</span></span>);
networkConfig.addOutboundPort(<span class="integer">34705</span>);
...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use port ranges and/or comma separated ports.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As shown in the programmatic configuration, you use the method <code>addOutboundPort</code> to add only one port. If you need to add a group of ports, then use the method <code>addOutboundPortDefinition</code>.</p>
</div>
<div class="paragraph">
<p>In the declarative configuration, the element <code>ports</code> can be used for both single and multiple port definitions.</p>
</div>
</div>
<div class="sect5">
<h6 id="setting-smart-routing"><a class="anchor" href="#setting-smart-routing"></a><a class="link" href="#setting-smart-routing">Setting Smart Routing</a></h6>
<div class="paragraph">
<p>Smart routing defines whether the client operation mode is smart or dummy. See <a href="#java-client-operation-modes">Java Client Operation Modes</a> to learn about these modes.</p>
</div>
<div class="paragraph">
<p>The following are example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
&lt;network&gt;
...
  &lt;smart-routing&gt;<span class="predefined-constant">true</span>&lt;/smart-routing&gt;
...
&lt;/network&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
ClientNetworkConfig networkConfig = clientConfig.getNetworkConfig();
networkConfig().setSmartRouting(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Its default value is <code>true</code> (smart client mode).</p>
</div>
</div>
<div class="sect5">
<h6 id="enabling-redo-operation"><a class="anchor" href="#enabling-redo-operation"></a><a class="link" href="#enabling-redo-operation">Enabling Redo Operation</a></h6>
<div class="paragraph">
<p>It enables/disables redo-able operations as described in <a href="#handling-failures">Handling Retry-able Operation Failure</a>. The following are the example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
&lt;network&gt;
...
  &lt;redo-operation&gt;<span class="predefined-constant">true</span>&lt;/redo-operation&gt;
...
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
ClientNetworkConfig networkConfig = clientConfig.getNetworkConfig();
networkConfig().setRedoOperation(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Its default value is <code>false</code> (disabled).</p>
</div>
</div>
<div class="sect5">
<h6 id="setting-connection-timeout"><a class="anchor" href="#setting-connection-timeout"></a><a class="link" href="#setting-connection-timeout">Setting Connection Timeout</a></h6>
<div class="paragraph">
<p>Connection timeout is the timeout value in milliseconds for members to accept client connection requests. The following are the example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
&lt;network&gt;
...
  &lt;connection-timeout&gt;<span class="integer">5000</span>&lt;/connection-timeout&gt;
...
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
clientConfig.getNetworkConfig().setConnectionTimeout(<span class="integer">5000</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Its default value is <strong>5000</strong> milliseconds.</p>
</div>
</div>
<div class="sect5">
<h6 id="setting-connection-attempt-limit"><a class="anchor" href="#setting-connection-attempt-limit"></a><a class="link" href="#setting-connection-attempt-limit">Setting Connection Attempt Limit</a></h6>
<div class="paragraph">
<p>While the client is trying to connect initially to one of the members in the <code>ClientNetworkConfig.addressList</code>, that member might not be available at that moment. Instead of giving up, throwing an exception and stopping the client, the client will retry as many as <code>ClientNetworkConfig.connectionAttemptLimit</code> times. This is also the case when the previously established connection between the client and that member goes down. The following are example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
&lt;network&gt;
...
  &lt;connection-attempt-limit&gt;<span class="integer">5</span>&lt;/connection-attempt-limit&gt;
...
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
clientConfig.getNetworkConfig().setConnectionAttemptLimit(<span class="integer">5</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Its default value is <strong>2</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="setting-connection-attempt-period"><a class="anchor" href="#setting-connection-attempt-period"></a><a class="link" href="#setting-connection-attempt-period">Setting Connection Attempt Period</a></h6>
<div class="paragraph">
<p>Connection timeout period is the duration in milliseconds between the connection attempts defined by <code>ClientNetworkConfig.connectionAttemptLimit</code>. The following are example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
&lt;network&gt;
...
  &lt;connection-attempt-period&gt;<span class="integer">5000</span>&lt;/connection-attempt-period&gt;
...
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
clientConfig.getNetworkConfig().setConnectionAttemptPeriod(<span class="integer">5000</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Its default value is <strong>3000</strong> milliseconds.</p>
</div>
</div>
<div class="sect5">
<h6 id="setting-a-socket-interceptor"><a class="anchor" href="#setting-a-socket-interceptor"></a><a class="link" href="#setting-a-socket-interceptor">Setting a Socket Interceptor</a></h6>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise</strong></p>
</div>
<div class="paragraph">
<p>Following is a client configuration to set a socket intercepter. Any class implementing <code>com.hazelcast.nio.SocketInterceptor</code> is a socket interceptor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SocketInterceptor</span> {
    <span class="type">void</span> init(<span class="predefined-type">Properties</span> properties);
    <span class="type">void</span> onConnect(<span class="predefined-type">Socket</span> connectedSocket) <span class="directive">throws</span> <span class="exception">IOException</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>SocketInterceptor</code> has two steps. First, it will be initialized by the configured properties. Second, it will be informed just after the socket is connected using <code>onConnect</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SocketInterceptorConfig socketInterceptorConfig = clientConfig
               .getNetworkConfig().getSocketInterceptorConfig();

MyClientSocketInterceptor myClientSocketInterceptor = <span class="keyword">new</span> MyClientSocketInterceptor();

socketInterceptorConfig.setEnabled(<span class="predefined-constant">true</span>);
socketInterceptorConfig.setImplementation(myClientSocketInterceptor);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to configure the socket connector with a class name instead of an instance, see the example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SocketInterceptorConfig socketInterceptorConfig = clientConfig
            .getNetworkConfig().getSocketInterceptorConfig();

MyClientSocketInterceptor myClientSocketInterceptor = <span class="keyword">new</span> MyClientSocketInterceptor();

socketInterceptorConfig.setEnabled(<span class="predefined-constant">true</span>);

<span class="comment">//These properties are provided to interceptor during init</span>
socketInterceptorConfig.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-host</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">kerb-host-name</span><span class="delimiter">&quot;</span></span>);
socketInterceptorConfig.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-config-file</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">kerb.conf</span><span class="delimiter">&quot;</span></span>);

socketInterceptorConfig.setClassName(myClientSocketInterceptor);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please see the <a href="#socket-interceptor">Socket Interceptor section</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="configuring-network-socket-options"><a class="anchor" href="#configuring-network-socket-options"></a><a class="link" href="#configuring-network-socket-options">Configuring Network Socket Options</a></h6>
<div class="paragraph">
<p>You can configure the network socket options using <code>SocketOptions</code>. It has the following methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>socketOptions.setKeepAlive(x)</code>: Enables/disables the <strong>SO_KEEPALIVE</strong> socket option. Its default value is <code>true</code>.</p>
</li>
<li>
<p><code>socketOptions.setTcpNoDelay(x)</code>: Enables/disables the <strong>TCP_NODELAY</strong> socket option. Its default value is <code>true</code>.</p>
</li>
<li>
<p><code>socketOptions.setReuseAddress(x)</code>: Enables/disables the <strong>SO_REUSEADDR</strong> socket option. Its default value is <code>true</code>.</p>
</li>
<li>
<p><code>socketOptions.setLingerSeconds(x)</code>: Enables/disables <strong>SO_LINGER</strong> with the specified linger time in seconds. Its default value is <code>3</code>.</p>
</li>
<li>
<p><code>socketOptions.setBufferSize(x)</code>: Sets the <strong>SO_SNDBUF</strong> and <strong>SO_RCVBUF</strong> options to the specified value in KB for this Socket. Its default value is <code>32</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">SocketOptions</span> socketOptions = clientConfig.getNetworkConfig().getSocketOptions();
socketOptions.setBufferSize(<span class="integer">32</span>);
socketOptions.setKeepAlive(<span class="predefined-constant">true</span>);
socketOptions.setTcpNoDelay(<span class="predefined-constant">true</span>);
socketOptions.setReuseAddress(<span class="predefined-constant">true</span>);
socketOptions.setLingerSeconds(<span class="integer">3</span>);</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="enabling-client-tls-ssl"><a class="anchor" href="#enabling-client-tls-ssl"></a><a class="link" href="#enabling-client-tls-ssl">Enabling Client TLS/SSL</a></h6>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise</strong></p>
</div>
<div class="paragraph">
<p>You can use TLS/SSL to secure the connection between the client and the members. If you want TLS/SSL enabled for the client-cluster connection, you should set <code>SSLConfig</code>. Once set, the connection (socket) is established out of an TLS/SSL factory defined either by a factory class name or factory implementation. Please see the <a href="#tlsssl ">TLS/SSL section</a>.</p>
</div>
<div class="paragraph">
<p>As explained in the <a href="#tlsssl ">TLS/SSL section</a>, Hazelcast members have keyStores used to identify themselves (to other members) and Hazelcast clients have trustStore used to define which members they can trust. Starting with Hazelcast 3.8.1 release, mutual authentication is introduced. This allows the clients also to have their keyStores and members to have their trustStores so that the members can know which clients they can trust. Please see the <a href="#mutual-authentication">Mutual Authentication section</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring-client-for-aws"><a class="anchor" href="#configuring-client-for-aws"></a><a class="link" href="#configuring-client-for-aws">Configuring Client for AWS</a></h6>
<div class="paragraph">
<p>The example declarative and programmatic configurations below show how to configure a Java client for connecting to a Hazelcast cluster in AWS.</p>
</div>
<div class="paragraph">
<p><strong>Declarative</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
&lt;network&gt;
  &lt;aws enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;inside-aws&gt;<span class="predefined-constant">false</span>&lt;/inside-aws&gt;
    &lt;access-key&gt;my-access-key&lt;/access-key&gt;
    &lt;secret-key&gt;my-secret-key&lt;/secret-key&gt;
    &lt;iam-role&gt;s3access&lt;/iam-role&gt;
    &lt;region&gt;us-west-<span class="integer">1</span>&lt;/region&gt;
    &lt;host-header&gt;ec2.amazonaws.com&lt;/host-header&gt;
    &lt;security-group-name&gt;hazelcast-sg&lt;/security-group-name&gt;
    &lt;tag-key&gt;type&lt;/tag-key&gt;
    &lt;tag-value&gt;hz-members&lt;/tag-value&gt;
  &lt;/aws&gt;
...
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in hazelcast_clients.adoc - include::{javasource}/clients/SampleClientAwsConfig.java[tag=clientaws]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can refer to the <a href="#aws-element">aws element section</a> for the descriptions of above AWS configuration elements except <code>inside-aws</code> and <code>iam-role</code>, which are explained below.</p>
</div>
<div class="paragraph">
<p>If the <code>inside-aws</code> element is not set, the private addresses of cluster members will always be converted to public addresses. Also, the client will use public addresses to connect to the members. In order to use private addresses, set the <code>inside-aws</code> parameter to <code>true</code>. Also note that, when connecting outside from AWS, setting the <code>inside-aws</code> parameter to <code>true</code> will cause the client to not be able to reach the members.</p>
</div>
<div class="paragraph">
<p>IAM roles are used to make secure requests from your clients. You can provide the name of your IAM role that you created previously on your AWS console using the <code>iam-role</code> or <code>setIamRole()</code> method.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configuring-client-load-balancer"><a class="anchor" href="#configuring-client-load-balancer"></a><a class="link" href="#configuring-client-load-balancer">Configuring Client Load Balancer</a></h5>
<div class="paragraph">
<p><code>LoadBalancer</code> allows you to send operations to one of a number of endpoints (Members). Its main purpose is to determine the next <code>Member</code> if queried.  It is up to your implementation to use different load balancing policies. You should implement the interface <code>com.hazelcast.client.LoadBalancer</code> for that purpose.</p>
</div>
<div class="paragraph">
<p>If the client is configured in smart mode, only the operations that are not key-based will be routed to the endpoint that is returned by the <code>LoadBalancer</code>. If the client is not a smart client, <code>LoadBalancer</code> will be ignored.</p>
</div>
<div class="paragraph">
<p>The following are example configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast-client&gt;
  ...
  &lt;load-balancer type=<span class="error"></span>random<span class="error"></span>&gt;
    yourLoadBalancer
  &lt;/load-balancer&gt;
  ...
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
clientConfig.setLoadBalancer(yourLoadBalancer);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configuring-client-listeners"><a class="anchor" href="#configuring-client-listeners"></a><a class="link" href="#configuring-client-listeners">Configuring Client Listeners</a></h5>
<div class="paragraph">
<p>You can configure global event listeners using <code>ListenerConfig</code> as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
ListenerConfig listenerConfig = <span class="keyword">new</span> ListenerConfig(LifecycleListenerImpl);
clientConfig.addListenerConfig(listenerConfig);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
ListenerConfig listenerConfig = <span class="keyword">new</span> ListenerConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.example.MembershipListenerImpl</span><span class="delimiter">&quot;</span></span>);
clientConfig.addListenerConfig(listenerConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can add three types of event listeners.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LifecycleListener</p>
</li>
<li>
<p>MembershipListener</p>
</li>
<li>
<p>DistributedObjectListener</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="configuring-client-connection-strategy"><a class="anchor" href="#configuring-client-connection-strategy"></a><a class="link" href="#configuring-client-connection-strategy">Configuring Client Connection Strategy</a></h5>
<div class="paragraph">
<p>You can configure the client&#8217;s starting mode as async or sync using the configuration element <code>async-start</code>. When it is set to <code>true</code> (async), Hazelcast will create the client without waiting a connection to the cluster. In this case, the client instance throws an exception until it connects to the cluster. If it is <code>false</code>, the client will not be created until the cluster is ready to use clients and a connection with the cluster is established. Its default value is <code>false</code> (sync)</p>
</div>
<div class="paragraph">
<p>You can also configure how the client will reconnect to the cluster after a disconnection. This is configured using the configuration element <code>reconnect-mode</code>; it has three options (<code>OFF</code>, <code>ON</code> or <code>ASYNC</code>). The option <code>OFF</code> disables the reconnection. <code>ON</code> enables reconnection in a blocking manner where all the waiting invocations will be blocked until a cluster connection is established or failed.
The option <code>ASYNC</code> enables reconnection in a non-blocking manner where all the waiting invocations will receive a <code>HazelcastClientOfflineException</code>. Its default value is <code>ON</code>.</p>
</div>
<div class="paragraph">
<p>The example declarative and programmatic configurations below show how to configure a Java client&#8217;s starting and reconnecting modes.</p>
</div>
<div class="paragraph">
<p><strong>Declarative</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast-client&gt;
  ...
  &lt;connection-strategy async-start=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> reconnect-mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">ASYNC</span><span class="delimiter">&quot;</span></span> /&gt;
  ...
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
clientConfig.getConnectionStrategyConfig()
            .setAsyncStart(<span class="predefined-constant">true</span>)
            .setReconnectMode(ClientConnectionStrategyConfig.ReconnectMode.ASYNC);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configuring-client-connection-retry"><a class="anchor" href="#configuring-client-connection-retry"></a><a class="link" href="#configuring-client-connection-retry">Configuring Client Connection Retry</a></h5>
<div class="paragraph">
<p>When the client tries to connect to a cluster, it considers the <a href="#setting-connection-attempt-limit">connection attempt limit</a> and
<a href="#setting-connection-attempt-period">connection attempt period</a>. When the client cannot connect to any member in the member list, it waits for <code>connection-attempt-period</code> between each attempt until the count of attempts reach <code>connection-attempt-limit</code>.</p>
</div>
<div class="paragraph">
<p>With the connection retry configuration, you can fine tune this connection behavior. When this configuration is enabled,
<code>connection-attempt-period</code> and <code>connection-attempt-limit</code> are ignored.
This configuration is used when trying to establish the initial connection and any time when the connection to cluster is broken.</p>
</div>
<div class="paragraph">
<p>Connection retry configuration is done using the <code>connection-retry</code> element when configuring declaratively or the object <code>ConnectionRetryConfig</code> when configuring programmatically. Below are the example configurations for each.</p>
</div>
<div class="paragraph">
<p><strong>Declarative</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast-client&gt;
  ...
   &lt;connection-strategy async-start=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> reconnect-mode=<span class="string"><span class="delimiter">&quot;</span><span class="content">ON</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;connection-retry enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;initial-backoff-millis&gt;<span class="integer">1000</span>&lt;/initial-backoff-millis&gt;
            &lt;max-backoff-millis&gt;<span class="integer">60000</span>&lt;/max-backoff-millis&gt;
            &lt;multiplier&gt;<span class="integer">2</span>&lt;/multiplier&gt;
            &lt;fail-on-max-backoff&gt;<span class="predefined-constant">true</span>&lt;/fail-on-max-backoff&gt;
            &lt;jitter&gt;<span class="float">0.5</span>&lt;/jitter&gt;
        &lt;/connection-retry&gt;
   &lt;/connection-strategy&gt;
  ...
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig config = <span class="keyword">new</span> ClientConfig();
ClientConnectionStrategyConfig connectionStrategyConfig = config.getConnectionStrategyConfig();
ConnectionRetryConfig connectionRetryConfig = connectionStrategyConfig.getConnectionRetryConfig();
connectionRetryConfig.setInitialBackoffMillis(<span class="integer">1000</span>)
                     .setMaxBackoffMillis(<span class="integer">60000</span>)
                     .setMultiplier(<span class="integer">2</span>)
                     .setFailOnMaxBackoff(<span class="predefined-constant">true</span>)
                     .setJitter(<span class="float">0.2</span>)
                     .setEnabled(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are configuration element descriptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial-backoff-millis</code>:  Specifies how long to wait (backoff) after the first failure before retrying in milliseconds. Its default value is 1000 ms.</p>
</li>
<li>
<p><code>max-backoff-millis</code>: Specifies the upper limit for the backoff in milliseconds. Its default value is 30000 ms.</p>
</li>
<li>
<p><code>multiplier</code>: Factor to multiply the backoff after a failed retry. Its default value is 2.</p>
</li>
<li>
<p><code>fail-on-max-backoff</code>: Specifies whether to fail when the <code>max-backoff-millis</code> has reached or continue waiting <code>max-backoff-millis</code> at each iteration. Its default value is false.</p>
</li>
<li>
<p><code>jitter</code>: Specifies by how much to randomize backoffs. Its default value is 0.2.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A pseudo-code is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">current_backoff_millis = INITIAL_BACKOFF_MILLIS
<span class="keyword">while</span> (TryConnect(connectionTimeout)) != SUCCESS)
   <span class="keyword">if</span> (fail-on-max-backoff &amp;&amp; current_backoff_millis &gt;= MAX_BACKOFF_MILLIS) {
       FAIL WITH EXCEPTION
   }
   randomizedSleepMillis = UniformRandom(-JITTER * current_backoff_millis, JITTER * current_backoff_millis)
   Sleep(randomizedSleepMillis)
   current_backoff = Min(current_backoff_millis * MULTIPLIER, MAX_BACKOFF_MILLIS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, <code>TryConnect</code> above tries to connect any member that the client knows of, and for each connection we have a connection timeout, see the <a href="#setting-connection-timeout">Setting Connection Timeout section</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="other-configurations"><a class="anchor" href="#other-configurations"></a><a class="link" href="#other-configurations">Other Configurations</a></h5>
<div class="sect5">
<h6 id="configuring-client-near-cache"><a class="anchor" href="#configuring-client-near-cache"></a><a class="link" href="#configuring-client-near-cache">Configuring Client Near Cache</a></h6>
<div class="paragraph">
<p>The Hazelcast distributed map supports a local Near Cache for remotely stored entries to increase the performance of local read operations. Since the client always requests data from the cluster members, it can be helpful in some use cases to configure a Near Cache on the client side. Please refer to the <a href="#near-cache">Near Cache section</a> for a detailed explanation of the Near Cache feature and its configuration.</p>
</div>
</div>
<div class="sect5">
<h6 id="client-group-configuration"><a class="anchor" href="#client-group-configuration"></a><a class="link" href="#client-group-configuration">Client Group Configuration</a></h6>
<div class="paragraph">
<p>Clients should provide a group name and password in order to connect to the cluster.
You can configure them using <code>GroupConfig</code>, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">clientConfig.setGroupConfig(<span class="keyword">new</span> GroupConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">dev-pass</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="client-security-configuration"><a class="anchor" href="#client-security-configuration"></a><a class="link" href="#client-security-configuration">Client Security Configuration</a></h6>
<div class="paragraph">
<p>In the cases where the security established with <code>GroupConfig</code> is not enough and you want your clients connecting securely to the cluster, you can use <code>ClientSecurityConfig</code>. This configuration has a <code>credentials</code> parameter to set the IP address and UID. Please see <code>ClientSecurityConfig.java</code> in our code.</p>
</div>
</div>
<div class="sect5">
<h6 id="client-serialization-configuration"><a class="anchor" href="#client-serialization-configuration"></a><a class="link" href="#client-serialization-configuration">Client Serialization Configuration</a></h6>
<div class="paragraph">
<p>For the client side serialization, use Hazelcast configuration. Please refer to the <a href="#serialization ">Serialization chapter</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="executorpoolsize"><a class="anchor" href="#executorpoolsize"></a><a class="link" href="#executorpoolsize">ExecutorPoolSize</a></h6>
<div class="paragraph">
<p>Hazelcast has an internal executor service (different from the data structure <strong>Executor Service</strong>) that has threads and queues to perform internal operations such as handling responses. This parameter specifies the size of the pool of threads which perform these operations laying in the executor&#8217;s queue. If not configured, this parameter has the value as <strong>5 \* <strong>core size of the client</strong></strong> (i.e. it is 20 for a machine that has 4 cores).</p>
</div>
</div>
<div class="sect5">
<h6 id="classloader"><a class="anchor" href="#classloader"></a><a class="link" href="#classloader">ClassLoader</a></h6>
<div class="paragraph">
<p>You can configure a custom <code>classLoader</code>. It will be used by the serialization service and to load any class configured in configuration, such as event listeners or ProxyFactories.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring-reliable-topic-at-client-side"><a class="anchor" href="#configuring-reliable-topic-at-client-side"></a><a class="link" href="#configuring-reliable-topic-at-client-side">Configuring Reliable Topic at Client Side</a></h6>
<div class="paragraph">
<p>Normally when a client uses a Hazelcast data structure, that structure is configured at the member side and the client makes use of that configuration. For the Reliable Topic structure, this is not the case; since it is backed by Ringbuffer, you should configure it at the client side. The class used for this configuration is <code>ClientReliableTopicConfig</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example programmatic configuration snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in hazelcast_clients.adoc - include::{javasource}/clients/SampleRTClient.java[tag=rtclient]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, when you create a Reliable Topic structure at your client, a Ringbuffer (with the same name as the Reliable Topic) is automatically created at the member side, with its default configuration. Please see the <a href="#ringbuffer">Configuring Ringbuffer section</a> for the defaults. You can edit that configuration according to your needs.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="java-client-failure-detectors"><a class="anchor" href="#java-client-failure-detectors"></a><a class="link" href="#java-client-failure-detectors">16.1.3. Java Client Failure Detectors</a></h4>
<div class="paragraph">
<p>The client failure detectors are responsible to determine if a member in the cluster is unreachable or crashed. The most important problem in the failure detection is to distinguish whether a member is still alive but slow, or has crashed. But according to the famous <a href="http://dl.acm.org/citation.cfm?doid=3149.214121">FLP result</a>, it is impossible to distinguish a crashed member from a slow one in an asynchronous system. A workaround to this limitation is to use unreliable failure detectors. An unreliable failure detector allows a member to suspect that others have failed, usually based on liveness criteria but it can make mistakes to a certain degree.</p>
</div>
<div class="paragraph">
<p>Hazelcast Java client has two built-in failure detectors: Deadline Failure Detector and Ping Failure Detector. These client failure detectors work independently from the member failure detectors, e.g., you do not need to enable the member failure detectors to benefit from the client ones.</p>
</div>
<div class="sect4">
<h5 id="client-deadline-failure-detector"><a class="anchor" href="#client-deadline-failure-detector"></a><a class="link" href="#client-deadline-failure-detector">Client Deadline Failure Detector</a></h5>
<div class="paragraph">
<p><em>Deadline Failure Detector</em> uses an absolute timeout for missing/lost heartbeats. After timeout, a member is considered as crashed/unavailable and marked as suspected.</p>
</div>
<div class="paragraph">
<p><em>Deadline Failure Detector</em> has two configuration properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.client.heartbeat.interval</code>: This is the interval at which client sends heartbeat messages to members.</p>
</li>
<li>
<p><code>hazelcast.client.heartbeat.timeout</code>: This is the timeout which defines when a cluster member is suspected, because it has not sent any response back to client requests.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The value of <code>hazelcast.client.heartbeat.interval</code> should be smaller than that of <code>hazelcast.client.heartbeat.timeout</code>. In addition, the value of system property <a href="#client-max-no">hazelcast.client.max.no.heartbeat.seconds</a>, which is set at the member side, should be larger than that of <code>hazelcast.client.heartbeat.interval</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following is a declarative example showing how you can configure the Deadline Failure Detector for your client (in the client&#8217;s  configuration XML file, e.g., <code>hazelcast-client.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast-client&gt;
    [...]
        &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.client.heartbeat.timeout</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">60000</span>&lt;/property&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.client.heartbeat.interval</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">5000</span>&lt;/property&gt;
        [...]
    &lt;/properties&gt;
    [...]
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, the following is the equivalent programmatic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig config = ...;
config.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.client.heartbeat.timeout</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span>);
config.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.client.heartbeat.interval</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span>);
[...]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="client-ping-failure-detector"><a class="anchor" href="#client-ping-failure-detector"></a><a class="link" href="#client-ping-failure-detector">Client Ping Failure Detector</a></h5>
<div class="paragraph">
<p>In addition to the Deadline Failure Detector, the Ping Failure Detector may be configured on your client. Please note that this detector is disabled by default. The Ping Failure Detector operates at Layer 3 of the OSI protocol and provides much quicker and more deterministic detection of hardware and other lower level events.
When the JVM process has enough permissions to create RAW sockets, the implementation will choose to rely on ICMP Echo requests. This is preferred.</p>
</div>
<div class="paragraph">
<p>If there are not enough permissions, it can be configured to fallback on attempting a TCP Echo on port 7. In the latter case, both a successful connection or an explicit rejection will be treated as "Host is Reachable". Or, it can be forced to use only RAW sockets. This is not preferred as each call creates a heavy weight socket and moreover the Echo service is typically disabled.</p>
</div>
<div class="paragraph">
<p>For the Ping Failure Detector to rely <strong>only</strong> on ICMP Echo requests, there are some criteria that need to be met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Supported OS: as of Java 1.8 only Linux/Unix environments are supported.</p>
</li>
<li>
<p>The Java executable must have the <code>cap_net_raw</code> capability.</p>
</li>
<li>
<p>The file <code>ld.conf</code> must be edited to overcome the rejection by the dynamic linker when loading libs from untrusted paths.</p>
</li>
<li>
<p>ICMP Echo Requests must not be blocked by the receiving hosts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The details of these requirements are explained in the <a href="#requirements-and-linuxunix-configuration">Requirements section</a> of Hazelcast members' <a href="#ping-failure-detector">Ping Failure Detector</a>.</p>
</div>
<div class="paragraph">
<p>If any of the above criteria isn&#8217;t met, then the <code>isReachable</code> will always fallback on TCP Echo attempts on port 7.</p>
</div>
<div class="paragraph">
<p>An example declarative configuration to use the Ping Failure Detector is as follows (in the client&#8217;s  configuration XML file, e.g., <code>hazelcast-client.xml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast-client&gt;
    [...]
    &lt;network&gt;
        [...]
        &lt;icmp-ping enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;timeout-milliseconds&gt;<span class="integer">1000</span>&lt;/timeout-milliseconds&gt;
            &lt;interval-milliseconds&gt;<span class="integer">1000</span>&lt;/interval-milliseconds&gt;
            &lt;ttl&gt;<span class="integer">255</span>&lt;ttl&gt;
            &lt;echo-fail-fast-on-startup&gt;<span class="predefined-constant">false</span>&lt;/echo-fail-fast-on-startup&gt;
            &lt;max-attempts&gt;<span class="integer">2</span>&lt;/max-attempts&gt;
        &lt;/icmp-ping&gt;
        [...]
    &lt;/network&gt;
    [...]
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, the equivalent programmatic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig config = ...;

ClientNetworkConfig networkConfig = clientConfig.getNetworkConfig();
ClientIcmpPingConfig clientIcmpPingConfig = networkConfig.getClientIcmpPingConfig();
clientIcmpPingConfig.setIntervalMilliseconds(<span class="integer">1000</span>)
        .setTimeoutMilliseconds(<span class="integer">1000</span>)
        .setTtl(<span class="integer">255</span>)
        .setMaxAttempts(<span class="integer">2</span>)
        .setEchoFailFastOnStartup(<span class="predefined-constant">false</span>)
        .setEnabled(<span class="predefined-constant">true</span>);
[...]</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Enables the legacy ICMP detection mode, works cooperatively with the existing failure detector and only kicks-in after a pre-defined period has passed with no heartbeats from a member. Its default value is <code>false</code>.</p>
</li>
<li>
<p><code>timeout-milliseconds</code>: Number of milliseconds until a ping attempt is considered failed if there was no reply. Its default value is <strong>1000</strong> milliseconds.</p>
</li>
<li>
<p><code>max-attempts</code>: Maximum number of ping attempts before the member gets suspected by the detector. Its default value is <strong>3</strong>.</p>
</li>
<li>
<p><code>interval-milliseconds</code>: Interval, in milliseconds, between each ping attempt. 1000ms (1 sec) is also the minimum interval allowed. Its default value is <strong>1000</strong> milliseconds.</p>
</li>
<li>
<p><code>ttl</code>: Maximum number of hops the packets should go through. Its default value is <strong>255</strong>. You can set to <strong>0</strong> to use your system&#8217;s default TTL.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the above example configuration, the Ping Failure Detector will attempt 2 pings, one every second and will wait up to 1 second for each to complete. If there is no successful ping after 2 seconds, the member will get suspected.</p>
</div>
<div class="paragraph">
<p>To enforce the <a href="#requirements-and-linuxunix-configuration">Requirements</a>, the property <code>echo-fail-fast-on-startup</code> can also be set to <code>true</code>, in which case Hazelcast will fail to start if any of the requirements
isn&#8217;t met.</p>
</div>
<div class="paragraph">
<p>Unlike the Hazelcast members, Ping Failure Detector works always in parallel with Deadline Failure Detector on the clients.
Below is a summary table of all possible configuration combinations of the Ping Failure Detector.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ICMP</th>
<th class="tableblock halign-left valign-top">Fail-Fast</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Linux</th>
<th class="tableblock halign-left valign-top">Windows</th>
<th class="tableblock halign-left valign-top">macOS</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parallel ping detector, works in parallel with the configured failure detector. Checks periodically if members are live (OSI Layer 3) and suspects them immediately, regardless of the other detectors.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported  ICMP Echo if available - Falls back on TCP Echo on port 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported  TCP Echo on port 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported  ICMP Echo if available - Falls back on TCP Echo on port 7</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parallel ping detector, works in parallel with the configured failure detector. Checks periodically if members are live (OSI Layer 3) and suspects them immediately, regardless of the other detectors.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supported - Requires OS Configuration  Enforcing ICMP Echo if available - No start up if not available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not Supported - Requires root privileges</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="client-system-properties"><a class="anchor" href="#client-system-properties"></a><a class="link" href="#client-system-properties">16.1.4. Client System Properties</a></h4>
<div class="paragraph">
<p>There are some advanced client configuration properties to tune some aspects of Hazelcast Client. You can set them as property name and value pairs through declarative configuration, programmatic configuration, or JVM system property. Please see the <a href="#system-properties">System Properties appendix</a> to learn how to set these properties.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you want to reconfigure a system property, you need to restart the members for which the property is modified.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The table below lists the client configuration properties with their descriptions.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.client.event.queue.capacity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value of the capacity of executor that handles incoming event packets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.client.event.thread.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Thread count for handling incoming event packets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.client.heartbeat.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frequency of heartbeat messages sent by the clients to members.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.client.heartbeat.timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout for the heartbeat messages sent by the client to members. If no messages pass between client and member within the given time via this property in milliseconds, the connection will be closed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.client.max.concurrent.invocations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer.MAX_VALUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum allowed number of concurrent invocations. You can apply a constraint on the number of concurrent invocations in order to prevent the system from overloading. If the maximum number of concurrent invocations is exceeded and a new invocation comes in, Hazelcast throws <code>HazelcastOverloadException</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.client.invocation.timeout.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period, in seconds, to give up the invocation when a member in the member list is not reachable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.client.shuffle.member.list</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The client shuffles the given member list to prevent all clients to connect to the same member when this property is <code>true</code>. When it is set to <code>false</code>, the client tries to connect to the members in the given order.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.compatibility.3.6.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When this property is true, if the client cannot know the server version, it will assume that the server has the version 3.6.x.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.invalidation.max.tolerated.miss.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If missed invalidation count is bigger than this value, relevant cached data will be made unreachable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.invalidation.reconciliation.interval.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period, in seconds, for which the clients are scanned to compare generated invalidation events with the received ones from Near Cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.client.statistics.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, it enables collecting the client statistics and sending them to the cluster. When it is <code>true</code> you can monitor the clients that are connected to your Hazelcast cluster, using Hazelcast Management Center. Please refer to the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#monitoring-clients">Monitoring Clients section</a> in the Hazelcast Management Center Reference Manual for more information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.client.statistics.period.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period in seconds the client statistics are collected and sent to the cluster. Please refer to the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#monitoring-clients">Monitoring Clients section</a> in the Hazelcast Management Center Reference Manual for more information. on the client statistics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.client.responsequeue.idlestrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the response thread for internal operations at the client side will be blocked or not. If you use <code>block</code> (the default value) the thread will be blocked and need to be notified which can cause a reduction in the performance. If you use <code>backoff</code> there will be no blocking. By enabling the backoff mode and depending on your use case, you can get a 5-10% performance improvement. However, keep in mind that this will increase CPU utilization. We recommend you to use backoff with care and if you have a tool for measuring your cluster&#8217;s performance.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="using-high-density-memory-store-with-java-client"><a class="anchor" href="#using-high-density-memory-store-with-java-client"></a><a class="link" href="#using-high-density-memory-store-with-java-client">16.1.5. Using High-Density Memory Store with Java Client</a></h4>
<div class="paragraph">
<p><strong class="navy">Hazelcast IMDG Enterprise HD</strong></p>
</div>
<div class="paragraph">
<p>If you have <strong class="navy">Hazelcast IMDG Enterprise HD</strong>, your Hazelcast Java client&#8217;s Near Cache can benefit from the High-Density Memory Store.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s recall the Java client&#8217;s Near Cache configuration (please see the <a href="#configuring-client-near-cache">Configuring Client Near Cache section</a>) <strong>without</strong> High-Density Memory Store:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;/hazelcast-client&gt;
    ...
    ...
    &lt;near-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">MENU</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;max-size&gt;<span class="integer">2000</span>&lt;/max-size&gt;
        &lt;time-to-live-seconds&gt;<span class="integer">0</span>&lt;/time-to-live-seconds&gt;
        &lt;max-idle-seconds&gt;<span class="integer">0</span>&lt;/max-idle-seconds&gt;
        &lt;eviction-policy&gt;LFU&lt;/eviction-policy&gt;
        &lt;invalidate-on-change&gt;<span class="predefined-constant">true</span>&lt;/invalidate-on-change&gt;
        &lt;in-memory-format&gt;OBJECT&lt;/in-memory-format&gt;
    &lt;/near-cache&gt;
    ...
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can configure this Near Cache to use Hazelcast&#8217;s High-Density Memory Store by setting the in-memory format to NATIVE. Please see the following configuration example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;/hazelcast-client&gt;
    ...
    ...
    &lt;near-cache&gt;
       ...
       &lt;time-to-live-seconds&gt;<span class="integer">0</span>&lt;/time-to-live-seconds&gt;
       &lt;max-idle-seconds&gt;<span class="integer">0</span>&lt;/max-idle-seconds&gt;
       &lt;invalidate-on-change&gt;<span class="predefined-constant">true</span>&lt;/invalidate-on-change&gt;
       &lt;in-memory-format&gt;NATIVE&lt;/in-memory-format&gt;
       &lt;eviction size=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTRY_COUNT</span><span class="delimiter">&quot;</span></span> eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">LFU</span><span class="delimiter">&quot;</span></span>/&gt;
       ...
    &lt;/near-cache&gt;
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please notice that when the in-memory format is NATIVE, i.e., High-Density Memory Store is enabled, the configuration element <code>&lt;eviction&gt;</code> is used to specify the eviction behavior of your client&#8217;s Near Cache. In this case, the elements <code>&lt;max-size&gt;</code> and <code>&lt;eviction-policy&gt;</code> used in the configuration of a Near Cache without High-Density Memory Store do not have any impact.</p>
</div>
<div class="paragraph">
<p>The element <code>&lt;eviction&gt;</code> has the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>size</code>: Maximum size (entry count) of the Near Cache.</p>
</li>
<li>
<p><code>max-size-policy</code>: Maximum size policy for eviction of the Near Cache. Available values are as follows:</p>
<div class="ulist">
<ul>
<li>
<p>ENTRY_COUNT: Maximum entry count per member.</p>
</li>
<li>
<p>USED_NATIVE_MEMORY_SIZE: Maximum used native memory size in megabytes.</p>
</li>
<li>
<p>USED_NATIVE_MEMORY_PERCENTAGE: Maximum used native memory percentage.</p>
</li>
<li>
<p>FREE_NATIVE_MEMORY_SIZE: Minimum free native memory size to trigger cleanup.</p>
</li>
<li>
<p>FREE_NATIVE_MEMORY_PERCENTAGE: Minimum free native memory percentage to trigger cleanup.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>eviction-policy</code>: Eviction policy configuration. Its default values is NONE. Available values are as follows:</p>
<div class="ulist">
<ul>
<li>
<p>NONE: No items will be evicted and the property max-size will be ignored. You still can combine it with time-to-live-seconds.</p>
</li>
<li>
<p>LRU: Least Recently Used.</p>
</li>
<li>
<p>LFU: Least Frequently Used.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Keep in mind that you should have already enabled the High-Density Memory Store usage for your client, using the <code>&lt;native-memory&gt;</code> element in the client&#8217;s configuration.</p>
</div>
<div class="paragraph">
<p>Please see the <a href="#high-density-memory-store">High-Density Memory Store section</a> for more information on Hazelcast&#8217;s High-Density Memory Store feature.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="c-client"><a class="anchor" href="#c-client"></a><a class="link" href="#c-client">16.2. C++ Client</a></h3>
<div class="paragraph">
<p>You can use the native C++ client to connect to Hazelcast cluster members and perform almost all operations that a member can perform. Clients differ from members in that clients do not hold data. The C++ client is by default a smart client, i.e., it knows where the data is and asks directly for the correct member. You can disable this feature (using the <code>ClientConfig::setSmart</code> method) if you do not want the clients to connect to every member.</p>
</div>
<div class="paragraph">
<p>The features of C++ clients are listed below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to distributed data structures (IMap, IQueue, MultiMap, ITopic, etc.).</p>
</li>
<li>
<p>Access to transactional distributed data structures (TransactionalMap, TransactionalQueue, etc.).</p>
</li>
<li>
<p>Ability to add cluster listeners to a cluster and entry/item listeners to distributed data structures.</p>
</li>
<li>
<p>Distributed synchronization mechanisms with ILock, ISemaphore and ICountDownLatch.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to C++ client&#8217;s own GitHub <a href="https://github.com/hazelcast/hazelcast-cpp-client">repo</a> for information on setting the client up, installing and compiling it, its serialization support and APIs such as raw pointer and query.</p>
</div>
</div>
<div class="sect2">
<h3 id="net-client"><a class="anchor" href="#net-client"></a><a class="link" href="#net-client">16.3. .NET Client</a></h3>
<div class="paragraph">
<p>You can use the native .NET client to connect to Hazelcast client members. You need to add <code>HazelcastClient3x.dll</code> into your .NET project references. The API is very similar to the Java native client.</p>
</div>
<div class="paragraph">
<p>Please refer to .NET client&#8217;s own GitHub repo at <a href="https://github.com/hazelcast/hazelcast-csharp-client">Hazelcast .NET Client</a> for information on configuring and starting the client.</p>
</div>
</div>
<div class="sect2">
<h3 id="rest-client"><a class="anchor" href="#rest-client"></a><a class="link" href="#rest-client">16.4. REST Client</a></h3>
<div class="paragraph">
<p>Hazelcast provides a REST interface, i.e. it provides an HTTP service in each cluster member so that you can access your <code>map</code> and <code>queue</code> using HTTP protocol. Assuming <code>mapName</code> and <code>queueName</code> are already configured in your Hazelcast, its structure is shown below.</p>
</div>
<div class="paragraph">
<p><code><a href="http://member" class="bare">http://member</a> IP address:port/hazelcast/rest/maps/mapName/key</code></p>
</div>
<div class="paragraph">
<p><code><a href="http://member" class="bare">http://member</a> IP address:port/hazelcast/rest/queues/queueName</code></p>
</div>
<div class="paragraph">
<p>For the operations to be performed, standard REST conventions for HTTP calls are used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
REST client request listener service is not enabled by default. You should enable it on your cluster members to use REST client. It can be enabled using the system property <code>hazelcast.rest.enabled</code>. Please refer to the <a href="#system-properties">System Properties appendix</a> for the definition of this property and how to set a system property.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="rest-client-get-post-delete-examples"><a class="anchor" href="#rest-client-get-post-delete-examples"></a><a class="link" href="#rest-client-get-post-delete-examples">16.4.1. REST Client GET/POST/DELETE Examples</a></h4>
<div class="paragraph">
<p>In the following GET, POST and DELETE examples, assume that your cluster members are as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Members [<span class="integer">5</span>] {
  <span class="predefined-type">Member</span> [<span class="float">10.20</span><span class="float">.17</span><span class="float">.1</span>:<span class="integer">5701</span>]
  <span class="predefined-type">Member</span> [<span class="float">10.20</span><span class="float">.17</span><span class="float">.2</span>:<span class="integer">5701</span>]
  <span class="predefined-type">Member</span> [<span class="float">10.20</span><span class="float">.17</span><span class="float">.4</span>:<span class="integer">5701</span>]
  <span class="predefined-type">Member</span> [<span class="float">10.20</span><span class="float">.17</span><span class="float">.3</span>:<span class="integer">5701</span>]
  <span class="predefined-type">Member</span> [<span class="float">10.20</span><span class="float">.17</span><span class="float">.5</span>:<span class="integer">5701</span>]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All of the requests below can return one of the following responses in case of a failure.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the HTTP request syntax is not known, the following response will be returned.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HTTP/<span class="float">1.1</span> <span class="integer">400</span> Bad Request
Content-Length: <span class="integer">0</span></code></pre>
</div>
</div>
</li>
<li>
<p>In case of an unexpected exception, the following response will be returned.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt; HTTP/<span class="float">1.1</span> <span class="integer">500</span> Internal Server <span class="exception">Error</span>
&lt; Content-Length: <span class="integer">0</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="creating-updating-entries-in-a-map-for-rest-client"><a class="anchor" href="#creating-updating-entries-in-a-map-for-rest-client"></a><a class="link" href="#creating-updating-entries-in-a-map-for-rest-client">Creating/Updating Entries in a Map for REST Client</a></h5>
<div class="paragraph">
<p>You can put a new <code>key1/value1</code> entry into a map by using POST call to
<code><a href="http://10.20.17.1:5701/hazelcast/" class="bare">http://10.20.17.1:5701/hazelcast/</a>
rest/maps/mapName/key1</code> URL. This call&#8217;s content body should contain the value of the key. Also, if the call contains the MIME type, Hazelcast stores this information, too.</p>
</div>
<div class="paragraph">
<p>A sample POST call is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">$ curl -v -X POST -H &quot;Content-Type: text/plain&quot; -d &quot;bar&quot;
    http://10.20.17.1:5701/hazelcast/rest/maps/mapName/foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will return the following response if successful:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/plain
&lt; Content-Length: 0</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="retrieving-entries-from-a-map-for-rest-client"><a class="anchor" href="#retrieving-entries-from-a-map-for-rest-client"></a><a class="link" href="#retrieving-entries-from-a-map-for-rest-client">Retrieving Entries from a Map for REST Client</a></h5>
<div class="paragraph">
<p>If you want to retrieve an entry, you can use a GET call to <code><a href="http://10.20.17.1:5701/hazelcast/rest/maps/mapName/key1" class="bare">http://10.20.17.1:5701/hazelcast/rest/maps/mapName/key1</a></code>. You can also retrieve this entry from another member of your cluster, such as
<code><a href="http://10.20.17.3:5701/hazelcast/rest/" class="bare">http://10.20.17.3:5701/hazelcast/rest/</a>
maps/mapName/key1</code>.</p>
</div>
<div class="paragraph">
<p>An example of a GET call is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">$ curl -X GET http://10.20.17.3:5701/hazelcast/rest/maps/mapName/foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will return the following response if there is a corresponding value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/plain
&lt; Content-Length: 3
bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>This GET call returned a value, its length and also the MIME type (<code>text/plain</code>) since the POST call example shown above included the MIME type.</p>
</div>
<div class="paragraph">
<p>It will return the following if there is no mapping for the given key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">&lt; HTTP/1.1 204 No Content
&lt; Content-Length: 0</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="removing-entries-from-a-map-for-rest-client"><a class="anchor" href="#removing-entries-from-a-map-for-rest-client"></a><a class="link" href="#removing-entries-from-a-map-for-rest-client">Removing Entries from a Map for REST Client</a></h5>
<div class="paragraph">
<p>You can use a DELETE call to remove an entry. A sample DELETE call is shown below with its response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">$ curl -v -X DELETE http://10.20.17.1:5701/hazelcast/rest/maps/mapName/foo</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt; HTTP/<span class="float">1.1</span> <span class="integer">200</span> OK
&lt; Content-<span class="predefined-type">Type</span>: text/plain
&lt; Content-Length: <span class="integer">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you leave the key empty as follows, DELETE will delete all entries from the map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">$ curl -v -X DELETE http://10.20.17.1:5701/hazelcast/rest/maps/mapName</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/plain
&lt; Content-Length: 0</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="offering-items-on-a-queue-for-rest-client"><a class="anchor" href="#offering-items-on-a-queue-for-rest-client"></a><a class="link" href="#offering-items-on-a-queue-for-rest-client">Offering Items on a Queue for REST Client</a></h5>
<div class="paragraph">
<p>You can use a POST call to create an item on the queue. A sample is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">$ curl -v -X POST -H &quot;Content-Type: text/plain&quot; -d &quot;foo&quot;
    http://10.20.17.1:5701/hazelcast/rest/queues/myEvents</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above call is equivalent to <code>HazelcastInstance.getQueue("myEvents").offer("foo");</code>.</p>
</div>
<div class="paragraph">
<p>It will return the following if successful:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/plain
&lt; Content-Length: 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will return the following if the queue is full and the item is not able to be offered to the queue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">&lt; HTTP/1.1 503 Service Unavailable
&lt; Content-Length: 0</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="retrieving-items-from-a-queue-for-rest-client"><a class="anchor" href="#retrieving-items-from-a-queue-for-rest-client"></a><a class="link" href="#retrieving-items-from-a-queue-for-rest-client">Retrieving Items from a Queue for REST Client</a></h5>
<div class="paragraph">
<p>You can use a DELETE call for retrieving items from a queue. Note that you should state the poll timeout while polling for queue events by an extra path parameter.</p>
</div>
<div class="paragraph">
<p>An example is shown below (<strong>10</strong> being the timeout value).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">$ curl -v -X DELETE \http://10.20.17.1:5701/hazelcast/rest/queues/myEvents/10</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above call is equivalent to <code>HazelcastInstance.getQueue("myEvents").poll(10, SECONDS);</code>. Below is the response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/plain
&lt; Content-Length: 3
foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the timeout is reached, the response will be <code>No Content</code> success, i.e. there is no item on the queue to be returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">&lt; HTTP/1.1 204 No Content
&lt; Content-Length: 0</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="getting-the-size-of-the-queue-for-rest-client"><a class="anchor" href="#getting-the-size-of-the-queue-for-rest-client"></a><a class="link" href="#getting-the-size-of-the-queue-for-rest-client">Getting the size of the queue for REST Client</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">$ curl -v -X GET \http://10.20.17.1:5701/hazelcast/rest/queues/myEvents/size</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above call is equivalent to <code>HazelcastInstance.getQueue("myEvents").size();</code>. Below is a sample response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">&lt; HTTP/1.1 200 OK
&lt; Content-Type: text/plain
&lt; Content-Length: 1
5</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="checking-the-status-of-the-cluster-for-rest-client"><a class="anchor" href="#checking-the-status-of-the-cluster-for-rest-client"></a><a class="link" href="#checking-the-status-of-the-cluster-for-rest-client">16.4.2. Checking the Status of the Cluster for REST Client</a></h4>
<div class="paragraph">
<p>Besides the above operations, you can check the status of your cluster, a sample of which is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">$ curl -v http://127.0.0.1:5701/hazelcast/rest/cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>The return will be similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">&lt; HTTP/1.1 200 OK
&lt; Content-Length: 119

Members [5] {
  Member [10.20.17.1:5701] this
  Member [10.20.17.2:5701]
  Member [10.20.17.4:5701]
  Member [10.20.17.3:5701]
  Member [10.20.17.5:5701]
}

ConnectionCount: 5
AllConnectionCount: 20</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p>RESTful access is provided through any member of your cluster. You can even put an HTTP load-balancer in front of your cluster members for load balancing and fault tolerance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You need to handle the failures on REST polls as there is no transactional guarantee.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="memcache-client"><a class="anchor" href="#memcache-client"></a><a class="link" href="#memcache-client">16.5. Memcache Client</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hazelcast Memcache Client only supports ASCII protocol. Binary Protocol is not supported.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A Memcache client written in any language can talk directly to a Hazelcast cluster. No additional configuration is required.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Memcache client request listener service is not enabled by default. You should enable it on your cluster members to use Memcache client. It can be enabled using the system property <code>hazelcast.memcache.enabled</code>. Please refer to the <a href="#system-properties">System Properties appendix</a> for the definition of this property and how to set a system property.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="memcache-client-code-examples"><a class="anchor" href="#memcache-client-code-examples"></a><a class="link" href="#memcache-client-code-examples">16.5.1. Memcache Client Code Examples</a></h4>
<div class="paragraph">
<p>Assume that your cluster members are as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="plain">Members [5] {
  Member [10.20.17.1:5701]
  Member [10.20.17.2:5701]
  Member [10.20.17.4:5701]
  Member [10.20.17.3:5701]
  Member [10.20.17.5:5701]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assume that you have a PHP application that uses PHP Memcache client to cache things in Hazelcast. All you need to do is have your PHP Memcache client connect to one of these members. It does not matter which member the client connects to because the Hazelcast cluster looks like one giant machine (Single System Image). Here is a PHP client code example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;?php
  <span class="error">$</span>memcache = <span class="keyword">new</span> Memcache;
  <span class="error">$</span>memcache-&gt;connect( <span class="string"><span class="delimiter">'</span><span class="content">10.20.17.1</span><span class="delimiter">'</span></span>, <span class="integer">5701</span> ) or die ( <span class="string"><span class="delimiter">&quot;</span><span class="content">Could not connect</span><span class="delimiter">&quot;</span></span> );
  <span class="error">$</span>memcache-&gt;set( <span class="string"><span class="delimiter">'</span><span class="content">key1</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">value1</span><span class="delimiter">'</span></span>, <span class="integer">0</span>, <span class="integer">3600</span> );
  <span class="error">$</span>get_result = <span class="error">$</span>memcache-&gt;get( <span class="string"><span class="delimiter">'</span><span class="content">key1</span><span class="delimiter">'</span></span> ); <span class="comment">// retrieve your data</span>
  var_dump( <span class="error">$</span>get_result ); <span class="comment">// show it</span>
?&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that Memcache client connects to <code>10.20.17.1</code> and uses port <code>5701</code>. Here is a Java client code example with SpyMemcached client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MemcachedClient client = <span class="keyword">new</span> MemcachedClient(
    AddrUtil.getAddresses( <span class="string"><span class="delimiter">&quot;</span><span class="content">10.20.17.1:5701 10.20.17.2:5701</span><span class="delimiter">&quot;</span></span> ) );
client.set( <span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, <span class="integer">3600</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span> );
<span class="predefined-type">System</span>.out.println( client.get( <span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span> ) );</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want your data to be stored in different maps, for example to utilize per map configuration, you can do that with a map name prefix as in the following example code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MemcachedClient client = <span class="keyword">new</span> MemcachedClient(
    AddrUtil.getAddresses( <span class="string"><span class="delimiter">&quot;</span><span class="content">10.20.17.1:5701 10.20.17.2:5701</span><span class="delimiter">&quot;</span></span> ) );
client.set( <span class="string"><span class="delimiter">&quot;</span><span class="content">map1:key1</span><span class="delimiter">&quot;</span></span>, <span class="integer">3600</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span> ); <span class="comment">// store to *hz_memcache_map1</span>
client.set( <span class="string"><span class="delimiter">&quot;</span><span class="content">map2:key1</span><span class="delimiter">&quot;</span></span>, <span class="integer">3600</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span> ); <span class="comment">// store to hz_memcache_map2</span>
<span class="predefined-type">System</span>.out.println( client.get( <span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span> ) ); <span class="comment">// get from hz_memcache_map1</span>
<span class="predefined-type">System</span>.out.println( client.get( <span class="string"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span> ) ); <span class="comment">// get from hz_memcache_map2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>hz_memcache prefix\_</strong> separates Memcache maps from Hazelcast maps. If no map name is given, it will be stored
in a default map named <strong>hz_memcache_default</strong>.</p>
</div>
<div class="paragraph">
<p>An entry written with a Memcache client can be read by another Memcache client written in another language.</p>
</div>
</div>
<div class="sect3">
<h4 id="unsupported-operations-for-memcache"><a class="anchor" href="#unsupported-operations-for-memcache"></a><a class="link" href="#unsupported-operations-for-memcache">16.5.2. Unsupported Operations for Memcache</a></h4>
<div class="ulist">
<ul>
<li>
<p>CAS operations are not supported. In operations that get CAS parameters, such as append, CAS values are ignored.</p>
</li>
<li>
<p>Only a subset of statistics are supported. Below is the list of supported statistic values.</p>
<div class="ulist">
<ul>
<li>
<p>cmd_set</p>
</li>
<li>
<p>cmd_get</p>
</li>
<li>
<p>incr_hits</p>
</li>
<li>
<p>incr_misses</p>
</li>
<li>
<p>decr_hits</p>
</li>
<li>
<p>decr_misses</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="other-client-and-language-implementations"><a class="anchor" href="#other-client-and-language-implementations"></a><a class="link" href="#other-client-and-language-implementations">16.6. Other Client and Language Implementations</a></h3>
<div class="paragraph">
<p>Please refer to <a href="https://hazelcast.org/clients-languages/">Feature Comparison Matrix</a> to see the features implemented across the clients and language APIs.</p>
</div>
<div class="sect3">
<h4 id="python-client"><a class="anchor" href="#python-client"></a><a class="link" href="#python-client">16.6.1. Python Client</a></h4>
<div class="paragraph">
<p>Python Client implementation for Hazelcast. It is implemented using the Hazelcast Open Binary Client Protocol.</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="http://hazelcast.github.io/hazelcast-python-client">Hazelcast Python Client</a> for its documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="node-js-client"><a class="anchor" href="#node-js-client"></a><a class="link" href="#node-js-client">16.6.2. Node.js Client</a></h4>
<div class="paragraph">
<p>Node.js Client implementation for Hazelcast. It is implemented using the Hazelcast Open Binary Client Protocol.</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://github.com/hazelcast/hazelcast-nodejs-client">Hazelcast Node.js Client</a> for its documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="go-client"><a class="anchor" href="#go-client"></a><a class="link" href="#go-client">16.6.3. Go Client</a></h4>
<div class="paragraph">
<p>Go Client implementation for Hazelcast. It is implemented using the Hazelcast Open Binary Client Protocol.</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://github.com/hazelcast/hazelcast-go-client">Go Client</a> for its documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="scala"><a class="anchor" href="#scala"></a><a class="link" href="#scala">16.6.4. Scala</a></h4>
<div class="paragraph">
<p>The API for Hazelcast Scala is based on Scala 2.11 and Hazelcast 3.6/3.7/3.8 releases. However, these are not hard dependencies provided that you include the relevant Hazelcast dependencies.</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://github.com/hazelcast/hazelcast-scala">Hazelcast Scala</a> for its documentation.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serialization"><a class="anchor" href="#serialization"></a><a class="link" href="#serialization">17. Serialization</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast needs to serialize the Java objects that you put into Hazelcast because Hazelcast is a distributed system. The data and its replicas are stored in different partitions on multiple cluster members. The data you need may not be present on the local member, and in that case, Hazelcast retrieves that data from another member. This requires serialization.</p>
</div>
<div class="paragraph">
<p>Hazelcast serializes all your objects into an instance of <code>com.hazelcast.nio.serialization.Data</code>. <code>Data</code> is the binary representation of an object.</p>
</div>
<div class="paragraph">
<p>Serialization is used in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding key/value objects to a map</p>
</li>
<li>
<p>Putting items in a queue/set/list</p>
</li>
<li>
<p>Sending a runnable using an executor service</p>
</li>
<li>
<p>Processing an entry within a map</p>
</li>
<li>
<p>Locking an object</p>
</li>
<li>
<p>Sending a message to a topic</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hazelcast optimizes the serialization for the basic types and their array types. You cannot override this behavior.</p>
</div>
<div class="paragraph">
<p><strong>Default Types</strong>;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Byte, Boolean, Character, Short, Integer, Long, Float, Double, String</p>
</li>
<li>
<p>byte[], boolean[], char[], short[], int[], long[], float[], double[], String[]</p>
</li>
<li>
<p><code>java.util.Date</code>, <code>java.math.BigInteger</code>, <code>java.math.BigDecimal</code>, <code>java.lang.Class</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hazelcast optimizes all of the above object types. You do not need to worry about their (de)serializations.</p>
</div>
<div class="sect2">
<h3 id="serialization-interface-types"><a class="anchor" href="#serialization-interface-types"></a><a class="link" href="#serialization-interface-types">17.1. Serialization Interface Types</a></h3>
<div class="paragraph">
<p>For complex objects, use the following interfaces for serialization and deserialization.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java.io.Serializable</code>: Please see the <a href="#implementing-java-serializable-and-externalizable">Implementing Java Serializable and Externalizable section</a>.</p>
</li>
<li>
<p><code>java.io.Externalizable</code>: Please see the <a href="#implementing-java-externalizable">Implementing Java Externalizable section</a>.</p>
</li>
<li>
<p><code>com.hazelcast.nio.serialization.DataSerializable</code>: Please see the <a href="#implementing-dataserializable">Implementing DataSerializable section</a>.</p>
</li>
<li>
<p><code>com.hazelcast.nio.serialization.IdentifiedDataSerializable</code>: Please see the <a href="#identifieddataserializable ">IdentifiedDataSerializable section</a>.</p>
</li>
<li>
<p><code>com.hazelcast.nio.serialization.Portable</code>: Please see the <a href="#implementing-portable-serialization">Implementing Portable Serialization section</a>.</p>
</li>
<li>
<p>Custom Serialization (using <a href="#implementing-streamserializer">StreamSerializer</a> and <a href="#implementing-bytearrayserializer">ByteArraySerializer</a>).</p>
</li>
<li>
<p>Global Serializer: Please see the <a href="#global-serializer">Global Serializer section</a> for details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When Hazelcast serializes an object into <code>Data</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It first checks whether the object is <code>null</code>.</p>
</li>
<li>
<p>If the above check fails, then Hazelcast checks if it is an instance of <code>com.hazelcast.nio.serialization.DataSerializable</code> or <code>com.hazelcast.nio.serialization.IdentifiedDataSerializable</code>.</p>
</li>
<li>
<p>If the above check fails, then Hazelcast checks if it is an instance of <code>com.hazelcast.nio.serialization.Portable</code>.</p>
</li>
<li>
<p>If the above check fails, then Hazelcast checks if it is an instance of one of the default types (see the <a href="#serialization">Serialization chapter introduction</a> for default types).</p>
</li>
<li>
<p>If the above check fails, then Hazelcast looks for a user-specified <a href="#custom-serialization">Custom Serializer</a>, i.e. an implementation of <code>ByteArraySerializer</code> or <code>StreamSerializer</code>. Custom serializer is searched using the input Object&#8217;s Class and its parent class up to Object. If parent class search fails, all interfaces implemented by the class are also checked (excluding <code>java.io.Serializable</code> and <code>java.io.Externalizable</code>).</p>
</li>
<li>
<p>If the above check fails, then Hazelcast checks if it is an instance of <code>java.io.Serializable</code> or <code>java.io.Externalizable</code> and a Global Serializer is not registered with Java Serialization Override feature.</p>
</li>
<li>
<p>If the above check fails, Hazelcast will use the registered Global Serializer if one exists.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If all of the above checks fail, then serialization will fail. When a class implements multiple interfaces, the above steps are important to determine the serialization mechanism that Hazelcast will use. When a class definition is required for any of these serializations, you need to have all the classes needed by the application on your classpath because Hazelcast does not download them automatically, unless you are using <a href="#member-user-code-deployment-beta">user code deployment</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="comparing-serialization-interfaces"><a class="anchor" href="#comparing-serialization-interfaces"></a><a class="link" href="#comparing-serialization-interfaces">17.2. Comparing Serialization Interfaces</a></h3>
<div class="paragraph">
<p>The table below provides a comparison between the interfaces listed in the previous section to help you in deciding which interface to use in your applications.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Serialization Interface</th>
<th class="tableblock halign-left valign-top">Advantages</th>
<th class="tableblock halign-left valign-top">Drawbacks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* A standard and basic Java interface</p>
<p class="tableblock">* Requires no implementation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* More time and CPU usage</p>
<p class="tableblock">* More space occupancy</p>
<p class="tableblock">* Not supported by Native clients</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Externalizable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* A standard Java interface</p>
<p class="tableblock">* More CPU and memory usage efficient than Serializable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* Serialization interface must be implemented</p>
<p class="tableblock">* Not supported by Native clients</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataSerializable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* More CPU and memory usage efficient than Serializable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* Specific to Hazelcast</p>
<p class="tableblock">*  Not supported by Native clients</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IdentifiedDataSerializable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* More CPU and memory usage efficient than Serializable</p>
<p class="tableblock">* Reflection is not used during deserialization</p>
<p class="tableblock">* Supported by all Native Clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* Specific to Hazelcast</p>
<p class="tableblock">* Serialization interface must be implemented</p>
<p class="tableblock">* A Factory and configuration must be implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Portable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* More CPU and memory usage efficient than Serializable</p>
<p class="tableblock">* Reflection is not used during deserialization</p>
<p class="tableblock">* Versioning is supported</p>
<p class="tableblock">* Partial deserialization is supported during Queries</p>
<p class="tableblock">* Supported by all Native Clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* Specific to Hazelcast</p>
<p class="tableblock">* Serialization interface must be implemented</p>
<p class="tableblock">* A Factory and configuration must be implemented</p>
<p class="tableblock">* Class definition is also sent with data but stored only once per class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom Serialization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* Does not require class to implement an interface</p>
<p class="tableblock">* Convenient and flexible</p>
<p class="tableblock">* Can be based on StreamSerializer ByteArraySerializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">* Serialization interface must be implemented</p>
<p class="tableblock">* Plug in and configuration is required</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Let&#8217;s dig into the details of the above serialization mechanisms in the following sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="implementing-java-serializable-and-externalizable"><a class="anchor" href="#implementing-java-serializable-and-externalizable"></a><a class="link" href="#implementing-java-serializable-and-externalizable">17.3. Implementing Java Serializable and Externalizable</a></h3>
<div class="paragraph">
<p>A class often needs to implement the <code>java.io.Serializable</code> interface; native Java serialization is the easiest way to do serialization.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at the example code below for Java Serializable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1L</span>;
    <span class="directive">private</span> <span class="predefined-type">String</span> surname;

    <span class="directive">public</span> Employee( <span class="predefined-type">String</span> surname ) {
        <span class="local-variable">this</span>.surname = surname;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the fields that are non-static and non-transient are automatically serialized. To eliminate class compatibility issues, it is recommended that you add a <code>serialVersionUID</code>, as shown above. Also, when you are using methods that perform byte-content comparisons, such as <code>IMap.replace()</code>, and if byte-content of equal objects is different, you may face unexpected behaviors. For example, if the class relies on a hash map, the <code>replace</code> method may fail. The reason for this is the hash map is a serialized data structure with unreliable byte-content.</p>
</div>
<div class="sect3">
<h4 id="implementing-java-externalizable"><a class="anchor" href="#implementing-java-externalizable"></a><a class="link" href="#implementing-java-externalizable">17.3.1. Implementing Java Externalizable</a></h4>
<div class="paragraph">
<p>Hazelcast also supports <code>java.io.Externalizable</code>. This interface offers more control on the way fields are serialized or deserialized. Compared to native Java serialization, it also can have a positive effect on performance. With <code>java.io.Externalizable</code>, there is no need to add <code>serialVersionUID</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at the example code below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">implements</span> <span class="predefined-type">Externalizable</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> surname;
    <span class="directive">public</span> Employee(<span class="predefined-type">String</span> surname) {
        <span class="local-variable">this</span>.surname = surname;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> readExternal( <span class="predefined-type">ObjectInput</span> in )
      <span class="directive">throws</span> <span class="exception">IOException</span>, <span class="exception">ClassNotFoundException</span> {
        <span class="local-variable">this</span>.surname = in.readUTF();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> writeExternal( <span class="predefined-type">ObjectOutput</span> out )
      <span class="directive">throws</span> <span class="exception">IOException</span> {
        out.writeUTF(surname);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You explicitly perform writing and reading of fields. Perform reading in the same order as writing.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implementing-dataserializable"><a class="anchor" href="#implementing-dataserializable"></a><a class="link" href="#implementing-dataserializable">17.4. Implementing DataSerializable</a></h3>
<div class="paragraph">
<p>As mentioned in <a href="#implementing-java-serializable-and-externalizable">Implementing Java Serializable &amp; Externalizable</a>, Java serialization is an easy mechanism. However, it does not control how fields are serialized or deserialized. Moreover, Java serialization can lead to excessive CPU loads since it keeps track of objects to handle the cycles and streams class descriptors. These are performance decreasing factors; thus, serialized data may not have an optimal size.</p>
</div>
<div class="paragraph">
<p>The <code>DataSerializable</code> interface of Hazelcast overcomes these issues. Here is an example of a class implementing the <code>com.hazelcast.nio.serialization.DataSerializable</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in serialization.adoc - include::{javasource}/serialization/Address.java[tag=address]</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="reading-and-writing-and-dataserializable"><a class="anchor" href="#reading-and-writing-and-dataserializable"></a><a class="link" href="#reading-and-writing-and-dataserializable">17.4.1. Reading and Writing and DataSerializable</a></h4>
<div class="paragraph">
<p>Let&#8217;s take a look at another example which encapsulates a <code>DataSerializable</code> field.</p>
</div>
<div class="paragraph">
<p>Since the <code>address</code> field itself is <code>DataSerializable</code>, it calls <code>address.writeData(out)</code> when writing and <code>address.readData(in)</code> when reading. Also note that you should have writing and reading of the fields occur
in the same order. When Hazelcast serializes a <code>DataSerializable</code>, it writes the <code>className</code> first. When Hazelcast deserializes it, <code>className</code> is used to instantiate the object using reflection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> <span class="directive">implements</span> DataSerializable {
    <span class="directive">private</span> <span class="predefined-type">String</span> firstName;
    <span class="directive">private</span> <span class="predefined-type">String</span> lastName;
    <span class="directive">private</span> <span class="type">int</span> age;
    <span class="directive">private</span> <span class="type">double</span> salary;
    <span class="directive">private</span> Address address; <span class="comment">//address itself is DataSerializable</span>

    <span class="directive">public</span> Employee() {}

    <span class="comment">//getters setters..</span>

    <span class="directive">public</span> <span class="type">void</span> writeData( ObjectDataOutput out ) <span class="directive">throws</span> <span class="exception">IOException</span> {
        out.writeUTF(firstName);
        out.writeUTF(lastName);
        out.writeInt(age);
        out.writeDouble (salary);
        address.writeData (out);
    }

    <span class="directive">public</span> <span class="type">void</span> readData( ObjectDataInput in ) <span class="directive">throws</span> <span class="exception">IOException</span> {
        firstName = in.readUTF();
        lastName = in.readUTF();
        age = in.readInt();
        salary = in.readDouble();
        address = <span class="keyword">new</span> Address();
        <span class="comment">// since Address is DataSerializable let it read its own internal state</span>
        address.readData(in);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, since the <code>address</code> field itself is <code>DataSerializable</code>, it calls <code>address.writeData(out)</code> when writing and <code>address.readData(in)</code> when reading. Also note that you should have writing and reading of the fields occur in the same order. While Hazelcast serializes a <code>DataSerializable</code>, it writes the <code>className</code> first. When Hazelcast deserializes it, <code>className</code> is used to instantiate the object using reflection.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since Hazelcast needs to create an instance during deserialization,<code>DataSerializable</code> class has a no-arg constructor.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>DataSerializable</code> is a good option if serialization is only needed for in-cluster communication.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>DataSerializable</code> is not supported by non-Java clients as it uses Java reflection. If you need non-Java clients, please use <a href="#identifieddataserializable">IdentifiedDataSerializable</a> or <a href="#implementing-portable-serialization">Portable</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="identifieddataserializable"><a class="anchor" href="#identifieddataserializable"></a><a class="link" href="#identifieddataserializable">17.4.2. IdentifiedDataSerializable</a></h4>
<div class="paragraph">
<p>For a faster serialization of objects, avoiding reflection and long class names, Hazelcast recommends you implement <code>com.hazelcast.nio.serialization.IdentifiedDataSerializable</code> which is a slightly better version of <code>DataSerializable</code>.</p>
</div>
<div class="paragraph">
<p><code>DataSerializable</code> uses reflection to create a class instance, as mentioned in <a href="#implementing-dataserializable">Implementing DataSerializable</a>. But <code>IdentifiedDataSerializable</code> uses a factory for this purpose and it is faster during deserialization, which requires new instance creations.</p>
</div>
<div class="sect4">
<h5 id="getid-and-getfactoryid-methods"><a class="anchor" href="#getid-and-getfactoryid-methods"></a><a class="link" href="#getid-and-getfactoryid-methods">getID and getFactoryId Methods</a></h5>
<div class="paragraph">
<p><code>IdentifiedDataSerializable</code> extends <code>DataSerializable</code> and introduces two new methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>int getId();</code></p>
</li>
<li>
<p><code>int getFactoryId();</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>IdentifiedDataSerializable</code> uses <code>getId()</code> instead of class name and it uses <code>getFactoryId()</code> to load the class when given the Id. To complete the implementation, you should also implement  <code>com.hazelcast.nio.serialization.DataSerializableFactory</code> and register it into <code>SerializationConfig</code>, which can be accessed from <code>Config.getSerializationConfig()</code>. Factory&#8217;s responsibility is to return an instance of the right <code>IdentifiedDataSerializable</code> object, given the Id. This is currently the most efficient way of Serialization that Hazelcast supports off the shelf.</p>
</div>
</div>
<div class="sect4">
<h5 id="implementing-identifieddataserializable"><a class="anchor" href="#implementing-identifieddataserializable"></a><a class="link" href="#implementing-identifieddataserializable">Implementing IdentifiedDataSerializable</a></h5>
<div class="paragraph">
<p>Let&#8217;s take a look at the following example code and configuration to see <code>IdentifiedDataSerializable</code> in action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span>
    <span class="directive">implements</span> IdentifiedDataSerializable {

    <span class="directive">private</span> <span class="predefined-type">String</span> surname;

    <span class="directive">public</span> Employee() {}

    <span class="directive">public</span> Employee( <span class="predefined-type">String</span> surname ) {
        <span class="local-variable">this</span>.surname = surname;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> readData( ObjectDataInput in )
      <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="local-variable">this</span>.surname = in.readUTF();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> writeData( ObjectDataOutput out )
      <span class="directive">throws</span> <span class="exception">IOException</span> {
        out.writeUTF( surname );
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getFactoryId() {
        <span class="keyword">return</span> EmployeeDataSerializableFactory.FACTORY_ID;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getId() {
        <span class="keyword">return</span> EmployeeDataSerializableFactory.EMPLOYEE_TYPE;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="predefined-type">String</span>.format( <span class="string"><span class="delimiter">&quot;</span><span class="content">Employee(surname=%s)</span><span class="delimiter">&quot;</span></span>, surname );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The methods <code>getId</code> and <code>getFactoryId</code> return a unique positive number within the <code>EmployeeDataSerializableFactory</code>. Now, let&#8217;s create an instance of this <code>EmployeeDataSerializableFactory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeDataSerializableFactory</span>
    <span class="directive">implements</span> DataSerializableFactory{

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> FACTORY_ID = <span class="integer">1</span>;

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> EMPLOYEE_TYPE = <span class="integer">1</span>;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> IdentifiedDataSerializable create(<span class="type">int</span> typeId) {
        <span class="keyword">if</span> ( typeId == EMPLOYEE_TYPE ) {
            <span class="keyword">return</span> <span class="keyword">new</span> Employee();
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only method you should implement is <code>create</code>, as seen in the above example. It is recommended that you use a <code>switch-case</code> statement instead of multiple <code>if-else</code> blocks if you have a lot of subclasses. Hazelcast throws an exception if null is returned for <code>typeId</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="registering-employeedataserializablefactory"><a class="anchor" href="#registering-employeedataserializablefactory"></a><a class="link" href="#registering-employeedataserializablefactory">Registering EmployeeDataSerializableFactory</a></h5>
<div class="paragraph">
<p>As the last step, you need to register <code>EmployeeDataSerializableFactory</code> declaratively (declare in the configuration file <code>hazelcast.xml</code>) as shown below. Note that <code>factory-id</code> has the same value of <code>FACTORY_ID</code> in the above code. This is crucial to enable Hazelcast to find the correct factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  ...
  &lt;serialization&gt;
    &lt;data-serializable-factories&gt;
      &lt;data-serializable-factory factory-id=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>&gt;
        EmployeeDataSerializableFactory
      &lt;/data-serializable-factory&gt;
    &lt;/data-serializable-factories&gt;
  &lt;/serialization&gt;
  ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="#serialization-configuration-wrap-up">Serialization Configuration Wrap-Up section</a> for a full description of Hazelcast Serialization configuration.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implementing-portable-serialization"><a class="anchor" href="#implementing-portable-serialization"></a><a class="link" href="#implementing-portable-serialization">17.5. Implementing Portable Serialization</a></h3>
<div class="paragraph">
<p>As an alternative to the existing serialization methods, Hazelcast offers a language/platform independent Portable serialization that has the following advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Supports multi-version of the same object type.</p>
</li>
<li>
<p>Fetches individual fields without having to rely on reflection.</p>
</li>
<li>
<p>Queries and indexing support without deserialization and/or reflection.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to support these features, a serialized Portable object contains meta information like the version and the concrete location of the each field in the binary data. This way, Hazelcast navigates in the <code>byte[]</code> and deserializes only the required field without actually deserializing the whole object. This improves the Query performance.</p>
</div>
<div class="paragraph">
<p>With multi-version support, you can have two cluster members where each has different versions of the same object. Hazelcast will store both meta information and use the correct one to serialize and deserialize Portable objects depending on the member. This is very helpful when you are doing a rolling upgrade without shutting down the cluster.</p>
</div>
<div class="paragraph">
<p>Portable serialization is totally language independent and is used as the binary protocol between Hazelcast server and clients.</p>
</div>
<div class="sect3">
<h4 id="portable-serialization-example-code"><a class="anchor" href="#portable-serialization-example-code"></a><a class="link" href="#portable-serialization-example-code">17.5.1. Portable Serialization Example Code</a></h4>
<div class="paragraph">
<p>Here is example code for Portable implementation of a Foo class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in serialization.adoc - include::{javasource}/serialization/Foo.java[tag=fooportable]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to <code>IdentifiedDataSerializable</code>, a Portable Class must provide <code>classId</code> and <code>factoryId</code>. The Factory object creates the Portable object given the <code>classId</code>.</p>
</div>
<div class="paragraph">
<p>An example <code>Factory</code> could be implemented as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyPortableFactory</span> <span class="directive">implements</span> PortableFactory {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Portable create( <span class="type">int</span> classId ) {
        <span class="keyword">if</span> ( Foo.ID == classId )
        <span class="keyword">return</span> <span class="keyword">new</span> Foo();
        <span class="keyword">else</span>
        <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="registering-the-portable-factory"><a class="anchor" href="#registering-the-portable-factory"></a><a class="link" href="#registering-the-portable-factory">17.5.2. Registering the Portable Factory</a></h4>
<div class="paragraph">
<p>The last step is to register the <code>Factory</code> to the <code>SerializationConfig</code>. Below are the programmatic and declarative configurations for this step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
config.getSerializationConfig().addPortableFactory( <span class="integer">1</span>, <span class="keyword">new</span> MyPortableFactory() );
<span class="error">`</span><span class="error">`</span><span class="error">`</span>


<span class="error">`</span><span class="error">`</span><span class="error">`</span>xml
&lt;hazelcast&gt;
  &lt;serialization&gt;
    &lt;portable-version&gt;<span class="integer">0</span>&lt;/portable-version&gt;
    &lt;portable-factories&gt;
      &lt;portable-factory factory-id=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>&gt;
          com.hazelcast.nio.serialization.MyPortableFactory
      &lt;/portable-factory&gt;
    &lt;/portable-factories&gt;
  &lt;/serialization&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>id</code> that is passed to the <code>SerializationConfig</code> is the same as the <code>factoryId</code> that the <code>Foo</code> class returns.</p>
</div>
</div>
<div class="sect3">
<h4 id="versioning-for-portable-serialization"><a class="anchor" href="#versioning-for-portable-serialization"></a><a class="link" href="#versioning-for-portable-serialization">17.5.3. Versioning for Portable Serialization</a></h4>
<div class="paragraph">
<p>More than one version of the same class may need to be serialized and deserialized. For example, a client may have an older version of a class and the member to which it is connected may have a newer version of the same class.</p>
</div>
<div class="paragraph">
<p>Portable serialization supports versioning. It is a global versioning, meaning that all portable classes that are serialized through a member get the globally configured portable version.</p>
</div>
<div class="paragraph">
<p>You can declare Version in the configuration file <code>hazelcast.xml</code> using the <code>portable-version</code> element, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;serialization&gt;
  &lt;portable-version&gt;<span class="integer">1</span>&lt;/portable-version&gt;
  &lt;portable-factories&gt;
    &lt;portable-factory factory-id=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>&gt;
        PortableFactoryImpl
    &lt;/portable-factory&gt;
  &lt;/portable-factories&gt;
&lt;/serialization&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the interface <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/nio/serialization/VersionedPortable.html">VersionedPortable</a> which enables to upgrade the version per class, instead of global versioning. If you need to update only one class, you can use this interface. In this case, your class should implement <code>VersionedPortable</code> instead of <code>Portable</code>, and you can give the desired version using the method <code>VersionedPortable.getClassVersion()</code>.</p>
</div>
<div class="paragraph">
<p>You should consider the following when you perform versioning.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is important to change the version whenever an update is performed in the serialized fields of a class, for example by incrementing the version.</p>
</li>
<li>
<p>If a client performs a Portable deserialization on a field and then that Portable is updated by removing that field on the cluster side, this may lead to a problem.</p>
</li>
<li>
<p>Portable serialization does not use reflection and hence, fields in the class and in the serialized content are not automatically mapped. Field renaming is a simpler process. Also, since the class ID is stored, renaming the Portable does not lead to problems.</p>
</li>
<li>
<p>Types of fields need to be updated carefully. Hazelcast performs basic type upgradings, such as <code>int</code> to <code>float</code>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="example-portable-versioning-scenarios"><a class="anchor" href="#example-portable-versioning-scenarios"></a><a class="link" href="#example-portable-versioning-scenarios">Example Portable Versioning Scenarios</a></h5>
<div class="paragraph">
<p>Assume that a new member joins to the cluster with a class that has been modified and class' version has been upgraded due to this modification.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you modified the class by adding a new field, the new member&#8217;s <code>put</code> operations will include that new field. If this new member tries to get an object that was put from the older members, it will get <code>null</code> for the newly added field.</p>
</li>
<li>
<p>If you modified the class by removing a field, the old members get <code>null</code> for the objects that are put by the new member.</p>
</li>
<li>
<p>If you modified the class by changing the type of a field, the error <code>IncompatibleClassChangeError</code> is generated unless the change was made on a built-in type or the byte size of the new type is less than or equal to the old one. The following are example allowed type conversions:</p>
<div class="ulist">
<ul>
<li>
<p><code>long</code> &#8594; <code>int</code>, <code>byte</code>, <code>char</code>, <code>short</code></p>
</li>
<li>
<p><code>int</code>&#8594; <code>byte</code>, <code>char</code>, <code>short</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you have not modify a class at all, it will work as usual.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ordering-consistency-for-code-writeportable-code"><a class="anchor" href="#ordering-consistency-for-code-writeportable-code"></a><a class="link" href="#ordering-consistency-for-code-writeportable-code">17.5.4. Ordering Consistency for <code>writePortable</code></a></h4>
<div class="paragraph">
<p>Independent of the member-member or member-client communications, the method <code>writePortable()</code> of the classes that implement <code>Portable</code> should be consistent. This means, the fields listed under the method <code>writePortable()</code> should be in the same order for all involved members and/or clients.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider the following <code>Employee</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in serialization.adoc - include::{javasource}/serialization/EmployeePortable.java[tag=empportable]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you see in the above example, first the <code>name</code> and then the <code>age</code> is written. This order should be preserved in other members or clients.</p>
</div>
</div>
<div class="sect3">
<h4 id="null-portable-serialization"><a class="anchor" href="#null-portable-serialization"></a><a class="link" href="#null-portable-serialization">17.5.5. Null Portable Serialization</a></h4>
<div class="paragraph">
<p>Be careful with serializing null portables. Hazelcast lazily creates a class definition of portable internally
when the user first serializes. This class definition is stored and used later for deserializing that portable class. When
the user tries to serialize a null portable when there is no class definition at the moment, Hazelcast throws an
exception saying that <code>com.hazelcast.nio.serialization.HazelcastSerializationException: Cannot write null portable
without explicitly registering class definition!</code>.</p>
</div>
<div class="paragraph">
<p>There are two solutions to get rid of this exception. Either put
a non-null portable class of the same type before any other operation, or manually register a class definition in serialization configuration as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
<span class="directive">final</span> <span class="predefined-type">ClassDefinition</span> classDefinition = <span class="keyword">new</span> ClassDefinitionBuilder(Foo.factoryId, Foo.getClassId)
                       .addUTFField(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>).build();
config.getSerializationConfig().addClassDefinition(classDefinition);
Hazelcast.newHazelcastInstance(config);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="distributedobject-serialization"><a class="anchor" href="#distributedobject-serialization"></a><a class="link" href="#distributedobject-serialization">17.5.6. DistributedObject Serialization</a></h4>
<div class="paragraph">
<p>Putting a <code>DistributedObject</code> (Hazelcast Semaphore, Queue, etc.) in a cluster member and getting it from another one is not a straightforward operation. Passing the ID and type of the <code>DistributedObject</code> can be a solution. For deserialization, you can get the object from HazelcastInstance. For instance, if your object is an instance of <code>IQueue</code>, you can either use <code>HazelcastInstance.getQueue(id)</code> or <code>Hazelcast.getDistributedObject</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code>HazelcastInstanceAware</code> interface in the case of a deserialization of a Portable <code>DistributedObject</code> if it gets an ID to be looked up. HazelcastInstance is set after deserialization, so you first need to store the ID and then retrieve the <code>DistributedObject</code> using the <code>setHazelcastInstance</code> method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="#serialization-configuration-wrap-up">Serialization Configuration Wrap-Up section</a> for a full description of Hazelcast Serialization configuration.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-serialization"><a class="anchor" href="#custom-serialization"></a><a class="link" href="#custom-serialization">17.6. Custom Serialization</a></h3>
<div class="paragraph">
<p>Hazelcast lets you plug in a custom serializer for serializing your objects. You can use <a href="#implementing-streamserializer">StreamSerializer</a> and <a href="#implementing-bytearrayserializer">ByteArraySerializer</a> interfaces for this purpose.</p>
</div>
<div class="sect3">
<h4 id="implementing-streamserializer"><a class="anchor" href="#implementing-streamserializer"></a><a class="link" href="#implementing-streamserializer">17.6.1. Implementing StreamSerializer</a></h4>
<div class="paragraph">
<p>You can use a stream to serialize and deserialize data by using <code>StreamSerializer</code>. This is a good option for your own implementations. It can also be adapted to external serialization libraries like Kryo, JSON and protocol buffers.</p>
</div>
<div class="sect4">
<h5 id="streamserializer-example-code-1"><a class="anchor" href="#streamserializer-example-code-1"></a><a class="link" href="#streamserializer-example-code-1">StreamSerializer Example Code 1</a></h5>
<div class="paragraph">
<p>First, let&#8217;s create a simple object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in serialization.adoc - include::{javasource}/serialization/EmployeeSS.java<span class="type">[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s implement StreamSerializer for <code>Employee</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in serialization.adoc - include::{javasource}/serialization/EmployeeStreamSerializer.java[tag=empss]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In practice, classes may have many fields. Just make sure the fields are read in the same order as they are written. The type ID must be unique and greater than or equal to <strong>1</strong>. Uniqueness of the type ID enables Hazelcast to determine which serializer will be used during deserialization.</p>
</div>
<div class="paragraph">
<p>As the last step, let&#8217;s register the <code>EmployeeStreamSerializer</code> in the configuration file <code>hazelcast.xml</code>, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;serialization&gt;
  &lt;serializers&gt;
    &lt;serializer type-<span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Employee</span><span class="delimiter">&quot;</span></span> <span class="class">class</span>-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">EmployeeStreamSerializer</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;/serializers&gt;
&lt;/serialization&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>StreamSerializer</code> cannot be created for well-known types, such as Long and String and primitive arrays. Hazelcast already registers these types.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="streamserializer-example-code-2"><a class="anchor" href="#streamserializer-example-code-2"></a><a class="link" href="#streamserializer-example-code-2">StreamSerializer Example Code 2</a></h5>
<div class="paragraph">
<p>Let&#8217;s take a look at another example implementing <code>StreamSerializer</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Foo</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> foo;

    <span class="directive">public</span> <span class="predefined-type">String</span> getFoo() {
        <span class="keyword">return</span> foo;
    }

    <span class="directive">public</span> <span class="type">void</span> setFoo( <span class="predefined-type">String</span> foo ) {
        <span class="local-variable">this</span>.foo = foo;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assume that our custom serialization will serialize
Foo into XML. First you need to implement a
<code>com.hazelcast.nio.serialization.StreamSerializer</code>. A very simple one that uses XMLEncoder and XMLDecoder could look like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in serialization.adoc - include::{javasource}/serialization/FooXmlSerializer.java[tag=fooxml]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configuring-streamserializer"><a class="anchor" href="#configuring-streamserializer"></a><a class="link" href="#configuring-streamserializer">Configuring StreamSerializer</a></h5>
<div class="paragraph">
<p>Note that <code>typeId</code> must be unique because Hazelcast will use it to look up the <code>StreamSerializer</code> while it deserializes the object. The last required step is to register the <code>StreamSerializer</code> in your Hazelcast configuration. Below are the programmatic and declarative configurations for this step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SerializerConfig sc = <span class="keyword">new</span> SerializerConfig()
    .setImplementation(<span class="keyword">new</span> FooXmlSerializer())
    .setTypeClass(Foo.class);
Config config = <span class="keyword">new</span> Config();
config.getSerializationConfig().addSerializerConfig(sc);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  &lt;serialization&gt;
    &lt;serializers&gt;
      &lt;serializer type-<span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.www.Foo</span><span class="delimiter">&quot;</span></span> <span class="class">class</span>-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.www.FooXmlSerializer</span><span class="delimiter">&quot;</span></span> /&gt;
    &lt;/serializers&gt;
  &lt;/serialization&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>From now on, this Hazelcast example will use <code>FooXmlSerializer</code>
to serialize Foo objects. In this way, you can write an adapter (StreamSerializer) for any Serialization framework and plug it into Hazelcast.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="#serialization-configuration-wrap-up">Serialization Configuration Wrap-Up section</a> for a full description of Hazelcast Serialization configuration.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="implementing-bytearrayserializer"><a class="anchor" href="#implementing-bytearrayserializer"></a><a class="link" href="#implementing-bytearrayserializer">17.6.2. Implementing ByteArraySerializer</a></h4>
<div class="paragraph">
<p><code>ByteArraySerializer</code> exposes the raw ByteArray used internally by Hazelcast. It is a good option if the serialization library you are using deals with ByteArrays instead of streams.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s implement <code>ByteArraySerializer</code> for the <code>Employee</code> class mentioned in <a href="#implementing-streamserializer">Implementing StreamSerializer</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in serialization.adoc - include::{javasource}/serialization/EmployeeByteArraySerializer.java[tag=empbas]</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="configuring-bytearrayserializer"><a class="anchor" href="#configuring-bytearrayserializer"></a><a class="link" href="#configuring-bytearrayserializer">Configuring ByteArraySerializer</a></h5>
<div class="paragraph">
<p>As usual, let&#8217;s register the <code>EmployeeByteArraySerializer</code> in the configuration file <code>hazelcast.xml</code>, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;serialization&gt;
  &lt;serializers&gt;
    &lt;serializer type-<span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Employee</span><span class="delimiter">&quot;</span></span>&gt;<span class="class">EmployeeByteArraySerializer</span>&lt;/serializer&gt;
  &lt;/serializers&gt;
&lt;/serialization&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="#serialization-configuration-wrap-up">Serialization Configuration Wrap-Up section</a> for a full description of Hazelcast Serialization configuration.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="global-serializer"><a class="anchor" href="#global-serializer"></a><a class="link" href="#global-serializer">17.7. Global Serializer</a></h3>
<div class="paragraph">
<p>The global serializer is identical to <a href="#custom-serialization">custom serializers</a> from the implementation perspective. The global serializer is registered as a fallback serializer to handle all other objects if a serializer cannot be located for them.</p>
</div>
<div class="paragraph">
<p>By default, the global serializer does not handle <code>java.io.Serializable</code> and <code>java.io.Externalizable</code> instances. However, you can configure it to be responsible for those instances.</p>
</div>
<div class="paragraph">
<p>A custom serializer should be registered for a specific class type. The global serializer will handle all class types if all the steps in searching for a serializer fail as described in <a href="#serialization-interface-types">Serialization Interface Types</a>.</p>
</div>
<div class="paragraph">
<p><strong>Use cases</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Third party serialization frameworks can be integrated using the global serializer.</p>
</li>
<li>
<p>For your custom objects, you can implement a single serializer to handle all of them.</p>
</li>
<li>
<p>You can replace the internal Java serialization by enabling the <code>overrideJavaSerialization</code> option of the global serializer configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any custom serializer can be used as the global serializer. Please refer to the <a href="#custom-serialization">Custom Serialization section</a> for implementation details.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To function properly, Hazelcast needs the Java serializable objects to be handled correctly. If the global serializer is configured to handle the Java serialization, the global serializer must properly serialize/deserialize the <code>java.io.Serializable</code> instances. Otherwise, it causes Hazelcast to malfunction.*
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sample-global-serializer"><a class="anchor" href="#sample-global-serializer"></a><a class="link" href="#sample-global-serializer">17.7.1. Sample Global Serializer</a></h4>
<div class="paragraph">
<p>A sample global serializer that integrates with a third party serializer is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">GlobalStreamSerializer</span>
    <span class="directive">implements</span> StreamSerializer&lt;<span class="predefined-type">Object</span>&gt; {

    <span class="directive">private</span> SomeThirdPartySerializer someThirdPartySerializer;

    <span class="directive">private</span> init() {
        <span class="comment">//someThirdPartySerializer  = ...</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getTypeId () {
        <span class="keyword">return</span> <span class="integer">123</span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> write( ObjectDataOutput out, <span class="predefined-type">Object</span> object ) <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="type">byte</span><span class="type">[]</span> bytes = someThirdPartySerializer.encode(object);
        out.writeByteArray(bytes);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> read( ObjectDataInput in ) <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="type">byte</span><span class="type">[]</span> bytes = in.readByteArray();
        <span class="keyword">return</span> someThirdPartySerializer.decode(bytes);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> destroy () {
        someThirdPartySerializer.destroy();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we can register the global serializer in the configuration file <code>hazelcast.xml</code>, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;serialization&gt;
  &lt;serializers&gt;
    &lt;global-serializer override-java-serialization=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;GlobalStreamSerializer&lt;/global-serializer&gt;
  &lt;/serializers&gt;
&lt;/serialization&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implementing-hazelcastinstanceaware"><a class="anchor" href="#implementing-hazelcastinstanceaware"></a><a class="link" href="#implementing-hazelcastinstanceaware">17.8. Implementing HazelcastInstanceAware</a></h3>
<div class="paragraph">
<p>You can implement the <code>HazelcastInstanceAware</code> interface to access distributed objects for cases where an object is deserialized and needs access to HazelcastInstance.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s implement it for the <code>Employee</code> class mentioned in the <a href="#custom-serialization">Custom Serialization section</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in serialization.adoc - include::{javasource}/serialization/PersonAwr.java[tag=personawr]</code></pre>
</div>
</div>
<div class="paragraph">
<p>After deserialization, the object is checked to see if it implements <code>HazelcastInstanceAware</code> and the method <code>setHazelcastInstance</code> is called. Notice the <code>hazelcastInstance</code> is <code>transient</code>. This is because this field should not be serialized.</p>
</div>
<div class="paragraph">
<p>It may be a good practice to inject a HazelcastInstance into a domain object, e.g., <code>Employee</code> in the above sample, when used together with <code>Runnable</code>/<code>Callable</code> implementations. These runnables/callables are executed by <code>IExecutorService</code> which sends them to another machine. And after a task is deserialized, run/call method implementations need to access HazelcastInstance.</p>
</div>
<div class="paragraph">
<p>We recommend you only set the HazelcastInstance field while using <code>setHazelcastInstance</code> method and you not execute operations on the HazelcastInstance. The reason is that when HazelcastInstance is injected for a <code>HazelcastInstanceAware</code> implementation, it may not be up and running at the injection time.</p>
</div>
</div>
<div class="sect2">
<h3 id="untrusted-deserialization-protection"><a class="anchor" href="#untrusted-deserialization-protection"></a><a class="link" href="#untrusted-deserialization-protection">17.9. Untrusted Deserialization Protection</a></h3>
<div class="paragraph">
<p>Hazelcast offers a Java deserialization protection based on whitelisting and blacklisting the class/package names. These listings support prefixes.</p>
</div>
<div class="paragraph">
<p>This protection is controlled using the configuration element <code>java-serialization-filter</code> under <code>serialization</code>, as shown in the example below.
op</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
    <span class="tag">&lt;serialization&gt;</span>
        <span class="tag">&lt;java-serialization-filter</span> <span class="attribute-name">defaults-disabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;whitelist&gt;</span>
                <span class="tag">&lt;class&gt;</span>example.Foo<span class="tag">&lt;/class&gt;</span>
                <span class="tag">&lt;package&gt;</span>com.acme.app<span class="tag">&lt;/package&gt;</span>
                <span class="tag">&lt;prefix&gt;</span>com.hazelcast.<span class="tag">&lt;/package&gt;</span>
                <span class="tag">&lt;prefix&gt;</span>java.<span class="tag">&lt;/package&gt;</span>
                <span class="tag">&lt;prefix&gt;</span>javax.<span class="tag">&lt;/package&gt;</span>
                <span class="tag">&lt;prefix&gt;</span>[<span class="tag">&lt;/package&gt;</span>
            <span class="tag">&lt;/whitelist&gt;</span>
            <span class="tag">&lt;blacklist&gt;</span>
                <span class="tag">&lt;class&gt;</span>com.acme.app.BeanComparator<span class="tag">&lt;/class&gt;</span>
            <span class="tag">&lt;/blacklist&gt;</span>
        <span class="tag">&lt;/java-serialization-filter&gt;</span>
    <span class="tag">&lt;/serialization&gt;</span>
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative, you can also configure it programmatically using the <code>JavaSerializationFilterConfig</code> object, as shown in the below example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
JavaSerializationFilterConfig javaSerializationFilterConfig = <span class="keyword">new</span> JavaSerializationFilterConfig();
javaSerializationFilterConfig.getWhitelist().addClasses(SomeDeserialized.class.getName());
config.getSerializationConfig().setJavaSerializationFilterConfig(javaSerializationFilterConfig);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Untrusted deserialization protection is not enabled by default. You can enable it simply by setting the element <code>java-serialization-filter</code> or using a non-null <code>JavaSerializationFilterConfig</code> object.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The protection uses a whitelist as the default configuration. When this list is not explicitly provided, the following default prefixes are used for the whitelist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>java</code></p>
</li>
<li>
<p><code>com.hazelcast.</code></p>
</li>
<li>
<p><code>[</code> (for primitives and arrays)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you do not want to use the default whitelist prefixes, you must set the <code>defaults-disabled</code> attribute to true.</p>
</div>
<div class="paragraph">
<p>Once the protection is enabled, the following filtering rules are used when objects are deserialized.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When whitelist is not provided:</p>
<div class="ulist">
<ul>
<li>
<p>if the deserialized object&#8217;s <code>getClass().getName()</code> is blacklisted or <code>getClass().getPackage().getName()</code> is blacklisted, then deserialization fails;</p>
</li>
<li>
<p>deserialization is allowed otherwise.</p>
</li>
</ul>
</div>
</li>
<li>
<p>When whitelist is provided:</p>
<div class="ulist">
<ul>
<li>
<p>if the deserialized object&#8217;s <code>getClass().getName()</code> or <code>getClass().getPackage().getName()</code> is blacklisted, then deserialization fails;</p>
</li>
<li>
<p>if the deserialized object&#8217;s <code>getClass().getName()</code> or <code>getClass().getPackage().getName()</code> is whitelisted, then deserialization is allowed;</p>
</li>
<li>
<p>deserialization fails otherwise.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When deserialization fails, a <code>SecurityException</code> is thrown.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that the safest way to provide a protection against untrusted deserialization is using whitelisting (also keep in mind that maintaining such a whitelist can be difficult).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="serialization-configuration-wrap-up"><a class="anchor" href="#serialization-configuration-wrap-up"></a><a class="link" href="#serialization-configuration-wrap-up">17.10. Serialization Configuration Wrap-Up</a></h3>
<div class="paragraph">
<p>This section summarizes the configuration of serialization options, explained in the above sections, into all-in-one examples. The following are example serialization configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;serialization&gt;
   &lt;portable-version&gt;<span class="integer">2</span>&lt;/portable-version&gt;
   &lt;use-<span class="directive">native</span>-<span class="type">byte</span>-order&gt;<span class="predefined-constant">true</span>&lt;/use-<span class="directive">native</span>-<span class="type">byte</span>-order&gt;
   &lt;<span class="type">byte</span>-order&gt;BIG_ENDIAN&lt;/<span class="type">byte</span>-order&gt;
   &lt;enable-compression&gt;<span class="predefined-constant">true</span>&lt;/enable-compression&gt;
   &lt;enable-shared-object&gt;<span class="predefined-constant">false</span>&lt;/enable-shared-object&gt;
   &lt;allow-unsafe&gt;<span class="predefined-constant">true</span>&lt;/allow-unsafe&gt;
   &lt;data-serializable-factories&gt;
      &lt;data-serializable-factory factory-id=<span class="string"><span class="delimiter">&quot;</span><span class="content">1001</span><span class="delimiter">&quot;</span></span>&gt;
          abc.xyz.Class
      &lt;/data-serializable-factory&gt;
   &lt;/data-serializable-factories&gt;
   &lt;portable-factories&gt;
      &lt;portable-factory factory-id=<span class="string"><span class="delimiter">&quot;</span><span class="content">9001</span><span class="delimiter">&quot;</span></span>&gt;
         xyz.abc.Class
      &lt;/portable-factory&gt;
   &lt;/portable-factories&gt;
   &lt;serializers&gt;
      &lt;global-serializer&gt;abc.Class&lt;/global-serializer&gt;
      &lt;serializer type-<span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Employee</span><span class="delimiter">&quot;</span></span> <span class="class">class</span>-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.EmployeeSerializer</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;/serializer&gt;
   &lt;/serializers&gt;
   &lt;check-<span class="type">class</span>-<span class="class">def</span>-errors&gt;<span class="predefined-constant">true</span>&lt;/check-<span class="type">class</span>-<span class="class">def</span>-errors&gt;
&lt;/serialization&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
SerializationConfig srzConfig = config.getSerializationConfig();
srzConfig.setPortableVersion( <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> ).setUseNativeByteOrder( <span class="predefined-constant">true</span> );
srzConfig.setAllowUnsafe( <span class="predefined-constant">true</span> ).setEnableCompression( <span class="predefined-constant">true</span> );
srzConfig.setCheckClassDefErrors( <span class="predefined-constant">true</span> );

GlobalSerializerConfig globSrzConfig = srzConfig.getGlobalSerializerConfig();
globSrzConfig.setClassName( <span class="string"><span class="delimiter">&quot;</span><span class="content">abc.Class</span><span class="delimiter">&quot;</span></span> );

SerializerConfig serializerConfig = srzConfig.getSerializerConfig();
serializerConfig.setTypeClass( <span class="string"><span class="delimiter">&quot;</span><span class="content">Employee</span><span class="delimiter">&quot;</span></span> )
                .setClassName( <span class="string"><span class="delimiter">&quot;</span><span class="content">com.EmployeeSerializer</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Serialization configuration has the following elements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>portable-version</code>: Defines versioning of the portable serialization. Portable version differentiates two of the same classes that have changes, such as adding/removing field or changing a type of a field.</p>
</li>
<li>
<p><code>use-native-byte-order</code>: Set to <code>true</code> to use native byte order for the underlying platform. Its default value is <code>false</code>.</p>
</li>
<li>
<p><code>byte-order</code>: Defines the byte order that the serialization will use: <code>BIG_ENDIAN</code> or <code>LITTLE_ENDIAN</code>. Its default value is <code>BIG_ENDIAN</code>.</p>
</li>
<li>
<p><code>enable-compression</code>: Enables compression if default Java serialization is used. Its default value is <code>false</code>.</p>
</li>
<li>
<p><code>enable-shared-object</code>: Enables shared object if default Java serialization is used. Its default value is <code>false</code>.</p>
</li>
<li>
<p><code>allow-unsafe</code>: Set to <code>true</code> to allow <code>unsafe</code> to be used. Its default value is <code>false</code>.</p>
</li>
<li>
<p><code>data-serializable-factory</code>: Custom classes implementing <code>com.hazelcast.nio.serialization.DataSerializableFactory</code> to be registered. These can be used to speed up serialization/deserialization of objects.</p>
</li>
<li>
<p><code>portable-factory</code>: The <code>PortableFactory</code> class to be registered.</p>
</li>
<li>
<p><code>global-serializer</code>: The global serializer class to be registered if no other serializer is applicable. This element has the optional boolean attribute <code>override-java-serialization</code>. If set to <code>true</code>, the Java serialization step is assumed to be handled by the global serializer. Java Serializable and Externalizable is prior to global serializer by default (<code>false</code>).</p>
</li>
<li>
<p><code>serializer</code>: The class name of the serializer implementation.</p>
</li>
<li>
<p><code>check-class-def-errors</code>: When set to <code>true</code>, the serialization system will check for class definitions error at start and will throw a Serialization Exception with an error definition.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="management"><a class="anchor" href="#management"></a><a class="link" href="#management">18. Management</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides information on managing and monitoring your Hazelcast cluster. It gives detailed instructions related to gathering statistics, monitoring via JMX protocol and managing the cluster with useful utilities.</p>
</div>
<div class="sect2">
<h3 id="getting-member-statistics"><a class="anchor" href="#getting-member-statistics"></a><a class="link" href="#getting-member-statistics">18.1. Getting Member Statistics</a></h3>
<div class="paragraph">
<p>You can get various statistics from your distributed data structures via the Statistics API.
Since the data structures are distributed in the cluster, the Statistics API provides
statistics for the local portion (1/Number of Members in the Cluster) of data on each member.</p>
</div>
<div class="sect3">
<h4 id="map-statistics"><a class="anchor" href="#map-statistics"></a><a class="link" href="#map-statistics">18.1.1. Map Statistics</a></h4>
<div class="paragraph">
<p>To get local map statistics, use the <code>getLocalMapStats()</code> method from the <code>IMap</code> interface. This method returns a
<code>LocalMapStats</code> object that holds local map statistics.</p>
</div>
<div class="paragraph">
<p>Below is an example code where the <code>getLocalMapStats()</code> method and the <code>getOwnedEntryCount()</code> method get the number of entries owned by this member.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in management.adoc - include::{javasource}/management/SampleLocalMapStats.java[tag=lms]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since Hazelcast IMDG 3.8 <code>getOwnedEntryMemoryCost()</code> method is now supported for NATIVE in-memory format as well.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following are some of the metrics that you can access via the <code>LocalMapStats</code> object.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of entries owned by the member (<code>getOwnedEntryCount()</code>).</p>
</li>
<li>
<p>Number of backup entries hold by the member (<code>getBackupEntryCount()</code>).</p>
</li>
<li>
<p>Number of backups per entry (<code>getBackupCount()</code>).</p>
</li>
<li>
<p>Memory cost (number of bytes) of owned entries in the member (<code>getOwnedEntryMemoryCost()</code>).</p>
</li>
<li>
<p>Creation time of the map on the member (<code>getCreationTime()</code>).</p>
</li>
<li>
<p>Number of hits (reads) of the locally owned entries (<code>getHits()</code>).</p>
</li>
<li>
<p>Number of get and put operations on the map (<code>getPutOperationCount()</code> and <code>getGetOperationCount()</code>).</p>
</li>
<li>
<p>Number of queries executed on the map (<code>getQueryCount()</code> and <code>getIndexedQueryCount()</code>). May be imprecise for queries involving partition predicates (<code>PartitionPredicate</code>) on off-heap storage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/monitor/LocalMapStats.html"><code>LocalMapStats</code> Javadoc</a> to see all the metrics.</p>
</div>
</div>
<div class="sect3">
<h4 id="map-index-statistics"><a class="anchor" href="#map-index-statistics"></a><a class="link" href="#map-index-statistics">18.1.2. Map Index Statistics</a></h4>
<div class="paragraph">
<p>To access map index statistics, if you are using indexes to speed up map queries, use the <code>getIndexStats()</code> method of the <code>LocalMapStats</code> interface returned by <code>IMap.getLocalMapStats()</code>.</p>
</div>
<div class="paragraph">
<p>Below is an example where the <code>getIndexStats()</code> method is used to examine an average selectivity of index hits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in management.adoc - include::{javasource}/management/SampleLocalIndexStats.java[tag=lis]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are some of the metrics that you can obtain via the <code>LocalIndexStats</code> interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of queries and hits into an index (<code>getQueryCount()</code> and <code>getHitCount()</code>). Number of hits and queries may differ since a single query may hit the same index more than once.</p>
</li>
<li>
<p>Average index hit latency measured in nanoseconds (<code>getAverageHitLatency()</code>).</p>
</li>
<li>
<p>Average index hit selectivity (<code>getAverageHitSelectivity</code>). Returned values are in the range from 0.0 to 1.0. Values close to 1.0 indicate a high selectivity meaning the index is efficient; values close to 0.0 indicate a low selectivity meaning the index efficiency is approaching an efficiency of a simple full scan.</p>
</li>
<li>
<p>Number of index insert, update and remove operations (<code>getInsertCount()</code>, <code>getUpdateCount()</code> and <code>getRemoveCount()</code>).</p>
</li>
<li>
<p>Total latencies of insert, update and remove operations (<code>getTotalInsertLatency()</code>, <code>getTotalUpdateLatency()</code>, <code>getTotalRemoveLatency()</code>). To compute an average latency divide the returned value by the number of operations of a corresponding type.</p>
</li>
<li>
<p>Memory cost of an index (<code>getMemoryCost()</code>). For on-heap storages, this memory cost metric value is a best-effort approximation and doesn&#8217;t indicate a precise on-heap memory usage of an index.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/monitor/LocalIndexStats.html"><code>LocalIndexStats</code> Javadoc</a> to see all the metrics.</p>
</div>
<div class="paragraph">
<p>To compute an aggregated value of <code>getAverageHitSelectivity()</code> for all cluster members, you can use a simple averaging computation as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">(s(<span class="integer">1</span>) + s(<span class="integer">2</span>) + ... + s(n)) / n</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this computation, <code>s(i)</code> is an average hit selectivity on the member <code>i</code> and <code>n</code> is the total number of cluster members.</p>
</div>
<div class="paragraph">
<p>A more advanced solution is to compute a weighted average as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">(s(<span class="integer">1</span>) * h(<span class="integer">1</span>) + s(<span class="integer">2</span>) * h(<span class="integer">2</span>) + ... + s(n) * h(n)) / (h(<span class="integer">1</span>) + h(<span class="integer">2</span>) + ... + h(n))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, <code>s(i)</code> is an average hit selectivity on the member <code>i</code>, <code>h(i)</code> is a hit count (<code>getHitCount()</code>) on the member <code>i</code> and <code>n</code> is the total number of cluster members. This more advanced solution may produce more precise results in unstable dynamic clusters where new members do not have enough statistics accumulated. The same technique may be applied to the <code>getAverageHitLatency()</code> metric.</p>
</div>
<div class="paragraph">
<p>Accuracy and reliability notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Values returned by <code>getAverageHitSelectivity()</code> have an accuracy of around 1% for on-heap storages.</p>
</li>
<li>
<p>Values returned by <code>getQueryCount()</code> and <code>getHitCount()</code> may be imprecise for queries involving partition predicates (<code>PartitionPredicate</code>) on off-heap storage.</p>
</li>
<li>
<p>Index statistics may be imprecise after a new cluster member addition or the existing member removal until enough fresh statistics is accumulated on a new owner of an index or its partition.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="near-cache-statistics"><a class="anchor" href="#near-cache-statistics"></a><a class="link" href="#near-cache-statistics">18.1.3. Near Cache Statistics</a></h4>
<div class="paragraph">
<p>To get Near Cache statistics, use the <code>getNearCacheStats()</code> method from the <code>LocalMapStats</code> object.
This method returns a <code>NearCacheStats</code> object that holds Near Cache statistics.</p>
</div>
<div class="paragraph">
<p>Below is an example code where the <code>getNearCacheStats()</code> method and the <code>getRatio</code> method from <code>NearCacheStats</code> get a Near Cache hit/miss ratio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in management.adoc - include::{javasource}/management/SampleNearCacheStats.java[tag=ncs]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are some of the metrics that you can access via the <code>NearCacheStats</code> object.
This behavior applies to both client and member Near Caches.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation time of the Near Cache map on the member (<code>getCreationTime()</code>).</p>
</li>
<li>
<p>Number of entries owned by the member (<code>getOwnedEntryCount()</code>).</p>
</li>
<li>
<p>Memory cost (number of bytes) of owned entries in the Near Cache (<code>getOwnedEntryMemoryCost()</code>).</p>
</li>
<li>
<p>Number of hits (reads) of the locally owned entries (<code>getHits()</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/monitor/NearCacheStats.html"><code>NearCacheStats</code> Javadoc</a> to see all the metrics.</p>
</div>
</div>
<div class="sect3">
<h4 id="multimap-statistics"><a class="anchor" href="#multimap-statistics"></a><a class="link" href="#multimap-statistics">18.1.4. Multimap Statistics</a></h4>
<div class="paragraph">
<p>To get MultiMap statistics, use the <code>getLocalMultiMapStats()</code> method from the <code>MultiMap</code> interface.
This method returns a <code>LocalMultiMapStats</code> object that holds local MultiMap statistics.</p>
</div>
<div class="paragraph">
<p>Below is an example code where the <code>getLocalMultiMapStats()</code> method and the <code>getLastUpdateTime</code> method from <code>LocalMultiMapStats</code> get the last update time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in management.adoc - include::{javasource}/management/SampleMultiMapStats.java[tag=mms]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are some of the metrics that you can access via the <code>LocalMultiMapStats</code> object.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of entries owned by the member (<code>getOwnedEntryCount()</code>).</p>
</li>
<li>
<p>Number of backup entries hold by the member (<code>getBackupEntryCount()</code>).</p>
</li>
<li>
<p>Number of backups per entry (<code>getBackupCount()</code>).</p>
</li>
<li>
<p>Memory cost (number of bytes) of owned entries in the member (<code>getOwnedEntryMemoryCost()</code>).</p>
</li>
<li>
<p>Creation time of the multimap on the member (<code>getCreationTime()</code>).</p>
</li>
<li>
<p>Number of hits (reads) of the locally owned entries (<code>getHits()</code>).</p>
</li>
<li>
<p>Number of get and put operations on the map (<code>getPutOperationCount()</code> and <code>getGetOperationCount()</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/monitor/LocalMultiMapStats.html"><code>LocalMultiMapStats</code> Javadoc</a> to see all the metrics.</p>
</div>
</div>
<div class="sect3">
<h4 id="queue-statistics"><a class="anchor" href="#queue-statistics"></a><a class="link" href="#queue-statistics">18.1.5. Queue Statistics</a></h4>
<div class="paragraph">
<p>To get local queue statistics, use the <code>getLocalQueueStats()</code> method from the <code>IQueue</code> interface.
This method returns a <code>LocalQueueStats</code> object that holds local queue statistics.</p>
</div>
<div class="paragraph">
<p>Below is an example code where the <code>getLocalQueueStats()</code> method and the <code>getAvgAge</code> method from <code>LocalQueueStats</code> get the average age of items.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in management.adoc - include::{javasource}/management/SampleQueueStats.java[tag=qs]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are some of the metrics that you can access via the `LocalQueueStats ` object.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of owned items in the member (<code>getOwnedItemCount()</code>).</p>
</li>
<li>
<p>Number of backup items in the member (<code>getBackupItemCount()</code>).</p>
</li>
<li>
<p>Minimum and maximum ages of the items in the member (<code>getMinAge()</code> and <code>getMaxAge()</code>).</p>
</li>
<li>
<p>Number of offer, put and add operations (<code>getOfferOperationCount()</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/monitor/LocalQueueStats.html"><code>LocalQueueStats</code> Javadoc</a> to see all the metrics.</p>
</div>
</div>
<div class="sect3">
<h4 id="topic-statistics"><a class="anchor" href="#topic-statistics"></a><a class="link" href="#topic-statistics">18.1.6. Topic Statistics</a></h4>
<div class="paragraph">
<p>To get local topic statistics, use the <code>getLocalTopicStats()</code> method from the <code>ITopic</code> interface.
This method returns a <code>LocalTopicStats</code> object that holds local topic statistics.</p>
</div>
<div class="paragraph">
<p>Below is an example code where the <code>getLocalTopicStats()</code> method and the <code>getPublishOperationCount</code> method from <code>LocalTopicStats</code> get the number of publish operations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in management.adoc - include::{javasource}/management/SampleTopicStats.java[tag=ts]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are the metrics that you can access via the `LocalTopicStats ` object.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation time of the topic on the member (<code>getCreationTime()</code>).</p>
</li>
<li>
<p>Total number of published messages of the topic on the member (<code>getPublishOperationCount()</code>).</p>
</li>
<li>
<p>Total number of received messages of the topic on the member (<code>getReceiveOperationCount()</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/monitor/LocalTopicStats.html">here</a> for its Javadoc.</p>
</div>
</div>
<div class="sect3">
<h4 id="executor-statistics"><a class="anchor" href="#executor-statistics"></a><a class="link" href="#executor-statistics">18.1.7. Executor Statistics</a></h4>
<div class="paragraph">
<p>To get local executor statistics, use the <code>getLocalExecutorStats()</code> method from the <code>IExecutorService</code> interface.
This method returns a <code>LocalExecutorStats</code> object that holds local executor statistics.</p>
</div>
<div class="paragraph">
<p>Below is an example code where the <code>getLocalExecutorStats()</code> method and the <code>getCompletedTaskCount</code> method from <code>LocalExecutorStats</code> get the number of completed operations of the executor service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in management.adoc - include::{javasource}/management/SampleExecutorStats.java[tag=es]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following are some of the metrics that you can access via the `LocalExecutorStats ` object.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Number of pending operations of the executor service (<code>getPendingTaskCount()</code>).</p>
</li>
<li>
<p>Number of started operations of the executor service (<code>getStartedTaskCount()</code>).</p>
</li>
<li>
<p>Number of completed operations of the executor service (<code>getCompletedTaskCount()</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/monitor/LocalExecutorStats.html"><code>LocalExecutorStats</code> Javadoc</a> to see all the metrics.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jmx-api-per-member"><a class="anchor" href="#jmx-api-per-member"></a><a class="link" href="#jmx-api-per-member">18.2. JMX API per Member</a></h3>
<div class="paragraph">
<p>Hazelcast members expose various management beans which include statistics about distributed data structures and the states of Hazelcast member internals.</p>
</div>
<div class="paragraph">
<p>The metrics are local to the members, i.e., they do not reflect cluster wide values.</p>
</div>
<div class="paragraph">
<p>You can find the JMX API definition below with descriptions and the API methods in parenthesis.</p>
</div>
<div class="paragraph">
<p><strong>Atomic Long (<code>IAtomicLong</code>)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Current Value ( <code>currentValue</code> )</p>
</li>
<li>
<p>Set Value ( <code>set(v)</code> )</p>
</li>
<li>
<p>Add value and Get ( <code>addAndGet(v)</code> )</p>
</li>
<li>
<p>Compare and Set ( <code>compareAndSet(e,v)</code> )</p>
</li>
<li>
<p>Decrement and Get ( <code>decrementAndGet()</code> )</p>
</li>
<li>
<p>Get and Add ( <code>getAndAdd(v)</code> )</p>
</li>
<li>
<p>Get and Increment ( <code>getAndIncrement()</code> )</p>
</li>
<li>
<p>Get and Set ( <code>getAndSet(v)</code> )</p>
</li>
<li>
<p>Increment and Get ( <code>incrementAndGet()</code> )</p>
</li>
<li>
<p>Partition key ( <code>partitionKey</code> )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Atomic Reference ( <code>IAtomicReference</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Partition key  ( <code>partitionKey</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Countdown Latch ( <code>ICountDownLatch</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Current count ( <code>count</code>)</p>
</li>
<li>
<p>Countdown ( <code>countDown()</code> )</p>
</li>
<li>
<p>Partition key  ( <code>partitionKey</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Executor Service ( <code>IExecutorService</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Local pending operation count ( <code>localPendingTaskCount</code> )</p>
</li>
<li>
<p>Local started operation count ( <code>localStartedTaskCount</code> )</p>
</li>
<li>
<p>Local completed operation count ( <code>localCompletedTaskCount</code> )</p>
</li>
<li>
<p>Local cancelled operation count ( <code>localCancelledTaskCount</code> )</p>
</li>
<li>
<p>Local total start latency ( <code>localTotalStartLatency</code> )</p>
</li>
<li>
<p>Local total execution latency ( <code>localTotalExecutionLatency</code> )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>List ( <code>IList</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Clear list ( <code>clear</code> )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Lock ( <code>ILock</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Lock Object ( <code>lockObject</code> )</p>
</li>
<li>
<p>Partition key ( <code>partitionKey</code> )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Map ( <code>IMap</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Size ( <code>size</code> )</p>
</li>
<li>
<p>Config ( <code>config</code> )</p>
</li>
<li>
<p>Owned entry count ( <code>localOwnedEntryCount</code> )</p>
</li>
<li>
<p>Owned entry memory cost ( <code>localOwnedEntryMemoryCost</code> )</p>
</li>
<li>
<p>Backup entry count ( <code>localBackupEntryCount</code> )</p>
</li>
<li>
<p>Backup entry cost ( <code>localBackupEntryMemoryCost</code> )</p>
</li>
<li>
<p>Backup count ( <code>localBackupCount</code> )</p>
</li>
<li>
<p>Creation time ( <code>localCreationTime</code> )</p>
</li>
<li>
<p>Last access time ( <code>localLastAccessTime</code> )</p>
</li>
<li>
<p>Last update time ( <code>localLastUpdateTime</code> )</p>
</li>
<li>
<p>Hits ( <code>localHits</code> )</p>
</li>
<li>
<p>Locked entry count ( <code>localLockedEntryCount</code> )</p>
</li>
<li>
<p>Dirty entry count ( <code>localDirtyEntryCount</code> )</p>
</li>
<li>
<p>Put operation count ( <code>localPutOperationCount</code> )</p>
</li>
<li>
<p>Get operation count ( <code>localGetOperationCount</code> )</p>
</li>
<li>
<p>Remove operation count ( <code>localRemoveOperationCount</code> )</p>
</li>
<li>
<p>Total put latency ( <code>localTotalPutLatency</code> )</p>
</li>
<li>
<p>Total get latency ( <code>localTotalGetLatency</code> )</p>
</li>
<li>
<p>Total remove latency ( <code>localTotalRemoveLatency</code> )</p>
</li>
<li>
<p>Max put latency ( <code>localMaxPutLatency</code> )</p>
</li>
<li>
<p>Max get latency ( <code>localMaxGetLatency</code> )</p>
</li>
<li>
<p>Max remove latency ( <code>localMaxRemoveLatency</code> )</p>
</li>
<li>
<p>Event count ( <code>localEventOperationCount</code> )</p>
</li>
<li>
<p>Other (keySet,entrySet etc..) operation count ( <code>localOtherOperationCount</code> )</p>
</li>
<li>
<p>Total operation count ( <code>localTotal</code> )</p>
</li>
<li>
<p>Heap Cost ( <code>localHeapCost</code> )</p>
</li>
<li>
<p>Clear ( <code>clear()</code> )</p>
</li>
<li>
<p>Values ( <code>values(p)</code>)</p>
</li>
<li>
<p>Entry Set ( <code>entrySet(p)</code> )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>MultiMap ( <code>MultiMap</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Size ( <code>size</code> )</p>
</li>
<li>
<p>Owned entry count ( <code>localOwnedEntryCount</code> )</p>
</li>
<li>
<p>Owned entry memory cost ( <code>localOwnedEntryMemoryCost</code> )</p>
</li>
<li>
<p>Backup entry count ( <code>localBackupEntryCount</code> )</p>
</li>
<li>
<p>Backup entry cost ( <code>localBackupEntryMemoryCost</code> )</p>
</li>
<li>
<p>Backup count ( <code>localBackupCount</code> )</p>
</li>
<li>
<p>Creation time ( <code>localCreationTime</code> )</p>
</li>
<li>
<p>Last access time ( <code>localLastAccessTime</code> )</p>
</li>
<li>
<p>Last update time ( <code>localLastUpdateTime</code> )</p>
</li>
<li>
<p>Hits ( <code>localHits</code> )</p>
</li>
<li>
<p>Locked entry count ( <code>localLockedEntryCount</code> )</p>
</li>
<li>
<p>Put operation count ( <code>localPutOperationCount</code> )</p>
</li>
<li>
<p>Get operation count ( <code>localGetOperationCount</code> )</p>
</li>
<li>
<p>Remove operation count ( <code>localRemoveOperationCount</code> )</p>
</li>
<li>
<p>Total put latency ( <code>localTotalPutLatency</code> )</p>
</li>
<li>
<p>Total get latency ( <code>localTotalGetLatency</code> )</p>
</li>
<li>
<p>Total remove latency ( <code>localTotalRemoveLatency</code> )</p>
</li>
<li>
<p>Max put latency ( <code>localMaxPutLatency</code> )</p>
</li>
<li>
<p>Max get latency ( <code>localMaxGetLatency</code> )</p>
</li>
<li>
<p>Max remove latency ( <code>localMaxRemoveLatency</code> )</p>
</li>
<li>
<p>Event count ( <code>localEventOperationCount</code> )</p>
</li>
<li>
<p>Other (keySet,entrySet etc..) operation count ( <code>localOtherOperationCount</code> )</p>
</li>
<li>
<p>Total operation count ( <code>localTotal</code> )</p>
</li>
<li>
<p>Clear ( <code>clear()</code> )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Replicated Map ( <code>ReplicatedMap</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Size ( <code>size</code> )</p>
</li>
<li>
<p>Config ( <code>config</code> )</p>
</li>
<li>
<p>Owned entry count ( <code>localOwnedEntryCount</code> )</p>
</li>
<li>
<p>Creation time ( <code>localCreationTime</code> )</p>
</li>
<li>
<p>Last access time ( <code>localLastAccessTime</code> )</p>
</li>
<li>
<p>Last update time ( <code>localLastUpdateTime</code> )</p>
</li>
<li>
<p>Hits ( <code>localHits</code> )</p>
</li>
<li>
<p>Put operation count ( <code>localPutOperationCount</code> )</p>
</li>
<li>
<p>Get operation count ( <code>localGetOperationCount</code> )</p>
</li>
<li>
<p>Remove operation count ( <code>localRemoveOperationCount</code> )</p>
</li>
<li>
<p>Total put latency ( <code>localTotalPutLatency</code> )</p>
</li>
<li>
<p>Total get latency ( <code>localTotalGetLatency</code> )</p>
</li>
<li>
<p>Total remove latency ( <code>localTotalRemoveLatency</code> )</p>
</li>
<li>
<p>Max put latency ( <code>localMaxPutLatency</code> )</p>
</li>
<li>
<p>Max get latency ( <code>localMaxGetLatency</code> )</p>
</li>
<li>
<p>Max remove latency ( <code>localMaxRemoveLatency</code> )</p>
</li>
<li>
<p>Event count ( <code>localEventOperationCount</code> )</p>
</li>
<li>
<p>Replication event count ( <code>localReplicationEventCount</code> )</p>
</li>
<li>
<p>Other (keySet,entrySet etc..) operation count ( <code>localOtherOperationCount</code> )</p>
</li>
<li>
<p>Total operation count ( <code>localTotal</code> )</p>
</li>
<li>
<p>Clear ( <code>clear()</code> )</p>
</li>
<li>
<p>Values ( <code>values()</code>)</p>
</li>
<li>
<p>Entry Set ( <code>entrySet()</code> )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Queue ( <code>IQueue</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Config ( <code>QueueConfig</code> )</p>
</li>
<li>
<p>Partition key ( <code>partitionKey</code> )</p>
</li>
<li>
<p>Owned item count ( <code>localOwnedItemCount</code> )</p>
</li>
<li>
<p>Backup item count ( <code>localBackupItemCount</code> )</p>
</li>
<li>
<p>Minimum age ( <code>localMinAge</code> )</p>
</li>
<li>
<p>Maximum age ( <code>localMaxAge</code> )</p>
</li>
<li>
<p>Average age ( <code>localAveAge</code> )</p>
</li>
<li>
<p>Offer operation count ( <code>localOfferOperationCount</code> )</p>
</li>
<li>
<p>Rejected offer operation count ( <code>localRejectedOfferOperationCount</code> )</p>
</li>
<li>
<p>Poll operation count ( <code>localPollOperationCount</code> )</p>
</li>
<li>
<p>Empty poll operation count ( <code>localEmptyPollOperationCount</code> )</p>
</li>
<li>
<p>Other operation count ( <code>localOtherOperationsCount</code> )</p>
</li>
<li>
<p>Event operation count ( <code>localEventOperationCount</code> )</p>
</li>
<li>
<p>Clear ( <code>clear()</code> )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Semaphore ( <code>ISemaphore</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Available permits ( <code>available</code> )</p>
</li>
<li>
<p>Partition key ( <code>partitionKey</code> )</p>
</li>
<li>
<p>Drain ( <code>drain()</code>)</p>
</li>
<li>
<p>Shrink available permits by given number ( <code>reduce(v)</code> )</p>
</li>
<li>
<p>Release given number of permits ( <code>release(v)</code> )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Set ( <code>ISet</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Partition key ( <code>partitionKey</code> )</p>
</li>
<li>
<p>Clear ( <code>clear()</code> )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Topic ( <code>ITopic</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Config ( <code>config</code> )</p>
</li>
<li>
<p>Creation time ( <code>localCreationTime</code> )</p>
</li>
<li>
<p>Publish operation count ( <code>localPublishOperationCount</code> )</p>
</li>
<li>
<p>Receive operation count ( <code>localReceiveOperationCount</code> )</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Hazelcast Instance ( <code>HazelcastInstance</code> )</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Version ( <code>version</code> )</p>
</li>
<li>
<p>Build ( <code>build</code> )</p>
</li>
<li>
<p>Configuration ( <code>config</code> )</p>
</li>
<li>
<p>Configuration source ( <code>configSource</code> )</p>
</li>
<li>
<p>Group name ( <code>groupName</code> )</p>
</li>
<li>
<p>Network Port ( <code>port</code> )</p>
</li>
<li>
<p>Cluster-wide Time ( <code>clusterTime</code> )</p>
</li>
<li>
<p>Size of the cluster ( <code>memberCount</code> )</p>
</li>
<li>
<p>List of members ( <code>Members</code> )</p>
</li>
<li>
<p>Running state ( <code>running</code> )</p>
</li>
<li>
<p>Shutdown the member ( <code>shutdown()</code> )</p>
</li>
<li>
<p><strong>Node ( <code>HazelcastInstance.Node</code> )</strong></p>
</li>
<li>
<p>Address ( <code>address</code> )</p>
</li>
<li>
<p>Master address ( <code>masterAddress</code> )</p>
</li>
<li>
<p><strong>Event Service ( <code>HazelcastInstance.EventService</code> )</strong></p>
<div class="ulist">
<ul>
<li>
<p>Event thread count  ( <code>eventThreadCount</code> )</p>
</li>
<li>
<p>Event queue size ( <code>eventQueueSize</code> )</p>
</li>
<li>
<p>Event queue capacity ( <code>eventQueueCapacity</code> )</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Operation Service ( <code>HazelcastInstance.OperationService</code> )</strong></p>
<div class="ulist">
<ul>
<li>
<p>Response queue size  ( <code>responseQueueSize</code> )</p>
</li>
<li>
<p>Operation executor queue size ( <code>operationExecutorQueueSize</code> )</p>
</li>
<li>
<p>Running operation count ( <code>runningOperationsCount</code> )</p>
</li>
<li>
<p>Remote operation count ( <code>remoteOperationCount</code> )</p>
</li>
<li>
<p>Executed operation count ( <code>executedOperationCount</code> )</p>
</li>
<li>
<p>Operation thread count ( <code>operationThreadCount</code> )</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Proxy Service ( <code>HazelcastInstance.ProxyService</code> )</strong></p>
<div class="ulist">
<ul>
<li>
<p>Proxy count ( <code>proxyCount</code> )</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Partition Service ( <code>HazelcastInstance.PartitionService</code> )</strong></p>
<div class="ulist">
<ul>
<li>
<p>Partition count ( <code>partitionCount</code> )</p>
</li>
<li>
<p>Active partition count ( <code>activePartitionCount</code> )</p>
</li>
<li>
<p>Cluster Safe State ( <code>isClusterSafe</code> )</p>
</li>
<li>
<p>LocalMember Safe State ( <code>isLocalMemberSafe</code> )</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Connection Manager ( <code>HazelcastInstance.ConnectionManager</code> )</strong></p>
<div class="ulist">
<ul>
<li>
<p>Client connection count ( <code>clientConnectionCount</code> )</p>
</li>
<li>
<p>Active connection count ( <code>activeConnectionCount</code> )</p>
</li>
<li>
<p>Connection count ( <code>connectionCount</code> )</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Client Engine ( <code>HazelcastInstance.ClientEngine</code> )</strong></p>
<div class="ulist">
<ul>
<li>
<p>Client endpoint count ( <code>clientEndpointCount</code> )</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>System Executor ( <code>HazelcastInstance.ManagedExecutorService</code> )</strong></p>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Work queue size ( <code>queueSize</code> )</p>
</li>
<li>
<p>Thread count of the pool ( <code>poolSize</code> )</p>
</li>
<li>
<p>Maximum thread count of the pool ( <code>maximumPoolSize</code> )</p>
</li>
<li>
<p>Remaining capacity of the work queue ( <code>remainingQueueCapacity</code> )</p>
</li>
<li>
<p>Is shutdown ( <code>isShutdown</code> )</p>
</li>
<li>
<p>Is terminated ( <code>isTerminated</code> )</p>
</li>
<li>
<p>Completed task count ( <code>completedTaskCount</code> )</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Async Executor (<code>HazelcastInstance.ManagedExecutorService</code>)</strong></p>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Work queue size ( <code>queueSize</code> )</p>
</li>
<li>
<p>Thread count of the pool ( <code>poolSize</code> )</p>
</li>
<li>
<p>Maximum thread count of the pool ( <code>maximumPoolSize</code> )</p>
</li>
<li>
<p>Remaining capacity of the work queue ( <code>remainingQueueCapacity</code> )</p>
</li>
<li>
<p>Is shutdown ( <code>isShutdown</code> )</p>
</li>
<li>
<p>Is terminated ( <code>isTerminated</code> )</p>
</li>
<li>
<p>Completed task count ( <code>completedTaskCount</code> )</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Scheduled Executor ( <code>HazelcastInstance.ManagedExecutorService</code> )</strong></p>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Work queue size ( <code>queueSize</code> )</p>
</li>
<li>
<p>Thread count of the pool ( <code>poolSize</code> )</p>
</li>
<li>
<p>Maximum thread count of the pool ( <code>maximumPoolSize</code> )</p>
</li>
<li>
<p>Remaining capacity of the work queue ( <code>remainingQueueCapacity</code> )</p>
</li>
<li>
<p>Is shutdown ( <code>isShutdown</code> )</p>
</li>
<li>
<p>Is terminated ( <code>isTerminated</code> )</p>
</li>
<li>
<p>Completed task count ( <code>completedTaskCount</code> )</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Client Executor ( <code>HazelcastInstance.ManagedExecutorService</code> )</strong></p>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Work queue size ( <code>queueSize</code> )</p>
</li>
<li>
<p>Thread count of the pool ( <code>poolSize</code> )</p>
</li>
<li>
<p>Maximum thread count of the pool ( <code>maximumPoolSize</code> )</p>
</li>
<li>
<p>Remaining capacity of the work queue ( <code>remainingQueueCapacity</code> )</p>
</li>
<li>
<p>Is shutdown ( <code>isShutdown</code> )</p>
</li>
<li>
<p>Is terminated ( <code>isTerminated</code> )</p>
</li>
<li>
<p>Completed task count ( <code>completedTaskCount</code> )</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Query Executor ( <code>HazelcastInstance.ManagedExecutorService</code> )</strong></p>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Work queue size ( <code>queueSize</code> )</p>
</li>
<li>
<p>Thread count of the pool ( <code>poolSize</code> )</p>
</li>
<li>
<p>Maximum thread count of the pool ( <code>maximumPoolSize</code> )</p>
</li>
<li>
<p>Remaining capacity of the work queue ( <code>remainingQueueCapacity</code> )</p>
</li>
<li>
<p>Is shutdown ( <code>isShutdown</code> )</p>
</li>
<li>
<p>Is terminated ( <code>isTerminated</code> )</p>
</li>
<li>
<p>Completed task count ( <code>completedTaskCount</code> )</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>IO Executor ( <code>HazelcastInstance.ManagedExecutorService</code> )</strong></p>
<div class="ulist">
<ul>
<li>
<p>Name ( <code>name</code> )</p>
</li>
<li>
<p>Work queue size ( <code>queueSize</code> )</p>
</li>
<li>
<p>Thread count of the pool ( <code>poolSize</code> )</p>
</li>
<li>
<p>Maximum thread count of the pool ( <code>maximumPoolSize</code> )</p>
</li>
<li>
<p>Remaining capacity of the work queue ( <code>remainingQueueCapacity</code> )</p>
</li>
<li>
<p>Is shutdown ( <code>isShutdown</code> )</p>
</li>
<li>
<p>Is terminated ( <code>isTerminated</code> )</p>
</li>
<li>
<p>Completed task count ( <code>completedTaskCount</code> )</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="monitoring-with-jmx"><a class="anchor" href="#monitoring-with-jmx"></a><a class="link" href="#monitoring-with-jmx">18.3. Monitoring with JMX</a></h3>
<div class="paragraph">
<p>You can monitor your Hazelcast members via the JMX protocol.</p>
</div>
<div class="paragraph">
<p>To achieve this, first add the following system properties to enable <a href="http://download.oracle.com/javase/1.5.0/docs/guide/management/agent.html">JMX agent</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-Dcom.sun.management.jmxremote</code></p>
</li>
<li>
<p><code>-Dcom.sun.management.jmxremote.port=_portNo\_</code> (to specify JMX port, the default is <code>1099</code>) (<strong>optional</strong>)</p>
</li>
<li>
<p><code>-Dcom.sun.management.jmxremote.authenticate=false</code> (to disable JMX auth) (<strong>optional</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then enable the Hazelcast property <code>hazelcast.jmx</code> (please refer to the <a href="#system-properties">System Properties appendix</a>) using one of the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>By declarative configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;properties&gt;
   &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.jmx</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">true</span>&lt;/property&gt;
&lt;/properties&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>By programmatic configuration:</p>
<div class="paragraph">
<p><code>config.setProperty("hazelcast.jmx", "true");</code></p>
</div>
</li>
<li>
<p>By Spring XML configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hz:properties&gt;
  &lt;hz: property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.jmx</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">true</span>&lt;/hz:property&gt;
&lt;/hz:properties&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>By setting the system property <code>-Dhazelcast.jmx=true</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="mbean-naming-for-hazelcast-data-structures"><a class="anchor" href="#mbean-naming-for-hazelcast-data-structures"></a><a class="link" href="#mbean-naming-for-hazelcast-data-structures">18.3.1. MBean Naming for Hazelcast Data Structures</a></h4>
<div class="paragraph">
<p>Hazelcast set the naming convention for MBeans as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="predefined-type">ObjectName</span> mapMBeanName = <span class="keyword">new</span> <span class="predefined-type">ObjectName</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast:instance=_hzInstance_1_dev,type=IMap,name=trial</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The MBeans name consists of the Hazelcast instance name, the type of the data structure and that data structure&#8217;s name. In the above sample, <code>_hzInstance_1_dev</code> is the instance name, we connect to an IMap with the name <code>trial</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="connecting-to-jmx-agent"><a class="anchor" href="#connecting-to-jmx-agent"></a><a class="link" href="#connecting-to-jmx-agent">18.3.2. Connecting to JMX Agent</a></h4>
<div class="paragraph">
<p>One of the ways you can connect to JMX agent is using jconsole, jvisualvm (with MBean plugin) or another JMX compliant monitoring tool.</p>
</div>
<div class="paragraph">
<p>The other way to connect is to use a custom JMX client.</p>
</div>
<div class="paragraph">
<p>First, you need to specify the URL where the Hazelcast JMX service is running. Please see the following sample code snippet. The <code>port</code> in this sample should be the one that you define while setting the JMX remote port number (if different than the default port <code>1099</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Parameters for connecting to the JMX Service</span>
<span class="type">int</span> port = <span class="integer">1099</span>;
<span class="predefined-type">String</span> hostname = <span class="predefined-type">InetAddress</span>.getLocalHost().getHostName();
<span class="predefined-type">JMXServiceURL</span> url = <span class="keyword">new</span> <span class="predefined-type">JMXServiceURL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">service:jmx:rmi://</span><span class="delimiter">&quot;</span></span> + hostname + <span class="string"><span class="delimiter">&quot;</span><span class="content">:</span><span class="delimiter">&quot;</span></span> + port + <span class="string"><span class="delimiter">&quot;</span><span class="content">/jndi/rmi://</span><span class="delimiter">&quot;</span></span> + hostname + <span class="string"><span class="delimiter">&quot;</span><span class="content">:</span><span class="delimiter">&quot;</span></span> + port + <span class="string"><span class="delimiter">&quot;</span><span class="content">/jmxrmi</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then use the URL you acquired to connect to the JMX service and get the <code>JMXConnector</code> object. Using this object, get the <code>MBeanServerConnection</code> object. The <code>MBeanServerConnection</code> object will enable you to use the MBean methods. Please see the example code below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Connect to the JMX Service</span>
<span class="predefined-type">JMXConnector</span> jmxc = <span class="predefined-type">JMXConnectorFactory</span>.connect(url, <span class="predefined-constant">null</span>);
<span class="predefined-type">MBeanServerConnection</span> mbsc = jmxc.getMBeanServerConnection();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you get the <code>MBeanServerConnection</code> object, you can call the getter methods of MBeans as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="content">Total entries on map </span><span class="delimiter">&quot;</span></span> + mbsc.getAttribute(mapMBeanName, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> : </span><span class="delimiter">&quot;</span></span>
                + mbsc.getAttribute(mapMBeanName, <span class="string"><span class="delimiter">&quot;</span><span class="content">localOwnedEntryCount</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cluster-utilities"><a class="anchor" href="#cluster-utilities"></a><a class="link" href="#cluster-utilities">18.4. Cluster Utilities</a></h3>
<div class="paragraph">
<p>This section provides information on programmatic utilities you can use to listen to the cluster events, to change the state of your cluster, to check whether the cluster and/or members are safe before shutting down a member and to define the minimum number of cluster members required for the cluster to remain up and running. It also gives information on the Hazelcast Lite Member.</p>
</div>
<div class="sect3">
<h4 id="getting-member-events-and-member-sets"><a class="anchor" href="#getting-member-events-and-member-sets"></a><a class="link" href="#getting-member-events-and-member-sets">18.4.1. Getting Member Events and Member Sets</a></h4>
<div class="paragraph">
<p>Hazelcast allows you to register for membership events so you will be notified when members are added or removed. You can also get the set of cluster members.</p>
</div>
<div class="paragraph">
<p>The following example code does the above: registers for member events, notifies when members are added or removed and gets the set of cluster members.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SampleGetMemberEventsAndSets</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
        Cluster cluster = hazelcastInstance.getCluster();
        cluster.addMembershipListener( <span class="keyword">new</span> MembershipListener() {
            <span class="directive">public</span> <span class="type">void</span> memberAdded( MembershipEvent membershipEvent ) {
                <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">MemberAdded </span><span class="delimiter">&quot;</span></span> + membershipEvent );
            }

            <span class="directive">public</span> <span class="type">void</span> memberRemoved( MembershipEvent membershipEvent ) {
                <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">MemberRemoved </span><span class="delimiter">&quot;</span></span> + membershipEvent );
            }
        } );

        <span class="predefined-type">Member</span> localMember  = cluster.getLocalMember();
        <span class="predefined-type">System</span>.out.println ( <span class="string"><span class="delimiter">&quot;</span><span class="content">my inetAddress= </span><span class="delimiter">&quot;</span></span> + localMember.getInetAddress() );

        <span class="predefined-type">Set</span> setMembers  = cluster.getMembers();
        <span class="keyword">for</span> ( <span class="predefined-type">Member</span> member : setMembers ) {
            <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">isLocalMember </span><span class="delimiter">&quot;</span></span> + member.localMember() );
            <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">member.inetaddress </span><span class="delimiter">&quot;</span></span> + member.getInetAddress() );
            <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">member.port </span><span class="delimiter">&quot;</span></span> + member.getPort() );
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="#listening-for-member-events">Membership Listener section</a> for more information on membership events.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="managing-cluster-and-member-states"><a class="anchor" href="#managing-cluster-and-member-states"></a><a class="link" href="#managing-cluster-and-member-states">18.4.2. Managing Cluster and Member States</a></h4>
<div class="paragraph">
<p>Starting with Hazelcast 3.6, Hazelcast introduces cluster and member states in addition to the default <code>ACTIVE</code> state. This section explains these states of Hazelcast clusters and members which you can use to allow or restrict the designated cluster/member operations.</p>
</div>
<div class="sect4">
<h5 id="cluster-states"><a class="anchor" href="#cluster-states"></a><a class="link" href="#cluster-states">Cluster States</a></h5>
<div class="paragraph">
<p>By changing the state of your cluster, you can allow/restrict several cluster operations or change the behavior of those operations. You can use the methods <code>changeClusterState()</code> and <code>shutdown()</code> which are in the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/core/Cluster.html">Cluster interface</a> to change your cluster&#8217;s state.</p>
</div>
<div class="paragraph">
<p>Hazelcast clusters have the following states:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>ACTIVE</code></strong>: This is the default cluster state. Cluster continues to operate without restrictions.</p>
</li>
<li>
<p><strong><code>NO_MIGRATION</code></strong>:</p>
<div class="ulist">
<ul>
<li>
<p>In this state, migrations (partition rebalancing) and backup replications are not allowed. In other words, there will be no data movement between Hazelcast members. However, in case of member failures, backup replicas can be still promoted to the primaries to maintain availability and migration listeners can be notified for these promotion migrations. Please note that promoting a backup replica to the primary replica is a local operation and does not transfer partition data between Hazelcast members.</p>
</li>
<li>
<p>The cluster accepts new members.</p>
</li>
<li>
<p>All other operations are allowed.</p>
</li>
<li>
<p>You cannot change the state of a cluster to <code>NO_MIGRATION</code> when migration/replication tasks are being performed.</p>
</li>
<li>
<p>When you want to add multiple new members to the cluster, you can first change the cluster state to <code>NO_MIGRATION</code>, then start the new members. Once all of them join to the cluster, you can change the cluster state back to <code>ACTIVE</code>. Then, the cluster will rebalance partition replica distribution at once.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>FROZEN</code></strong>:</p>
<div class="ulist">
<ul>
<li>
<p>In this state, the partition table is frozen and partition assignments are not performed.</p>
</li>
<li>
<p>The cluster does not accept new members.</p>
</li>
<li>
<p>If a member leaves, it can join back. Its partition assignments (both primary and backup replicas) remain the same until either it joins back or the cluster state is changed to <code>ACTIVE</code>. When it joins back to the cluster, it will own all previous partition assignments as it was. On the other hand, when the cluster state changes to <code>ACTIVE</code>, re-partitioning starts and unassigned partition replicas are assigned to the active members.</p>
</li>
<li>
<p>All other operations in the cluster, except migration, continue without restrictions.</p>
</li>
<li>
<p>You cannot change the state of a cluster to <code>FROZEN</code> when migration/replication tasks are being performed.</p>
</li>
<li>
<p>You can make use of <code>FROZEN</code> state along with the <a href="#hot-restart-persistence">Hot Restart Persistence</a> feature. You can change the cluster state to <code>FROZEN</code>, then restart some of your members using the Hot Restart feature. The data on the restarting members will not be accessible but you will be able to access to the data that is stored in other members. Basically, <code>FROZEN</code> cluster state allows you do perform maintenance on your members with degrading availability partially.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>PASSIVE</code></strong>:</p>
<div class="ulist">
<ul>
<li>
<p>In this state, the partition table is frozen and partition assignments are not performed.</p>
</li>
<li>
<p>The cluster does not accept new members.</p>
</li>
<li>
<p>If a member leaves while the cluster is in this state, the member will be removed from the partition table if cluster state moves back to <code>ACTIVE</code>.</p>
</li>
<li>
<p>This state rejects ALL operations immediately EXCEPT the read-only operations like <code>map.get()</code> and <code>cache.get()</code>, replication and cluster heartbeat tasks.</p>
</li>
<li>
<p>You cannot change the state of a cluster to <code>PASSIVE</code> when migration/replication tasks are being performed.</p>
</li>
<li>
<p>You can make use of <code>PASSIVE</code> state along with the <a href="#hot-restart-persistence">Hot Restart Persistence</a> feature. Please see <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/core/Cluster.html#shutdown--">Cluster Shutdown API</a> for more info.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>IN_TRANSITION</code></strong>:</p>
<div class="ulist">
<ul>
<li>
<p>This state shows that the state of the cluster is in transition.</p>
</li>
<li>
<p>You cannot set your cluster&#8217;s state as <code>IN_TRANSITION</code> explicitly.</p>
</li>
<li>
<p>It is a temporary and intermediate state.</p>
</li>
<li>
<p>During this state, your cluster does not accept new members and migration/replication tasks are paused.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All in-cluster methods are fail-fast, i.e., when a method fails in the cluster, it throws an exception immediately (it will not be retried).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following snippet is from the <code>Cluster</code> interface showing the methods used to manage your cluster&#8217;s states.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Cluster</span> {
...
...
    ClusterState getClusterState();
    <span class="type">void</span> changeClusterState(ClusterState newState);
    <span class="type">void</span> changeClusterState(ClusterState newState, TransactionOptions transactionOptions);
    <span class="type">void</span> shutdown();
    <span class="type">void</span> shutdown(TransactionOptions transactionOptions);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/core/Cluster.html">Cluster interface</a> for information on these methods.</p>
</div>
</div>
<div class="sect4">
<h5 id="cluster-member-states"><a class="anchor" href="#cluster-member-states"></a><a class="link" href="#cluster-member-states">Cluster Member States</a></h5>
<div class="paragraph">
<p>Hazelcast cluster members have the following states:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>ACTIVE</code></strong>: This is the initial member state. The member can execute and process all operations. When the state of the cluster is <code>ACTIVE</code> or <code>FROZEN</code>, the members are in the <code>ACTIVE</code> state.</p>
</li>
<li>
<p><strong><code>PASSIVE</code></strong>: In this state, member rejects all operations EXCEPT the read-only ones, replication and migration operations, heartbeat operations and the join operations as explained in the <a href="#cluster-states">Cluster States section</a> above. A member can go into this state when either of the following happens:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Until the member&#8217;s shutdown process is completed after the method <code>Node.shutdown(boolean)</code> is called. Note that, when the shutdown process is completed, member&#8217;s state changes to <code>SHUT_DOWN</code>.</p>
</li>
<li>
<p>Cluster&#8217;s state is changed to <code>PASSIVE</code> using the method <code>changeClusterState()</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong><code>SHUT_DOWN</code></strong>: A member goes into this state when the member&#8217;s shutdown process is completed. The member in this state rejects all operations and invocations. A member in this state cannot be restarted.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-the-script-cluster-sh"><a class="anchor" href="#using-the-script-cluster-sh"></a><a class="link" href="#using-the-script-cluster-sh">18.4.3. Using the Script cluster.sh</a></h4>
<div class="paragraph">
<p>You can use the script <code>cluster.sh</code>, which comes with the Hazelcast package, to get/change the state of your cluster, to shutdown your cluster and to force your cluster to clean its persisted data and make a fresh start. The latter is the Force Start operation of Hazelcast&#8217;s Hot Restart Persistence feature. Please refer to the <a href="#force-start">Force Start section</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The script <code>cluster.sh</code> uses <code>curl</code> command and <code>curl</code> must be installed to be able to use the script.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The script <code>cluster.sh</code> needs the following parameters to operate according to your needs. If these parameters are not provided, the default values are used.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 55.5556%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code> or <code>--operation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get-state</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Executes a cluster-wide operation. Operations can be the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IMDG Open Source operations: <code>get-state</code>, <code>change-state</code>, <code>shutdown</code> and <code>get-cluster-version</code>.</p>
</li>
<li>
<p>IMDG Enterprise operations: <code>force-start</code>, <code>partial-start</code> and <code>change-cluster-version</code>.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code> or <code>--state</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Updates the state of the cluster to a new state. New state can be <code>active</code>, <code>no_migration</code>, <code>frozen</code>, <code>passive</code>. This is used with the operation <code>change-state</code>. This parameter has no default value; when you use this, you should provide a valid state.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code> or <code>--address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>127.0.0.1</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Defines the IP address of a cluster member. If you want to manage your cluster remotely, you should use this parameter to provide the IP address of a member to this script.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code> or <code>--port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5701</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Defines on which port Hazelcast is running on the local or remote machine. Its default value is <code>5701</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-g</code> or <code>--groupname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dev</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Defines the name of a cluster group which is used for a simple authentication. Please see the <a href="#creating-cluster-groups">Creating Cluster Groups section</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code> or <code>--password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dev-pass</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Defines the password of a cluster group (valid only for Hazelcast releases older than 3.8.2). Please see the <a href="#creating-cluster-groups">Creating Cluster Groups section</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code> or <code>--version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Defines the cluster version to change to. To be used in conjunction with <code>change-cluster-version</code> operation.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The script <code>cluster.sh</code> is self-documented; you can see the parameter descriptions using the command <code>sh cluster.sh -h</code> or <code>sh cluster.sh --help</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can perform the above operations using the Hot Restart tab of Hazelcast Management Center or using the REST API. Please see the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#hot-restart">Hot Restart</a> and <a href="#using-rest-api-for-cluster-management">Using REST API for Cluster Management</a>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="example-usages-for-cluster-sh"><a class="anchor" href="#example-usages-for-cluster-sh"></a><a class="link" href="#example-usages-for-cluster-sh">Example Usages for cluster.sh</a></h5>
<div class="paragraph">
<p>Let&#8217;s say you have a cluster running on remote machines and one Hazelcast member is running on the IP  <code>172.16.254.1</code> and on the port
<code>5702</code>. The group name and password of the cluster are <code>test</code> and <code>test</code>.</p>
</div>
<div class="paragraph">
<p><strong>Getting the cluster state:</strong></p>
</div>
<div class="paragraph">
<p>To get the state of the cluster, use the following command:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh -o get-state -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>The following also gets the cluster state, using the alternative parameter names, e.g., <code>--port</code> instead of <code>-p</code>:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh --operation get-state --address 172.16.254.1 --port 5702 --groupname test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Changing the cluster state:</strong></p>
</div>
<div class="paragraph">
<p>To change the state of the cluster to <code>frozen</code>, use the following command:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh -o change-state -s frozen -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>Similarly, you can use the following command for the same purpose:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh --operation change-state --state frozen --address 172.16.254.1 --port 5702 --groupname test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Shutting down the cluster:</strong></p>
</div>
<div class="paragraph">
<p>To shutdown the cluster, use the following command:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh -o shutdown -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>Similarly, you can use the following command for the same purpose:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh --operation shutdown --address 172.16.254.1 --port 5702 --groupname test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Partial starting the cluster:</strong></p>
</div>
<div class="paragraph">
<p>To partial start the cluster when Hot Restart is enabled, use the following command:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh -o partial-start -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>Similarly, you can use the following command for the same purpose:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh --operation partial-start --address 172.16.254.1 --port 5702 --groupname test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Force starting the cluster:</strong></p>
</div>
<div class="paragraph">
<p>To force start the cluster when Hot Restart is enabled, use the following command:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh -o force-start -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>Similarly, you can use the following command for the same purpose:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh --operation force-start --address 172.16.254.1 --port 5702 --groupname test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Getting the current cluster version:</strong></p>
</div>
<div class="paragraph">
<p>To get the cluster version, use the following command:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh -o get-cluster-version -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>The following also gets the cluster state, using the alternative parameter names, e.g., <code>--port</code> instead of <code>-p</code>:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh --operation get-cluster-version --address 172.16.254.1 --port 5702 --groupname test --password test</code></p>
</div>
<div class="paragraph">
<p><strong>Changing cluster version:</strong></p>
</div>
<div class="paragraph">
<p>Learn more about when you should change the cluster version in <a href="#rolling-member-upgrades">Rolling Member Upgrades chapter</a>.</p>
</div>
<div class="paragraph">
<p>To change the cluster version to <code>3.9</code>, use the following command:</p>
</div>
<div class="paragraph">
<p><code>sh cluster.sh -o change-cluster-version -v 3.9 -a 172.16.254.1 -p 5702 -g test -P test</code></p>
</div>
<div class="paragraph">
<p>Cluster version is always in <code>major.minor</code> format, using other formats will result in a failure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, this script is not supported on the Windows platforms.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-rest-api-for-cluster-management"><a class="anchor" href="#using-rest-api-for-cluster-management"></a><a class="link" href="#using-rest-api-for-cluster-management">18.4.4. Using REST API for Cluster Management</a></h4>
<div class="paragraph">
<p>Besides the Management Center&#8217;s Hot Restart <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#hot-restart">tab</a> and the script <a href="#using-the-script-cluster-sh"><code>cluster.sh</code></a>, you can also use REST API to manage your cluster&#8217;s state. The following are the operations you can perform.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. REST API calls</caption>
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>IMDG Open Source commands</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Getting the cluster state:</em></p>
<div class="paragraph">
<p>To get the state of the cluster, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">curl --data <span class="string"><span class="delimiter">&quot;</span><span class="content">${GROUPNAME}&amp;${PASSWORD}</span><span class="delimiter">&quot;</span></span> http:<span class="comment">//127.0.0.1:5701/hazelcast/rest/management/cluster/state</span></code></pre>
</div>
</div>
</li>
<li>
<p><em>Changing the cluster state:</em></p>
<div class="paragraph">
<p>To change the state of the cluster to <code>frozen</code>, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">curl --data <span class="string"><span class="delimiter">&quot;</span><span class="content">${GROUPNAME}&amp;${PASSWORD}&amp;${STATE}</span><span class="delimiter">&quot;</span></span> http:<span class="comment">//127.0.0.1:${PORT}/hazelcast/rest/management/cluster/changeState</span></code></pre>
</div>
</div>
</li>
<li>
<p><em>Shutting down the cluster:</em></p>
<div class="paragraph">
<p>To shutdown the cluster, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">curl --data <span class="string"><span class="delimiter">&quot;</span><span class="content">${GROUPNAME}&amp;${PASSWORD}</span><span class="delimiter">&quot;</span></span>  http:<span class="comment">//127.0.0.1:${PORT}/hazelcast/rest/management/cluster/clusterShutdown</span></code></pre>
</div>
</div>
</li>
<li>
<p><em>Querying the current cluster version:</em></p>
<div class="paragraph">
<p>To get the current cluster version, use the following <code>curl</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span> curl http:<span class="comment">//127.0.0.1:${PORT}/hazelcast/rest/management/cluster/version</span>
  {<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">3.9</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>IMDG Enterprise commands</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Partial starting the cluster:</em></p>
<div class="paragraph">
<p>To partial start the cluster when Hot Restart is enabled, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">curl --data <span class="string"><span class="delimiter">&quot;</span><span class="content">${GROUPNAME}&amp;${PASSWORD}</span><span class="delimiter">&quot;</span></span> http:<span class="comment">//127.0.0.1:${PORT}/hazelcast/rest/management/cluster/partialStart/</span></code></pre>
</div>
</div>
</li>
<li>
<p><em>Force starting the cluster:</em></p>
<div class="paragraph">
<p>To force start the cluster when Hot Restart is enabled, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">curl --data <span class="string"><span class="delimiter">&quot;</span><span class="content">${GROUPNAME}&amp;${PASSWORD}</span><span class="delimiter">&quot;</span></span> http:<span class="comment">//127.0.0.1:${PORT}/hazelcast/rest/management/cluster/forceStart/</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also perform the above operations (partialStart and forceStart) using the Hot Restart tab of Hazelcast Management Center or using the script <code>cluster.sh</code>. Please see the <a href="http://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#hot-restart">Hot Restart</a> and <a href="#using-the-script-cluster-sh"><code>cluster.sh</code></a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><em>Initiating Hot Backup:</em></p>
<div class="paragraph">
<p>To initiate the Hot Backup, use the following <code>curl</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">curl --data <span class="string"><span class="delimiter">&quot;</span><span class="content">${GROUPNAME}&amp;${PASSWORD}</span><span class="delimiter">&quot;</span></span> http:<span class="comment">//127.0.0.1:${PORT}/hazelcast/rest/management/cluster/hotBackup</span></code></pre>
</div>
</div>
</li>
<li>
<p><em>Changing the cluster version:</em></p>
<div class="paragraph">
<p>To upgrade the cluster version, after having upgraded all members of your cluster to a new minor version, use the following <code>curl</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span> curl --data <span class="string"><span class="delimiter">&quot;</span><span class="content">${GROUPNAME}&amp;${PASSWORD}&amp;${CLUSTER_VERSION}</span><span class="delimiter">&quot;</span></span> http:<span class="comment">//127.0.0.1:${PORT}/hazelcast/rest/management/cluster/version</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, assuming the default group name and password, issue the following command to any member of the cluster to upgrade from cluster version 3.8 to 3.9:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span> curl --data <span class="string"><span class="delimiter">&quot;</span><span class="content">dev&amp;dev-pass&amp;3.9</span><span class="delimiter">&quot;</span></span> http:<span class="comment">//127.0.0.1:5701/hazelcast/rest/management/cluster/version</span>
  {<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">success</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">3.9</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also perform the above cluster version operations using Hazelcast Management Center or using the script <code>cluster.sh</code>. Please see the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#rolling-upgrade">Rolling Member Upgrades</a> and <a href="#using-the-script-cluster-sh"><code>cluster.sh</code></a>.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="enabling-lite-members"><a class="anchor" href="#enabling-lite-members"></a><a class="link" href="#enabling-lite-members">18.4.5. Enabling Lite Members</a></h4>
<div class="paragraph">
<p>Lite members are the Hazelcast cluster members that do not store data. These members are used mainly to execute tasks and register listeners and they do not have partitions.</p>
</div>
<div class="paragraph">
<p>You can form your cluster to include the regular Hazelcast members to store data and Hazelcast lite members to run heavy computations. The presence of the lite members do not affect the operations performed on the other members in the cluster. You can directly submit your tasks to the lite members, register listeners on them and invoke operations for the Hazelcast data structures on them such as <code>map.put()</code> and <code>map.get()</code>.</p>
</div>
<div class="sect4">
<h5 id="configuring-lite-members"><a class="anchor" href="#configuring-lite-members"></a><a class="link" href="#configuring-lite-members">Configuring Lite Members</a></h5>
<div class="paragraph">
<p>You can enable a cluster member to be a lite member using declarative or programmatic configuration.</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
    &lt;lite-member enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
config.setLiteMember(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="promoting-lite-members-to-data-member"><a class="anchor" href="#promoting-lite-members-to-data-member"></a><a class="link" href="#promoting-lite-members-to-data-member">Promoting Lite Members to Data Member</a></h5>
<div class="paragraph">
<p>Lite members can be promoted to data members using the <code>Cluster</code> interface. When they are promoted, cluster partitions are rebalanced and ownerships of some portion of the partitions are assigned to the newly promoted data members.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
config.setLiteMember(<span class="predefined-constant">true</span>);

HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance(config);
Cluster cluster = hazelcastInstance.getCluster();
cluster.promoteLocalLiteMember();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A data member cannot be downgraded to a lite member back.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="defining-member-attributes"><a class="anchor" href="#defining-member-attributes"></a><a class="link" href="#defining-member-attributes">18.4.6. Defining Member Attributes</a></h4>
<div class="paragraph">
<p>You can define various member attributes on your Hazelcast members. You can use these member attributes to tag your members as your business logic requirements.</p>
</div>
<div class="paragraph">
<p>To define member attribute on a member, you can either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>provide <code>MemberAttributeConfig</code> to your <code>Config</code> object,</p>
</li>
<li>
<p>or provide member attributes at runtime via attribute setter methods on the <code>Member</code> interface.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, you can tag your members with their CPU characteristics and you can route CPU intensive tasks to those CPU-rich members:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SampleMemberAttributes</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        MemberAttributeConfig fourCore = <span class="keyword">new</span> MemberAttributeConfig();
        memberAttributeConfig.setIntAttribute( <span class="string"><span class="delimiter">&quot;</span><span class="content">CPU_CORE_COUNT</span><span class="delimiter">&quot;</span></span>, <span class="integer">4</span> );
        MemberAttributeConfig twelveCore = <span class="keyword">new</span> MemberAttributeConfig();
        memberAttributeConfig.setIntAttribute( <span class="string"><span class="delimiter">&quot;</span><span class="content">CPU_CORE_COUNT</span><span class="delimiter">&quot;</span></span>, <span class="integer">12</span> );
        MemberAttributeConfig twentyFourCore = <span class="keyword">new</span> MemberAttributeConfig();
        memberAttributeConfig.setIntAttribute( <span class="string"><span class="delimiter">&quot;</span><span class="content">CPU_CORE_COUNT</span><span class="delimiter">&quot;</span></span>, <span class="integer">24</span> );

        Config member1Config = <span class="keyword">new</span> Config();
        config.setMemberAttributeConfig( fourCore );
        Config member2Config = <span class="keyword">new</span> Config();
        config.setMemberAttributeConfig( twelveCore );
        Config member3Config = <span class="keyword">new</span> Config();
        config.setMemberAttributeConfig( twentyFourCore );

        HazelcastInstance member1 = Hazelcast.newHazelcastInstance( member1Config );
        HazelcastInstance member2 = Hazelcast.newHazelcastInstance( member2Config );
        HazelcastInstance member3 = Hazelcast.newHazelcastInstance( member3Config );

        IExecutorService executorService = member1.getExecutorService( <span class="string"><span class="delimiter">&quot;</span><span class="content">processor</span><span class="delimiter">&quot;</span></span> );

        executorService.execute( <span class="keyword">new</span> CPUIntensiveTask(), <span class="keyword">new</span> MemberSelector() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">boolean</span> select(<span class="predefined-type">Member</span> member) {
                <span class="type">int</span> coreCount = (<span class="type">int</span>) member.getIntAttribute( <span class="string"><span class="delimiter">&quot;</span><span class="content">CPU_CORE_COUNT</span><span class="delimiter">&quot;</span></span> );
                <span class="comment">// Task will be executed at either member2 or member3</span>
                <span class="keyword">if</span> ( coreCount &gt; <span class="integer">8</span> ) {
                    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
                }
                <span class="keyword">return</span> <span class="predefined-constant">false</span>;
            }
        } );

        HazelcastInstance member4 = Hazelcast.newHazelcastInstance();
        <span class="comment">// We can also set member attributes at runtime.</span>
        member4.setIntAttribute( <span class="string"><span class="delimiter">&quot;</span><span class="content">CPU_CORE_COUNT</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span> );
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For another example, you can tag some members with a filter so that a member in the cluster can load classes from those tagged members. Please see the <a href="#member-user-code-deployment-beta">User Code Deployment section</a> for more information.</p>
</div>
<div class="paragraph">
<p>You can also configure your member attributes through declarative configuration and start your member afterwards. Here is how you can use the declarative approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;member-attributes&gt;
  &lt;attribute name=<span class="string"><span class="delimiter">&quot;</span><span class="content">CPU_CORE_COUNT</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">4</span>&lt;/attribute-name&gt;
&lt;/member-attributes&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="safety-checking-cluster-members"><a class="anchor" href="#safety-checking-cluster-members"></a><a class="link" href="#safety-checking-cluster-members">18.4.7. Safety Checking Cluster Members</a></h4>
<div class="paragraph">
<p>To prevent data loss when shutting down a cluster member, Hazelcast provides a graceful shutdown feature. You perform this shutdown by calling the method <code>HazelcastInstance.shutdown()</code>.</p>
</div>
<div class="paragraph">
<p>Starting with Hazelcast 3.7, the master member migrates all of the replicas owned by the shutdown-requesting member to the other running (not initiated shutdown) cluster members. After these migrations are completed, the shutting down member will not be the owner or a backup of any partition anymore. It means that you can shutdown any number of Hazelcast members in a cluster concurrently with no data loss.</p>
</div>
<div class="paragraph">
<p>Please note that the process of shutting down members waits for a predefined amount of time for the master to migrate their partition replicas. You can specify this graceful shutdown timeout duration using the property <code>hazelcast.graceful.shutdown.max.wait</code>. Its default value is 10 minutes. If migrations are not completed within this duration, shutdown may continue non-gracefully and lead to data loss. Therefore, you should choose your own timeout duration considering the size of data in your cluster.</p>
</div>
<div class="sect4">
<h5 id="ensuring-safe-state-with-partitionservice"><a class="anchor" href="#ensuring-safe-state-with-partitionservice"></a><a class="link" href="#ensuring-safe-state-with-partitionservice">Ensuring Safe State with PartitionService</a></h5>
<div class="paragraph">
<p>With the improvements in graceful shutdown procedure in Hazelcast 3.7, the following methods are not needed to perform graceful shutdown. Nevertheless, you can use them to check the current safety status of the partitions in your cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">PartitionService</span> {
   ...
   ...
    boolean isClusterSafe();
    <span class="type">boolean</span> isMemberSafe(<span class="predefined-type">Member</span> member);
    <span class="type">boolean</span> isLocalMemberSafe();
    <span class="type">boolean</span> forceLocalMemberToBeSafe(<span class="type">long</span> timeout, <span class="predefined-type">TimeUnit</span> unit);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method <code>isClusterSafe</code> checks whether the cluster is in a safe state. It returns <code>true</code> if there are no active partition migrations and all backups are in sync for each partition.</p>
</div>
<div class="paragraph">
<p>The method <code>isMemberSafe</code> checks whether a specific member is in a safe state. It checks if all backups of partitions of the given member are in sync with the primary ones. Once it returns <code>true</code>, the given member is safe and it can be shut down without data loss.</p>
</div>
<div class="paragraph">
<p>Similarly, the method <code>isLocalMemberSafe</code> does the same check for the local member. The method <code>forceLocalMemberToBeSafe</code> forces the owned and backup partitions to be synchronized, making the local member safe.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you want to use the above methods, please note that they are available starting with Hazelcast 3.3.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more code samples please refer to <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/monitoring/cluster-safety">PartitionService Code Samples</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="diagnostics"><a class="anchor" href="#diagnostics"></a><a class="link" href="#diagnostics">18.5. Diagnostics</a></h3>
<div class="paragraph">
<p>Starting with Hazelcast 3.7, Hazelcast offers an extended set of diagnostics plugins for both Hazelcast members and clients. A dedicated log file is used to write the diagnostics content, and a rolling file approach is used to prevent taking up too much disk space.</p>
</div>
<div class="sect3">
<h4 id="enabling-diagnostics-logging"><a class="anchor" href="#enabling-diagnostics-logging"></a><a class="link" href="#enabling-diagnostics-logging">18.5.1. Enabling Diagnostics Logging</a></h4>
<div class="paragraph">
<p>To enable diagnostics logging, you should specify the following properties on the member side:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.diagnostics.enabled=<span class="predefined-constant">true</span>
-Dhazelcast.diagnostics.metric.level=info
-Dhazelcast.diagnostics.invocation.sample.period.seconds=<span class="integer">30</span>
-Dhazelcast.diagnostics.pending.invocations.period.seconds=<span class="integer">30</span>
-Dhazelcast.diagnostics.slowoperations.period.seconds=<span class="integer">30</span>
-Dhazelcast.diagnostics.storeLatency.period.seconds=<span class="integer">60</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At the client side you should specify the following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.diagnostics.enabled=<span class="predefined-constant">true</span>
-Dhazelcast.diagnostics.metric.level=info</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="diagnostics-log-file"><a class="anchor" href="#diagnostics-log-file"></a><a class="link" href="#diagnostics-log-file">18.5.2. Diagnostics Log File</a></h4>
<div class="paragraph">
<p>You can use the following property to specify the location of the diagnostics log file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.diagnostics.directory=/your/log/directory</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the log file has the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">diagnostics-&lt;host IP&gt;<span class="error">#</span>&lt;port&gt;-&lt;unique ID&gt;.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the log file can be prefixed with a custom string as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.diagnostics.filename.prefix=foobar</code></pre>
</div>
</div>
<div class="paragraph">
<p>The content format of the diagnostics log file is depicted below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;<span class="predefined-type">Date</span>&gt; BuildInfo[
        &lt;log content <span class="keyword">for</span> BuildInfo diagnostics plugin&gt;]
&lt;<span class="predefined-type">Date</span>&gt; SystemProperties[
        &lt;log content <span class="keyword">for</span> SystemProperties diagnostics plugin&gt;]
&lt;<span class="predefined-type">Date</span>&gt; ConfigProperties[
        &lt;log content <span class="keyword">for</span> ConfigProperties diagnostics plugin&gt;]
&lt;<span class="predefined-type">Date</span>&gt; Metrics[
        &lt;log content <span class="keyword">for</span> Metrics diagnostics plugin&gt;]
&lt;<span class="predefined-type">Date</span>&gt; SlowOperations[
        &lt;log content <span class="keyword">for</span> SlowOperations diagnostics plugin&gt;]
&lt;<span class="predefined-type">Date</span>&gt; HazelcastInstance[
        &lt;log content <span class="keyword">for</span> HazelcastInstance diagnostics plugin&gt;]
...
...
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>A rolling file approach is used to prevent creating too much data. By default 10 files of 50MB each are allowed
to exist. The size of the file can be changed using the following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.diagnostics.max.rolled.file.size.mb=<span class="integer">100</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set the number of files using the following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.diagnostics.max.rolled.file.count=<span class="integer">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Hazelcast 3.9 the default file size has been upgraded from 10MB to 50MB.</p>
</div>
</div>
<div class="sect3">
<h4 id="diagnostics-plugins"><a class="anchor" href="#diagnostics-plugins"></a><a class="link" href="#diagnostics-plugins">18.5.3. Diagnostics Plugins</a></h4>
<div class="paragraph">
<p>As it is stated in the introduction of this section and shown in the log file content above, diagnostics utility consists of plugins such as BuildInfo, SystemProperties and HazelcastInstance.</p>
</div>
<div class="sect4">
<h5 id="buildinfo"><a class="anchor" href="#buildinfo"></a><a class="link" href="#buildinfo">BuildInfo</a></h5>
<div class="paragraph">
<p>It shows the detailed Hazelcast build information including the Hazelcast release number, <code>Git</code> revision number and whether you have Hazelcast IMDG Enterprise or not.</p>
</div>
</div>
<div class="sect4">
<h5 id="systemproperties"><a class="anchor" href="#systemproperties"></a><a class="link" href="#systemproperties">SystemProperties</a></h5>
<div class="paragraph">
<p>It shows all the properties and their values in your system used by and configured for your Hazelcast installation. These are the properties starting with <code>java</code> (excluding <code>java.awt</code>), <code>hazelcast</code>, <code>sun</code> and <code>os</code>. It also includes the arguments that are used to startup the JVM.</p>
</div>
</div>
<div class="sect4">
<h5 id="configproperties"><a class="anchor" href="#configproperties"></a><a class="link" href="#configproperties">ConfigProperties</a></h5>
<div class="paragraph">
<p>It shows the Hazelcast properties and their values explicitly set by you either on the command line (with <code>-D</code>) or by using declarative/programmatic configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="metrics"><a class="anchor" href="#metrics"></a><a class="link" href="#metrics">Metrics</a></h5>
<div class="paragraph">
<p>It shows a comprehensive log of what is happening in your Hazelcast system.</p>
</div>
<div class="paragraph">
<p>You can configure the level of detail and frequency of dumping information to the log file using the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.diagnostics.metrics.period.seconds</code>: Set a value in seconds. Its default value is <code>60</code> seconds.</p>
</li>
<li>
<p><code>hazelcast.diagnostics.metrics.level</code>: Set a level. It can be <code>Mandatory</code>, <code>Info</code> and <code>Debug</code>. Its default value is <code>Mandatory</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="slowoperations"><a class="anchor" href="#slowoperations"></a><a class="link" href="#slowoperations">SlowOperations</a></h5>
<div class="paragraph">
<p>It shows the slow operations and invocations, Please refer to <a href="#slowoperationdetector ">SlowOperationDetector</a> for more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="invocations"><a class="anchor" href="#invocations"></a><a class="link" href="#invocations">Invocations</a></h5>
<div class="paragraph">
<p>It shows all kinds of statistics about current and past invocations including current pending invocations, history of invocations and slow history, i.e. all samples where the invocation took more than the defined threshold.  Slow history does not only include the invocations where the operations took a lot of time, but it also includes any other invocations that have been obstructed.</p>
</div>
<div class="paragraph">
<p>Using the following properties, you can configure the frequency of scanning all pending invocations and the threshold that makes an invocation to be considered as slow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.diagnostics.invocation.sample.period.seconds</code>: Set a value in seconds. Its default value is <code>60</code> seconds.</p>
</li>
<li>
<p><code>hazelcast.diagnostics.invocation.slow.threshold.seconds</code>: Set a value in seconds. Its default value is <code>5</code> seconds.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="hazelcastinstance"><a class="anchor" href="#hazelcastinstance"></a><a class="link" href="#hazelcastinstance">HazelcastInstance</a></h5>
<div class="paragraph">
<p>It shows the basic state of your Hazelcast cluster including the count and addresses of current members and the address of master member. It is useful to get a fast impression of the cluster without needing to analyze a lot of data.</p>
</div>
<div class="paragraph">
<p>You can configure the frequency at which the cluster information is dumped to the log file using the following property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.diagnostics.memberinfo.period.second</code>: Set a value in seconds. Its default value is <code>60</code> seconds.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="systemlog"><a class="anchor" href="#systemlog"></a><a class="link" href="#systemlog">SystemLog</a></h5>
<div class="paragraph">
<p>It shows the activities in your cluster including when a connection/member is added or removed and if there is a change in the lifecycle of the cluster. It also includes the reasons for connection closings.</p>
</div>
<div class="paragraph">
<p>You can enable or disable the system log diagnostics plugin, and configure whether it shows information about partition migrations using the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.diagnostics.systemlog.enabled</code>: Its default value is <code>true</code>.</p>
</li>
<li>
<p><code>hazelcast.diagnostics.systemlog.partitions</code>: Its default value is <code>false</code>. Please note that if you enable this, you may get a lot of log entries if you have many partitions.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="storelatency"><a class="anchor" href="#storelatency"></a><a class="link" href="#storelatency">StoreLatency</a></h5>
<div class="paragraph">
<p>It shows statistics including the count of methods for each store (<code>load</code>, <code>loadAll</code>, <code>loadAllKeys</code>, etc.), average and maximum latencies for each store method calls and latency distributions for each store. The following is an example output snippet as part of the diagnostics log file for Hazelcast MapStore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="integer">17</span>-<span class="integer">9</span>-<span class="integer">2016</span> <span class="integer">13</span>:<span class="integer">12</span>:<span class="integer">34</span> MapStoreLatency[
              map[
                 loadAllKeys[
                    count=<span class="integer">1</span>
                    totalTime(us)=<span class="integer">8</span>
                    avg(us)=<span class="integer">8</span>
                    max(us)=<span class="integer">8</span>
                    latency-distribution[
                    <span class="integer">0</span>.<span class="float">.99</span>us=<span class="integer">1</span>]]
                 load[
                    count=<span class="integer">100</span>
                    totalTime(us)=<span class="integer">4</span>,<span class="integer">632</span>,<span class="integer">190</span>
                    avg(us)=<span class="integer">46</span>,<span class="integer">321</span>
                    max(us)=<span class="integer">99</span>,<span class="integer">178</span>
                    latency-distribution[
                           <span class="integer">0</span>.<span class="float">.99</span>us=<span class="integer">1</span>
                           <span class="integer">1600</span>.<span class="float">.3199</span>us=<span class="integer">3</span>
                           <span class="integer">3200</span>.<span class="float">.6399</span>us=<span class="integer">3</span>
                           <span class="integer">6400</span>.<span class="float">.12799</span>us=<span class="integer">7</span>
                           <span class="integer">12800</span>.<span class="float">.25599</span>us=<span class="integer">13</span>
                           <span class="integer">25600</span>.<span class="float">.51199</span>us=<span class="integer">32</span>
                           <span class="integer">51200</span>.<span class="float">.102399</span>us=<span class="integer">41</span>]]]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>According to your store usage, a similar output can be seen for Hazelcast JCache, Queue and Ringbuffer with persistent datastores.</p>
</div>
<div class="paragraph">
<p>You can control the StoreLatency plugin using the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.diagnostics.storeLatency.period.seconds</code>: The frequency this plugin is writing the collected information to the disk. By default it is disabled. A sensible production value would be <code>60</code> seconds.</p>
</li>
<li>
<p><code>hazelcast.diagnostics.storeLatency.reset.period.seconds</code>: The period of resetting the statistics. If, for example, it is set as 300 (5 minutes), all the statistics are cleared for every 5 minutes. By default it is 0, meaning that statistics are not reset.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="operationheartbeats"><a class="anchor" href="#operationheartbeats"></a><a class="link" href="#operationheartbeats">OperationHeartbeats</a></h5>
<div class="paragraph">
<p>It shows the deviation between member/member operation heartbeats. Every member will send to every other member, regardless if
there is an operation running on behalf of that member, an operation heartbeat. It contains a listing of all `callId`s of the running
operations from a given member. This plugin also works fine between members/lite-members.</p>
</div>
<div class="paragraph">
<p>Because this operation heartbeat is sent periodically; by default 1/4 of the operation call timeout of 60 seconds, we would expect
an operation heartbeat to be received every 15 seconds. Operation heartbeats are high priority packets (so they overtake regular packets)
and are processed by an isolated thread in the invocation monitor. If there is any deviation in the frequency of receiving
these packets, it may be due to the problems such as network latencies.</p>
</div>
<div class="paragraph">
<p>The following shows an example of the output where an operation heartbeat has not been received for 37 seconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="integer">20</span>-<span class="integer">7</span>-<span class="integer">2017</span> <span class="integer">11</span>:<span class="integer">12</span>:<span class="integer">55</span> OperationHeartbeats[
            member[<span class="float">10.212</span><span class="float">.1</span><span class="float">.119</span>]:<span class="integer">5701</span>[
                   deviation(%)=<span class="float">146.6666717529297</span>
                   noHeartbeat(ms)=<span class="integer">37</span>,<span class="octal">000</span>
                   lastHeartbeat(ms)=<span class="integer">1</span>,<span class="integer">500</span>,<span class="integer">538</span>,<span class="integer">375</span>,<span class="integer">603</span>
                   lastHeartbeat(date-time)=<span class="integer">20</span>-<span class="integer">7</span>-<span class="integer">2017</span> <span class="integer">11</span>:<span class="integer">12</span>:<span class="integer">55</span>
                   now(ms)=<span class="integer">1</span>,<span class="integer">500</span>,<span class="integer">538</span>,<span class="integer">338</span>,<span class="integer">603</span>
                   now(date-time)=<span class="integer">20</span>-<span class="integer">7</span>-<span class="integer">2017</span> <span class="integer">11</span>:<span class="integer">12</span>:<span class="integer">18</span>]]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The OperationHeartbeats plugin is enabled by default since it has very little overhead and will only print to the diagnostics
file if the max-deviation (explained below) is exceeded.</p>
</div>
<div class="paragraph">
<p>You can control the OperationHeartbeats plugin using the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.diagnostics.operation-heartbeat.seconds</code>: The frequency this plugin is writing the collected information to the disk. It is configured to be 10 seconds by default. 0 disables the plugin.</p>
</li>
<li>
<p><code>hazelcast.diagnostics.operation-heartbeat.max-deviation-percentage</code>:  The maximum allowed deviation percentage. Its default value is 33. For example, with a default 60 call timeout and operation heartbeat interval being 15 seconds, the maximum deviation with a deviation-percentage of 33, is 5 seconds. So there is no problem if a packet is arrived after 19 seconds, but if it arrives after 21 seconds, then the plugin will render.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="memberheartbeats"><a class="anchor" href="#memberheartbeats"></a><a class="link" href="#memberheartbeats">MemberHeartbeats</a></h5>
<div class="paragraph">
<p>This plugin looks a lot like the OperationHeartbeats plugin, but instead of relying on operation heartbeats to determine the deviation, it relies on member/member cluster heartbeats. Every member will send a heartbeat to every other member periodically (by default every 5 seconds).</p>
</div>
<div class="paragraph">
<p>Just like the OperationHeartbeats, the MemberHeartbeats plugin can be used to detect if there are networking problems long before they actually lead to problems such as split-brain syndromes.</p>
</div>
<div class="paragraph">
<p>The following shows an example of the output where no member/member heartbeat has been received for 9 seconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="integer">20</span>-<span class="integer">7</span>-<span class="integer">2017</span> <span class="integer">19</span>:<span class="integer">32</span>:<span class="integer">22</span> MemberHeartbeats[
             member[<span class="float">10.212</span><span class="float">.1</span><span class="float">.119</span>]:<span class="integer">5701</span>[
                    deviation(%)=<span class="float">80.0</span>
                    noHeartbeat(ms)=<span class="integer">9</span>,<span class="octal">000</span>
                    lastHeartbeat(ms)=<span class="integer">1</span>,<span class="integer">500</span>,<span class="integer">568</span>,<span class="integer">333</span>,<span class="integer">645</span>
                    lastHeartbeat(date-time)=<span class="integer">20</span>-<span class="integer">7</span>-<span class="integer">2017</span> <span class="integer">19</span>:<span class="integer">32</span>:<span class="integer">13</span>
                    now(ms)=<span class="integer">1</span>,<span class="integer">500</span>,<span class="integer">568</span>,<span class="integer">342</span>,<span class="integer">645</span>
                    now(date-time)=<span class="integer">20</span>-<span class="integer">7</span>-<span class="integer">2017</span> <span class="integer">19</span>:<span class="integer">32</span>:<span class="integer">22</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The MemberHeartbeats plugin is enabled by default since it has very little overhead and will only print to the diagnostics
file if the max-deviation (explained below) is exceeded.</p>
</div>
<div class="paragraph">
<p>You can control the MemberHeartbeats plugin using the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.diagnostics.member-heartbeat.seconds</code>: The frequency this plugin is writing the collected information to the disk. It is configured to be 10 seconds by default. 0 disables the plugin.</p>
</li>
<li>
<p><code>hazelcast.diagnostics.member-heartbeat.max-deviation-percentage</code>: The maximum allowed deviation percentage. Its default value is 100. For example, if the interval of member/member heartbeats is 5 seconds, a 100% deviation will be fine with heartbeats arriving up to 5 seconds after they are expected. So a heartbeat arriving after 9 seconds will not be rendered, but a heartbeat received after 11 seconds will be rendered.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="operationthreadsamples"><a class="anchor" href="#operationthreadsamples"></a><a class="link" href="#operationthreadsamples">OperationThreadSamples</a></h5>
<div class="paragraph">
<p>This plugin samples the operation threads and checks the running operations/tasks. Hazelcast has the <a href="#slowoperationdetector">slow operation detector</a> which is useful for very slow operations. But it may not be efficient for high volumes of not too slow operations. Using the OperationThreadSamples plugin it is more clear to see which operations are actually running.</p>
</div>
<div class="paragraph">
<p>You can control the OperationThreadSamples plugin using the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.diagnostics.operationthreadsamples.period.seconds</code>: The frequency this plugin is writing the collected information to the disk. An efficient value for production would be 30, 60 or more seconds. 0, which is the default value, disables the plugin.</p>
</li>
<li>
<p><code>hazelcast.diagnostics.operationthreadsamples.sampler.period.millis</code>: The period in milliseconds between taking samples. The lower the value, the higher the overhead but also the higher the precision. Its default value is 100 ms.</p>
</li>
<li>
<p><code>hazelcast.diagnostics.operationthreadsamples.includeName</code>: Specifies whether the data structures' name pointed to by the operation (if available) should be included in the name of the samples. Its default value is false.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following shows an example of the output when the property <code>hazelcast.diagnostics.operationthreadsamples.includeName</code> is false:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="integer">28</span>-<span class="integer">08</span>-<span class="integer">2018</span> <span class="octal">07</span>:<span class="integer">40</span>:<span class="octal">07</span> <span class="integer">1535442007330</span> OperationThreadSamples[
              Partition[
                        com.hazelcast.map.impl.operation.MapSizeOperation=<span class="integer">304623</span> <span class="float">85.6927</span>%
                        com.hazelcast.map.impl.operation.PutOperation=<span class="integer">33061</span> <span class="float">9.300304</span>%
                        com.hazelcast.map.impl.operation.GetOperation=<span class="integer">17799</span> <span class="float">5.0069904</span>%]
              Generic[
                        com.hazelcast.client.impl.ClientEngineImpl<span class="error">$</span>PriorityPartitionSpecificRunnable=<span class="integer">2308</span> <span class="float">35.738617</span>%
                        com.hazelcast.nio.Packet=<span class="integer">1767</span> <span class="float">27.361412</span>%
                        com.hazelcast.internal.cluster.impl.operations.JoinRequestOp=<span class="integer">821</span> <span class="float">12.712914</span>%
                        com.hazelcast.spi.impl.operationservice.impl.operations.PartitionIteratingOperation=<span class="integer">278</span> <span class="float">4.3047385</span>%
                        com.hazelcast.internal.cluster.impl.operations.HeartbeatOp=<span class="integer">93</span> <span class="float">1.4400743</span>%
                        com.hazelcast.internal.cluster.impl.operations.OnJoinOp=<span class="integer">89</span> <span class="float">1.3781357</span>%
                        com.hazelcast.internal.cluster.impl.operations.WhoisMasterOp=<span class="integer">75</span> <span class="float">1.1613503</span>%
                        com.hazelcast.client.impl.operations.ClientReAuthOperation=<span class="integer">33</span> <span class="float">0.51099414</span>%]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen above, the <code>MapSizeOperations</code> run on the operation threads most of the time.</p>
</div>
</div>
<div class="sect4">
<h5 id="wandiagnostics"><a class="anchor" href="#wandiagnostics"></a><a class="link" href="#wandiagnostics">WanDiagnostics</a></h5>
<div class="paragraph">
<p>The WAN diagnostics plugin provides information about the WAN replication.</p>
</div>
<div class="paragraph">
<p>It is disabled by default and can be configured using the following property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.diagnostics.wan.period.seconds</code>: The frequency this plugin is writing the collected information to the disk. 0 disables the plugin.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following shows an example of the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="integer">10</span>-<span class="integer">11</span>-<span class="integer">2017</span> <span class="integer">14</span>:<span class="integer">11</span>:<span class="integer">32</span> <span class="integer">1510319492497</span> WanBatchSenderLatency[
               targetClusterGroupName[
                    [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5801</span>[
                        count=<span class="integer">1</span>
                        totalTime(us)=<span class="integer">2</span>,<span class="octal">010</span>,<span class="integer">567</span>
                        avg(us)=<span class="integer">2</span>,<span class="octal">010</span>,<span class="integer">567</span>
                        max(us)=<span class="integer">2</span>,<span class="octal">010</span>,<span class="integer">567</span>
                        latency-distribution[
                              <span class="integer">1638400</span>.<span class="float">.3276799</span>us=<span class="integer">1</span>]]
                    [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5802</span>[
                        count=<span class="integer">1</span>
                        totalTime(us)=<span class="integer">1</span>,<span class="octal">021</span>,<span class="integer">867</span>
                        avg(us)=<span class="integer">1</span>,<span class="octal">021</span>,<span class="integer">867</span>
                        max(us)=<span class="integer">1</span>,<span class="octal">021</span>,<span class="integer">867</span>
                        latency-distribution[
                              <span class="integer">819200</span>.<span class="float">.1638399</span>us=<span class="integer">1</span>]]]]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="health-check-and-monitoring"><a class="anchor" href="#health-check-and-monitoring"></a><a class="link" href="#health-check-and-monitoring">18.6. Health Check and Monitoring</a></h3>
<div class="paragraph">
<p>Hazelcast provides the HTTP-based Health Check endpoint, Health Check script and Health Monitoring utility.</p>
</div>
<div class="sect3">
<h4 id="health-check"><a class="anchor" href="#health-check"></a><a class="link" href="#health-check">18.6.1. Health Check</a></h4>
<div class="paragraph">
<p>This is Hazelcast&#8217;s HTTP based health check implementation which provides basic information about your cluster and member (on which it is launched).</p>
</div>
<div class="paragraph">
<p>First, you need to enable the health check. To do this, set the <code>hazelcast.http.healthcheck.enabled</code> system property to <code>true</code>. By default, it is <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Now you retrieve information about your cluster&#8217;s health status (member state, cluster state, cluster size, etc.) by launching <code><a href="http://&lt;your" class="bare">http://&lt;your</a> member&#8217;s host IP&gt;:5701/hazelcast/health</code> on your preferred browser.</p>
</div>
<div class="paragraph">
<p>An example output is given below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Hazelcast::NodeState=ACTIVE
Hazelcast::ClusterState=ACTIVE
Hazelcast::ClusterSafe=TRUE
Hazelcast::MigrationQueueSize=<span class="integer">0</span>
Hazelcast::ClusterSize=<span class="integer">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the <a href="#managing-cluster-and-member-states">Managing Cluster and Member States section</a> to learn more about each state of a Hazelcast cluster and member.</p>
</div>
</div>
<div class="sect3">
<h4 id="health-check-script"><a class="anchor" href="#health-check-script"></a><a class="link" href="#health-check-script">18.6.2. Health Check Script</a></h4>
<div class="paragraph">
<p>The <code>healthcheck.sh</code> script comes with the Hazelcast package. Internally, it uses the HTTP-based Health Check endpoint and that is why you also need to set the <code>hazelcast.http.healthcheck.enabled</code> system property to <code>true</code>.</p>
</div>
<div class="paragraph">
<p>You can use the script to check health parameters in the following manner:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span> ./healthcheck.sh &lt;parameters&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following parameters can be used:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-o</code>, <code>--operation</code>: Health check operation. It can be <code>all</code>, <code>node-state</code>, <code>cluster-state</code>, <code>cluster-safe</code>, <code>migration-queue-size</code> and <code>cluster-size</code>.</p>
</li>
<li>
<p><code>-a</code>, <code>--address</code>: Defines which IP address Hazelcast member is running on. Its default value is <code>127.0.0.1</code>.</p>
</li>
<li>
<p><code>-p</code>, <code>--port</code>: Defines which port Hazelcast member is running on. Its default value is <code>5701</code>.</p>
</li>
<li>
<p><code>-h</code>, <code>--help</code>: Lists the parameter descriptions along with a usage example.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong><em>Example 1: Checking Member State of a Healthy Cluster:</em></strong></p>
</div>
<div class="paragraph">
<p>Assuming the member is deployed under the address <code>127.0.0.1:5701</code> and it is in the healthy state, the following output is expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span> ./healthcheck.sh -a <span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span> -p <span class="integer">5701</span> -o node-state
ACTIVE</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong><em>Example 2: Checking Safety of a Non-Existing Cluster:</em></strong></p>
</div>
<div class="paragraph">
<p>Assuming there is no member running under the address <code>127.0.0.1:5701</code>, the following output is expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span> ./healthcheck.sh -a <span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span> -p <span class="integer">5701</span> -o cluster-safe
<span class="exception">Error</span> <span class="keyword">while</span> checking health of hazelcast cluster on ip <span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span> on port <span class="integer">5701</span>.
Please check that cluster is running and that health check is enabled (property set to <span class="predefined-constant">true</span>: <span class="string"><span class="delimiter">'</span><span class="content">hazelcast.http.healthcheck.enabled</span><span class="delimiter">'</span></span> or <span class="string"><span class="delimiter">'</span><span class="content">hazelcast.rest.enabled</span><span class="delimiter">'</span></span>).</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="health-monitor"><a class="anchor" href="#health-monitor"></a><a class="link" href="#health-monitor">18.6.3. Health Monitor</a></h4>
<div class="paragraph">
<p>Health monitor periodically prints logs in your console to provide information about your member&#8217;s state. By default, it is enabled when you start your cluster.</p>
</div>
<div class="paragraph">
<p>You can set the interval of health monitoring using the <code>hazelcast.health.monitoring.delay.seconds</code> system property. Its default value is 30 seconds.</p>
</div>
<div class="paragraph">
<p>The system property <code>hazelcast.health.monitoring.level</code> is used to configure the monitoring&#8217;s log level. If it is set to OFF, the monitoring will be disabled. If it is set to NOISY, monitoring logs are always printed for the defined intervals. When it is SILENT, which is the default value, monitoring logs are printed only when the values exceed some predefined thresholds. These thresholds are related to memory and CPU percentages, and can be configured using the <code>hazelcast.health.monitoring.threshold.memory.percentage</code> and <code>hazelcast.health.monitoring.threshold.cpu.percentage</code> system properties, whose default values are both 70.</p>
</div>
<div class="paragraph">
<p>The following is an example monitoring output</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Sep <span class="integer">08</span>, <span class="integer">2017</span> <span class="integer">5</span>:<span class="octal">02</span>:<span class="integer">28</span> PM com.hazelcast.internal.diagnostics.HealthMonitor

INFO: [<span class="float">192.168</span><span class="float">.2</span><span class="float">.44</span>]:<span class="integer">5701</span> [host-name] [<span class="float">3.9</span>] processors=<span class="integer">4</span>, physical.memory.total=<span class="float">16.0</span>G, physical.memory.free=<span class="float">5.5</span>G, swap.space.total=<span class="integer">0</span>, swap.space.free=<span class="integer">0</span>, heap.memory.used=<span class="float">102.4</span>M,

heap.memory.free=<span class="float">249.1</span>M, heap.memory.total=<span class="float">351.5</span>M, heap.memory.max=<span class="float">3.6</span>G, heap.memory.used/total=<span class="float">29.14</span>%, heap.memory.used/max=<span class="float">2.81</span>%, minor.gc.count=<span class="integer">4</span>, minor.gc.time=<span class="integer">68</span>ms, major.gc.count=<span class="integer">1</span>,

major.gc.time=<span class="integer">41</span>ms, load.process=<span class="float">0.44</span>%, load.system=<span class="float">1.00</span>%, load.systemAverage=<span class="float">315.48</span>%, thread.count=<span class="integer">97</span>, thread.peakCount=<span class="integer">98</span>, cluster.timeDiff=<span class="integer">0</span>, event.q.size=<span class="integer">0</span>, executor.q.async.size=<span class="integer">0</span>,

executor.q.client.size=<span class="integer">0</span>, executor.q.query.size=<span class="integer">0</span>, executor.q.scheduled.size=<span class="integer">0</span>, executor.q.io.size=<span class="integer">0</span>, executor.q.system.size=<span class="integer">0</span>, executor.q.operations.size=<span class="integer">0</span>,

executor.q.priorityOperation.size=<span class="integer">0</span>, operations.completed.count=<span class="integer">226</span>, executor.q.mapLoad.size=<span class="integer">0</span>, executor.q.mapLoadAllKeys.size=<span class="integer">0</span>, executor.q.cluster.size=<span class="integer">0</span>, executor.q.response.size=<span class="integer">0</span>,

operations.running.count=<span class="integer">0</span>, operations.pending.invocations.percentage=<span class="float">0.00</span>%, operations.pending.invocations.count=<span class="integer">0</span>, proxy.count=<span class="integer">0</span>, clientEndpoint.count=<span class="integer">1</span>,

connection.active.count=<span class="integer">2</span>, client.connection.count=<span class="integer">1</span>, connection.count=<span class="integer">1</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please see the <a href="#configuring-with-system-properties">Configuring with System Properties section</a> to learn how to set system properties.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="using-health-check-on-f5-big-ip-ltm"><a class="anchor" href="#using-health-check-on-f5-big-ip-ltm"></a><a class="link" href="#using-health-check-on-f5-big-ip-ltm">18.6.4. Using Health Check on F5 BIG-IP LTM</a></h4>
<div class="paragraph">
<p>The F5 BIG-IP Local Traffic Manager (LTM) can be used as a load balancer for Hazelcast cluster members. This section describes how you can configure a health monitor to check the Hazelcast member states.</p>
</div>
<div class="sect4">
<h5 id="monitor-types"><a class="anchor" href="#monitor-types"></a><a class="link" href="#monitor-types">Monitor Types</a></h5>
<div class="paragraph">
<p>Following types of monitors can be used to track Hazelcast cluster members:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP Monitor: A custom HTTP monitor enables you to send a command to Hazelcasts Health Check API using HTTP requests. This is a good choice if SSL/TLS is not enabled in your cluster.</p>
</li>
<li>
<p>HTTPS Monitor: A custom HTTPS monitor enables you to verify the health of Hazelcast cluster members by sending a command to Hazelcasts Health Check API using Secure Socket Layer (SSL) security. This is a good choice if SSL/TLS is enabled in your cluster.</p>
</li>
<li>
<p>TCP\_HALF\_OPEN Monitor: A TCP\_HALF\_OPEN monitor is a very basic monitor that only checks that the TCP port used by Hazelcast is open and responding to connection requests. It does not interact with the Hazelcast Health Check API. The TCP\_HALF\_OPEN monitor can be used with or without SSL/TLS.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="configuration"><a class="anchor" href="#configuration"></a><a class="link" href="#configuration">Configuration</a></h5>
<div class="paragraph">
<p>After signing in to the BIG-IP LTM User Interface, follow F5s <a href="https://support.f5.com/kb/en-us/products/big-ip_ltm/manuals/product/ltm-monitors-reference-11-6-0/3.html#unique_859105660">instructions</a> to create a new monitor. Next, apply the following configuration according to your monitor type.</p>
</div>
<div class="sect5">
<h6 id="http-https-monitors"><a class="anchor" href="#http-https-monitors"></a><a class="link" href="#http-https-monitors">HTTP/HTTPS Monitors</a></h6>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note that you should enable the Hazelcast health check for HTTP/HTTPS monitors to run. To do this, set the <code>hazelcast.http.healthcheck.enabled</code> system property to true. By default, it is false.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Using a GET request:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the Send String as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GET /hazelcast/health HTTP/<span class="float">1.1</span><span class="error">\</span>r<span class="error">\</span>n<span class="error">\</span>nHost: [HOST-ADDRESS-OF-HAZELCAST-MEMBER] <span class="error">\</span>r<span class="error">\</span>nConnection: Close<span class="error">\</span>r<span class="error">\</span>n<span class="error">\</span>r<span class="error">\</span>n</code></pre>
</div>
</div>
</li>
<li>
<p>Set the Receive String as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Hazelcast::NodeState=ACTIVE<span class="error">\</span>nHazelcast::ClusterState=ACTIVE<span class="error">\</span>nHazelcast::ClusterSafe=TRUE<span class="error">\</span>nHazelcast::MigrationQueueSize=<span class="integer">0</span><span class="error">\</span>nHazelcast::ClusterSize=([^<span class="error">\</span>s]+)<span class="error">\</span>n</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The BIG-IP LTM monitors accept regular expressions in these strings allowing you to configure them as needed. The example provided above will remain green even if the cluster size changes.</p>
</div>
<div class="paragraph">
<p><strong>Using a HEAD request:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the Send String as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HEAD /hazelcast/health HTTP/<span class="float">1.1</span><span class="error">\</span>r<span class="error">\</span>n<span class="error">\</span>nHost: [HOST-ADDRESS-OF-HAZELCAST-MEMBER] <span class="error">\</span>r<span class="error">\</span>nConnection: Close<span class="error">\</span>r<span class="error">\</span>n<span class="error">\</span>r<span class="error">\</span>n</code></pre>
</div>
</div>
</li>
<li>
<p>Set the Receive String as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="integer">200</span> OK</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>As you can see, the HEAD request only checks for a <code>200 OK</code> response. A Hazelcast cluster member will send this status code when it is alive and running without issue. This provides a very basic health check. For increased flexibility, we recommend using the GET request API.</p>
</div>
</div>
<div class="sect5">
<h6 id="tcp_half_open-monitors"><a class="anchor" href="#tcp_half_open-monitors"></a><a class="link" href="#tcp_half_open-monitors">TCP_HALF_OPEN Monitors</a></h6>
<div class="ulist">
<ul>
<li>
<p>Set the "Type" as <code>TCP Half Open</code>.</p>
</li>
<li>
<p>Optionally, set the "Alias Service Port" as the port of Hazelcast cluster member if you want to specify the port in the monitor.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="management-center"><a class="anchor" href="#management-center"></a><a class="link" href="#management-center">18.7. Management Center</a></h3>
<div class="paragraph">
<p>Hazelcast Management Center enables you to monitor and manage your cluster members running Hazelcast. In addition to monitoring the overall state of your clusters, you can also analyze and browse your data structures in detail, update map configurations and take thread dumps from members. You can run scripts (JavaScript, Groovy, etc.) and commands on your members with its scripting and console modules.</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html">Hazelcast Management Center Documentation</a> for its usage details.</p>
</div>
</div>
<div class="sect2">
<h3 id="clustered-jmx-and-rest-via-management-center"><a class="anchor" href="#clustered-jmx-and-rest-via-management-center"></a><a class="link" href="#clustered-jmx-and-rest-via-management-center">18.8. Clustered JMX and REST via Management Center</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise</strong></p>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html">Hazelcast Management Center Documentation</a> for information on Clustered JMX and Clustered REST (via Management Center) features.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security"><a class="anchor" href="#security"></a><a class="link" href="#security">19. Security</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="paragraph">
<p>This chapter describes the security features of Hazelcast. These features allow you to perform security activities, such as intercepting socket connections and remote operations executed by the clients, encrypting the communications between the members at socket level and using SSL socket communication. All of the Security features explained in this chapter are the features of <span class="blue">Hazelcast IMDG Enterprise</span> edition.</p>
</div>
<div class="sect2">
<h3 id="enabling-jaas-security"><a class="anchor" href="#enabling-jaas-security"></a><a class="link" href="#enabling-jaas-security">19.1. Enabling JAAS Security</a></h3>
<div class="paragraph">
<p>With Hazelcast&#8217;s extensible, JAAS based security feature, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>authenticate both cluster members and clients,</p>
</li>
<li>
<p>and perform access control checks on client operations. Access control can be done according to endpoint principal and/or endpoint address.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can enable security declaratively or programmatically, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast xsi:schemaLocation=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.hazelcast.com/schema/config
    http://www.hazelcast.com/schema/config/hazelcast-config-3.9.xsd</span><span class="delimiter">&quot;</span></span>
    xmlns=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.hazelcast.com/schema/config</span><span class="delimiter">&quot;</span></span>
    xmlns:xsi=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>&gt;

  ...

  &lt;security enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
    ...
  &lt;/security&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in security.adoc - include::{javasource}/security/EnablingSecurity.java[tag=es]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, see the <a href="#setting-the-license-key">Setting License Key section</a> for information on how to set your <span class="blue">Hazelcast IMDG Enterprise</span> license.</p>
</div>
</div>
<div class="sect2">
<h3 id="socket-interceptor"><a class="anchor" href="#socket-interceptor"></a><a class="link" href="#socket-interceptor">19.2. Socket Interceptor</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast allows you to intercept socket connections before a member joins a cluster or a client connects to a member of a cluster. This allow you to add custom hooks to join and perform connection procedures (like identity checking using Kerberos, etc.).</p>
</div>
<div class="paragraph">
<p>To use the socket interceptor, implement <code>com.hazelcast.nio.MemberSocketInterceptor</code> for members and <code>com.hazelcast.nio.SocketInterceptor</code> for clients.</p>
</div>
<div class="paragraph">
<p>The following is an example socket interceptor implementation for the member side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in security.adoc - include::{javasource}/security/SocketInterceptorMember.java[tag=msi]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can declaratively configure this socket interceptor as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  ...
  <span class="tag">&lt;network&gt;</span>
    ...
    <span class="tag">&lt;socket-interceptor</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;class-name&gt;</span>com.hazelcast.examples.MySocketInterceptor<span class="tag">&lt;/class-name&gt;</span>
      <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-host</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>kerb-host-name<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">kerberos-config-file</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>kerb.conf<span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/socket-interceptor&gt;</span>
  <span class="tag">&lt;/network&gt;</span>
  ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an example configuration of the above socket interceptor for the client side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in security.adoc - include::{javasource}/security/SocketInterceptorClient.java[tag=sic]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="security-interceptor"><a class="anchor" href="#security-interceptor"></a><a class="link" href="#security-interceptor">19.3. Security Interceptor</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast allows you to intercept every remote operation executed by the client. This lets you add a very flexible custom security logic. To do this, implement <code>com.hazelcast.security.SecurityInterceptor</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in security.adoc - include::{javasource}/security/MapSecurityInterceptor.java[tag=mysi]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>before</code> method will be called before processing the request on the remote server. The <code>after</code> method will be called after the processing. Exceptions thrown while executing the <code>before</code> method will propagate to the client, but exceptions thrown while executing the <code>after</code> method will be suppressed.</p>
</div>
</div>
<div class="sect2">
<h3 id="encryption"><a class="anchor" href="#encryption"></a><a class="link" href="#encryption">19.4. Encryption</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast offers features which allow to reach a required privacy on communication level by enabling encryption. Encryption is based on <a href="http://java.sun.com/javase/6/docs/technotes/guides/security/crypto/CryptoSpec.html">Java Cryptography Architecture</a>.</p>
</div>
<div class="paragraph">
<p>There are two different encryption features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TLS protocol</p>
<div class="ulist">
<ul>
<li>
<p>transport level encryption</p>
</li>
<li>
<p>supported by members and clients</p>
</li>
<li>
<p>TCP-only (i.e. Multicast join messages are not encrypted)</p>
</li>
<li>
<p>Please see the <a href="#tlsssl">TLS/SSL section</a> for details.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Symmetric encryption for Hazelcast member protocol</p>
<div class="ulist">
<ul>
<li>
<p>only supported by members; communication with clients is not encrypted</p>
</li>
<li>
<p>Multicast join messages are encrypted too</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The preferred and recommended feature is the TLS protocol as it&#8217;s a
standard way how to protect communication on transport level.</p>
</div>
<div class="paragraph">
<p>Symmetric encryption for Hazelcast member protocol can be configured with cipher algorithms implemented by security providers and accessed through Java Cryptography Architecture.
Check documentation of your Java version to learn about supported algorithm
names. Some examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AES</code></p>
</li>
<li>
<p><code>PBEWithMD5AndDES</code></p>
</li>
<li>
<p><code>DES/ECB/PKCS5Padding</code></p>
</li>
<li>
<p><code>Blowfish</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hazelcast uses <code>MD5</code> message-digest algorithm as the cryptographic hash function. You can also use the salting process by giving a salt and password which are then concatenated and processed with <code>MD5</code>, and the resulting output is stored with the salt.</p>
</div>
<div class="paragraph">
<p>In symmetric encryption, each member uses the same key, so the key is shared. Here is an example configuration for symmetric encryption.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  ...
  &lt;network&gt;
    ...
    &lt;symmetric-encryption enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;algorithm&gt;AES&lt;/algorithm&gt;
      &lt;salt&gt;thesalt&lt;/salt&gt;
      &lt;password&gt;thepass&lt;/password&gt;
      &lt;iteration-count&gt;<span class="integer">175</span>&lt;/iteration-count&gt;
    &lt;/symmetric-encryption&gt;
  &lt;/network&gt;
  ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You set the encryption algorithm, the salt value to use for generating the secret key, the password to use when generating the secret key and the iteration count to use when generating the secret key. You also need to set <code>enabled</code> to true. Note that all members should have the same encryption configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="tlsssl"><a class="anchor" href="#tlsssl"></a><a class="link" href="#tlsssl">19.5. TLS/SSL</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot use TLS/SSL when <a href="#encryption">Hazelcast Encryption</a> is enabled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One of the offers of Hazelcast is the SSL (Secure Sockets Layer) protocol which you can use to establish an encrypted communication across your cluster with key stores and trust stores. Note that, if you are developing applications using Java 8, you will be using its successor TLS (Transport Layer Security).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is NOT recommended to reuse the key stores and trust stores for external applications.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="tls-ssl-for-hazelcast-members"><a class="anchor" href="#tls-ssl-for-hazelcast-members"></a><a class="link" href="#tls-ssl-for-hazelcast-members">19.5.1. TLS/SSL for Hazelcast Members</a></h4>
<div class="paragraph">
<p>Hazelcast allows you to encrypt socket level communication between Hazelcast members and between Hazelcast clients and members, for end to end encryption. To use it, you need to implement <code>com.hazelcast.nio.ssl.SSLContextFactory</code> and configure the SSL section in the network configuration.</p>
</div>
<div class="paragraph">
<p>The following is the implementation code snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MySSLContextFactory</span> <span class="directive">implements</span> SSLContextFactory {
    <span class="directive">public</span> <span class="type">void</span> init( <span class="predefined-type">Properties</span> properties ) <span class="directive">throws</span> <span class="exception">Exception</span> {
    }

    <span class="directive">public</span> <span class="predefined-type">SSLContext</span> getSSLContext() {
        ...
        SSLContext sslCtx = <span class="predefined-type">SSLContext</span>.getInstance( <span class="string"><span class="delimiter">&quot;</span><span class="content">the protocol to be used</span><span class="delimiter">&quot;</span></span> );
        <span class="keyword">return</span> sslCtx;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is the base declarative configuration for the implemented <code>SSLContextFactory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  ...
  &lt;network&gt;
    ...
    &lt;ssl enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;factory-<span class="type">class</span>-<span class="class">name</span>&gt;
          com.hazelcast.examples.MySSLContextFactory
      &lt;/factory-<span class="type">class</span>-<span class="class">name</span>&gt;
      &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>&gt;bar&lt;/property&gt;
      &lt;/properties&gt;
    &lt;/ssl&gt;
  &lt;/network&gt;
  ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hazelcast provides a default SSLContextFactory, <code>com.hazelcast.nio.ssl.BasicSSLContextFactory</code>, which uses the configured keystore to initialize <code>SSLContext</code>; see the following example configuration for TLS/SSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast&gt;</span>
  ...
  <span class="tag">&lt;network&gt;</span>
    ...
    <span class="tag">&lt;ssl</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;factory-class-name&gt;</span>
          com.hazelcast.nio.ssl.BasicSSLContextFactory
      <span class="tag">&lt;/factory-class-name&gt;</span>
      <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>/opt/hazelcast-keystore.p12<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStorePassword</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>secret.123<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStoreType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>PKCS12<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trustStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>/opt/hazelcast-truststore.p12<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trustStorePassword</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>changeit<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trustStoreType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>PKCS12<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">protocol</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>TLSv1.2<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mutualAuthentication</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>REQUIRED<span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/ssl&gt;</span>
  <span class="tag">&lt;/network&gt;</span>
  ...
<span class="tag">&lt;/hazelcast&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the descriptions for the properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>keyStore</code>: Path of your keystore file.</p>
</li>
<li>
<p><code>keyStorePassword</code>: Password to access the key from your keystore file.</p>
</li>
<li>
<p><code>keyManagerAlgorithm</code>: Name of the algorithm based on which the authentication keys are provided.</p>
</li>
<li>
<p><code>keyStoreType</code>: Type of the keystore. Its default value is <code>JKS</code>. Another commonly used type is the <code>PKCS12</code>. Available keystore/truststore types depend on your Operating system and the Java runtime.</p>
</li>
<li>
<p><code>trustStore</code>: Path of your truststore file. The file truststore is a keystore file that contains a collection of certificates trusted by your application.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you configure TLS/SSL and do not specify the <code>trustStore</code> property, no default trusted certificates will be used; neither the keystore, nor the Java provided list of trusted CA certificates. Therefore, you ALWAYS need to configure the <code>trustStore</code> property.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>trustStorePassword</code>: Password to unlock the truststore file.</p>
</li>
<li>
<p><code>trustManagerAlgorithm</code>: Name of the algorithm based on which the trust managers are provided.</p>
</li>
<li>
<p><code>trustStoreType</code>: Type of the truststore. Its default value is <code>JKS</code>. Another commonly used type is the <code>PKCS12</code>. Available keystore/truststore types depend on your Operating system and the Java runtime.</p>
</li>
<li>
<p><code>mutualAuthentication</code>: Mutual authentication configuration. It&#8217;s empty by default which means the client side of connection is not authenticated. Available values are:</p>
<div class="ulist">
<ul>
<li>
<p><code>REQUIRED</code> - server forces usage of a trusted client certificate</p>
</li>
<li>
<p><code>OPTIONAL</code> - server asks for a client certificate, but it doesn&#8217;t require it</p>
<div class="paragraph">
<p>Please see the <a href="#mutual-authentication">Mutual Authentication section</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>ciphersuites</code>: Comma-separated list of cipher suite names allowed to be used. Its default value are all supported suites in your Java runtime.</p>
</li>
<li>
<p><code>protocol</code>: Name of the algorithm which is used in your TLS/SSL. Its default value is <code>TLS</code>. Available values are:</p>
<div class="ulist">
<ul>
<li>
<p><code>TLS</code></p>
</li>
<li>
<p><code>TLSv1</code></p>
</li>
<li>
<p><code>TLSv1.1</code> (from Java 8)</p>
</li>
<li>
<p><code>TLSv1.2</code> (from Java 8)</p>
</li>
<li>
<p><code>TLSv1.3</code> (from Java 11)</p>
<div class="paragraph">
<p>For the <code>protocol</code> property, we recommend you to provide TLS with its version information, e.g., <code>TLSv1.2</code>. Note that if you write only <code>TLS</code>, your application will choose the TLS version according to your Java version.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="other-property-configuration-options"><a class="anchor" href="#other-property-configuration-options"></a><a class="link" href="#other-property-configuration-options">Other Property Configuration Options</a></h5>
<div class="paragraph">
<p>You can set all the properties presented in this section as system properties using the <code>javax.net.ssl</code> prefix, e.g., <code>javax.net.ssl.keyStore</code> and <code>javax.net.ssl.keyStorePassword</code>.</p>
</div>
<div class="paragraph">
<p>See below equivalent examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">System</span>.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.net.ssl.trustStore</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/user/home/hazelcast.ts</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Djavax.net.ssl.trustStore=/user/home/hazelcast.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>This way of TLS/SSL configuration is then system wide in your Java runtime.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tls-ssl-for-hazelcast-clients"><a class="anchor" href="#tls-ssl-for-hazelcast-clients"></a><a class="link" href="#tls-ssl-for-hazelcast-clients">19.5.2. TLS/SSL for Hazelcast Clients</a></h4>
<div class="paragraph">
<p>The TLS configuration in Hazelcast clients is very similar to member configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;hazelcast-client&gt;</span>
  ...
  <span class="tag">&lt;network&gt;</span>
    ...
    <span class="tag">&lt;ssl</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;factory-class-name&gt;</span>
          com.hazelcast.nio.ssl.BasicSSLContextFactory
      <span class="tag">&lt;/factory-class-name&gt;</span>
      <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>/opt/hazelcast-client.keystore<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStorePassword</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>clientsSecret<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trustStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>/opt/hazelcast-client.truststore<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">trustStorePassword</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>changeit<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">protocol</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>TLSv1.2<span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/ssl&gt;</span>
  <span class="tag">&lt;/network&gt;</span>
  ...
<span class="tag">&lt;/hazelcast-client&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The same <code>BasicSSLContextFactory</code> properties used for members are available on clients.
Clients don&#8217;t need to set <code>mutualAuthentication</code> property as it&#8217;s used in configuring the server side of TLS connections.</p>
</div>
</div>
<div class="sect3">
<h4 id="mutual-authentication"><a class="anchor" href="#mutual-authentication"></a><a class="link" href="#mutual-authentication">19.5.3. Mutual Authentication</a></h4>
<div class="paragraph">
<p>TLS connections have two sides: the one opening the connection (TLS client)
and the one accepting the connection (TLS server).
By default only the TLS server proves its identity by presenting a certificate to the TLS client.
The mutual authentication means that also the TLS clients prove their identity to TLS servers.</p>
</div>
<div class="paragraph">
<p>Hazelcast members can be on both sides of TLS connection - TLS servers and TLS clients.
Hazelcast clients are always on the client side of a TLS connection.</p>
</div>
<div class="paragraph">
<p>By default Hazelcast members have keyStore used to identify themselves to the clients and other members.
Both Hazelcast members and Hazelcast clients have trustStore used to define which members they can trust.</p>
</div>
<div class="paragraph">
<p>When the mutual authentication feature is enabled, Hazelcast clients need to provide keyStore.
A client proves its identity by providing its certificate to Hazelcast member it&#8217;s connecting to.
The member only accepts the connection if the client&#8217;s certificate is present in the member&#8217;s trustStore.</p>
</div>
<div class="paragraph">
<p>To enable mutual authentication, set <code>mutualAuthentication</code> property value to <code>REQUIRED</code> on member side:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config cfg = <span class="keyword">new</span> Config();
<span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();

props.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">mutualAuthentication</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">REQUIRED</span><span class="delimiter">&quot;</span></span>);
props.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStore</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/opt/hazelcast.keystore</span><span class="delimiter">&quot;</span></span>);
props.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStorePassword</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">123456</span><span class="delimiter">&quot;</span></span>);
props.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">trustStore</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/opt/hazelcast.truststore</span><span class="delimiter">&quot;</span></span>);
props.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">trustStorePassword</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">123456</span><span class="delimiter">&quot;</span></span>);

cfg.getNetworkConfig().setSSLConfig(<span class="keyword">new</span> SSLConfig().setEnabled(<span class="predefined-constant">true</span>).setProperties(props));
Hazelcast.newHazelcastInstance(cfg);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And at the client side, you need to set client identity by providing the keystore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">clientSslProps.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStore</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/opt/client.keystore</span><span class="delimiter">&quot;</span></span>);
clientSslProps.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStorePassword</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">123456</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The property <code>mutualAuthentication</code> has two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>REQUIRED</code>: Server asks for client certificate. If the client does not provide a keystore or the provided keys is not verified against member&#8217;s truststore, the client will not be authenticated.</p>
</li>
<li>
<p><code>OPTIONAL</code>: Server asks for client certificate, but client is not required to provide any valid certificate.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When a new client is introduced with a new keystore, the truststore at the member side should be updated accordingly to include new clients' information to be able to accept it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please see the below example snippet to see the full configuration at the client side:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig config = <span class="keyword">new</span> ClientConfig();
<span class="predefined-type">Properties</span> clientSslProps = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
clientSslProps.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStore</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/opt/client.keystore</span><span class="delimiter">&quot;</span></span>);
clientSslProps.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStorePassword</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">123456</span><span class="delimiter">&quot;</span></span>);
clientSslProps.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">trustStore</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/opt/client.truststore</span><span class="delimiter">&quot;</span></span>);
clientSslProps.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">trustStorePassword</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">123456</span><span class="delimiter">&quot;</span></span>);

config.getNetworkConfig().setSSLConfig(<span class="keyword">new</span> SSLConfig().setEnabled(<span class="predefined-constant">true</span>).setProperties(clientSslProps));
HazelcastClient.newHazelcastClient(config);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the mutual authentication is not required, the Hazelcast members will accept all incoming TLS connections without verifying if the connecting side is trusted.
Therefore it&#8217;s recommended to require the mutual authentication in Hazelcast members configuration.</p>
</div>
</div>
<div class="sect3">
<h4 id="tls-ssl-performance-improvements-for-java"><a class="anchor" href="#tls-ssl-performance-improvements-for-java"></a><a class="link" href="#tls-ssl-performance-improvements-for-java">19.5.4. TLS/SSL Performance Improvements for Java</a></h4>
<div class="paragraph">
<p>TLS/SSL can have a significant impact on performance. There are a few ways to increase the performance.</p>
</div>
<div class="paragraph">
<p>The first thing that can be done is making sure that AES intrensics are used. Modern CPUs (2010 or newer Westmere) have hardware support for AES encryption/decryption and if a Java 8 or newer JVM is
used, the JIT will automatically make use of these AES instructions. They can also be explicitly enabled using <code>-XX:+UseAES -XX:+UseAESIntrinsics</code>,
or disabled using <code>-XX:-UseAES -XX:-UseAESIntrinsics</code>.</p>
</div>
<div class="paragraph">
<p>A lot of encryption algorithms make use of padding because they encrypt/decrypt in fixed sized blocks. If not enough data is available
for a block, the algorithm relies on random number generation to pad. Under Linux, the JVM automatically makes use of <code>/dev/random</code> for
the generation of random numbers. <code>/dev/random</code> relies on entropy to be able to generate random numbers. However if this entropy is
insufficient to keep up with the rate requiring random numbers, it can slow down the encryption/decryption since <code>/dev/random</code> will
block; it could block for minutes waiting for sufficient entropy . This can be fixed
by adding the following system property <code>-Djava.security.egd=file:/dev/./urandom</code>. For a more permanent solution, modify
<code>&lt;JAVA_HOME&gt;/jre/lib/security/java.security</code> file, look for the <code>securerandom.source=/dev/urandom</code> and change it
to <code>securerandom.source=file:/dev/./urandom</code>. Switching to <code>/dev/urandom</code> could be controversial because the <code>/dev/urandom</code> will not
block if there is a shortage of entropy and the returned random values could theoretically be vulnerable to a cryptographic attack.
If this is a concern in your application, use <code>/dev/random</code> instead.</p>
</div>
<div class="paragraph">
<p>Another way to increase performance for the Java smart client is to make use of Hazelcast 3.8. In Hazelcast 3.8, the Java smart client
automatically makes use of extra I/O threads for encryption/decryption and this have a significant impact on the performance. This can
be changed using the <code>hazelcast.client.io.input.thread.count</code> and <code>hazelcast.client.io.input.thread.count</code> client system properties.
By default it is 1 input thread and 1 output thread. If TLS/SSL is enabled, it will default to 3 input threads and 3 output threads.
Having more client I/O threads than members in the cluster will not lead to an increased performance. So with a 2-member cluster,
2 in and 2 out threads will give the best performance.</p>
</div>
</div>
<div class="sect3">
<h4 id="tls-ssl-debugging"><a class="anchor" href="#tls-ssl-debugging"></a><a class="link" href="#tls-ssl-debugging">19.5.5. TLS/SSL Debugging</a></h4>
<div class="paragraph">
<p>To assist with TLS/SSL issues, the following system property can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Djavax.net.debug=all</code></pre>
</div>
</div>
<div class="paragraph">
<p>The property will provide a lot of logging output including the TLS/SSL handshake, that can be used to determine the cause of the problem. For more information please see <a href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/jsse/ReadDebug.html">Debugging TSL/SSL Connections</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="tls-ssl-for-hazelcast-management-center"><a class="anchor" href="#tls-ssl-for-hazelcast-management-center"></a><a class="link" href="#tls-ssl-for-hazelcast-management-center">19.5.6. TLS/SSL for Hazelcast Management Center</a></h4>
<div class="paragraph">
<p>In order to use secured communication between cluster and Management Center, you have to configure the cluster, see <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#connecting-hazelcast-members-to-management-center">Connecting Hazelcast members to Management Center</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="integrating-openssl-boringssl"><a class="anchor" href="#integrating-openssl-boringssl"></a><a class="link" href="#integrating-openssl-boringssl">19.6. Integrating OpenSSL / BoringSSL</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot integrate OpenSSL into Hazelcast when <a href="#encryption">Hazelcast Encryption</a> is enabled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>TLS/SSL in Java is normally provided by the JRE. However, the performance overhead can be significant; even with AES intrensics
enabled. If you are using a x86_64 system (Linux, Mac, Windows), Hazelcast supports native integration for TLS/SSL which can provide significant performance
improvements. There are two supported native TLS/SSL libraries available through
<a href="https://netty.io/wiki/forked-tomcat-native.html">netty-tcnative</a> libraries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenSSL</p>
<div class="ulist">
<ul>
<li>
<p>dynamically linked;</p>
</li>
<li>
<p>prerequisities: <code>libapr</code>, <code>openssl</code> packages installed on your system;</p>
</li>
</ul>
</div>
</li>
<li>
<p>BoringSSL - Google managed fork of the OpenSSL</p>
<div class="ulist">
<ul>
<li>
<p>statically linked;</p>
</li>
<li>
<p>easier to get started with;</p>
</li>
<li>
<p>benefits: reduced code footprint, additional features</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The native TLS integration can be used on clients and/or members. For best performance, it is recommended to install on a client and member and
configure the appropriate cipher suite(s).</p>
</div>
<div class="paragraph">
<p>Check <a href="https://netty.io/wiki/forked-tomcat-native.html">netty-tcnative</a> page
for installation details.</p>
</div>
<div class="sect3">
<h4 id="netty-libraries"><a class="anchor" href="#netty-libraries"></a><a class="link" href="#netty-libraries">19.6.1. Netty Libraries</a></h4>
<div class="paragraph">
<p>For the native TLS/SSL integration in Java, the <a href="https://netty.io/">Netty</a> library is used.</p>
</div>
<div class="paragraph">
<p>Make sure the following libraries from the Netty framework are on the classpath:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>netty-handler</code> and its dependencies</p>
</li>
<li>
<p>one of <code>tc-native</code> implementations</p>
<div class="ulist">
<ul>
<li>
<p>either BoringSSL: <code>netty-tcnative-boringssl-static-{tcnative_version}.jar</code></p>
</li>
<li>
<p>or OpenSSL: <code>netty-tcnative-{tcnative_version}-{os_arch}.jar</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is very important that the version of Netty JAR(s) corresponds to a very specific version of <code>netty-tcnative</code>. In case of doubt, the simplest thing to do is to download the <code>netty-&lt;version&gt;.tar.bz2</code> file from the <a href="https://netty.io/downloads.html">Netty</a> website and check which <code>netty-tcnative</code> version is used for that Netty release.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="using-boringssl"><a class="anchor" href="#using-boringssl"></a><a class="link" href="#using-boringssl">19.6.2. Using BoringSSL</a></h4>
<div class="paragraph">
<p>The statically linked BoringSSL binaries are included within the <code>netty-tcnative</code> libraries. There is no need to install additional software on supported systems.</p>
</div>
<div class="paragraph">
<p>Example Maven dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.netty&lt;/groupId&gt;
        &lt;artifactId&gt;netty-tcnative-boringssl-<span class="directive">static</span>&lt;/artifactId&gt;
        &lt;version&gt;<span class="float">2.0</span><span class="float">.12</span>.Final&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.netty&lt;/groupId&gt;
        &lt;artifactId&gt;netty-handler&lt;/artifactId&gt;
        &lt;version&gt;<span class="float">4.1</span><span class="float">.27</span>.Final&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="using-openssl"><a class="anchor" href="#using-openssl"></a><a class="link" href="#using-openssl">19.6.3. Using OpenSSL</a></h4>
<div class="paragraph">
<p>Install OpenSSL. Make sure that you are installing 1.0.1 or newer release. Please refer to its documentation at
<a href="https://github.com/openssl/openssl/blob/master/INSTALL">github.com/openssl</a>.</p>
</div>
<div class="paragraph">
<p>Install Apache Portable Runtime (APR) library. Please refer to <a href="https://apr.apache.org/download.cgi">apr.apache.org</a>.</p>
</div>
<div class="paragraph">
<p>For RHEL:</p>
</div>
<div class="paragraph">
<p><code>sudo yum -y install apr openssl</code></p>
</div>
<div class="paragraph">
<p>For Ubuntu:</p>
</div>
<div class="paragraph">
<p><code>sudo apt-get -y install libapr1 openssl</code></p>
</div>
<div class="paragraph">
<p>For Alpine Linux:</p>
</div>
<div class="paragraph">
<p><code>apk add --update apr openssl</code></p>
</div>
<div class="paragraph">
<p>Example Maven dependencies (for Linux):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.netty&lt;/groupId&gt;
        &lt;artifactId&gt;netty-tcnative-boringssl-<span class="directive">static</span>&lt;/artifactId&gt;
        &lt;version&gt;<span class="float">2.0</span><span class="float">.12</span>.Final&lt;/version&gt;
        &lt;classifier&gt;linux-x86_64&lt;/classifier&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.netty&lt;/groupId&gt;
        &lt;artifactId&gt;netty-handler&lt;/artifactId&gt;
        &lt;version&gt;<span class="float">4.1</span><span class="float">.27</span>.Final&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-hazelcast-for-openssl"><a class="anchor" href="#configuring-hazelcast-for-openssl"></a><a class="link" href="#configuring-hazelcast-for-openssl">19.6.4. Configuring Hazelcast for OpenSSL</a></h4>
<div class="paragraph">
<p>Configuring OpenSSL in Hazelcast is straight forward. On the client and/or member side, the following snippet enables TLS/SSL
using OpenSSL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;network&gt;
    ...
    &lt;ssl enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;factory-<span class="type">class</span>-<span class="class">name</span>&gt;com.hazelcast.nio.ssl.OpenSSLEngineFactory&lt;/factory-<span class="type">class</span>-<span class="class">name</span>&gt;

        &lt;properties&gt;
            &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">protocol</span><span class="delimiter">&quot;</span></span>&gt;TLSv1<span class="float">.2</span>&lt;/property&gt;
            &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">trustCertCollectionFile</span><span class="delimiter">&quot;</span></span>&gt;trusted-certs.pem&lt;/property&gt;
            &lt;!-- If the TLS mutual authentication is not used,
                 then the key configuration is not needed on client side. --&gt;
            &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyFile</span><span class="delimiter">&quot;</span></span>&gt;privkey.pem&lt;/property&gt;
            &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyCertChainFile</span><span class="delimiter">&quot;</span></span>&gt;chain.pem&lt;/property&gt;
        &lt;/properties&gt;
    &lt;/ssl&gt;
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration is similar to a regular TLS/SSL integration. The main difference is the <code>OpenSSLEngineFactory</code> factory class and following new properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>keyFile</code>: Path of your PKCS#8 key file in PEM format.</p>
</li>
<li>
<p><code>keyPassword</code>: Password to access the key file when it&#8217;s encrypted.</p>
</li>
<li>
<p><code>keyCertChainFile</code>: Path to an X.509 certificate chain file in PEM format.</p>
</li>
<li>
<p><code>trustCertCollectionFile</code>: Path to an X.509 certificate collection file in PEM format.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These new properties take precedence over keyStore and trustStore configurations.
Using keyStores and trustStores together with OpenSSL causes problems on some Java versions, therefor we recommend to use the OpenSSL native way.</p>
</div>
<div class="paragraph">
<p>Other supported properties are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>keyStore</code>: Path of your keystore file.</p>
<div class="ulist">
<ul>
<li>
<p><em>Using the <code>keyStore</code> property is not recommended, use <code>keyFile</code> and <code>keyCertChainFile</code> instead</em></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>keyStorePassword</code>: Password to access the key from your keystore file.</p>
</li>
<li>
<p><code>keyStoreType</code>: Type of the keystore. Its default value is <code>JKS</code>. Another commonly used type is the <code>PKCS12</code>. Available keystore/truststore types depend on your Operating system and the Java runtime.</p>
</li>
<li>
<p><code>keyManagerAlgorithm</code>: Name of the algorithm based on which the authentication keys are provided.</p>
</li>
<li>
<p><code>trustManagerAlgorithm</code>: Name of the algorithm based on which the trust managers are provided.</p>
</li>
<li>
<p><code>trustStore</code>: Path of your truststore file. The file truststore is a keystore file that contains a collection of certificates
trusted by your application. Its type should be <code>JKS</code>.</p>
<div class="ulist">
<ul>
<li>
<p><em>Using the <code>trustStore</code> property is not recommended, use <code>trustCertCollectionFile</code> instead</em></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>trustStorePassword</code>: Password to unlock the truststore file.</p>
</li>
<li>
<p><code>trustStoreType</code>: Type of the truststore. Its default value is <code>JKS</code>. Another commonly used type is the <code>PKCS12</code>. Available keystore/truststore types depend on your Operating system and the Java runtime.</p>
</li>
<li>
<p><code>ciphersuites</code>: Comma-separated list of cipher suite names allowed to be used.</p>
</li>
<li>
<p><code>protocol</code>: Name of the algorithm which is used in your TLS/SSL. Its default value is <code>TLSv1.2</code>. Available values are:</p>
<div class="ulist">
<ul>
<li>
<p><code>TLS</code></p>
</li>
<li>
<p><code>TLSv1</code></p>
</li>
<li>
<p><code>TLSv1.1</code></p>
</li>
<li>
<p><code>TLSv1.2</code></p>
</li>
<li>
<p><code>SSL</code> <em>(insecure!)</em></p>
</li>
<li>
<p><code>SSLv2</code> <em>(insecure!)</em></p>
</li>
<li>
<p><code>SSLv3</code> <em>(insecure!)</em></p>
<div class="paragraph">
<p>All of the algorithms listed above support Java 6 and higher versions. For the <code>protocol</code> property, we recommend you to provide SSL or TLS with its version information, e.g., <code>TLSv1.2</code>. Note that if you
provide only <code>SSL</code> or <code>TLS</code> as a value for the <code>protocol</code> property, they will be converted to <code>SSLv3</code> and <code>TLSv1.2</code>, respectively. We strongly recommend to avoid SSL protocols.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-cipher-suites"><a class="anchor" href="#configuring-cipher-suites"></a><a class="link" href="#configuring-cipher-suites">19.6.5. Configuring Cipher Suites</a></h4>
<div class="paragraph">
<p>To get the best performance, the correct <a href="https://en.wikipedia.org/wiki/Cipher_suite">cipher suites</a> need to be configured.
Each cipher suite has different performance and security characteristics and depending on the hardware and selected cipher suite, the overhead of TLS can range from dramatic to almost negligible.</p>
</div>
<div class="paragraph">
<p>The cipher suites are configured using the <code>ciphersuites</code> property as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;ssl enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;factory-<span class="type">class</span>-<span class="class">name</span>&gt;...&lt;/factory-<span class="type">class</span>-<span class="class">name</span>&gt;

    &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">keyStore</span><span class="delimiter">&quot;</span></span>&gt;upload/hazelcast.keystore&lt;/property&gt;
        ...
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ciphersuites</span><span class="delimiter">&quot;</span></span>&gt;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,
                                      TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA&lt;/property&gt;
    &lt;/properties&gt;
&lt;/ssl&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ciphersuites</code> property accepts a comma separated list (spaces, enters, tabs are filtered out) of cipher suites in the order
of preference.</p>
</div>
<div class="paragraph">
<p>You can configure a member and client with different cipher suites; but there should be at least one shared cipher suite.</p>
</div>
<div class="paragraph">
<p>One of the cipher suites that gave very low overhead but still provides solid security is the 'TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256'.
However in our measurements this cipher suite only performs well using OpenSSL; using the regular Java TLS integration, it performs
badly. So keep that in mind when configuring a client using regular SSL and a member using OpenSSL.</p>
</div>
<div class="paragraph">
<p>Please check with your security expert to determine which cipher suites are appropriate and run performance tests to see which ones perform
well in your environment.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t configure the cipher suites, then both client and/or member will determine a cipher suite by themselves during the TLS/SSL
handshake. This can lead to suboptimal performance and lower security than required.</p>
</div>
</div>
<div class="sect3">
<h4 id="other-ways-of-configuring-properties"><a class="anchor" href="#other-ways-of-configuring-properties"></a><a class="link" href="#other-ways-of-configuring-properties">19.6.6. Other Ways of Configuring Properties</a></h4>
<div class="paragraph">
<p>You can set all the properties presented in this section using the <code>javax.net.ssl</code> prefix, e.g., <code>javax.net.ssl.keyStore</code>
and <code>javax.net.ssl.keyStorePassword</code>.</p>
</div>
<div class="paragraph">
<p>Also note that these properties can be specified using the related Java system properties and also Java&#8217;s <code>-D</code> command line
option. This is very useful if you require a more flexible configuration e.g. when doing performance tests.</p>
</div>
<div class="paragraph">
<p>See below examples equivalent to each other:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">System</span>.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.net.ssl.trustStore</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/user/home/hazelcast.ts</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Djavax.net.ssl.trustStore=/user/home/hazelcast.ts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another two examples equivalent to each other:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">System</span>.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.net.ssl.ciphersuites</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Djavax.net.ssl.ciphersuites=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="credentials"><a class="anchor" href="#credentials"></a><a class="link" href="#credentials">19.7. Credentials</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="paragraph">
<p>One of the key elements in Hazelcast security is the <code>Credentials</code> object, which carries all credentials of an endpoint (member or client). Credentials is an interface which extends <code>Serializable</code>. You can either implement the three methods in the <code>Credentials</code> interface, or you can extend the <code>AbstractCredentials</code> class, which is an abstract implementation of <code>Credentials</code>.</p>
</div>
<div class="paragraph">
<p>Hazelcast calls the <code>Credentials.setEndpoint()</code> method when an authentication request arrives at the member before authentication takes place. Here are the methods of <code>Credentials</code> interface (see its <a href="https://docs.hazelcast.org/docs/3.11/javadoc/com/hazelcast/security/Credentials.html">Javadoc</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Credentials</span> <span class="directive">extends</span> <span class="predefined-type">Serializable</span> {
    <span class="predefined-type">String</span> getEndpoint();
    <span class="type">void</span> setEndpoint( <span class="predefined-type">String</span> endpoint ) ;
    <span class="predefined-type">String</span> getPrincipal() ;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the snippet from the abstract implementation of <code>Credentials</code> (see its <a href="https://docs.hazelcast.org/docs/3.11/javadoc/com/hazelcast/security/AbstractCredentials.html">Javadoc</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">AbstractCredentials</span> <span class="directive">implements</span> Credentials, DataSerializable {
    <span class="directive">private</span> <span class="directive">transient</span> <span class="predefined-type">String</span> endpoint;
    <span class="directive">private</span> <span class="predefined-type">String</span> principal;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>UsernamePasswordCredentials</code>, a custom implementation of Credentials, is in the Hazelcast <code>com.hazelcast.security</code> package. <code>UsernamePasswordCredentials</code> is used for default configuration during the authentication process of both members and clients.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UsernamePasswordCredentials</span> <span class="directive">extends</span> Credentials {
    <span class="directive">private</span> <span class="type">byte</span><span class="type">[]</span> password;
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="validating-secrets-using-strength-policy"><a class="anchor" href="#validating-secrets-using-strength-policy"></a><a class="link" href="#validating-secrets-using-strength-policy">19.8. Validating Secrets Using Strength Policy</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast IMDG Enterprise offers a secret validation mechanism including a strength policy. The term "secret" here refers to the symmetric encryption password, salt and other passwords and keys.</p>
</div>
<div class="paragraph">
<p>For this validation, Hazelcast IMDG Enterprise comes with the class DefaultSecretStrengthPolicy to identify all possible weaknesses of secrets and to display a warning in the system logger. Note that, by default, no matter how weak the secrets are, the cluster members will still start after logging this warning; however, this is configurable (please see the Enforcing the Secret Strength Policy section).</p>
</div>
<div class="paragraph">
<p>Requirements (rules) for the secrets are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minimum length of eight characters; and</p>
</li>
<li>
<p>Large keyspace use, ensuring the use of at least three of the following:</p>
<div class="ulist">
<ul>
<li>
<p>mixed case;</p>
</li>
<li>
<p>alpha;</p>
</li>
<li>
<p>numerals;</p>
</li>
<li>
<p>special characters; and</p>
</li>
<li>
<p>no dictionary words.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rules Minimum length of eight characters and no dictionary words can be configured using the following system properties:</p>
</div>
<div class="paragraph">
<p><code>hazelcast.security.secret.policy.min.length</code>: Set the minimum secret length. The default is 8 characters.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.security.secret.policy.min.length=<span class="integer">10</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>hazelcast.security.dictionary.policy.wordlist.path</code>: Set the path of a wordlist available in the file system. The default is <code>/usr/share/dict/words</code>.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.security.dictionary.policy.wordlist.path=<span class="error"></span>/Desktop/myWordList<span class="error"></span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="using-a-custom-secret-strength-policy"><a class="anchor" href="#using-a-custom-secret-strength-policy"></a><a class="link" href="#using-a-custom-secret-strength-policy">19.8.1. Using a Custom Secret Strength Policy</a></h4>
<div class="paragraph">
<p>You can implement SecretStrengthPolicy to develop your custom strength policy for a more flexible or strict security. After you implement it, you can use the following system property to point to your custom class:</p>
</div>
<div class="paragraph">
<p><code>hazelcast.security.secret.strength.default.policy.class</code>: Set the full name of the custom class.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.security.secret.strength.default.policy.class=<span class="error"></span>com.impl.myStrengthPolicy<span class="error"></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enforcing-the-secret-strength-policy"><a class="anchor" href="#enforcing-the-secret-strength-policy"></a><a class="link" href="#enforcing-the-secret-strength-policy">19.8.2. Enforcing the Secret Strength Policy</a></h4>
<div class="paragraph">
<p>By default, secret strength policy is NOT enforced. This means, if a weak secret is detected, an informative warning will be showed in the system logger and the members will continue to initialize. However, you can enforce the policy using the following system property so that the members will not be started until the weak secret errors are fixed:</p>
</div>
<div class="paragraph">
<p><code>hazelcast.security.secret.strength.policy.enforced</code>: Set to true to enforce the secret strength policy. The default is false. To enforce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">-Dhazelcast.security.secret.strength.policy.enforced=<span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is a sample warning when secret strength policy is NOT enforced, i.e., the above system property is set to false:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span> SECURITY WARNING <span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span>
<span class="predefined-type">Group</span> password does not meet the current policy and complexity requirements.
*Must not be set to the <span class="keyword">default</span>.
<span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is a sample warning when secret strength policy is enforced, i.e., the above system property is set to true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WARNING: [<span class="float">192.168</span><span class="float">.2</span><span class="float">.112</span>]:<span class="integer">5701</span> [dev] [<span class="float">3.9</span>-SNAPSHOT]
<span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span> SECURITY WARNING <span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span>
Symmetric Encryption Password does not meet the current policy and complexity requirements.
*Must contain at least <span class="integer">1</span> number.
*Must contain at least <span class="integer">1</span> special character.
Group Password does not meet the current policy and complexity requirements.
*Must not be set to the <span class="keyword">default</span>.
*Must have at least <span class="integer">1</span> lower and <span class="integer">1</span> upper <span class="keyword">case</span> characters.
*Must contain at least <span class="integer">1</span> number.
*Must contain at least <span class="integer">1</span> special character.
Symmetric Encryption Salt does not meet the current policy and complexity requirements.
*Must contain <span class="integer">8</span> or more characters.
*Must contain at least <span class="integer">1</span> number.
*Must contain at least <span class="integer">1</span> special character.
<span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span><span class="error">@</span>
<span class="exception">Exception</span> in thread <span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span> com.hazelcast.security.WeakSecretException: Weak secrets found in configuration, check output above <span class="keyword">for</span> more details.
at com.hazelcast.security.impl.WeakSecretsConfigChecker.evaluateAndReport(WeakSecretsConfigChecker.java:<span class="integer">49</span>)
at com.hazelcast.instance.EnterpriseNodeExtension.printNodeInfo(EnterpriseNodeExtension.java:<span class="integer">197</span>)
at com.hazelcast.instance.Node.&lt;init&gt;(Node.java:<span class="integer">194</span>)
at com.hazelcast.instance.HazelcastInstanceImpl.createNode(HazelcastInstanceImpl.java:<span class="integer">163</span>)
at com.hazelcast.instance.HazelcastInstanceImpl.&lt;init&gt;(HazelcastInstanceImpl.java:<span class="integer">130</span>)
at com.hazelcast.instance.HazelcastInstanceFactory.constructHazelcastInstance(HazelcastInstanceFactory.java:<span class="integer">195</span>)
at com.hazelcast.instance.HazelcastInstanceFactory.newHazelcastInstance(HazelcastInstanceFactory.java:<span class="integer">174</span>)
at com.hazelcast.instance.HazelcastInstanceFactory.newHazelcastInstance(HazelcastInstanceFactory.java:<span class="integer">124</span>)
at com.hazelcast.core.Hazelcast.newHazelcastInstance(Hazelcast.java:<span class="integer">58</span>)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clusterloginmodule"><a class="anchor" href="#clusterloginmodule"></a><a class="link" href="#clusterloginmodule">19.9. ClusterLoginModule</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="paragraph">
<p>All security attributes are carried in the <code>Credentials</code> object. <code>Credentials</code> is used by <a href="http://docs.oracle.com/javase/7/docs/api/javax/security/auth/spi/LoginModule.html">LoginModule</a> s during the authentication process. User supplied attributes from <code>LoginModule`s are accessed by <a href="http://docs.oracle.com/javase/7/docs/api/javax/security/auth/callback/CallbackHandler.html">CallbackHandler</a> s. To access the `Credentials</code> object, Hazelcast uses its own specialized <code>CallbackHandler</code>. During initialization of <code>LoginModules</code>, Hazelcast passes this special <code>CallbackHandler</code> into the <code>LoginModule.initialize()</code> method.</p>
</div>
<div class="paragraph">
<p>Your implementation of <code>LoginModule</code> should create an instance of <code>com.hazelcast.security.CredentialsCallback</code> and call the <code>handle(Callback[] callbacks)</code> method of <code>CallbackHandler</code> during the login process.</p>
</div>
<div class="paragraph">
<p><code>CredentialsCallback.getCredentials()</code> returns the supplied <code>Credentials</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in security.adoc - include::{javasource}/security/CustomLoginModule.java[tag=clm]</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the default Hazelcast permission policy, you must create an instance of <code>com.hazelcast.security.ClusterPrincipal</code> that holds the <code>Credentials</code> object and you must add it to <code>Subject.principals onLoginModule.commit()</code> as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyCustomLoginModule</span> <span class="directive">implements</span> <span class="predefined-type">LoginModule</span> {
    ...
    public <span class="type">boolean</span> commit() <span class="directive">throws</span> <span class="exception">LoginException</span> {
        ...
        Principal principal = <span class="keyword">new</span> ClusterPrincipal( credentials );
        subject.getPrincipals().add( principal );
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hazelcast has an abstract implementation of <code>LoginModule</code> that does callback and cleanup operations and holds the resulting <code>Credentials</code> instance. <code>LoginModule`s extending `ClusterLoginModule</code> can access <code>Credentials</code>, <code>Subject</code>, <code>LoginModule</code> instances and options and <code>sharedState</code> maps. Extending the <code>ClusterLoginModule</code> is recommended instead of implementing all required stuff.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">ClusterLoginModule</span> <span class="directive">implements</span> <span class="predefined-type">LoginModule</span> {
    <span class="directive">protected</span> <span class="directive">abstract</span> <span class="type">boolean</span> onLogin() <span class="directive">throws</span> <span class="exception">LoginException</span>;
    <span class="directive">protected</span> <span class="directive">abstract</span> <span class="type">boolean</span> onCommit() <span class="directive">throws</span> <span class="exception">LoginException</span>;
    <span class="directive">protected</span> <span class="directive">abstract</span> <span class="type">boolean</span> onAbort() <span class="directive">throws</span> <span class="exception">LoginException</span>;
    <span class="directive">protected</span> <span class="directive">abstract</span> <span class="type">boolean</span> onLogout() <span class="directive">throws</span> <span class="exception">LoginException</span>;
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="enterprise-integration"><a class="anchor" href="#enterprise-integration"></a><a class="link" href="#enterprise-integration">19.9.1. Enterprise Integration</a></h4>
<div class="paragraph">
<p>Using the above API, you can implement a <code>LoginModule</code> that performs authentication against the Security System of your choice, such as an LDAP store like <a href="https://directory.apache.org/">Apache Directory</a> or some other corporate standard you might have. For example, you may wish to have your clients send an identification token in the <code>Credentials</code> object. This token can then be sent to your back-end security system via the <code>LoginModule</code> that runs on the cluster side.</p>
</div>
<div class="paragraph">
<p>Additionally, the same system may authenticate the user and also then return the roles that are attributed to the user. These roles can then be used for data structure authorization.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASRefGuide.html">JAAS Reference Guide</a> for further information.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cluster-member-security"><a class="anchor" href="#cluster-member-security"></a><a class="link" href="#cluster-member-security">19.10. Cluster Member Security</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast supports standard Java Security (JAAS) based authentication between cluster members. To implement it, you configure one or more LoginModules and an instance of <code>com.hazelcast.security.ICredentialsFactory</code>. Although Hazelcast has default implementations using cluster groups and UsernamePasswordCredentials on authentication, it is recommended that you implement the LoginModules and an instance of <code>com.hazelcast.security.ICredentialsFactory</code> according to your specific needs and environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;security enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;member-credentials-factory
      <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.examples.MyCredentialsFactory</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;properties&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">property1</span><span class="delimiter">&quot;</span></span>&gt;value1&lt;/property&gt;
      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">property2</span><span class="delimiter">&quot;</span></span>&gt;value2&lt;/property&gt;
    &lt;/properties&gt;
  &lt;/member-credentials-factory&gt;
  &lt;member-login-modules&gt;
    &lt;login-module usage=<span class="string"><span class="delimiter">&quot;</span><span class="content">REQUIRED</span><span class="delimiter">&quot;</span></span>
        <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.examples.MyRequiredLoginModule</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">property3</span><span class="delimiter">&quot;</span></span>&gt;value3&lt;/property&gt;
      &lt;/properties&gt;
    &lt;/login-module&gt;
    &lt;login-module usage=<span class="string"><span class="delimiter">&quot;</span><span class="content">SUFFICIENT</span><span class="delimiter">&quot;</span></span>
        <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.examples.MySufficientLoginModule</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">property4</span><span class="delimiter">&quot;</span></span>&gt;value4&lt;/property&gt;
      &lt;/properties&gt;
    &lt;/login-module&gt;
    &lt;login-module usage=<span class="string"><span class="delimiter">&quot;</span><span class="content">OPTIONAL</span><span class="delimiter">&quot;</span></span>
        <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.examples.MyOptionalLoginModule</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">property5</span><span class="delimiter">&quot;</span></span>&gt;value5&lt;/property&gt;
      &lt;/properties&gt;
    &lt;/login-module&gt;
  &lt;/member-login-modules&gt;
  ...
&lt;/security&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define as many as LoginModules as you want in configuration. They are executed in the order listed in configuration. The <code>usage</code> attribute has 4 values: 'required', 'requisite', 'sufficient' and 'optional' as defined in <code>javax.security.auth.login.AppConfigurationEntry.LoginModuleControlFlag</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.hazelcast.security</span>;
<span class="comment">/**
 * ICredentialsFactory is used to create Credentials objects to be used
 * during member authentication before connection accepted by master member.
 */</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">ICredentialsFactory</span> {

  <span class="type">void</span> configure( GroupConfig groupConfig, <span class="predefined-type">Properties</span> properties );

  Credentials newCredentials();

  <span class="type">void</span> destroy();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Properties defined in the configuration are passed to the <code>ICredentialsFactory.configure()</code> method as <code>java.util.Properties</code> and to the <code>LoginModule.initialize()</code> method as <code>java.util.Map</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="native-client-security"><a class="anchor" href="#native-client-security"></a><a class="link" href="#native-client-security">19.11. Native Client Security</a></h3>
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast&#8217;s Client security includes both authentication and authorization.</p>
</div>
<div class="sect3">
<h4 id="authentication"><a class="anchor" href="#authentication"></a><a class="link" href="#authentication">19.11.1. Authentication</a></h4>
<div class="paragraph">
<p>The authentication mechanism works the same as cluster member authentication. To implement client authentication, you configure a Credential and one or more LoginModules. The client side also needs a factory object as in member side, e.g., the <code>ICredentialsFactory</code> given in the <a href="#cluster-member-security">Cluster Member Security section</a> above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;security enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;client-login-modules&gt;
    &lt;login-module usage=<span class="string"><span class="delimiter">&quot;</span><span class="content">REQUIRED</span><span class="delimiter">&quot;</span></span>
        <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.examples.MyRequiredClientLoginModule</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">property3</span><span class="delimiter">&quot;</span></span>&gt;value3&lt;/property&gt;
      &lt;/properties&gt;
    &lt;/login-module&gt;
    &lt;login-module usage=<span class="string"><span class="delimiter">&quot;</span><span class="content">SUFFICIENT</span><span class="delimiter">&quot;</span></span>
        <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.examples.MySufficientClientLoginModule</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">property4</span><span class="delimiter">&quot;</span></span>&gt;value4&lt;/property&gt;
      &lt;/properties&gt;
    &lt;/login-module&gt;
    &lt;login-module usage=<span class="string"><span class="delimiter">&quot;</span><span class="content">OPTIONAL</span><span class="delimiter">&quot;</span></span>
        <span class="type">class</span>-<span class="class">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.examples.MyOptionalClientLoginModule</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">property5</span><span class="delimiter">&quot;</span></span>&gt;value5&lt;/property&gt;
      &lt;/properties&gt;
    &lt;/login-module&gt;
  &lt;/client-login-modules&gt;
  ...
&lt;/security&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define as many as <code>LoginModules</code> as you want in the configuration. Those are executed in the order given in configuration. The <code>usage</code> attribute has 4 values: 'required', 'requisite', 'sufficient' and 'optional' as defined in <code>javax.security.auth.login.AppConfigurationEntry.LoginModuleControlFlag</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig();
clientConfig.setCredentials( <span class="keyword">new</span> UsernamePasswordCredentials( <span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">dev-pass</span><span class="delimiter">&quot;</span></span> ) );
HazelcastInstance client = HazelcastClient.newHazelcastClient( clientConfig );</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See an implementation and configuration example <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/enterprise/client-custom-credentials">here</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="authorization"><a class="anchor" href="#authorization"></a><a class="link" href="#authorization">19.11.2. Authorization</a></h4>
<div class="paragraph">
<p>Hazelcast client authorization is configured by a client permission policy. Hazelcast has a default permission policy implementation that uses permission configurations defined in the Hazelcast security configuration. Default policy permission checks are done against instance types (map, queue, etc.), instance names (map, queue, name, etc.), instance actions (put, read, remove, add, etc.), client endpoint addresses and client principal defined by the Credentials object. The default permission policy allows to use comma separated names in the principal attribute configuration. Instance and principal names and endpoint addresses can be defined as wildcards(*). Please see the <a href="#other-network-configurations">Network Configuration section</a> and <a href="#using-wildcards">Using Wildcards section</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;security enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;client-permissions&gt;
    &lt;!-- Principals <span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span> and <span class="string"><span class="delimiter">'</span><span class="content">root</span><span class="delimiter">'</span></span> from endpoint <span class="string"><span class="delimiter">'</span><span class="content">127.0.0.1</span><span class="delimiter">'</span></span> have all permissions. --&gt;
    &lt;all-permissions principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin,root</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;endpoints&gt;
        &lt;endpoint&gt;<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>&lt;/endpoint&gt;
      &lt;/endpoints&gt;
    &lt;/all-permissions&gt;

    &lt;!-- Principals named <span class="string"><span class="delimiter">'</span><span class="content">dev</span><span class="delimiter">'</span></span> from all endpoints have <span class="string"><span class="delimiter">'</span><span class="content">create</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">destroy</span><span class="delimiter">'</span></span>,
         <span class="string"><span class="delimiter">'</span><span class="content">put</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">read</span><span class="delimiter">'</span></span> permissions <span class="keyword">for</span> map named <span class="string"><span class="delimiter">'</span><span class="content">myMap</span><span class="delimiter">'</span></span>. --&gt;
    &lt;map-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMap</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;actions&gt;
        &lt;action&gt;create&lt;/action&gt;
        &lt;action&gt;destroy&lt;/action&gt;
        &lt;action&gt;put&lt;/action&gt;
        &lt;action&gt;read&lt;/action&gt;
      &lt;/actions&gt;
    &lt;/map-permission&gt;

    &lt;!-- All principals from endpoints <span class="string"><span class="delimiter">'</span><span class="content">127.0.0.1</span><span class="delimiter">'</span></span> or matching to <span class="string"><span class="delimiter">'</span><span class="content">10.10.*.*</span><span class="delimiter">'</span></span>
         have <span class="string"><span class="delimiter">'</span><span class="content">put</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">read</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">remove</span><span class="delimiter">'</span></span> permissions <span class="keyword">for</span> map
         whose name matches to <span class="string"><span class="delimiter">'</span><span class="content">com.foo.entity.*</span><span class="delimiter">'</span></span>. --&gt;
    &lt;map-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.entity.*</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;endpoints&gt;
        &lt;endpoint&gt;<span class="float">10.10</span>.*.*&lt;/endpoint&gt;
        &lt;endpoint&gt;<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>&lt;/endpoint&gt;
      &lt;/endpoints&gt;
      &lt;actions&gt;
        &lt;action&gt;put&lt;/action&gt;
        &lt;action&gt;read&lt;/action&gt;
        &lt;action&gt;remove&lt;/action&gt;
      &lt;/actions&gt;
    &lt;/map-permission&gt;

    &lt;!-- Principals named <span class="string"><span class="delimiter">'</span><span class="content">dev</span><span class="delimiter">'</span></span> from endpoints matching to either
         <span class="string"><span class="delimiter">'</span><span class="content">192.168.1.1-100</span><span class="delimiter">'</span></span> or <span class="string"><span class="delimiter">'</span><span class="content">192.168.2.*</span><span class="delimiter">'</span></span>
         have <span class="string"><span class="delimiter">'</span><span class="content">create</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">add</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">remove</span><span class="delimiter">'</span></span> permissions <span class="keyword">for</span> all queues. --&gt;
    &lt;queue-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;endpoints&gt;
        &lt;endpoint&gt;<span class="float">192.168</span><span class="float">.1</span><span class="float">.1</span>-<span class="integer">100</span>&lt;/endpoint&gt;
        &lt;endpoint&gt;<span class="float">192.168</span><span class="float">.2</span>.*&lt;/endpoint&gt;
      &lt;/endpoints&gt;
      &lt;actions&gt;
        &lt;action&gt;create&lt;/action&gt;
        &lt;action&gt;add&lt;/action&gt;
        &lt;action&gt;remove&lt;/action&gt;
      &lt;/actions&gt;
    &lt;/queue-permission&gt;

    &lt;!-- All principals from all endpoints have transaction permission.--&gt;
    &lt;transaction-permission /&gt;
  &lt;/client-permissions&gt;
&lt;/security&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define your own policy by implementing <code>com.hazelcast.security.IPermissionPolicy</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.hazelcast.security</span>;
<span class="comment">/**
 * IPermissionPolicy is used to determine any Subject's
 * permissions to perform a security sensitive Hazelcast operation.
 *
 */</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">IPermissionPolicy</span> {
  <span class="type">void</span> configure( SecurityConfig securityConfig, <span class="predefined-type">Properties</span> properties );

  <span class="predefined-type">PermissionCollection</span> getPermissions( <span class="predefined-type">Subject</span> subject,
                                       <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">Permission</span>&gt; type );

  <span class="type">void</span> destroy();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Permission policy implementations can access client-permissions that are in configuration by using
<code>SecurityConfig.
getClientPermissionConfigs()</code> when Hazelcast calls the method <code>configure(SecurityConfig securityConfig, Properties properties)</code>.</p>
</div>
<div class="paragraph">
<p>The <code>IPermissionPolicy.getPermissions(Subject subject, Class&lt;? extends Permission&gt; type)</code> method is used to determine a client request that has been granted permission to perform a security-sensitive operation.</p>
</div>
<div class="paragraph">
<p>Permission policy should return a <code>PermissionCollection</code> containing permissions of the given type for the given <code>Subject</code>. The Hazelcast access controller will call <code>PermissionCollection.implies(Permission)</code> on returning <code>PermissionCollection</code> and it will decide whether or not the current <code>Subject</code> has permission to access the requested resources.</p>
</div>
</div>
<div class="sect3">
<h4 id="permissions"><a class="anchor" href="#permissions"></a><a class="link" href="#permissions">19.11.3. Permissions</a></h4>
<div class="ulist">
<ul>
<li>
<p>All Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;all-permissions principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
&lt;/all-permissions&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Map Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;map-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/map-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, put, read, remove, lock, intercept, index, listen</p>
</div>
</li>
<li>
<p>Queue Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;queue-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/queue-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, add, remove, read, listen</p>
</div>
</li>
<li>
<p>Multimap Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;multimap-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/multimap-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, put, read, remove, listen, lock</p>
</div>
</li>
<li>
<p>Topic Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;topic-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/topic-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: create, destroy, publish, listen</p>
</div>
</li>
<li>
<p>List Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;list-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/list-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, add, read, remove, listen</p>
</div>
</li>
<li>
<p>Set Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;set-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/set-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, add, read, remove, listen</p>
</div>
</li>
<li>
<p>Lock Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;lock-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/lock-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, lock, read</p>
</div>
</li>
<li>
<p>AtomicLong Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;atomic-<span class="type">long</span>-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
        ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/atomic-<span class="type">long</span>-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, read, modify</p>
</div>
</li>
<li>
<p>CountDownLatch Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;countdown-latch-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/countdown-latch-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, modify, read</p>
</div>
</li>
<li>
<p>IdGenerator Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;id-generator-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/id-generator-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, modify, read</p>
</div>
</li>
<li>
<p>FlakeIdGenerator Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;flake-id-generator-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/flake-id-generator-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, modify</p>
</div>
</li>
<li>
<p>Semaphore Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;semaphore-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/semaphore-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, acquire, release, read</p>
</div>
</li>
<li>
<p>Executor Service Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;executor-service-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/executor-service-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy</p>
</div>
</li>
<li>
<p>Transaction Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;transaction-permission principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
&lt;/transaction-permission&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Cache Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;cache-permission name=<span class="string"><span class="delimiter">&quot;</span><span class="content">/hz/cache-name</span><span class="delimiter">&quot;</span></span> principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/cache-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, create, destroy, put, read, remove, listen</p>
</div>
</li>
<li>
<p>User Code Deployment Permission</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;user-code-deployment-permission principal=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;endpoints&gt;
    ...
  &lt;/endpoints&gt;
  &lt;actions&gt;
    ...
  &lt;/actions&gt;
&lt;/user-code-deployment-permission&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Actions: all, deploy</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The name provided in <code>cache-permission</code> must be the Hazelcast distributed object name corresponding to the <code>Cache</code> as described in <a href="#jcache-hazelcast-instance-integration">JCache - Hazelcast Instance Integration</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performance"><a class="anchor" href="#performance"></a><a class="link" href="#performance">20. Performance</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides information on the performance features of Hazelcast including near cache, slow operations detector, back pressure and data affinity. Moreover, the chapter describes the best performance practices for Hazelcast deployed on Amazon EC2. It also describes the threading models for I/O, events, executors and operations.</p>
</div>
<div class="sect2">
<h3 id="data-affinity"><a class="anchor" href="#data-affinity"></a><a class="link" href="#data-affinity">20.1. Data Affinity</a></h3>
<div class="paragraph">
<p>Data affinity ensures that related entries exist on the same member. If related data is on the same member, operations can be executed without the cost of extra network calls and extra wire data. This feature is provided by using the same partition keys for related data.</p>
</div>
<div class="sect3">
<h4 id="partitionaware"><a class="anchor" href="#partitionaware"></a><a class="link" href="#partitionaware">20.1.1. PartitionAware</a></h4>
<div class="paragraph">
<p><strong>Co-location of related data and computation</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast has a standard way of finding out which member owns/manages each key object. The following operations will be routed to the same member, since all of them are operating based on the same key <code>"key1"</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
<span class="predefined-type">Map</span> mapA = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">mapA</span><span class="delimiter">&quot;</span></span> );
<span class="predefined-type">Map</span> mapB = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">mapB</span><span class="delimiter">&quot;</span></span> );
<span class="predefined-type">Map</span> mapC = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">mapC</span><span class="delimiter">&quot;</span></span> );

<span class="comment">// since map names are different, operation will be manipulating</span>
<span class="comment">// different entries, but the operation will take place on the</span>
<span class="comment">// same member since the keys (&quot;key1&quot;) are the same</span>
mapA.put( <span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, value );
mapB.get( <span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span> );
mapC.remove( <span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span> );

<span class="comment">// lock operation will still execute on the same member</span>
<span class="comment">// of the cluster since the key (&quot;key1&quot;) is same</span>
hazelcastInstance.getLock( <span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span> ).lock();

<span class="comment">// distributed execution will execute the 'runnable' on the</span>
<span class="comment">// same member since &quot;key1&quot; is passed as the key.</span>
hazelcastInstance.getExecutorService().executeOnKeyOwner( runnable, <span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the keys are the same, entries are stored on the same member. But we sometimes want to have related entries stored on the same member, such as a customer and his/her order entries. We would have a customers map with customerId as the key and an orders map with orderId as the key. Since customerId and orderId are different keys, a customer and his/her orders may fall into different members in your cluster. So how can we have them stored on the same member? We create an affinity between customer and orders. If we make them part of the same partition then these entries will be co-located. We achieve this by making orderIds <code>PartitionAware</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in performance.adoc - include::{javasource}/performance/OrderKey.java[tag=orderkey]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that OrderKey implements <code>PartitionAware</code> and that <code>getPartitionKey()</code> returns the <code>customerId</code>. This will make sure that the <code>Customer</code> entry and its `Order`s will be stored on the same member.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();
<span class="predefined-type">Map</span> mapCustomers = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span> );
<span class="predefined-type">Map</span> mapOrders = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">orders</span><span class="delimiter">&quot;</span></span> );

<span class="comment">// create the customer entry with customer id = 1</span>
mapCustomers.put( <span class="integer">1</span>, customer );

<span class="comment">// now create the orders for this customer</span>
mapOrders.put( <span class="keyword">new</span> OrderKey( <span class="integer">21</span>, <span class="integer">1</span> ), order );
mapOrders.put( <span class="keyword">new</span> OrderKey( <span class="integer">22</span>, <span class="integer">1</span> ), order );
mapOrders.put( <span class="keyword">new</span> OrderKey( <span class="integer">23</span>, <span class="integer">1</span> ), order );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assume that you have a customers map where <code>customerId</code> is the key and the customer object is the value. You want to remove one of the customer orders and return the number of remaining orders. Here is how you would normally do it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">int</span> removeOrder( <span class="type">long</span> customerId, <span class="type">long</span> orderId ) <span class="directive">throws</span> <span class="exception">Exception</span> {
    IMap&lt;<span class="predefined-type">Long</span>, Customer&gt; mapCustomers = instance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span> );
    IMap mapOrders = hazelcastInstance.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">orders</span><span class="delimiter">&quot;</span></span> );

    mapCustomers.lock( customerId );
    mapOrders.remove( orderId );
    <span class="predefined-type">Set</span> orders = orderMap.keySet(Predicates.equal( <span class="string"><span class="delimiter">&quot;</span><span class="content">customerId</span><span class="delimiter">&quot;</span></span>, customerId ));
    mapCustomers.unlock( customerId );

    <span class="keyword">return</span> orders.size();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are couple of things you should consider.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There are four distributed operations there: lock, remove, keySet, unlock. Can you reduce
the number of distributed operations?</p>
</li>
<li>
<p>The customer object may not be that big, but can you not have to pass that object through the
wire? Think about a scenario where you set order count to the customer object for fast access, so you
should do a get and a put, and as a result, the customer object is passed through the wire twice.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Instead, why not move the computation over to the member (JVM) where your customer data resides. Here is how you can do this with distributed executor service.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Send a <code>PartitionAware</code> <code>Callable</code> task.</p>
</li>
<li>
<p><code>Callable</code> does the deletion of the order right there and returns with the remaining
order count.</p>
</li>
<li>
<p>Upon completion of the <code>Callable</code> task, return the result (remaining order count). You
do not have to wait until the task is completed; since distributed executions are asynchronous, you can do other things in the meantime.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here is an example code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance hazelcastInstance = Hazelcast.newHazelcastInstance();

    <span class="directive">public</span> <span class="type">int</span> removeOrder(<span class="type">long</span> customerId, <span class="type">long</span> orderId) <span class="directive">throws</span> <span class="exception">Exception</span> {
        IExecutorService executorService = hazelcastInstance.getExecutorService(<span class="string"><span class="delimiter">&quot;</span><span class="content">ExecutorService</span><span class="delimiter">&quot;</span></span>);

        OrderDeletionTask task = <span class="keyword">new</span> OrderDeletionTask(customerId, orderId);
        <span class="predefined-type">Future</span>&lt;<span class="predefined-type">Integer</span>&gt; future = executorService.submit(task);
        <span class="type">int</span> remainingOrders = future.get();

        <span class="keyword">return</span> remainingOrders;
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">OrderDeletionTask</span>
            <span class="directive">implements</span> <span class="predefined-type">Callable</span>&lt;<span class="predefined-type">Integer</span>&gt;, PartitionAware, <span class="predefined-type">Serializable</span>, HazelcastInstanceAware {

        <span class="directive">private</span> <span class="type">long</span> orderId;
        <span class="directive">private</span> <span class="type">long</span> customerId;
        <span class="directive">private</span> HazelcastInstance hazelcastInstance;

        <span class="directive">public</span> OrderDeletionTask() {
        }

        <span class="directive">public</span> OrderDeletionTask(<span class="type">long</span> customerId, <span class="type">long</span> orderId) {
            <span class="local-variable">this</span>.customerId = customerId;
            <span class="local-variable">this</span>.orderId = orderId;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Integer</span> call() {
            IMap&lt;<span class="predefined-type">Long</span>, Customer&gt; customerMap = hazelcastInstance.getMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>);
            IMap&lt;OrderKey, Order&gt; orderMap = hazelcastInstance.getMap(<span class="string"><span class="delimiter">&quot;</span><span class="content">orders</span><span class="delimiter">&quot;</span></span>);

            customerMap.lock(customerId);

            <span class="predefined-type">Predicate</span> predicate = Predicates.equal(<span class="string"><span class="delimiter">&quot;</span><span class="content">customerId</span><span class="delimiter">&quot;</span></span>, customerId);
            <span class="predefined-type">Set</span>&lt;OrderKey&gt; orderKeys = orderMap.localKeySet(predicate);
            <span class="type">int</span> orderCount = orderKeys.size();
            <span class="keyword">for</span> (OrderKey key : orderKeys) {
                <span class="keyword">if</span> (key.orderId == orderId) {
                    orderCount--;
                    orderMap.delete(key);
                }
            }

            customerMap.unlock(customerId);

            <span class="keyword">return</span> orderCount;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Object</span> getPartitionKey() {
            <span class="keyword">return</span> customerId;
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> setHazelcastInstance(HazelcastInstance hazelcastInstance) {
            <span class="local-variable">this</span>.hazelcastInstance = hazelcastInstance;
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The benefits of doing the same operation with distributed <code>ExecutorService</code> based on the key are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only one distributed execution (<code>executorService.submit(task)</code>), instead of four.</p>
</li>
<li>
<p>Less data is sent over the wire.</p>
</li>
<li>
<p>Since lock/update/unlock cycle is done locally (local to the customer data), lock duration for the <code>Customer</code> entry is much less, thus enabling higher concurrency.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="partitioningstrategy"><a class="anchor" href="#partitioningstrategy"></a><a class="link" href="#partitioningstrategy">20.1.2. PartitioningStrategy</a></h4>
<div class="paragraph">
<p>Another way of storing the related data on the same location is using/implementing the class <code>PartitioningStrategy</code>. Normally (if no partitioning strategy is defined), Hazelcast finds the partition of a key first by converting the object to binary and then by hashing this binary. If a partitioning strategy is defined, Hazelcast injects the key to the strategy and the strategy returns an object out of which the partition is calculated by hashing it.</p>
</div>
<div class="paragraph">
<p>Hazelcast offers the following out-of-the-box partitioning strategies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DefaultPartitioningStrategy</code>: Default strategy. It checks whether the key implements <code>PartitionAware</code>. If it implements, the object is converted to binary and then hashed, to find the partition of the key.</p>
</li>
<li>
<p><code>StringPartitioningStrategy</code>: Works only for string keys. It uses the string after <code>@</code> character as the partition ID. For example, if you have two keys <code>ordergroup1@region1</code> and <code>customergroup1@region1</code>, both <code>ordergroup1</code> and <code>customergroup1</code> will fall into the partition where <code>region1</code> is located.</p>
</li>
<li>
<p><code>StringAndPartitionAwarePartitioningStrategy</code>: Works as the combination of the above two strategies. If the key implements <code>PartitionAware</code>, it works like the <code>DefaultPartitioningStrategy</code>. If it is a string key, it works like the <code>StringPartitioningStrategy</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following are the example configuration snippets. Note that these strategy configurations are <strong>per map</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Declarative Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
...
   &lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">name-of-the-map</span><span class="delimiter">&quot;</span></span>&gt;
   ...
      &lt;partition-strategy&gt;
         com.hazelcast.partition.strategy.StringAndPartitionAwarePartitioningStrategy
      &lt;/partition-strategy&gt;
   ...
   &lt;/map&gt;
...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
MapConfig mapConfig = config.getMapConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">name-of-the-map</span><span class="delimiter">&quot;</span></span>);
PartitioningStrategyConfig psConfig = mapConfig.getPartitioningStrategyConfig();
psConfig.setPartitioningStrategyClass( <span class="string"><span class="delimiter">&quot;</span><span class="content">StringAndPartitionAwarePartitioningStrategy</span><span class="delimiter">&quot;</span></span> );

<span class="comment">// OR</span>
psConfig.setPartitioningStrategy(YourCustomPartitioningStrategy);
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also define your own partition strategy by implementing the class <code>PartitioningStrategy</code>. To enable your implementation, add the full class name to your Hazelcast configuration using either the declarative or programmatic approach, as sampled above.</p>
</div>
<div class="paragraph">
<p>As stated previously, above strategies are defined <strong>per map</strong> in your Hazelcast member. You can also define a strategy <strong>per member</strong> in your Hazelcast cluster. This can be done by defining the <code>hazelcast.partitioning.strategy.class</code> system property. An example declarative way of configuring this property is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
...
  &lt;properties&gt;
    &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.partitioning.strategy.class</span><span class="delimiter">&quot;</span></span>&gt;
       com.hazelcast.partition.strategy.StringAndPartitionAwarePartitioningStrategy
    &lt;/property&gt;
    ....
  &lt;/properties&gt;
  ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use other system property configuring options as explained in the <a href="#configuring-with-system-properties">Configuring with System Properties section</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-in-ec2"><a class="anchor" href="#running-in-ec2"></a><a class="link" href="#running-in-ec2">20.2. Running in EC2</a></h3>
<div class="paragraph">
<p>For the best performance of your Hazelcast in AWS EC2:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is best to select the newest Linux AMIs.</p>
</li>
<li>
<p>HVM based instances give the best performance.</p>
</li>
<li>
<p>Select at least a system with 8 vCPUs, e.g., c4.2xlarge. For an overview of all types of EC2 instances, please check <a href="https://www.ec2instances.info" class="bare">https://www.ec2instances.info</a>.</p>
</li>
<li>
<p>Consider setting a placement group. A placement group can have a significant impact on the performance.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="back-pressure"><a class="anchor" href="#back-pressure"></a><a class="link" href="#back-pressure">20.3. Back Pressure</a></h3>
<div class="paragraph">
<p>Hazelcast uses operations to make remote calls. For example, a <code>map.get</code> is an operation and a <code>map.put</code> is one operation for the primary
and one operation for each of the backups, i.e. <code>map.put</code> is executed for the primary and also for each backup. In most cases, there will be a natural balance between the number of threads performing operations
and the number of operations being executed. However, there are two situations where this balance and operations
can pile up and eventually lead to Out of Memory Exception (OOME):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Asynchronous calls: With async calls, the system may be flooded with the requests.</p>
</li>
<li>
<p>Asynchronous backups: The asynchronous backups may be piling up.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To prevent the system from crashing, Hazelcast provides back pressure. Back pressure works by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>limiting the number of concurrent operation invocations,</p>
</li>
<li>
<p>periodically making an async backup sync.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="member-side"><a class="anchor" href="#member-side"></a><a class="link" href="#member-side">20.3.1. Member Side</a></h4>
<div class="paragraph">
<p>Back pressure is disabled by default and you can enable it using the following system property:</p>
</div>
<div class="paragraph">
<p><code>hazelcast.backpressure.enabled</code></p>
</div>
<div class="paragraph">
<p>To control the number of concurrent invocations, you can configure the number of invocations allowed per partition using the
following system property:</p>
</div>
<div class="paragraph">
<p><code>hazelcast.backpressure.max.concurrent.invocations.per.partition</code></p>
</div>
<div class="paragraph">
<p>The default value of this system property is 100. Using a default configuration a system is allowed to have (271 + 1) * 100 = 27200 concurrent invocations (271 partitions + 1 for generic operations).</p>
</div>
<div class="paragraph">
<p>Back pressure is only applied to normal operations. System operations like heart beats and partition migration operations
are not influenced by back pressure. 27200 invocations might seem like a lot, but keep in mind that executing a task on <code>IExecutor</code>
or acquiring a lock also requires an operation.</p>
</div>
<div class="paragraph">
<p>If the maximum number of invocations has been reached, Hazelcast will automatically apply an exponential back off policy. This
gives the system some time to deal with the load. Using the following system property, you can configure the maximum time to wait before a <code>HazelcastOverloadException</code> is thrown:</p>
</div>
<div class="paragraph">
<p><code>hazelcast.backpressure.backoff.timeout.millis</code></p>
</div>
<div class="paragraph">
<p>This system property&#8217;s default value is 60000 milliseconds.</p>
</div>
<div class="paragraph">
<p>The Health Monitor keeps an eye on the usage of the invocations. If it sees a member has consumed 70% or more of the invocations, it starts to log health messages.</p>
</div>
<div class="paragraph">
<p>Apart from controlling the number of invocations, you also need to control the number of pending async backups. This is done
by periodically making these backups sync instead of async. This forces all pending backups to get drained. For this, Hazelcast tracks the number of asynchronous backups for each partition. At every <strong>Nth</strong> call, one synchronization is forced. This <strong>N</strong> is
controlled through the following property:</p>
</div>
<div class="paragraph">
<p><code>hazelcast.backpressure.syncwindow</code></p>
</div>
<div class="paragraph">
<p>This system property&#8217;s default value is 100. It means, out of 100 <strong>asynchronous</strong> backups, Hazelcast makes 1 of them a <strong>synchronous</strong> one. A randomization is added, so the sync window with default configuration will be between 75 and 125
invocations.</p>
</div>
</div>
<div class="sect3">
<h4 id="client-side"><a class="anchor" href="#client-side"></a><a class="link" href="#client-side">20.3.2. Client Side</a></h4>
<div class="paragraph">
<p>To prevent the system at the client side from overloading, you can apply a constraint on the number of concurrent invocations. You can use the following system property at the client side for this purpose:</p>
</div>
<div class="paragraph">
<p><code>hazelcast.client.max.concurrent.invocations</code></p>
</div>
<div class="paragraph">
<p>This property defines the maximum allowed number of concurrent invocations. When it is not explicitly set, it has the value <code>Integer.MAX_VALUE</code> by default, which means infinite. When you set it and if the maximum number of concurrent invocations is exceeded this value, Hazelcast will throw <code>HazelcastOverloadException</code> when a new invocation comes in.</p>
</div>
<div class="paragraph">
<p>Please note that back off timeout and controlling the number of pending async backups (sync window) is not supported at the client side.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="#system-properties">System Properties appendix</a> to learn how to configure the system properties.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="threading-model"><a class="anchor" href="#threading-model"></a><a class="link" href="#threading-model">20.4. Threading Model</a></h3>
<div class="paragraph">
<p>Your application server has its own threads. Hazelcast does not use these; it manages its own threads.</p>
</div>
<div class="sect3">
<h4 id="i-o-threading"><a class="anchor" href="#i-o-threading"></a><a class="link" href="#i-o-threading">20.4.1. I/O Threading</a></h4>
<div class="paragraph">
<p>Hazelcast uses a pool of threads for I/O. A single thread does not perform all the I/O. Instead, multiple threads perform the I/O. On each cluster member, the I/O threading is split up in 3 types of I/O threads:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>I/O thread for the accept requests.</p>
</li>
<li>
<p>I/O threads to read data from other members/clients.</p>
</li>
<li>
<p>I/O threads to write data to other members/clients.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure the number of I/O threads using the <code>hazelcast.io.thread.count</code> system property. Its default value is 3 per member. If 3 is used, in total there are 7 I/O threads: 1 accept I/O thread, 3 read I/O threads and 3 write I/O threads. Each I/O thread has its own Selector instance and waits on the <code>Selector.select</code> if there is nothing to do.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also specify counts for input and output threads separately. There are <code>hazelcast.io.input.thread.count</code> and <code>hazelcast.io.output.thread.count</code> properties for this purpose. Please refer to the <a href="#system-properties">System Properties section</a> for information on these properties and how to set them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hazelcast periodically scans utilization of each I/O thread and can decide to migrate a connection to a new thread if the existing thread is servicing a disproportionate number of I/O events. You can customize the scanning interval by configuring the <code>hazelcast.io.balancer.interval.seconds</code> system property; its default interval is 20 seconds. You can disable the balancing process by setting this property to a negative value.</p>
</div>
<div class="paragraph">
<p>In case of the read I/O thread, when sufficient bytes for a packet have been received, the <code>Packet</code> object is created. This <code>Packet</code> object is
then sent to the system where it is de-multiplexed. If the <code>Packet</code> header signals that it is an operation/response, the <code>Packet</code> is handed
over to the operation service (please see the <a href="#operation-threading">Operation Threading section</a>). If the <code>Packet</code> is an event, it is handed
over to the event service (please see the <a href="#event-threading">Event Threading section</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="event-threading"><a class="anchor" href="#event-threading"></a><a class="link" href="#event-threading">20.4.2. Event Threading</a></h4>
<div class="paragraph">
<p>Hazelcast uses a shared event system to deal with components that rely on events, such as topic, collections, listeners and Near Cache.</p>
</div>
<div class="paragraph">
<p>Each cluster member has an array of event threads and each thread has its own work queue. When an event is produced,
either locally or remotely, an event thread is selected (depending on if there is a message ordering) and the event is placed
in the work queue for that event thread.</p>
</div>
<div class="paragraph">
<p>The following properties
can be set to alter the behavior of the system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.event.thread.count</code>: Number of event-threads in this array. Its default value is 5.</p>
</li>
<li>
<p><code>hazelcast.event.queue.capacity</code>: Capacity of the work queue. Its default value is 1000000.</p>
</li>
<li>
<p><code>hazelcast.event.queue.timeout.millis</code>: Timeout for placing an item on the work queue in milliseconds. Its default value is 250 milliseconds.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you process a lot of events and have many cores, changing the value of <code>hazelcast.event.thread.count</code> property to
a higher value is a good practice. This way, more events can be processed in parallel.</p>
</div>
<div class="paragraph">
<p>Multiple components share the same event queues. If there are 2 topics, say A and B, for certain messages
they may share the same queue(s) and hence the same event thread. If there are a lot of pending messages produced by A, then B needs to wait.
Also, when processing a message from A takes a lot of time and the event thread is used for that, B suffers from this.
That is why it is better to offload processing to a dedicated thread (pool) so that systems are better isolated.</p>
</div>
<div class="paragraph">
<p>If the events are produced at a higher rate than they are consumed, the queue grows in size. To prevent overloading the system
and running into an <code>OutOfMemoryException</code>, the queue is given a capacity of 1 million items. When the maximum capacity is reached, the items are
dropped. This means that the event system is a 'best effort' system. There is no guarantee that you are going to get an
event. Topic A might have a lot of pending messages and therefore B cannot receive messages because the queue
has no capacity and messages for B are dropped.</p>
</div>
</div>
<div class="sect3">
<h4 id="iexecutor-threading"><a class="anchor" href="#iexecutor-threading"></a><a class="link" href="#iexecutor-threading">20.4.3. IExecutor Threading</a></h4>
<div class="paragraph">
<p>Executor threading is straight forward. When a task is received to be executed on Executor E, then E will have its
own <code>ThreadPoolExecutor</code> instance and the work is placed in the work queue of this executor. Thus, Executors are fully isolated, but still share the same underlying hardware - most importantly the CPUs.</p>
</div>
<div class="paragraph">
<p>You can configure the IExecutor using the <code>ExecutorConfig</code> (programmatic configuration) or using <code>&lt;executor&gt;</code> (declarative configuration). Please also see the <a href="#configuring-executor-service">Configuring Executor Service section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="operation-threading"><a class="anchor" href="#operation-threading"></a><a class="link" href="#operation-threading">20.4.4. Operation Threading</a></h4>
<div class="paragraph">
<p>There are 2 types of operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operations that are aware of a certain partition, e.g., <code>IMap.get(key)</code>.</p>
</li>
<li>
<p>Operations that are not partition aware, such as the <code>IExecutorService.executeOnMember(command, member)</code> operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these operation types has a different threading model explained in the following sections.</p>
</div>
<div class="sect4">
<h5 id="partition-aware-operations"><a class="anchor" href="#partition-aware-operations"></a><a class="link" href="#partition-aware-operations">Partition-aware Operations</a></h5>
<div class="paragraph">
<p>To execute partition-aware operations, an array of operation threads is created. The default value of this array&#8217;s size is the number of cores and it has a minimum value of 2. This value can be changed using the <code>hazelcast.operation.thread.count</code> property.</p>
</div>
<div class="paragraph">
<p>Each operation thread has its own work queue and it consumes messages from this work queue. If a partition-aware
operation needs to be scheduled, the right thread is found using the formula below.</p>
</div>
<div class="paragraph">
<p><code>threadIndex = partitionId % partition thread-count</code></p>
</div>
<div class="paragraph">
<p>After the <code>threadIndex</code> is determined, the operation is put in the work queue of that operation thread. This means the followings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A single operation thread executes operations for multiple partitions; if there are 271 partitions and 10 partition threads, then roughly every operation thread executes operations for 27 partitions.</p>
</li>
<li>
<p>Each partition belongs to only 1 operation thread. All operations for a partition are always handled by exactly the same operation thread.</p>
</li>
<li>
<p>Concurrency control is not needed to deal with partition-aware operations because once a partition-aware operation is put in the work queue of a partition-aware operation thread, only 1 thread is able to touch that partition.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because of this threading strategy, there are two forms of false sharing you need to be aware of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>False sharing of the partition - two completely independent data structures share the same partition. For example, if there is a map <code>employees</code> and a map <code>orders</code>, the method <code>employees.get("peter")</code> running on partition 25 may be blocked by the method <code>orders.get(1234)</code> also running on partition 25. If independent data structures share the same partition, a slow operation on one data structure can slow down the other data structures.</p>
</li>
<li>
<p>False sharing of the partition-aware operation thread - each operation thread is responsible for executing
operations on a number of partitions. For example, <strong>thread 1</strong> could be responsible for partitions 0, 10, 20, etc. and <strong>thread-2</strong> could be responsible for partitions
1, 11, 21, etc. If an operation for partition 1 takes a lot of time, it blocks the execution of an operation for partition
11 because both of them are mapped to the same operation thread.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You need to be careful with long running operations because you could starve operations of a thread.
As a general rule, the partition thread should be released as soon as possible because operations are not designed
as long running operations. That is why, for example, it is very dangerous to execute a long running operation
using <code>AtomicReference.alter()</code> or an <code>IMap.executeOnKey()</code>, because these operations block other operations to be executed.</p>
</div>
<div class="paragraph">
<p>Currently, there is no support for work stealing. Different partitions that map to the same thread may need to wait
till one of the partitions is finished, even though there are other free partition-aware operation threads available.</p>
</div>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="paragraph">
<p>Take a cluster with three members. Two members will have 90 primary partitions and one member will have 91 primary partitions. Let&#8217;s
say you have one CPU and four cores per CPU. By default, four operation threads will be allocated to serve 90 or 91 partitions.</p>
</div>
</div>
<div class="sect4">
<h5 id="non-partition-aware-operations"><a class="anchor" href="#non-partition-aware-operations"></a><a class="link" href="#non-partition-aware-operations">Non-Partition-aware Operations</a></h5>
<div class="paragraph">
<p>To execute operations that are not partition-aware, e.g., <code>IExecutorService.executeOnMember(command, member)</code>, generic operation
threads are used. When the Hazelcast instance is started, an array of operation threads is created. The size of this array
has a default value of the number of cores divided by two with a minimum value of 2. It can be changed using the
<code>hazelcast.operation.generic.thread.count</code> property.</p>
</div>
<div class="paragraph">
<p>A non-partition-aware operation thread does not execute an operation for a specific partition. Only partition-aware
  operation threads execute partition-aware operations.</p>
</div>
<div class="paragraph">
<p>Unlike the partition-aware operation threads, all the generic operation threads share the same work queue: <code>genericWorkQueue</code>.</p>
</div>
<div class="paragraph">
<p>If a non-partition-aware operation needs to be executed, it is placed in that work queue and any generic operation
thread can execute it. The big advantage is that you automatically have work balancing since any generic operation
thread is allowed to pick up work from this queue.</p>
</div>
<div class="paragraph">
<p>The disadvantage is that this shared queue can be a point of contention. You may not see this contention in
production since performance is dominated by I/O and the system does not run many non-partition-aware operations.</p>
</div>
</div>
<div class="sect4">
<h5 id="priority-operations"><a class="anchor" href="#priority-operations"></a><a class="link" href="#priority-operations">Priority Operations</a></h5>
<div class="paragraph">
<p>In some cases, the system needs to run operations with a higher priority, e.g., an important system operation. To support priority operations, Hazelcast has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For partition-aware operations: Each partition thread has its own work queue and it also has a priority
work queue. The partition thread always checks the priority queue before it processes work from its normal work queue.</p>
</li>
<li>
<p>For non-partition-aware operations: Next to the <code>genericWorkQueue</code>, there is also a <code>genericPriorityWorkQueue</code>. When a priority operation
needs to be run, it is put in the <code>genericPriorityWorkQueue</code>. Like the partition-aware operation threads, a generic
operation thread first checks the <code>genericPriorityWorkQueue</code> for work.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since a worker thread blocks on the normal work queue (either partition specific or generic), a priority operation
may not be picked up because it is not put in the queue where it is blocking. Hazelcast always sends a 'kick the worker' operation that
only triggers the worker to wake up and check the priority queue.</p>
</div>
</div>
<div class="sect4">
<h5 id="operation-response-and-invocation-future"><a class="anchor" href="#operation-response-and-invocation-future"></a><a class="link" href="#operation-response-and-invocation-future">Operation-response and Invocation-future</a></h5>
<div class="paragraph">
<p>When an Operation is invoked, a <code>Future</code> is returned. Please see the example code below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GetOperation operation = <span class="keyword">new</span> GetOperation( mapName, key );
<span class="predefined-type">Future</span> future = operationService.invoke( operation );
future.get();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The calling side blocks for a reply. In this case, <code>GetOperation</code> is set in the work queue for the partition of <code>key</code>, where
it eventually is executed. Upon execution, a response is returned and placed on the <code>genericWorkQueue</code> where it is executed by a
"generic operation thread". This thread signals the <code>future</code> and notifies the blocked thread that a response is available.
Hazelcast has a plan of exposing this <code>future</code> to the outside world, and we will provide the ability to register a completion listener so you can perform asynchronous calls.</p>
</div>
</div>
<div class="sect4">
<h5 id="local-calls"><a class="anchor" href="#local-calls"></a><a class="link" href="#local-calls">Local Calls</a></h5>
<div class="paragraph">
<p>When a local partition-aware call is done, an operation is made and handed over to the work queue of the correct partition operation thread,
and a <code>future</code> is returned. When the calling thread calls <code>get</code> on that <code>future</code>, it acquires a lock and waits for the result
to become available. When a response is calculated, the <code>future</code> is looked up and the waiting thread is notified.</p>
</div>
<div class="paragraph">
<p>In the future, this will be optimized to reduce the amount of expensive systems calls, such as <code>lock.acquire()</code>/<code>notify()</code> and the expensive
interaction with the operation-queue. Probably, we will add support for a caller-runs mode, so that an operation is directly run on
the calling thread.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="slowoperationdetector"><a class="anchor" href="#slowoperationdetector"></a><a class="link" href="#slowoperationdetector">20.5. SlowOperationDetector</a></h3>
<div class="paragraph">
<p>The <code>SlowOperationDetector</code> monitors the operation threads and collects information about all slow operations. An <code>Operation</code> is a task executed by a generic or partition thread (see <a href="#operation-threading">Operation Threading</a>). An operation is considered as slow when it takes more computation time than the configured threshold.</p>
</div>
<div class="paragraph">
<p>The <code>SlowOperationDetector</code> stores the fully qualified classname of the operation and its stacktrace as well as operation details, start time and duration of each slow invocation. All collected data is available in the <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#monitoring-members">Management Center</a>.</p>
</div>
<div class="paragraph">
<p>The <code>SlowOperationDetector</code> is configured via the following system properties.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.slow.operation.detector.enabled</code></p>
</li>
<li>
<p><code>hazelcast.slow.operation.detector.log.purge.interval.seconds</code></p>
</li>
<li>
<p><code>hazelcast.slow.operation.detector.log.retention.seconds</code></p>
</li>
<li>
<p><code>hazelcast.slow.operation.detector.stacktrace.logging.enabled</code></p>
</li>
<li>
<p><code>hazelcast.slow.operation.detector.threshold.millis</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please refer to the <a href="#system-properties">System Properties appendix</a> for explanations of these properties.</p>
</div>
<div class="sect3">
<h4 id="logging-of-slow-operations"><a class="anchor" href="#logging-of-slow-operations"></a><a class="link" href="#logging-of-slow-operations">20.5.1. Logging of Slow Operations</a></h4>
<div class="paragraph">
<p>The detected slow operations are logged as warnings in the Hazelcast log files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WARN <span class="integer">2015</span>-<span class="octal">05</span>-<span class="octal">07</span> <span class="integer">11</span>:<span class="octal">05</span>:<span class="integer">30</span>,<span class="integer">890</span> SlowOperationDetector: [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5701</span>
  Slow operation detected: com.hazelcast.map.impl.operation.PutOperation
  Hint: You can enable the logging of stacktraces with the following config
  property: hazelcast.slow.operation.detector.stacktrace.logging.enabled
WARN <span class="integer">2015</span>-<span class="octal">05</span>-<span class="octal">07</span> <span class="integer">11</span>:<span class="octal">05</span>:<span class="integer">30</span>,<span class="integer">891</span> SlowOperationDetector: [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5701</span>
  Slow operation detected: com.hazelcast.map.impl.operation.PutOperation
  (<span class="integer">2</span> invocations)
WARN <span class="integer">2015</span>-<span class="octal">05</span>-<span class="octal">07</span> <span class="integer">11</span>:<span class="octal">05</span>:<span class="integer">30</span>,<span class="integer">892</span> SlowOperationDetector: [<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>]:<span class="integer">5701</span>
  Slow operation detected: com.hazelcast.map.impl.operation.PutOperation
  (<span class="integer">3</span> invocations)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Stacktraces are always reported to the Management Center, but by default they are not printed to keep the log size small. If logging of stacktraces is enabled, the full stacktrace is printed every 100 invocations. All other invocations print a shortened version.</p>
</div>
</div>
<div class="sect3">
<h4 id="purging-of-slow-operation-logs"><a class="anchor" href="#purging-of-slow-operation-logs"></a><a class="link" href="#purging-of-slow-operation-logs">20.5.2. Purging of Slow Operation Logs</a></h4>
<div class="paragraph">
<p>Since a Hazelcast cluster can run for a very long time, Hazelcast purges the slow operation logs periodically to prevent an OOME. You can configure the purge interval and the retention time for each invocation.</p>
</div>
<div class="paragraph">
<p>The purging removes each invocation whose retention time is exceeded. When all invocations are purged from a slow operation log, the log is deleted.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="near-cache"><a class="anchor" href="#near-cache"></a><a class="link" href="#near-cache">20.6. Near Cache</a></h3>
<div class="paragraph">
<p>Map or Cache entries in Hazelcast are partitioned across the cluster members. Hazelcast clients do not have local data at all. Suppose you read the key <code>k</code> a number of times from a Hazelcast client or <code>k</code> is owned by another member in your cluster. Then each <code>map.get(k)</code> or <code>cache.get(k)</code> will be a remote operation, which creates a lot of network trips. If you have a data structure that is mostly read, then you should consider creating a local Near Cache, so that reads are sped up and less network traffic is created.</p>
</div>
<div class="paragraph">
<p>These benefits do not come for free, please consider the following trade-offs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Members with a Near Cache will have to hold the extra cached data, which increases memory consumption.</p>
</li>
<li>
<p>If invalidation is enabled and entries are updated frequently, then invalidations will be costly.</p>
</li>
<li>
<p>Near Cache breaks the strong consistency guarantees; you might be reading stale data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Near Cache is highly recommended for data structures that are mostly read.</p>
</div>
<div class="paragraph">
<p>In a client/server system you must enable the Near Cache separately on the client, without the need to configure it on the server. Please note that Near Cache configuration is specific to the server or client itself: a data structure on a server may not have Near Cache configured while the same data structure on a client may have Near Cache configured. They also can have different Near Cache configurations.</p>
</div>
<div class="paragraph">
<p>If you are using Near Cache, you should take into account that your hits to the keys in the Near Cache are not reflected as hits to the original keys on the primary members. This has for example an impact on IMap&#8217;s maximum idle seconds or time-to-live seconds expiration. Therefore, even though there is a hit on a key in Near Cache, your original key on the primary member may expire.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Near Cache works only when you access data via <code>map.get(k)</code> or <code>cache.get(k)</code> methods. Data returned using a predicate is not stored in the Near Cache.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="hazelcast-data-structures-with-near-cache-support"><a class="anchor" href="#hazelcast-data-structures-with-near-cache-support"></a><a class="link" href="#hazelcast-data-structures-with-near-cache-support">20.6.1. Hazelcast Data Structures with Near Cache Support</a></h4>
<div class="paragraph">
<p>The following matrix shows the Hazelcast data structures with Near Cache support. Please have a look at the next section for a detailed explanation of <code>cache-local-entries</code>, <code>local-update-policy</code>, <code>preloader</code> and <code>serialize-keys</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Data structure</th>
<th class="tableblock halign-left valign-top">Near Cache Support</th>
<th class="tableblock halign-left valign-top"><code>cache-local-entries</code></th>
<th class="tableblock halign-left valign-top"><code>local-update-policy</code></th>
<th class="tableblock halign-left valign-top"><code>preloader</code></th>
<th class="tableblock halign-left valign-top"><code>serialize-keys</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMap member</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMap client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JCache member</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JCache client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReplicatedMap member</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReplicatedMap client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TransactionalMap member</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">limited</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TransactionalMap client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Even though lite members do not store any data for Hazelcast data structures, you can enable Near Cache on lite members for faster reads.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuring-near-cache"><a class="anchor" href="#configuring-near-cache"></a><a class="link" href="#configuring-near-cache">20.6.2. Configuring Near Cache</a></h4>
<div class="paragraph">
<p>The following shows the configuration for the Hazelcast Near Cache.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please keep in mind that, if you want to use near cache on a Hazelcast member, configure it on the member; if you want to use it on a Hazelcast client, configure it on the client.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Declarative</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;near-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataStructure</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;in-memory-format&gt;(OBJECT|BINARY|NATIVE)&lt;/in-memory-format&gt;
  &lt;serialize-keys&gt;(<span class="predefined-constant">true</span>|<span class="predefined-constant">false</span>)&lt;/serialize-keys&gt;
  &lt;invalidate-on-change&gt;(<span class="predefined-constant">true</span>|<span class="predefined-constant">false</span>)&lt;/invalidate-on-change&gt;
  &lt;time-to-live-seconds&gt;(<span class="integer">0</span>..INT_MAX)&lt;/time-to-live-seconds&gt;
  &lt;max-idle-seconds&gt;(<span class="integer">0</span>..INT_MAX)&lt;/max-idle-seconds&gt;
  &lt;eviction eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">(LRU|LFU|RANDOM|NONE)</span><span class="delimiter">&quot;</span></span>
            max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">(ENTRY_COUNT
              |USED_NATIVE_MEMORY_SIZE|USED_NATIVE_MEMORY_PERCENTAGE
              |FREE_NATIVE_MEMORY_SIZE|FREE_NATIVE_MEMORY_PERCENTAGE</span><span class="delimiter">&quot;</span></span>
            size=<span class="string"><span class="delimiter">&quot;</span><span class="content">(0..INT_MAX)</span><span class="delimiter">&quot;</span></span>/&gt;
  &lt;cache-local-entries&gt;(<span class="predefined-constant">false</span>|<span class="predefined-constant">true</span>)&lt;/cache-local-entries&gt;
  &lt;local-update-policy&gt;(INVALIDATE|CACHE_ON_UPDATE)&lt;/local-update-policy&gt;
  &lt;preloader enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">(true|false)</span><span class="delimiter">&quot;</span></span>
             directory=<span class="string"><span class="delimiter">&quot;</span><span class="content">nearcache-example</span><span class="delimiter">&quot;</span></span>
             store-initial-delay-seconds=<span class="string"><span class="delimiter">&quot;</span><span class="content">(0..INT_MAX)</span><span class="delimiter">&quot;</span></span>
             store-interval-seconds=<span class="string"><span class="delimiter">&quot;</span><span class="content">(0..INT_MAX)</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/near-cache&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The element <code>&lt;near-cache&gt;</code> has an optional attribute <code>name</code> whose default value is <code>default</code>.</p>
</div>
<div class="paragraph">
<p><strong>Programmatic</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in performance.adoc - include::{javasource}/performance/NearCacheConfigurationSample.java[tag=nearcacheconfig]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/config/NearCacheConfig.html">NearCacheConfig</a> is used for all supported Hazelcast data structures on members and clients.</p>
</div>
<div class="paragraph">
<p>Following are the descriptions of all configuration elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>in-memory-format</code>: Specifies in which format data will be stored in your Near Cache. Note that a map&#8217;s in-memory format can be different from that of its Near Cache. Available values are as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>BINARY</code>: Data will be stored in serialized binary format (default value).</p>
</li>
<li>
<p><code>OBJECT</code>: Data will be stored in deserialized form.</p>
</li>
<li>
<p><code>NATIVE</code>: Data will be stored in the Near Cache that uses Hazelcast&#8217;s High-Density Memory Store feature. This option is available only in Hazelcast IMDG Enterprise HD. Note that a map and its Near Cache can independently use High-Density Memory Store. For example, while your map does not use High-Density Memory Store, its Near Cache can use it.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>serialize-keys</code>: Specifies if the keys of a Near Cache entry should be serialized or not. Serializing the keys has a big impact on the read performance of the Near Cache. It should just be activated when you have mutable keys, which are changed after use for the Near Cache. Its default value is <code>false</code>.</p>
</li>
<li>
<p><code>invalidate-on-change</code>: Specifies whether the cached entries are evicted when the entries are updated or removed. Its default value is true.</p>
</li>
<li>
<p><code>time-to-live-seconds</code>: Maximum number of seconds for each entry to stay in the Near Cache. Entries that are older than this period are automatically evicted from the Near Cache. Regardless of the eviction policy used, <code>time-to-live-seconds</code> still applies. Any integer between 0 and <code>Integer.MAX_VALUE</code>. 0 means infinite. Its default value is 0.</p>
</li>
<li>
<p><code>max-idle-seconds</code>: Maximum number of seconds each entry can stay in the Near Cache as untouched (not read). Entries that are not read more than this period are removed from the Near Cache. Any integer between 0 and <code>Integer.MAX_VALUE</code>. 0 means <code>Integer.MAX_VALUE</code>. Its default value is 0.</p>
</li>
<li>
<p><code>eviction</code>: Specifies the eviction behavior when you use High-Density Memory Store for your Near Cache. It has the following attributes:</p>
<div class="ulist">
<ul>
<li>
<p><code>eviction-policy</code>: Eviction policy configuration. Available values are as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>LRU</code>: Least Recently Used (default value).</p>
</li>
<li>
<p><code>LFU</code>: Least Frequently Used.</p>
</li>
<li>
<p><code>NONE</code>: No items will be evicted and the property max-size will be ignored. You still can combine it with <code>time-to-live-seconds</code> and <code>max-idle-seconds</code> to evict items from the Near Cache.
<strong>*</strong>- <code>RANDOM</code>: A random item will be evicted.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>max-size-policy</code>: Maximum size policy for eviction of the Near Cache. Available values are as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>ENTRY_COUNT</code>: Maximum size based on the entry count in the Near Cache (default value).</p>
</li>
<li>
<p><code>USED_NATIVE_MEMORY_SIZE</code>: Maximum used native memory size of the specified Near Cache in MB to trigger the eviction. If the used native memory size exceeds this threshold, the eviction is triggered.  Available only for <code>NATIVE</code> in-memory format. This is supported only by Hazelcast IMDG Enterprise.</p>
</li>
<li>
<p><code>USED_NATIVE_MEMORY_PERCENTAGE</code>: Maximum used native memory percentage of the specified Near Cache to trigger the eviction. If the native memory usage percentage (relative to maximum native memory size) exceeds this threshold, the eviction is triggered. Available only for <code>NATIVE</code> in-memory format. This is supported only by Hazelcast IMDG Enterprise.</p>
</li>
<li>
<p><code>FREE_NATIVE_MEMORY_SIZE</code>: Minimum free native memory size of the specified Near Cache in MB to trigger the eviction. If free native memory size goes below this threshold, eviction is triggered. Available only for <code>NATIVE</code> in-memory format. This is supported only by Hazelcast IMDG Enterprise.</p>
</li>
<li>
<p><code>FREE_NATIVE_MEMORY_PERCENTAGE</code>: Minimum free native memory percentage of the specified Near Cache to trigger eviction. If free native memory percentage (relative to maximum native memory size) goes below this threshold, eviction is triggered. Available only for <code>NATIVE</code> in-memory format. This is supported only by Hazelcast IMDG Enterprise.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>size</code>: Maximum size of the Near Cache used for <code>max-size-policy</code>. When this is reached the Near Cache is evicted based on the policy defined. Any integer between <code>1</code> and <code>Integer.MAX_VALUE</code>. This value has different defaults, depending on the data structure.</p>
<div class="ulist">
<ul>
<li>
<p><code>IMap</code>: Its default value is <code>Integer.MAX_VALUE</code> for on-heap maps and <code>10000</code> for the <code>NATIVE</code> in-memory format.</p>
</li>
<li>
<p><code>JCache</code>: Its default value is <code>10000</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>cache-local-entries</code>: Specifies whether the local entries will be cached. It can be useful when in-memory format for Near Cache is different from that of the map. By default, it is disabled. Is just available on Hazelcast members, not on Hazelcast clients (which have no local entries).</p>
</li>
<li>
<p><code>local-update-policy</code>: Specifies the update policy of the local Near Cache. It is available on JCache clients. Available values are as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>INVALIDATE</code>: Removes the Near Cache entry on mutation. After the mutative call to the member completes but before the operation returns to the caller, the Near Cache entry is removed. Until the mutative operation completes, the readers still continue to read the old value. But as soon as the update completes the Near Cache entry is removed. Any threads reading the key after this point will have a Near Cache miss and call through to the member, obtaining the new entry. This setting provides read-your-writes consistency. This is the default setting.</p>
</li>
<li>
<p><code>CACHE_ON_UPDATE</code>: Updates the Near Cache entry on mutation. After the mutative call to the member completes but before the put returns to the caller, the Near Cache entry is updated. So a remove will remove it and one of the put methods will update it to the new value. Until the update/remove operation completes, the entry&#8217;s old value can still be read from the Near Cache. But before the call completes the Near Cache entry is updated. Any threads reading the key after this point will read the new entry. If the mutative operation was a remove, the key will no longer exist in the cache, both the Near Cache and the original copy in the member. The member will initiate an invalidate event to any other Near Caches, however the caller Near Cache is not invalidated as it already has the new value. This setting also provides read-your-writes consistency.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>preloader</code>: Specifies if the Near Cache should store and pre-load its keys for a faster re-population after a Hazelcast client restart. Is just available on IMap and JCache clients. It has the following attributes:</p>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Specifies whether the preloader for this Near Cache is enabled or not, <code>true</code> or <code>false</code>.</p>
</li>
<li>
<p><code>directory</code>: Specifies the parent directory for the preloader of this Near Cache. The filenames for the preloader storage will be generated from the Near Cache name. You can additionally specify the parent directory to have multiple clients on the same machine with the same Near Cache names.</p>
</li>
<li>
<p><code>store-initial-delay-seconds</code>: Specifies the delay in seconds until the keys of this Near Cache are stored for the first time. Its default value is <code>600</code> seconds.</p>
</li>
<li>
<p><code>store-interval-seconds</code>: Specifies the interval in seconds in which the keys of this Near Cache are stored. Its default value is <code>600</code> seconds.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="near-cache-configuration-examples"><a class="anchor" href="#near-cache-configuration-examples"></a><a class="link" href="#near-cache-configuration-examples">20.6.3. Near Cache Configuration Examples</a></h4>
<div class="paragraph">
<p>This section shows some configuration examples for different Hazelcast data structures.</p>
</div>
<div class="sect4">
<h5 id="near-cache-example-for-imap"><a class="anchor" href="#near-cache-example-for-imap"></a><a class="link" href="#near-cache-example-for-imap">Near Cache Example for IMap</a></h5>
<div class="paragraph">
<p>The following are configuration examples for IMap Near Caches for Hazelcast members and clients.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  &lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">mostlyReadMap</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;in-memory-format&gt;BINARY&lt;/in-memory-format&gt;
    &lt;near-cache&gt;
      &lt;in-memory-format&gt;OBJECT&lt;/in-memory-format&gt;
      &lt;invalidate-on-change&gt;<span class="predefined-constant">false</span>&lt;/invalidate-on-change&gt;
      &lt;time-to-live-seconds&gt;<span class="integer">600</span>&lt;/time-to-live-seconds&gt;
      &lt;eviction eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">NONE</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTRY_COUNT</span><span class="delimiter">&quot;</span></span> size=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span>/&gt;
      &lt;cache-local-entries&gt;<span class="predefined-constant">true</span>&lt;/cache-local-entries&gt;
    &lt;/near-cache&gt;
  &lt;/map&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EvictionConfig evictionConfig = <span class="keyword">new</span> EvictionConfig()
  .setEvictionPolicy(EvictionPolicy.NONE)
  .setMaximumSizePolicy(MaxSizePolicy.ENTRY_COUNT)
  .setSize(<span class="integer">5000</span>);

NearCacheConfig nearCacheConfig = <span class="keyword">new</span> NearCacheConfig()
  .setInMemoryFormat(InMemoryFormat.OBJECT)
  .setInvalidateOnChange(<span class="predefined-constant">false</span>)
  .setTimeToLiveSeconds(<span class="integer">600</span>)
  .setEvictionConfig(evictionConfig);

Config config = <span class="keyword">new</span> Config();
config.getMapConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">mostlyReadMap</span><span class="delimiter">&quot;</span></span>)
  .setInMemoryFormat(InMemoryFormat.BINARY)
  .setNearCacheConfig(nearCacheConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Near Cache configuration for maps on members is a child of the map configuration, so you do not have to define the map name in the Near Cache configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast-client&gt;
  &lt;near-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">mostlyReadMap</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;in-memory-format&gt;OBJECT&lt;/in-memory-format&gt;
    &lt;invalidate-on-change&gt;<span class="predefined-constant">true</span>&lt;/invalidate-on-change&gt;
    &lt;eviction eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">LRU</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTRY_COUNT</span><span class="delimiter">&quot;</span></span> size=<span class="string"><span class="delimiter">&quot;</span><span class="content">50000</span><span class="delimiter">&quot;</span></span>/&gt;
  &lt;/near-cache&gt;
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EvictionConfig evictionConfig = <span class="keyword">new</span> EvictionConfig()
  .setEvictionPolicy(EvictionPolicy.LRU)
  .setMaximumSizePolicy(MaxSizePolicy.ENTRY_COUNT)
  .setSize(<span class="integer">50000</span>);

NearCacheConfig nearCacheConfig = <span class="keyword">new</span> NearCacheConfig()
  .setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">mostlyReadMap</span><span class="delimiter">&quot;</span></span>)
  .setInMemoryFormat(InMemoryFormat.OBJECT)
  .setInvalidateOnChange(<span class="predefined-constant">true</span>)
  .setEvictionConfig(evictionConfig);

ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig()
  .addNearCacheConfig(nearCacheConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Near Cache on the client side must have the same name as the data structure on the member for which this Near Cache is being created. You can use wildcards, so in this example <code>mostlyRead*</code> would also match the map <code>mostlyReadMap</code>.</p>
</div>
<div class="paragraph">
<p>A Near Cache can have its own <code>in-memory-format</code> which is independent of the <code>in-memory-format</code> of the data structure.</p>
</div>
</div>
<div class="sect4">
<h5 id="near-cache-example-for-jcache-clients"><a class="anchor" href="#near-cache-example-for-jcache-clients"></a><a class="link" href="#near-cache-example-for-jcache-clients">Near Cache Example for JCache Clients</a></h5>
<div class="paragraph">
<p>The following is a configuration example for a JCache Near Cache for a Hazelcast client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast-client&gt;
  &lt;near-cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">mostlyReadCache</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;in-memory-format&gt;OBJECT&lt;/in-memory-format&gt;
    &lt;invalidate-on-change&gt;<span class="predefined-constant">true</span>&lt;/invalidate-on-change&gt;
    &lt;eviction eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">LRU</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENTRY_COUNT</span><span class="delimiter">&quot;</span></span> size=<span class="string"><span class="delimiter">&quot;</span><span class="content">30000</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;local-update-policy&gt;CACHE_ON_UPDATE&lt;/local-update-policy&gt;
  &lt;/near-cache&gt;
&lt;/hazelcast-client&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EvictionConfig evictionConfig = <span class="keyword">new</span> EvictionConfig()
  .setEvictionPolicy(EvictionPolicy.LRU)
  .setMaximumSizePolicy(MaxSizePolicy.ENTRY_COUNT)
  .setSize(<span class="integer">30000</span>);

NearCacheConfig nearCacheConfig = <span class="keyword">new</span> NearCacheConfig()
  .setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">mostlyReadCache</span><span class="delimiter">&quot;</span></span>)
  .setInMemoryFormat(InMemoryFormat.OBJECT)
  .setInvalidateOnChange(<span class="predefined-constant">true</span>)
  .setEvictionConfig(evictionConfig)
  .setLocalUpdatePolicy(LocalUpdatePolicy.CACHE_ON_UPDATE);

ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig()
  .addNearCacheConfig(nearCacheConfig);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="example-for-near-cache-with-high-density-memory-store"><a class="anchor" href="#example-for-near-cache-with-high-density-memory-store"></a><a class="link" href="#example-for-near-cache-with-high-density-memory-store">Example for Near Cache with High-Density Memory Store</a></h5>
<div class="paragraph">
<p><strong class="navy">Hazelcast IMDG Enterprise HD Feature</strong></p>
</div>
<div class="paragraph">
<p>The following is a configuration example for an IMap High-Density Near Cache for a Hazelcast member.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  &lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">mostlyReadMapWithHighDensityNearCache</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;in-memory-format&gt;OBJECT&lt;/in-memory-format&gt;
    &lt;near-cache&gt;
      &lt;in-memory-format&gt;NATIVE&lt;/in-memory-format&gt;
      &lt;eviction eviction-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">LFU</span><span class="delimiter">&quot;</span></span> max-size-policy=<span class="string"><span class="delimiter">&quot;</span><span class="content">USED_NATIVE_MEMORY_PERCENTAGE</span><span class="delimiter">&quot;</span></span> size=<span class="string"><span class="delimiter">&quot;</span><span class="content">90</span><span class="delimiter">&quot;</span></span>/&gt;
    &lt;/near-cache&gt;
  &lt;/map&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">EvictionConfig evictionConfig = <span class="keyword">new</span> EvictionConfig()
  .setEvictionPolicy(EvictionPolicy.LFU)
  .setMaximumSizePolicy(MaxSizePolicy.USED_NATIVE_MEMORY_PERCENTAGE)
  .setSize(<span class="integer">90</span>);

NearCacheConfig nearCacheConfig = <span class="keyword">new</span> NearCacheConfig()
  .setInMemoryFormat(InMemoryFormat.NATIVE)
  .setEvictionConfig(evictionConfig);

Config config = <span class="keyword">new</span> Config();
config.getMapConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">mostlyReadMapWithHighDensityNearCache</span><span class="delimiter">&quot;</span></span>)
  .setInMemoryFormat(InMemoryFormat.OBJECT)
  .setNearCacheConfig(nearCacheConfig);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that you should have already enabled the High-Density Memory Store usage for your cluster. Please see the <a href="#configuring-high-density-memory-store">Configuring High-Density Memory Store section</a>.</p>
</div>
<div class="paragraph">
<p>Note that a map and its Near Cache can independently use High-Density Memory Store. For example, if your map does not use High-Density Memory Store, its Near Cache can still use it.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="near-cache-eviction"><a class="anchor" href="#near-cache-eviction"></a><a class="link" href="#near-cache-eviction">20.6.4. Near Cache Eviction</a></h4>
<div class="paragraph">
<p>In the scope of Near Cache, eviction means evicting (clearing) the entries selected according to the given <code>eviction-policy</code> when the specified <code>max-size-policy</code> has been reached.</p>
</div>
<div class="paragraph">
<p>The <code>max-size-policy</code> defines the state when the Near Cache is full and determines whether the eviction should be triggered. The <code>size</code> is either interpreted as entry count, memory size or percentage, depending on the chosen policy.</p>
</div>
<div class="paragraph">
<p>Once the eviction is triggered the configured <code>eviction-policy</code> determines which, if any, entries must be evicted.</p>
</div>
</div>
<div class="sect3">
<h4 id="near-cache-expiration"><a class="anchor" href="#near-cache-expiration"></a><a class="link" href="#near-cache-expiration">20.6.5. Near Cache Expiration</a></h4>
<div class="paragraph">
<p>Expiration means the eviction of expired records. A record is expired:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if it is not touched (accessed/read) for <code>max-idle-seconds</code></p>
</li>
<li>
<p><code>time-to-live-seconds</code> passed since it is put to Near Cache</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The actual expiration is performed in two cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a record is accessed: it is checked if the record is expired or not. If it is expired, it is evicted and <code>null</code> is returned as the value to the caller.</p>
</li>
<li>
<p>In the background: there is an expiration task that periodically (currently 5 seconds) scans records and evicts the expired records.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="near-cache-invalidation"><a class="anchor" href="#near-cache-invalidation"></a><a class="link" href="#near-cache-invalidation">20.6.6. Near Cache Invalidation</a></h4>
<div class="paragraph">
<p>Invalidation is the process of removing an entry from the Near Cache when its value is updated or it is removed from the original data structure (to prevent stale reads). Near Cache invalidation happens asynchronously at the cluster level, but synchronously at the current member. This means that the Near Cache is invalidated within the whole cluster after the modifying operation is finished, but updated from the current member before the modifying operation is done. A modifying operation can be an EntryProcessor, an explicit update or remove as well as an expiration or eviction. Generally, whenever the state of an entry changes in the record store by updating its value or removing it, the invalidation event is sent for that entry.</p>
</div>
<div class="paragraph">
<p>Invalidations can be sent from members to client Near Caches or to member Near Caches, either individually or in batches. Default behavior is sending in batches. If there are lots of mutating operations such as put/remove on data structures, it is advised that you configure batch invalidations. This reduces the network traffic and keeps the eventing system less busy, but may increase the delay of individual invalidations.</p>
</div>
<div class="paragraph">
<p>You can use the following system properties to configure the Near Cache invalidation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.map.invalidation.batch.enabled</code>: Enable or disable batching. Its default value is <code>true</code>. When it is set to <code>false</code>, all invalidations are sent immediately.</p>
</li>
<li>
<p><code>hazelcast.map.invalidation.batch.size</code>: Maximum number of invalidations in a batch. Its default value is <code>100</code>.</p>
</li>
<li>
<p><code>hazelcast.map.invalidation.batchfrequency.seconds</code>: If the collected invalidations do not reach the configured batch size, a background process sends them periodically. Its default value is <code>10</code> seconds.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If there are a lot of clients or many mutating operations, batching should remain enabled and the batch size should be configured with the <code>hazelcast.map.invalidation.batch.size</code> system property to a suitable value.</p>
</div>
</div>
<div class="sect3">
<h4 id="near-cache-consistency"><a class="anchor" href="#near-cache-consistency"></a><a class="link" href="#near-cache-consistency">20.6.7. Near Cache Consistency</a></h4>
<div class="sect4">
<h5 id="eventual-consistency"><a class="anchor" href="#eventual-consistency"></a><a class="link" href="#eventual-consistency">Eventual Consistency</a></h5>
<div class="paragraph">
<p>Near Caches are invalidated by invalidation events. Invalidation events can be lost due to the fire-and-forget fashion of eventing system. If an event is lost, reads from Near Cache can indefinitely be stale.</p>
</div>
<div class="paragraph">
<p>To solve this problem, starting with Hazelcast 3.8, Hazelcast provides eventually consistent behavior for IMap/JCache Near Caches by detecting invalidation losses.
After detection of an invalidation loss, stale data will be made unreachable and Near Cache&#8217;s <code>get</code> calls to that data will be directed to underlying IMap/JCache to fetch the fresh data.</p>
</div>
<div class="paragraph">
<p>You can configure eventual consistency with the system properties below (same properties are valid for both member and client side Near Caches):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hazelcast.invalidation.max.tolerated.miss.count</code>: Default value is 10. If missed invalidation count is bigger than this value, relevant cached data will be made unreachable.</p>
</li>
<li>
<p><code>hazelcast.invalidation.reconciliation.interval.seconds</code>: Default value is 60 seconds. This is a periodic task that scans cluster members periodically to compare generated invalidation events with the received ones from Near Cache.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="locally-initiated-changes"><a class="anchor" href="#locally-initiated-changes"></a><a class="link" href="#locally-initiated-changes">Locally Initiated Changes</a></h5>
<div class="paragraph">
<p>For local invalidations, when a record is updated/removed, future reads will see this update/remove to provide read-your-writes consistency. To achieve this consistency, Near Cache configuration provides two update policies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>INVALIDATE</code></p>
</li>
<li>
<p><code>CACHE_ON_UPDATE</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you choose <code>INVALIDATE</code>, the entry is removed from the Near Cache after the update/remove occurs in the underlying data structure and before the operation (get) returns to the caller. Until the update/remove operation completes, the entry&#8217;s old value can still be read from the Near Cache.</p>
</div>
<div class="paragraph">
<p>If you choose <code>CACHE_ON_UPDATE</code>, the entry is updated after the update/remove occurs in the underlying data structure and before the operation (put/get) returns to the caller. If it is an update operation, it will remove the entry and the new value will be placed. Until the update/remove operation completes, the entry&#8217;s old value can still be read from the Near Cache. Any threads reading the key after this point will read the new entry. If the mutative operation was a remove, the key will no longer exist in the the Near Cache and the original copy in the member.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="near-cache-preloader"><a class="anchor" href="#near-cache-preloader"></a><a class="link" href="#near-cache-preloader">20.6.8. Near Cache Preloader</a></h4>
<div class="paragraph">
<p>The Near Cache preloader is a functionality to store the keys from a Near Cache to provide a fast re-population of the previous hot data set after a Hazelcast Client has been restarted. It is available on IMap and JCache clients.</p>
</div>
<div class="paragraph">
<p>The Near Cache preloader stores the keys (not the values) of Near Cache entries in regular intervals. You can define the initial delay via <code>store-initial-delay-seconds</code>, e.g., if you know that your hot data set will need some time to build up. You can configure the interval via <code>store-interval-seconds</code> which determines how often the key-set will be stored. The persistence will not run continuously. Whenever the storage is scheduled, it will be performed on the actual keys in the Near Cache.</p>
</div>
<div class="paragraph">
<p>The Near Cache preloader will be triggered on the first initialization of the data structure on the client, e.g., <code>client.getMap("myNearCacheMap")</code>. This schedules the preloader, which will work in the background, so your application is not blocked. The storage will be enabled after the loading is completed.</p>
</div>
<div class="paragraph">
<p>The configuration parameter <code>directory</code> is optional. If you omit it the base folder will be the user working directory (normally where the JVM was started or configured with the system property <code>user.dir</code>). The storage filenames will always be created from the Near Cache name. So even if you use a wildcard name in the Near Cache Configuration, the preloader filenames will be unique.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you run multiple Hazelcast clients with enabled Near Cache preloader on the same machine, you have to configure a unique storage filename for each client or run them from different user directories. If two clients would write into the same file, only the first client will succeed. The following clients will throw an exception as soon as the Near Cache preloader is triggered.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-deserialized-values"><a class="anchor" href="#caching-deserialized-values"></a><a class="link" href="#caching-deserialized-values">20.7. Caching Deserialized Values</a></h3>
<div class="paragraph">
<p>There may be cases where you do not want to deserialize some values in your Hazelcast map again which were already deserialized previously. This way your query operations get faster. This is possible by using the <code>cache-deserialized-values</code> element in your declarative Hazelcast configuration, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
   ...
   ...
   &lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMap</span><span class="delimiter">&quot;</span></span>&gt;
      ...
      &lt;in-memory-format&gt;BINARY&lt;/in-memory-format&gt;
      &lt;cache-deserialized-values&gt;INDEX-ONLY&lt;/cache-deserialized-values&gt;
      &lt;backup-count&gt;<span class="integer">1</span>&lt;/backup-count&gt;
      ...
   &lt;/map&gt;
   ...
   ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The element <code>cache-deserialized-values</code> controls the caching of deserialized values. Note that caching makes the query evaluation faster, but it will consume more memory. This element has the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NEVER: Deserialized values will never be cached.</p>
</li>
<li>
<p>INDEX-ONLY: Deserialized values will be cached only when they are inserted into an index.</p>
</li>
<li>
<p>ALWAYS: Deserialized values will always be cached.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are using portable serialization or your map&#8217;s in-memory format is <code>OBJECT</code> or <code>NATIVE</code>, then <code>cache-deserialized-values</code> element does not have any effect.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hazelcast-simulator"><a class="anchor" href="#hazelcast-simulator"></a><a class="link" href="#hazelcast-simulator">21. Hazelcast Simulator</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast Simulator is a production simulator used to test Hazelcast and Hazelcast-based applications in clustered environments. It also allows you to create your own tests and perform them on your Hazelcast clusters and applications that are deployed to cloud computing environments. In your tests, you can provide any property that can be specified on these environments (Amazon EC2, Google Compute Engine(GCE), or your own environment): properties such as hardware specifications, operating system, Java version, etc.</p>
</div>
<div class="paragraph">
<p>Please refer to the documentation on its own GitHub repository at <a href="https://github.com/hazelcast/hazelcast-simulator/blob/master/README.md">Hazelcast Simulator</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="wan"><a class="anchor" href="#wan"></a><a class="link" href="#wan">22. WAN</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong class="blue">Hazelcast IMDG Enterprise Feature</strong></p>
</div>
<div class="sect2">
<h3 id="wan-replication"><a class="anchor" href="#wan-replication"></a><a class="link" href="#wan-replication">22.1. WAN Replication</a></h3>
<div class="paragraph">
<p>There could be cases where you need to synchronize multiple Hazelcast clusters to the same state. Hazelcast WAN Replication allows you to keep multiple Hazelcast clusters in sync by replicating their state over WAN environments such as the Internet.</p>
</div>
<div class="paragraph">
<p>Imagine you have different data centers in New York, London and Tokyo each running an independent Hazelcast cluster. Every cluster
would be operating at native speed in their own LAN (Local Area Network), but you also want some or all record sets in
these clusters to be replicated to each other: updates in the Tokyo cluster should also replicate to London and New York and updates
in the New York cluster are to be synchronized to the Tokyo and London clusters.</p>
</div>
<div class="paragraph">
<p>This chapter explains how you can replicate the state of your clusters over Wide Area Network (WAN) through Hazelcast WAN Replication.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can download the white paper <strong>Hazelcast on AWS: Best Practices for Deployment</strong> at
https://[Hazelcast.com].
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="defining-wan-replication"><a class="anchor" href="#defining-wan-replication"></a><a class="link" href="#defining-wan-replication">22.1.1. Defining WAN Replication</a></h4>
<div class="paragraph">
<p>Hazelcast supports two different operation modes of WAN Replication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Active-Passive:</strong> This mode is mostly used for failover scenarios where you want to replicate an active cluster to one
or more passive clusters, for the purpose of maintaining a backup.</p>
</li>
<li>
<p><strong>Active-Active:</strong> Every cluster is equal, each cluster replicates to all other clusters. This is normally used to connect
different clients to different clusters for the sake of the shortest path between client and server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two different ways of defining the WAN replication endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Static endpoints</p>
</li>
<li>
<p>Discovery SPI</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use at most one of these when defining a single WAN publisher.</p>
</div>
<div class="sect4">
<h5 id="defining-wan-replication-using-static-endpoints"><a class="anchor" href="#defining-wan-replication-using-static-endpoints"></a><a class="link" href="#defining-wan-replication-using-static-endpoints">Defining WAN Replication Using Static Endpoints</a></h5>
<div class="paragraph">
<p>Below is an example of declarative configuration of WAN Replication from New York cluster to target the London cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
...
  &lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster-batch</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;wan-publisher group-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">london</span><span class="delimiter">&quot;</span></span>&gt;
          &lt;<span class="type">class</span>-<span class="class">name</span>&gt;com.hazelcast.enterprise.wan.replication.WanBatchReplication&lt;/<span class="type">class</span>-<span class="class">name</span>&gt;
          &lt;queue-full-behavior&gt;THROW_EXCEPTION&lt;/queue-full-behavior&gt;
          &lt;queue-capacity&gt;<span class="integer">1000</span>&lt;/queue-capacity&gt;
          &lt;properties&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">batch.size</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">500</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">batch.max.delay.millis</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">1000</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">snapshot.enabled</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">false</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">response.timeout.millis</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">60000</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ack.type</span><span class="delimiter">&quot;</span></span>&gt;ACK_ON_OPERATION_COMPLETE&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoints</span><span class="delimiter">&quot;</span></span>&gt;<span class="float">10.3</span><span class="float">.5</span><span class="float">.1</span>:<span class="integer">5701</span>, <span class="float">10.3</span><span class="float">.5</span><span class="float">.2</span>:<span class="integer">5701</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">group.password</span><span class="delimiter">&quot;</span></span>&gt;london-pass&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">discovery.period</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">20</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">executorThreadCount</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">2</span>&lt;/property&gt;
          &lt;/properties&gt;
      &lt;/wan-publisher&gt;
  &lt;/wan-replication&gt;
...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following are the definitions of configuration elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Name of your WAN Replication. This name is referenced in IMap or ICache configuration when you add WAN Replication for these data structures (using the element &lt;wan-replication-ref&gt; in the configuration of IMap or ICache).</p>
</li>
<li>
<p><code>group-name</code>: Configures target cluster&#8217;s group name.</p>
</li>
<li>
<p><code>class-name</code>: Name of the class implementation for the WAN replication.</p>
</li>
<li>
<p><code>queue-full-behavior</code>: Policy to be applied when WAN Replication event queues are full. Please see the <a href="#queue-full-behavior">Queue Full Behavior section</a>.</p>
</li>
<li>
<p><code>queue-capacity</code>: Size of the queue of events. Its default value is 10000. Please see the <a href="#queue-capacity">Queue Capacity section</a>.</p>
</li>
<li>
<p><code>batch.size</code>: Maximum size of events that are sent to the target cluster in a single batch. Its default value is 500. Please see the <a href="#batch-size">Batch Size section</a>.</p>
</li>
<li>
<p><code>batch.max.delay.millis</code>: Maximum amount of time, in milliseconds, to be waited before sending a batch of events in case <code>batch.size</code> is not reached. Its default value is 1000 milliseconds. Please see the <a href="#batch-maximum-delay">Batch Maximum Delay section</a>.</p>
</li>
<li>
<p><code>snapshot.enabled</code>: When set to <code>true</code>, only the latest events (based on key) are selected and sent in a batch. Its default value is <code>false</code>.</p>
</li>
<li>
<p><code>response.timeout.millis</code>: Time, in milliseconds, to be waited for the acknowledgment of a sent WAN event to target cluster. Its default value is 60000 milliseconds. Please see the <a href="#response-timeout">Response Timeout section</a>.</p>
</li>
<li>
<p><code>ack.type</code>: Acknowledgment type for each target cluster. Please see the <a href="#acknowledgment-types">Acknowledgment Types section</a>.</p>
</li>
<li>
<p><code>endpoints</code>: IP addresses and ports of the cluster members for which the WAN replication is implemented. These endpoints are not necessarily the entire target cluster and WAN does not perform the discovery of other members in the target cluster. It only expects that these IP addresses (or at least some of them) are available.</p>
</li>
<li>
<p><code>group.password</code>: Configures target cluster&#8217;s group password.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other relevant properties are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>discovery.period</code>: Period in seconds in which WAN tries to reestablish connections to failed endpoints. Default is 10 seconds.</p>
</li>
<li>
<p><code>executorThreadCount</code>: The number of threads that the <code>WanBatchReplication</code> executor will have. The executor is used to send WAN events to the endpoints and ideally you want to have one thread per endpoint. If this property is omitted and you have specified the <code>endpoints</code> property, this will be the case. If necessary you can manually define the number of threads that the executor will use. Once the executor has been initialized there is thread affinity between the discovered endpoints and the executor threads - all events for a single endpoint will go through a single executor thread, preserving event order. It is important to determine which number of executor threads is a good value. Failure to do so can lead to performance issues - either contention on a too small number of threads or wasted threads that will not be performing any work.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And the following is the equivalent programmatic configuration snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in wan.adoc - include::{javasource}/wan/SampleWANReplicationConfiguration.java[tag=wrc]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this configuration, the cluster running in New York will replicate to Tokyo and London. The Tokyo and London clusters should
have similar configurations if you want to run in Active-Active mode.</p>
</div>
<div class="paragraph">
<p>If the New York and London cluster configurations contain the <code>wan-replication</code> element and the Tokyo cluster does not, it means
New York and London are active endpoints and Tokyo is a passive endpoint.</p>
</div>
</div>
<div class="sect4">
<h5 id="defining-wan-replication-using-discovery-spi"><a class="anchor" href="#defining-wan-replication-using-discovery-spi"></a><a class="link" href="#defining-wan-replication-using-discovery-spi">Defining WAN Replication Using Discovery SPI</a></h5>
<div class="paragraph">
<p>In addition to defining target cluster endpoints with static IP addresses, you can configure WAN to work with the discovery SPI and determine the endpoint IP addresses at runtime. This allows you to use WAN with endpoints on various cloud infrastructures (such as Amazon EC2 or GCP Compute) where the IP address is not known in advance. Typically you will use a readily available discovery SPI plugin such as <a href="https://github.com/hazelcast/hazelcast-aws">Hazelcast AWS EC2 discovery plugin</a>, <a href="https://github.com/hazelcast/hazelcast-gcp">Hazelcast GCP discovery plugin</a>, or similar. For more advanced cases, you can provide your own discovery SPI implementation with custom logic for determining the WAN target endpoints such as looking up the endpoints in some service registry or even reading the endpoint addresses from a file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using the discovery SPI, WAN will always connect to the public address of the members returned by the discovery SPI implementation. This is opposite to the cluster membership mechanism using the discovery SPI where a member connects to a different member in the same cluster through its private address. Should you prefer for WAN to use the private address of the discovered member as well, please use the <code>discovery.useEndpointPrivateAddress</code> publisher property (see below).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Following is an example of setting up the WAN replication with the EC2 discovery plugin. You must have the <a href="https://github.com/hazelcast/hazelcast-aws">Hazelcast AWS EC2 discovery plugin</a> on the classpath.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
...
  &lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster-batch</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;wan-publisher group-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">london</span><span class="delimiter">&quot;</span></span>&gt;
          &lt;<span class="type">class</span>-<span class="class">name</span>&gt;com.hazelcast.enterprise.wan.replication.WanBatchReplication&lt;/<span class="type">class</span>-<span class="class">name</span>&gt;
          &lt;queue-full-behavior&gt;THROW_EXCEPTION&lt;/queue-full-behavior&gt;
          &lt;queue-capacity&gt;<span class="integer">1000</span>&lt;/queue-capacity&gt;
          &lt;properties&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">batch.size</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">500</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">batch.max.delay.millis</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">1000</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">snapshot.enabled</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">false</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">response.timeout.millis</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">60000</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ack.type</span><span class="delimiter">&quot;</span></span>&gt;ACK_ON_OPERATION_COMPLETE&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">group.password</span><span class="delimiter">&quot;</span></span>&gt;london-pass&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">discovery.period</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">20</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">maxEndpoints</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">5</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">executorThreadCount</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">5</span>&lt;/property&gt;
          &lt;/properties&gt;
          &lt;discovery-strategies&gt;
              &lt;discovery-strategy enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.aws.AwsDiscoveryStrategy</span><span class="delimiter">&quot;</span></span>&gt;
                  &lt;<span class="class">properties</span>&gt;
                      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">access-key</span><span class="delimiter">&quot;</span></span>&gt;test-access-key&lt;/property&gt;
                      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret-key</span><span class="delimiter">&quot;</span></span>&gt;test-secret-key&lt;/property&gt;
                      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">region</span><span class="delimiter">&quot;</span></span>&gt;test-region&lt;/property&gt;
                      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">iam-role</span><span class="delimiter">&quot;</span></span>&gt;test-iam-role&lt;/property&gt;
                      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">host-header</span><span class="delimiter">&quot;</span></span>&gt;ec2.test-host-header&lt;/property&gt;
                      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">security-group-name</span><span class="delimiter">&quot;</span></span>&gt;test-security-group-name&lt;/property&gt;
                      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">tag-key</span><span class="delimiter">&quot;</span></span>&gt;test-tag-key&lt;/property&gt;
                      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">tag-value</span><span class="delimiter">&quot;</span></span>&gt;test-tag-value&lt;/property&gt;
                      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">connection-timeout-seconds</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">10</span>&lt;/property&gt;
                      &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hz-port</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">5701</span>-<span class="integer">5708</span>&lt;/property&gt;
                  &lt;/properties&gt;
              &lt;/discovery-strategy&gt;
          &lt;/discovery-strategies&gt;
      &lt;/wan-publisher&gt;
  &lt;/wan-replication&gt;
...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>hz-port</code> property defines the port or the port range on which the target endpoint is running. The default port range 5701-5708 is used if this property is not defined. This is needed because the Amazon API which the AWS plugin uses does not provide the port on which Hazelcast is running, only the IP address. For some other discovery SPI implementations, this might not be necessary and it might discover the port as well, e.g., by looking up in a service registry.</p>
</div>
<div class="paragraph">
<p>The other properties are the same as when using the <code>aws</code> element. In case of EC2 discovery you can configure the WAN replication using the <code>aws</code> element. You may use either of these, but not both at the same time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
...
  &lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster-batch</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;wan-publisher group-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">london</span><span class="delimiter">&quot;</span></span>&gt;
          &lt;<span class="type">class</span>-<span class="class">name</span>&gt;com.hazelcast.enterprise.wan.replication.WanBatchReplication&lt;/<span class="type">class</span>-<span class="class">name</span>&gt;
          &lt;queue-full-behavior&gt;THROW_EXCEPTION&lt;/queue-full-behavior&gt;
          &lt;queue-capacity&gt;<span class="integer">1000</span>&lt;/queue-capacity&gt;
          &lt;properties&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">batch.size</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">500</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">batch.max.delay.millis</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">1000</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">snapshot.enabled</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">false</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">response.timeout.millis</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">60000</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ack.type</span><span class="delimiter">&quot;</span></span>&gt;ACK_ON_OPERATION_COMPLETE&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">group.password</span><span class="delimiter">&quot;</span></span>&gt;london-pass&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">discovery.period</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">20</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">discovery.useEndpointPrivateAddress</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">false</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">maxEndpoints</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">5</span>&lt;/property&gt;
              &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">executorThreadCount</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">5</span>&lt;/property&gt;
          &lt;/properties&gt;
          &lt;aws enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
              &lt;access-key&gt;my-access-key&lt;/access-key&gt;
              &lt;secret-key&gt;my-secret-key&lt;/secret-key&gt;
              &lt;iam-role&gt;dummy&lt;/iam-role&gt;
              &lt;region&gt;us-west-<span class="integer">1</span>&lt;/region&gt;
              &lt;host-header&gt;ec2.amazonaws.com&lt;/host-header&gt;
              &lt;security-group-name&gt;hazelcast-sg&lt;/security-group-name&gt;
              &lt;tag-key&gt;type&lt;/tag-key&gt;
              &lt;tag-value&gt;hz-members&lt;/tag-value&gt;
          &lt;/aws&gt;
      &lt;/wan-publisher&gt;
  &lt;/wan-replication&gt;
...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can refer to the <a href="#aws-element">aws element</a> and the <a href="#configuring-client-for-aws">Configuring Client for AWS</a> sections for the descriptions of above AWS configuration elements. Following are the definitions of additional configuration properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>discovery.period</code>: Period in seconds in which WAN tries to discover new endpoints and reestablish connections to failed endpoints. Default is 10 seconds.</p>
</li>
<li>
<p><code>maxEndpoints</code>: Maximum number of endpoints that WAN will connect to when using a discovery mechanism to define endpoints. Default is <code>Integer.MAX_VALUE</code>. This property has no effect when static endpoint IPs are defined using the <code>endpoints</code> property.</p>
</li>
<li>
<p><code>executorThreadCount</code>: Number of threads that the <code>WanBatchReplication</code> executor will have. The executor is used to send WAN events to the endpoints and ideally you want to have one thread per endpoint. If this property is omitted and you have specified the <code>endpoints</code> property, this will be the case. If, on the other hand, you are using WAN with the discovery SPI and you have not specified this property, the executor will be sized to the initial number of discovered endpoints. This can lead to performance issues if the number of endpoints changes in the future - either contention on a too small number of threads or wasted threads that will not be performing any work. To prevent this you can manually define the executor thread count. Once the executor has been initialized there is thread affinity between the discovered endpoints and the executor threads - all events for a single endpoint will go through a single executor thread, preserving event order.</p>
</li>
<li>
<p><code>discovery.useEndpointPrivateAddress</code>: Determines whether the WAN connection manager should connect to the endpoint on the private address returned by the discovery SPI. By default this property is <code>false</code> which means the WAN connection manager will always use the public address.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also define the WAN publisher with discovery SPI using the programmatic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in wan.adoc - include::{javasource}/wan/SampleWANReplicationDiscoveryConfiguration.java[tag=wrdc]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="wanbatchreplication-implementation"><a class="anchor" href="#wanbatchreplication-implementation"></a><a class="link" href="#wanbatchreplication-implementation">22.1.2. WanBatchReplication Implementation</a></h4>
<div class="paragraph">
<p>Hazelcast offers <code>WanBatchReplication</code> implementation for the WAN replication.</p>
</div>
<div class="paragraph">
<p>As you see in the above configuration examples, this implementation is configured using the <code>class-name</code> element (in the declarative configuration) or the method <code>setClassName</code> (in the programmatic configuration).</p>
</div>
<div class="paragraph">
<p>The implementation <code>WanBatchReplication</code> waits until:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a pre-defined number of replication events are generated, (please refer to the <a href="#batch-size">Batch Size section</a>).</p>
</li>
<li>
<p>or a pre-defined amount of time is passed (please refer to the <a href="#batch-maximum-delay">Batch Maximum Delay section</a>).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>WanNoDelayReplication</code> implementation has been removed. You can still achieve this behavior by setting the batch size to <code>1</code> while configuring your WAN replication.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuring-wan-replication-for-imap-and-icache"><a class="anchor" href="#configuring-wan-replication-for-imap-and-icache"></a><a class="link" href="#configuring-wan-replication-for-imap-and-icache">22.1.3. Configuring WAN Replication for IMap and ICache</a></h4>
<div class="paragraph">
<p>Yon can configure the WAN replication for Hazelcast&#8217;s IMap and ICache data structures. To enable WAN replication for an IMap or ICache instance, you can use the <code>wan-replication-ref</code> element. Each IMap and ICache instance can have different WAN replication configurations.</p>
</div>
<div class="paragraph">
<p><strong>Enabling WAN Replication for IMap:</strong></p>
</div>
<div class="paragraph">
<p>Imagine you have different distributed maps, however only one of those maps should be replicated to a target cluster. To achieve this, configure the map that you want
replicated by adding the <code>wan-replication-ref</code> element in the map configuration as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  &lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
    ...
  &lt;/wan-replication&gt;
  &lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-shared-map</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;wan-replication-ref name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
       &lt;merge-policy&gt;com.hazelcast.map.merge.PassThroughMergePolicy&lt;/merge-policy&gt;
       &lt;republishing-enabled&gt;<span class="predefined-constant">false</span>&lt;/republishing-enabled&gt;
    &lt;/wan-replication-ref&gt;
  &lt;/map&gt;
  ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is the equivalent programmatic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in wan.adoc - include::{javasource}/wan/EnablingWRforMap.java[tag=wrmap]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You see that we have <code>my-shared-map</code> configured to replicate itself to the cluster targets defined in the earlier
<code>wan-replication</code> element.</p>
</div>
<div class="paragraph">
<p><code>wan-replication-ref</code> has the following elements;</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>: Name of <code>wan-replication</code> configuration. IMap or ICache instance uses this <code>wan-replication</code> configuration.</p>
</li>
<li>
<p><code>merge-policy</code>: Resolve conflicts that are occurred when target cluster already has the replicated entry key.</p>
</li>
<li>
<p><code>republishing-enabled</code>: When enabled, an incoming event to a member is forwarded to target cluster of that member. Enabling the event republishing is useful in a scenario where cluster A replicates to cluster B and cluster B replicates to cluster C. You do not need to enable republishing when all your clusters replicate to each other.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using Active-Active Replication, multiple clusters can simultaneously update the same entry in a distributed data structure.
You can configure a merge policy to resolve these potential conflicts, as shown in the above example configuration (using the <code>merge-policy</code> sub-element under the <code>wan-replication-ref</code> element).</p>
</div>
<div class="paragraph">
<p>Hazelcast provides the following merge policies for IMap:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.hazelcast.map.merge.PutIfAbsentMapMergePolicy</code>: Incoming entry merges from the source map to the target map if it does not exist in the target map.</p>
</li>
<li>
<p><code>com.hazelcast.map.merge.HigherHitsMapMergePolicy</code>: Incoming entry merges from the source map to the target map if the source entry has more hits than the target one.</p>
</li>
<li>
<p><code>com.hazelcast.map.merge.PassThroughMergePolicy</code>: Incoming entry merges from the source map to the target map unless the incoming entry is not null.</p>
</li>
<li>
<p><code>com.hazelcast.map.merge.LatestUpdateMapMergePolicy</code>: Incoming entry merges from the source map to the target map if the source entry has been updated more recently than the target entry. Please note that this merge policy can only be used when the clusters' clocks are in sync.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>NOTE When using WAN replication, please note that only key based events are replicated to the target cluster. Operations like <code>clear</code>, <code>destroy</code> and <code>evictAll</code> are NOT replicated.</p>
</div>
<div class="paragraph">
<p><strong>Enabling WAN Replication for ICache:</strong></p>
</div>
<div class="paragraph">
<p>The following is a declarative configuration example for enabling WAN Replication for ICache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
   ...
&lt;/wan-replication&gt;
&lt;cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-shared-cache</span><span class="delimiter">&quot;</span></span>&gt;
   &lt;wan-replication-ref name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;merge-policy&gt;com.hazelcast.cache.merge.PassThroughCacheMergePolicy&lt;/merge-policy&gt;
      &lt;republishing-enabled&gt;<span class="predefined-constant">true</span>&lt;/republishing-enabled&gt;
   &lt;/wan-replication-ref&gt;
&lt;/cache&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is the equivalent programmatic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in wan.adoc - include::{javasource}/wan/EnablingWRforCache.java[tag=wrcache]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Caches that are created dynamically do not support WAN replication functionality. Cache configurations should be defined either declaratively (by XML) or programmatically on both source and target clusters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hazelcast provides the following merge policies for ICache:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>com.hazelcast.cache.merge.HigherHitsCacheMergePolicy</code>: Incoming entry merges from the source cache to the target cache if the source entry has more hits than the target one.</p>
</li>
<li>
<p><code>com.hazelcast.cache.merge.PassThroughCacheMergePolicy</code>: Incoming entry merges from the source cache to the target cache unless the incoming entry is not null.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="batch-size"><a class="anchor" href="#batch-size"></a><a class="link" href="#batch-size">22.1.4. Batch Size</a></h4>
<div class="paragraph">
<p>The maximum size of events that are sent in a single batch can be changed
depending on your needs. Default value for batch size is <code>500</code>.</p>
</div>
<div class="paragraph">
<p>Batch size can be set for each target cluster by modifying related <code>WanPublisherConfig</code>.</p>
</div>
<div class="paragraph">
<p>Below is the declarative configuration for changing the value of the property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
 &lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;wan-publisher group-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">london</span><span class="delimiter">&quot;</span></span>&gt;
        ...
        &lt;properties&gt;
            ...
            &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">batch.size</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">1000</span>&lt;/property&gt;
            ...
        &lt;/properties&gt;
        ...
    &lt;/wan-publisher&gt;
 &lt;/wan-replication&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, following is the equivalent programmatic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
 WanReplicationConfig wanConfig = config.getWanReplicationConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>);
 WanPublisherConfig publisherConfig = <span class="keyword">new</span> WanPublisherConfig();
 ...
 Map&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Comparable</span>&gt; props = publisherConfig.getProperties();
 props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">batch.size</span><span class="delimiter">&quot;</span></span>, <span class="integer">1000</span>);
 wanConfig.addWanPublisherConfig(publisherConfig);
...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>WanNoDelayReplication</code> implementation has been removed. You can still achieve this behavior by setting the batch size to <code>1</code> while configuring your WAN replication.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="batch-maximum-delay"><a class="anchor" href="#batch-maximum-delay"></a><a class="link" href="#batch-maximum-delay">22.1.5. Batch Maximum Delay</a></h4>
<div class="paragraph">
<p>When using <code>WanBatchReplication</code> if the number of WAN replication events generated does not reach <a href="#batch-size">Batch Size</a>,
they are sent to the target cluster after a certain amount of time is passed. You can set this duration in milliseconds using this batch maximum delay configuration. Default value of for this duration is 1 second (1000 milliseconds).</p>
</div>
<div class="paragraph">
<p>Maximum delay can be set for each target cluster by modifying related <code>WanPublisherConfig</code>.</p>
</div>
<div class="paragraph">
<p>You can change this property using the declarative configuration as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
 &lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;wan-publisher group-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">london</span><span class="delimiter">&quot;</span></span>&gt;
        ...
        &lt;properties&gt;
            ...
            &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">batch.max.delay.millis</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">2000</span>&lt;/property&gt;
            ...
        &lt;/properties&gt;
        ...
    &lt;/wan-publisher&gt;
 &lt;/wan-replication&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, the following is the equivalent programmatic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
 WanReplicationConfig wanConfig = config.getWanReplicationConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>);
 WanPublisherConfig publisherConfig = <span class="keyword">new</span> WanPublisherConfig();
 ...
 Map&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Comparable</span>&gt; props = publisherConfig.getProperties();
 props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">batch.max.delay.millis</span><span class="delimiter">&quot;</span></span>, <span class="integer">2000</span>);
 wanConfig.addWanPublisherConfig(publisherConfig);
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="response-timeout"><a class="anchor" href="#response-timeout"></a><a class="link" href="#response-timeout">22.1.6. Response Timeout</a></h4>
<div class="paragraph">
<p>After a replication event is sent to the target cluster, the source member waits for an acknowledgement of the delivery of the event to the target.
If the confirmation is not received inside a timeout duration window, the event is resent to the target cluster. Default value of this duration is <code>60000</code> milliseconds.</p>
</div>
<div class="paragraph">
<p>You can change this duration depending on your network latency for each target cluster by modifying related <code>WanPublisherConfig</code>.</p>
</div>
<div class="paragraph">
<p>Below is an example of declarative configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
  &lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;wan-publisher group-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">london</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">response.timeout.millis</span><span class="delimiter">&quot;</span></span>&gt;<span class="integer">5000</span>&lt;/property&gt;
      &lt;/properties&gt;
    &lt;/wan-publisher&gt;
  &lt;/wan-replication&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, the following is the equivalent programmatic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
 WanReplicationConfig wanConfig = config.getWanReplicationConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>);
 WanPublisherConfig publisherConfig = <span class="keyword">new</span> WanPublisherConfig();
 ...
 Map&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Comparable</span>&gt; props = publisherConfig.getProperties();
 props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">response.timeout.millis</span><span class="delimiter">&quot;</span></span>, <span class="integer">5000</span>);
 wanConfig.addWanPublisherConfig(publisherConfig);
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="queue-capacity"><a class="anchor" href="#queue-capacity"></a><a class="link" href="#queue-capacity">22.1.7. Queue Capacity</a></h4>
<div class="paragraph">
<p>For huge clusters or high data mutation rates, you might need to increase the replication queue size. The default queue
size for replication queues is <code>10000</code>. This means, if you have heavy put/update/remove rates, you might exceed the queue size
so that the oldest, not yet replicated, updates might get lost. Note that a separate queue is used for each WAN Replication configured for IMap and ICache.</p>
</div>
<div class="paragraph">
<p>Queue capacity can be set for each target cluster by modifying related <code>WanPublisherConfig</code>.</p>
</div>
<div class="paragraph">
<p>You can change this property using the declarative configuration as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
 &lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;wan-publisher group-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">london</span><span class="delimiter">&quot;</span></span>&gt;
        ...
        &lt;queue-capacity&gt;<span class="integer">15000</span>&lt;/queue-capacity&gt;
        ...
    &lt;/target-cluster&gt;
 &lt;/wan-replication&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, the following is the equivalent programmatic configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
 WanReplicationConfig wanConfig = config.getWanReplicationConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>);
 WanPublisherConfig publisherConfig = <span class="keyword">new</span> WanPublisherConfig();
 ...
 publisherConfig.setQueueCapacity(<span class="integer">15000</span>);
 wanConfig.addWanPublisherConfig(publisherConfig);
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can clear a member&#8217;s WAN replication event queue. It can be initiated through Management Center&#8217;s <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#monitoring-wan-replication">Clear Queues action</a> or Hazelcasts REST API. Below is the URL for its REST call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//member_ip:port/hazelcast/rest/mancenter/wan/clearWanQueues</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This may be useful, for instance, to release the consumed heap if you know that the target cluster is being shut down, decommissioned, put out of use and it will never come back. Or, when a failure happens and queues are not replicated anymore, you could clear the queues using this clearing action.</p>
</div>
</div>
<div class="sect3">
<h4 id="queue-full-behavior"><a class="anchor" href="#queue-full-behavior"></a><a class="link" href="#queue-full-behavior">22.1.8. Queue Full Behavior</a></h4>
<div class="paragraph">
<p>In the previous Hazelcast releases, WAN replication was dropping the new events if WAN replication event queues are full.
This behavior is configurable starting with Hazelcast 3.6.</p>
</div>
<div class="paragraph">
<p>There are following supported behaviors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DISCARD_AFTER_MUTATION</code>: If you select this option, the new WAN events generated by the member are dropped and not replicated to the target cluster
when the WAN event queues are full.</p>
</li>
<li>
<p><code>THROW_EXCEPTION</code>: If you select this option, the WAN queue size is checked before each supported mutating operation (like <code>IMap.put()</code>, <code>ICache.put()</code>).
If one the queues of target cluster is full, <code>WANReplicationQueueFullException</code> is thrown and the operation is not allowed.</p>
</li>
<li>
<p><code>THROW_EXCEPTION_ONLY_IF_REPLICATION_ACTIVE</code>: Its effect is similar to that of <code>THROW_EXCEPTION</code>. But, it  throws exception only when WAN replication is active. It discards the new events if WAN replication is stopped.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following is an example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;wan-publisher group-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-cluster-1</span><span class="delimiter">&quot;</span></span>&gt;
    ...
    &lt;queue-full-behavior&gt;DISCARD_AFTER_MUTATION&lt;/queue-full-behavior&gt;
  &lt;/wan-publisher&gt;
&lt;/wan-replication&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>queue-full-behavior</code> configuration is optional. Its default value is <code>DISCARD_AFTER_MUTATION</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="event-filtering-api"><a class="anchor" href="#event-filtering-api"></a><a class="link" href="#event-filtering-api">22.1.9. Event Filtering API</a></h4>
<div class="paragraph">
<p>Starting with Hazelcast 3.6, WAN replication allows you to intercept WAN replication events before they are placed to
WAN event replication queues by providing a filtering API. Using this API, you can monitor WAN replication events of each data structure
separately.</p>
</div>
<div class="paragraph">
<p>You can attach filters to your data structures using  <code>filter</code> property of <code>wan-replication-ref</code> configuration inside <code>hazelcast.xml</code> as shown in the following example configuration. You can also configure it using the programmatic configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  &lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">testMap</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;wan-replication-ref name=<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;filters&gt;
        &lt;filter-impl&gt;com.example.SampleFilter&lt;/filter-impl&gt;
        &lt;filter-impl&gt;com.example.SampleFilter2&lt;/filter-impl&gt;
      &lt;/filters&gt;
    &lt;/wan-replication-ref&gt;
  &lt;/map&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown in the above configuration, you can define more than one filter. Filters are called in the order that they are introduced.
A WAN replication event is only eligible to publish if it passes all the filters.</p>
</div>
<div class="paragraph">
<p>Map and Cache have different filter interfaces: <code>MapWanEventFilter</code> and <code>CacheWanEventFilter</code>. Both of these interfaces have the method <code>filter</code> which takes the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mapName</code>/<code>cacheName</code>: Name of the related data structure.</p>
</li>
<li>
<p><code>entryView</code>: <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/core/EntryView.html">EntryView</a>
or <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/cache/CacheEntryView.html">CacheEntryView</a> depending on the data structure.</p>
</li>
<li>
<p><code>eventType</code>: Enum type - <code>UPDATED(1)</code>, <code>REMOVED(2)</code> or <code>LOADED(3)</code> - depending on the event.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>LOADED</code> events are filtered out and not replicated to target cluster.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="acknowledgment-types"><a class="anchor" href="#acknowledgment-types"></a><a class="link" href="#acknowledgment-types">22.1.10. Acknowledgment Types</a></h4>
<div class="paragraph">
<p>Starting with Hazelcast 3.6, WAN replication supports different acknowledgment (ACK) types for each target cluster group.
You can choose from 2 different ACK type depending on your consistency requirements. The following ACK types are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ACK_ON_RECEIPT</code>: A batch of replication events is considered successful as soon as it is received by the target cluster. This option does not guarantee that the received event is actually applied but it is faster.</p>
</li>
<li>
<p><code>ACK_ON_OPERATION_COMPLETE</code>: This option guarantees that the event is received by the target cluster and it is applied. It is more time consuming. But it is the best way if you have strong consistency requirements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following is an example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;wan-publisher group-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-cluster-1</span><span class="delimiter">&quot;</span></span>&gt;
    ...
    &lt;properties&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">ack.type</span><span class="delimiter">&quot;</span></span>&gt;ACK_ON_OPERATION_COMPLETE&lt;/property&gt;
    &lt;/properties&gt;
  &lt;/wan-publisher&gt;
&lt;/wan-replication&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>ack.type</code> configuration is optional. Its default value is <code>ACK_ON_RECEIPT</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="synchronizing-wan-target-cluster"><a class="anchor" href="#synchronizing-wan-target-cluster"></a><a class="link" href="#synchronizing-wan-target-cluster">22.1.11. Synchronizing WAN Target Cluster</a></h4>
<div class="paragraph">
<p>Starting with Hazelcast 3.7 you can initiate a synchronization operation on an IMap for a specific target cluster.
Synchronization operation sends all the data of an IMap to a target cluster to align the state of target IMap with source IMap.
Synchronization is useful if two remote clusters lost their synchronization due to WAN queue overflow or in restart scenarios.</p>
</div>
<div class="paragraph">
<p>Synchronization can be initiated through <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#wan-sync">Management Center</a> and Hazelcasts REST API.</p>
</div>
<div class="paragraph">
<p>Below is the URL for the REST call;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//member_ip:port/hazelcast/rest/mancenter/wan/sync/map</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to add parameters to the request in the following order separated by "&amp;";</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name of the WAN replication configuration</p>
</li>
<li>
<p>Target group name</p>
</li>
<li>
<p>Map name to be synchronized</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assume that you have configured an IMap with a WAN replication configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;wan-replication name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;wan-publisher group-name=<span class="string"><span class="delimiter">&quot;</span><span class="content">istanbul</span><span class="delimiter">&quot;</span></span>&gt;
          &lt;<span class="type">class</span>-<span class="class">name</span>&gt;com.hazelcast.enterprise.wan.replication.WanBatchReplication&lt;/<span class="type">class</span>-<span class="class">name</span>&gt;
            ...
      &lt;/wan-publisher&gt;
&lt;wan-replication&gt;
...
&lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-map</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;wan-replication-ref name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster</span><span class="delimiter">&quot;</span></span>&gt;
       &lt;merge-policy&gt;com.hazelcast.map.merge.PassThroughMergePolicy&lt;/merge-policy&gt;
    &lt;/wan-replication-ref&gt;
&lt;/map&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, a sample CURL command to initiate the synchronization for "my-map" would be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">curl -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Content-type: text/plain</span><span class="delimiter">&quot;</span></span> -X POST -d <span class="string"><span class="delimiter">&quot;</span><span class="content">my-wan-cluster&amp;istanbul&amp;my-map</span><span class="delimiter">&quot;</span></span> --<span class="predefined-type">URL</span> http:<span class="comment">//127.0.0.1:5701/hazelcast/rest/mancenter/wan/sync/map</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Synchronizing All Maps</div>
<div class="paragraph">
<p>You can also use the following URL in your REST call if you want to synchronize all the maps in source and target cluster:</p>
</div>
<div class="paragraph">
<p><code><a href="http://member_ip:port/hazelcast/rest/mancenter/wan/sync/allmaps" class="bare">http://member_ip:port/hazelcast/rest/mancenter/wan/sync/allmaps</a></code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Synchronization for a target cluster operates only with the data residing in the memory. Therefore, evicted entries will not be
synchronized, not even if <code>MapLoader</code> is configured.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="wan-replication-failure-detection-and-recovery"><a class="anchor" href="#wan-replication-failure-detection-and-recovery"></a><a class="link" href="#wan-replication-failure-detection-and-recovery">22.1.12. WAN Replication Failure Detection and Recovery</a></h4>
<div class="paragraph">
<p>The failure detection and recovery mechanisms in WAN handle failures during WAN replication and they closely interact with the list of endpoints that WAN is replicating to. There might be some small differences when using static endpoints or the discovery SPI but here we will outline the general mechanism of failure detection and recovery.</p>
</div>
<div class="sect4">
<h5 id="wan-target-endpoint-list"><a class="anchor" href="#wan-target-endpoint-list"></a><a class="link" href="#wan-target-endpoint-list">WAN Target Endpoint List</a></h5>
<div class="paragraph">
<p>The WAN connection manager maintains a list of public addresses that it can replicate to at any moment. This list may change over time as failures are detected or as new addresses are discovered when using the discovery SPI. The connection manager does not eagerly create connections to these addresses as they are added to the list to avoid overloading the endpoint with connections from all members using the same configuration. It will try and connect to the endpoint just before WAN events are about to be transmitted. This means that if there are no updates on the map or cache using WAN replication, there will be no WAN events and the connection will not be established to the endpoint.</p>
</div>
<div class="paragraph">
<p>When more than one endpoint is configured, traffic will be load balanced between them using the partition, so that the same partitions are always sent to the same target member, ensuring ordering by partition.</p>
</div>
</div>
<div class="sect4">
<h5 id="wan-failure-detection"><a class="anchor" href="#wan-failure-detection"></a><a class="link" href="#wan-failure-detection">WAN Failure Detection</a></h5>
<div class="paragraph">
<p>If using the Hazelcast IMDG Enterprise edition class <code>WanBatchReplication</code> (see the <a href="#defining-wan-replication">Defining WAN replication section</a>), the WAN replication will catch any exceptions when sending the WAN events to the endpoint. In the case of an exception, the endpoint will be removed from the endpoint list to which WAN replicates and the WAN events will be resent to a different address. The replication will be retried until it is successful.</p>
</div>
</div>
<div class="sect4">
<h5 id="wan-endpoint-recovery"><a class="anchor" href="#wan-endpoint-recovery"></a><a class="link" href="#wan-endpoint-recovery">WAN Endpoint Recovery</a></h5>
<div class="paragraph">
<p>Periodically the WAN connection manager will try and "rediscover" new endpoints. The period is 10 seconds by default but configurable with the <code>discovery.period</code> property (see the <a href="#defining-wan-replication">Defining WAN replication section</a>).</p>
</div>
<div class="paragraph">
<p>The discovered endpoints depend on the configuration used to define WAN replication. If using static WAN endpoints (by using the <code>endpoints</code> property), the discovered endpoints are always the same and are equal to the values defined in the configuration. If using discovery SPI with WAN, the discovered endpoints may be different each time.</p>
</div>
<div class="paragraph">
<p>When the discovery returns a list of endpoints (addresses), the WAN target endpoint list is updated. Newly discovered endpoints are added and endpoints which are no longer in the discovered list are removed. Newly discovered endpoints may include addresses to which WAN replication has previously failed. This means that once a new WAN event is about to be sent, a connection will be reestablished to the previously failed endpoint and WAN replication will be retried. The endpoint can later be again removed from the target endpoint list if the replication again encounters failure.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="wan-replication-additional-information"><a class="anchor" href="#wan-replication-additional-information"></a><a class="link" href="#wan-replication-additional-information">22.1.13. WAN Replication Additional Information</a></h4>
<div class="paragraph">
<p>Each cluster in WAN topology has to have a unique <code>group-name</code> property for a proper handling of forwarded events.</p>
</div>
<div class="paragraph">
<p>Starting with Hazelcast 3.6, WAN replication backs up its event queues to other members to prevent event loss in case of member failures.
WAN replication&#8217;s backup mechanism depends on the related data structures' backup operations. Note that, WAN replication is supported for IMap and ICache.
That means, as far as you set a backup count for your IMap or ICache instances, WAN replication events generated by these instances are also replicated.</p>
</div>
<div class="paragraph">
<p>There is no additional configuration to enable/disable WAN replication event backups.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="delta-wan-synchronization"><a class="anchor" href="#delta-wan-synchronization"></a><a class="link" href="#delta-wan-synchronization">22.2. Delta WAN Synchronization</a></h3>
<div class="paragraph">
<p>Hazelcast clusters connected over WAN can go out-of-sync because of various reasons such as member failures and concurrent updates. To overcome the out-of-sync issue, Hazelcast has the default <a href="#synchronizing-wan-target-cluster">WAN synchronization</a> feature, through which the maps in different clusters are synced by transferring all entries from the source to the target cluster. This may be not efficient since some of the entries have remained unchanged on both clusters and do not require to be transferred. Also, for the entries to be transferred, they need to be copied to on-heap on the source cluster. This may cause spikes in the heap usage, especially if using large off-heap stores.</p>
</div>
<div class="paragraph">
<p>Besides the default WAN synchronization, Hazelcast provides Delta WAN Synchronization which uses <a href="https://en.wikipedia.org/wiki/Merkle_tree">Merkle tree</a> for the same purpose. It is a data structure used for efficient comparison of the difference in the contents of large data structures. The precision of this comparison is defined by Merkle tree&#8217;s depth. Merkle tree hash exchanges can detect inconsistencies in the map data and synchronize only the different entries when using WAN synchronization, instead of sending all the map entries.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Currently, Delta WAN Synchronization is implemented only for Hazelcast IMap. It will also be implemented for ICache in the future releases.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="requirements"><a class="anchor" href="#requirements"></a><a class="link" href="#requirements">22.2.1. Requirements</a></h4>
<div class="paragraph">
<p>To be able to use Delta WAN synchronization, the following must be met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Source and target cluster versions must be at least Hazelcast 3.11.</p>
</li>
<li>
<p>Both clusters must have the same number of partitions.</p>
</li>
<li>
<p>Both clusters must use the same partitioning strategy.</p>
</li>
<li>
<p>Both clusters must have the Merkle tree structure enabled.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="using-delta-wan-synchronization"><a class="anchor" href="#using-delta-wan-synchronization"></a><a class="link" href="#using-delta-wan-synchronization">22.2.2. Using Delta WAN Synchronization</a></h4>
<div class="paragraph">
<p>To be able to use Delta WAN synchronization for a Hazelcast data structure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the WAN synchronization mechanism for your WAN publisher so that it uses the Merkle tree: If configuring declaratively, you can use the <code>consistency-check-strategy</code> sub-element of the <code>wan-sync</code> element. If configuring programmatically, you can use the setter of the <a href="https://docs.hazelcast.org/docs/3.11/javadoc/com/hazelcast/config/WanSyncConfig.html"><code>WanSyncConfig</code></a> object.</p>
</li>
<li>
<p>Bind that WAN synchronization configuration to the data structure (currently IMap): Simply set the WAN replication reference of your map to the name of the WAN replication configuration which uses the Merkle tree.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Following is a declarative configuration example of the above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wan-replication-ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wanReplicationScheme</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        ...
    <span class="tag">&lt;/wan-replication-ref&gt;</span>
    ...
<span class="tag">&lt;/map&gt;</span>
...
...
<span class="tag">&lt;wan-replication</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wanReplicationScheme</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wan-publisher</span> <span class="attribute-name">group-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groupName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;class-name&gt;</span>...<span class="tag">&lt;/class-name&gt;</span>
        <span class="tag">&lt;wan-sync&gt;</span>
            <span class="tag">&lt;consistency-check-strategy&gt;</span>MERKLE_TREES<span class="tag">&lt;/consistency-check-strategy&gt;</span>
        <span class="tag">&lt;/wan-sync&gt;</span>
        ...
    <span class="tag">&lt;/wan-publisher&gt;</span>
<span class="tag">&lt;/wan-replication&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the element <code>consistency-check-strategy</code> sets the strategy for checking the consistency of data between the source and target clusters. You must initiate the WAN synchronization (via Management Center or REST API as explained in <a href="#synchronizing-wan-target-cluster">Synchronizing WAN clusters</a>) to let this strategy reconcile the inconsistencies. The element <code>consistency-check-strategy</code> has currently two values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NONE</code>: Means that there will be no consistency checks. This is the default value.</p>
</li>
<li>
<p><code>MERKLE_TREES</code>: Means that WAN synchronization will use Merkle tree structure.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-delta-wan-synchronization"><a class="anchor" href="#configuring-delta-wan-synchronization"></a><a class="link" href="#configuring-delta-wan-synchronization">22.2.3. Configuring Delta WAN Synchronization</a></h4>
<div class="paragraph">
<p>You can configure Delta WAN Synchronization declaratively using the <code>merkle-tree</code> element or programmatically using the <a href="https://docs.hazelcast.org/docs/3.11/javadoc/com/hazelcast/config/MerkleTreeConfig.html"><code>MerkleTreeConfig</code></a> object.</p>
</div>
<div class="paragraph">
<p>Following is a declarative configuration example showing how to enable Delta WAN Synchronization, bind it to a Hazelcast data structure (an IMap in the below case) and specify its depth.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;merkle-tree</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;mapName&gt;</span>someMap<span class="tag">&lt;/mapName&gt;</span>
    <span class="tag">&lt;depth&gt;</span>5<span class="tag">&lt;/depth&gt;</span>
<span class="tag">&lt;/merkle-tree&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are the descriptions of sub-elements and attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>enabled</code>: Specifies whether the Merkle tree structure is enabled. Its default value is <code>true</code>.</p>
</li>
<li>
<p><code>mapName</code>: Specifies the name of the map for which the Merkle tree structure is used.</p>
</li>
<li>
<p><code>depth</code>: Specifies the depth of Merkle tree. Valid values are between 2 and 27 (exclusive). Its default value is <code>10</code>.</p>
<div class="ulist">
<ul>
<li>
<p>A larger depth means that a data synchronization mechanism is able to pinpoint a smaller subset of the data structure (e.g., IMap) contents in which a change has occurred. This causes the synchronization mechanism to be more efficient. However, keep in mind that a large depth means that the Merkle tree will consume more memory. As the comparison mechanism is iterative, a larger depth also prolongs the comparison duration. Therefore, it is recommended not to have large tree depths if the latency of the comparison operation is high.</p>
</li>
<li>
<p>A smaller depth means that the Merkle tree is shallower and the data synchronization mechanism transfers larger chunks of the data structure (e.g., IMap) in which a possible change has happened. As you can imagine, a shallower Merkle tree will consume less memory.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following is a declarative example including the Merkle tree configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;map</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wan-replication-ref</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wanReplicationScheme</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        ...
    <span class="tag">&lt;/wan-replication-ref&gt;</span>
    ...
<span class="tag">&lt;/map&gt;</span>
...
<span class="tag">&lt;merkle-tree</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;mapName&gt;</span>myMap<span class="tag">&lt;/mapName&gt;</span>
    <span class="tag">&lt;depth&gt;</span>10<span class="tag">&lt;/depth&gt;</span>
<span class="tag">&lt;/merkle-tree&gt;</span>
...
<span class="tag">&lt;wan-replication</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wanReplicationScheme</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wan-publisher</span> <span class="attribute-name">group-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groupName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;class-name&gt;</span>...<span class="tag">&lt;/class-name&gt;</span>
        <span class="tag">&lt;wan-sync&gt;</span>
            <span class="tag">&lt;consistency-check-strategy&gt;</span>MERKLE_TREES<span class="tag">&lt;/consistency-check-strategy&gt;</span>
        <span class="tag">&lt;/wan-sync&gt;</span>
        ...
    <span class="tag">&lt;/wan-publisher&gt;</span>
<span class="tag">&lt;/wan-replication&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you do not specifically configure the <code>merkle-tree</code> in your Hazelcast configuration, Hazelcast uses the default Merkle tree structure values (i.e., it is enabled by default and its default depth is 10) when there is a WAN publisher using the Merkle tree (i.e., <code>consistency-check-strategy</code> for a WAN replication configuration is set as <code>MERKLE_TREES</code> and there is a data structure using that WAN replication configuration).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Merkle trees are created for each partition holding IMap data. Therefore, increasing the partition count also
increases the efficiency of the Delta WAN Synchronization.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="the-process"><a class="anchor" href="#the-process"></a><a class="link" href="#the-process">22.2.4. The Process</a></h4>
<div class="paragraph">
<p>Synchronizing the maps based on Merkle trees consists of two phases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Consistency check</em>: Process of exchanging and comparing the hashes stored in the Merkle tree structures in the
source and target clusters. The check starts with the root node and continues recursively with the children with different
hash codes. Both sides send the children of the nodes that the other side sent, hence the comparison is done by <code>depth/2</code>
steps. After this check, the tree leaves holding different entries are identified.</p>
</li>
<li>
<p><em>Synchronization</em>: Process of transferring the entries belong to the leaves identified by the <em>consistency
check</em> from the source to target cluster. On the target cluster the configured merge policy is applied for each entry that
is in both the source and target clusters.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you only need the differences between the clusters, you can trigger the consistency check without performing
synchronization.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="memory-consumption"><a class="anchor" href="#memory-consumption"></a><a class="link" href="#memory-consumption">22.2.5. Memory Consumption</a></h4>
<div class="paragraph">
<p>Since Merkle trees are built for each partition and each map, the memory overhead of the trees with high entry count and deep
trees can be significant. The trees are maintained on-heap, therefore - besides the memory consumption - garbage collection could be another
concern. Make sure the configuration is tested with realistic data size before deployed in production.</p>
</div>
<div class="paragraph">
<p>The table below shows a few examples for what the memory overhead could be.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Merkle trees memory overhead for a member</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entries Stored</th>
<th class="tableblock halign-left valign-top">Partitions Owned</th>
<th class="tableblock halign-left valign-top">Entries per Leaf</th>
<th class="tableblock halign-left valign-top">Depth</th>
<th class="tableblock halign-left valign-top">Memory Overhead</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">271</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">57 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">271</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">97 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">271</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">412 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">271</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">453 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">577 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">900 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1986 MB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2740 MB</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="defining-the-depth"><a class="anchor" href="#defining-the-depth"></a><a class="link" href="#defining-the-depth">22.2.6. Defining the Depth</a></h4>
<div class="paragraph">
<p>The efficiency of the Delta WAN Synchronization (WAN synchronization based on Merkle trees) is determined by the average number of entries per the tree
leaves that is proportionate to the number of entries in the map. The bigger this average the more entries are getting
synchronized for the same difference. Raising the depth decreases this average at the cost of increasing the memory overhead.</p>
</div>
<div class="paragraph">
<p>This average can be calculated for a map as <code>avgEntriesPerLeaf = mapEntryCount / totalLeafCount</code>, where <code>totalLeafCount =
partitionCount * 2<sup>depth-1</sup></code>. The ideal value is 1, however this may come at significant memory overhead as shown in the
table above.</p>
</div>
<div class="paragraph">
<p>In order to specify the tree depth, a trade-off between memory consumption and effectiveness might be needed.</p>
</div>
<div class="paragraph">
<p>Even if the map is huge and the Merkle trees are configured to be relatively shallow, the Merkle tree based synchronization
may be leveraged if only a small subset of the whole map is expected to be synchronized. The table below illustrates the
efficiency of the Merkle tree based synchronization compared to the default synchronization mechanism.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Efficiency examples</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Map entry count</th>
<th class="tableblock halign-left valign-top">Difference count</th>
<th class="tableblock halign-left valign-top">Depth</th>
<th class="tableblock halign-left valign-top">Memory consumption</th>
<th class="tableblock halign-left valign-top">Avg entries / leaf</th>
<th class="tableblock halign-left valign-top">Entries synced</th>
<th class="tableblock halign-left valign-top">Efficiency</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">685 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">900 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">577 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">150%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10K</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">497 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">160K</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6150%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10K</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">900 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1K</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">99900%</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As shown in the last two rows, the Merkle tree based synchronization transfers significantly less entries than what the
default mechanism does even with 8 deep trees. The efficiency with depth 12 is even better but consumes much more memory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The averages in the table are calculated with 5009 partitions.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The average entries per leaf number above assumes perfect distribution of the entries amongst the leaves. Since this is
typically not true in real-life scenarios the efficiency can be slightly worse. The statistics section below describes how to
get the actual average for the leaves involved in the synchronization.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="rest-api"><a class="anchor" href="#rest-api"></a><a class="link" href="#rest-api">22.2.7. REST API</a></h4>
<div class="paragraph">
<p>The two phases of the Merkle tree based synchronization can be triggered by a REST call, as it can be done with the
default synchronization.</p>
</div>
<div class="paragraph">
<p>The URL for the consistency check REST call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//member_ip:port/hazelcast/rest/mancenter/wan/consistencyCheck/map</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The URL for the synchronization REST call - the same as it is for the default synchronization:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http:<span class="comment">//member_ip:port/hazelcast/rest/mancenter/wan/sync/map</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to add parameters to the request in both cases in the following order separated by "&amp;";</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name of the WAN replication configuration</p>
</li>
<li>
<p>Target group name</p>
</li>
<li>
<p>Map name to be synchronized</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also use the following URL in your REST call if you want to synchronize all the maps in source and target cluster:
<code><a href="http://member_ip:port/hazelcast/rest/mancenter/wan/sync/allmaps" class="bare">http://member_ip:port/hazelcast/rest/mancenter/wan/sync/allmaps</a></code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Consistency check can be triggered only for one map.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="statistics"><a class="anchor" href="#statistics"></a><a class="link" href="#statistics">22.2.8. Statistics</a></h4>
<div class="paragraph">
<p>The consistency check and the synchronization both write statistics into the diagnostics subsystem and send it
 to the Management Center. The following reported fields can be used to reason about the efficiency of the configuration.</p>
</div>
<div class="paragraph">
<p>Consistency check reports the number of the</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Merkle tree nodes checked,</p>
</li>
<li>
<p>Merkle tree nodes found to be different,</p>
</li>
<li>
<p>entries needed to be synchronized to make the clusters consistent.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Synchronization reports the</p>
</div>
<div class="ulist">
<ul>
<li>
<p>duration of the synchronization,</p>
</li>
<li>
<p>number of the entries synchronized,</p>
</li>
<li>
<p>average number of the entries per tree leaves in the synchronized leaves.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hazelcast-wan-replication-with-solace"><a class="anchor" href="#hazelcast-wan-replication-with-solace"></a><a class="link" href="#hazelcast-wan-replication-with-solace">22.3. Hazelcast WAN Replication with Solace</a></h3>
<div class="imageblock">
<div class="content">
<img src="images/Plugin_New.png" alt="Solace Plugin" width="84" height="22">
</div>
</div>
<div class="paragraph">
<p>This section explains how you can integrate Hazelcast&#8217;s WAN replication with <a href="http://www.solacesystems.com/">Solace</a> messaging platform. With this integration, you can publish and consume WAN replication events to/from Solace appliances.</p>
</div>
<div class="paragraph">
<p>Solace combines with Hazelcast to drive efficiencies in the processing of global data workloads. This joint solution enables multi-cloud and hybrid-cloud replication of Hazelcast clusters. Please see <a href="https://hazelcast.com/partner/solace/">Hazelcast-Solace partnership</a> for more information.</p>
</div>
<div class="sect3">
<h4 id="enabling-integration"><a class="anchor" href="#enabling-integration"></a><a class="link" href="#enabling-integration">22.3.1. Enabling Integration</a></h4>
<div class="paragraph">
<p>To publish and consume WAN replication events on Solace appliances, Hazelcast WAN replication has the following classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SolaceWanPublisher</code></p>
</li>
<li>
<p><code>SolaceWanConsumer</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can register these classes using the configuration elements <code>&lt;wan-publisher&gt;</code> and <code>&lt;wan-consumer&gt;</code> while configuring your WAN replication.
<code>SolaceWanPublisher</code> and <code>SolaceWanConsumer</code> are included in the <code>hazelcast-solace</code> library which can be found in following Maven coordinates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;dependency&gt;
  &lt;groupId&gt;com.hazelcast&lt;/groupId&gt;
  &lt;artifactId&gt;hazelcast-solace&lt;/artifactId&gt;
  &lt;version&gt;<span class="float">1.0</span><span class="float">.0</span>&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The hazelcast-solace artifact is not available in central Maven repository, but in Hazelcast&#8217;s repository on the CloudBees platform. Please refer to the <a href="#installing-hazelcast-imdg-enterprise">Installing Hazelcast IMDG Enterprise section</a> for information on how to configure this repository.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please see the following sections for configuration details.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-publisher"><a class="anchor" href="#configuring-publisher"></a><a class="link" href="#configuring-publisher">22.3.2. Configuring Publisher</a></h4>
<div class="paragraph">
<p>Following is an example declarative configuration for the publisher side:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;wan-replication</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AtoB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wan-publisher</span> <span class="attribute-name">group-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clusterB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;class-name&gt;</span>com.hazelcast.enterprise.wan.solace.SolaceWanPublisher<span class="tag">&lt;/class-name&gt;</span>
        <span class="tag">&lt;properties&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>192.168.2.66<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vpn.name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>YOUR_VPN_NAME<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>admin<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>YOUR_PASSWORD<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">topic.base.name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>BaseTopic<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue.name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Q/hz/clusterA<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">initial.queue.mapping.enabled</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/wan-publisher&gt;</span>
<span class="tag">&lt;/wan-replication&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Descriptions of the properties are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>class-name</code>: Full class name of Solace WAN publisher, i.e., <code>com.hazelcast.enterprise.wan.solace.SolaceWanPublisher</code></p>
</li>
<li>
<p><code>host</code>: IP address of the Solace host machine. It can be in the format "IP address:Port number". It is a mandatory property.</p>
</li>
<li>
<p><code>vpn.name</code>: Name of the Solace VPN. It is an optional property.</p>
</li>
<li>
<p><code>username</code>: Username for the Solace host. It is a mandatory property.</p>
</li>
<li>
<p><code>password</code>: Password for the Solace host. It is an optional property.</p>
</li>
<li>
<p><code>topic.base.name</code>: Base topic name to use while publishing events to Solace appliance. If not defined, the members will publish to topics using the format "T/hz/[cluster-group-name]/partitionId". If defined, the format "[topic.base.name]/partitionId" will be used. It is an optional property.</p>
</li>
<li>
<p><code>queue.name</code>: Name of the queue to be used in topic-to-queue mapping. This property is only valid if the property <code>initial.queue.mapping.enabled</code> is set to "true". Default queue name is "Q/hz/[cluster-group-name].</p>
</li>
<li>
<p><code>initial.queue.mapping.enabled</code>: Decides if a default topic-to-queue mapping should be performed on the publisher side. When enabled, it tries to provide a queue, whose name is defined by the property <code>queue.name</code>, and all topics that are generated by this instance is mapped to this queue. When disabled, you should perform this mapping manually. It is enabled by default.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-consumer"><a class="anchor" href="#configuring-consumer"></a><a class="link" href="#configuring-consumer">22.3.3. Configuring Consumer</a></h4>
<div class="paragraph">
<p>Following is an example declarative configuration for the consumer side:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;wan-replication</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AtoB</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;wan-consumer&gt;</span>
        <span class="tag">&lt;class-name&gt;</span>com.hazelcast.enterprise.wan.solace.SolaceWanConsumer<span class="tag">&lt;/class-name&gt;</span>
        <span class="tag">&lt;persist-wan-replicated-data&gt;</span>false<span class="tag">&lt;/persist-wan-replicated-data&gt;</span>
        <span class="tag">&lt;properties&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>192.168.2.66<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vpn.name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>YOUR_VPN_NAME<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>admin<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>YOUR_PASSWORD<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">queue.name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Q/hz/clusterA<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;/properties&gt;</span>
    <span class="tag">&lt;/wan-consumer&gt;</span>
<span class="tag">&lt;/wan-replication&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Descriptions of the properties are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>class-name</code>: Full class name of Solace WAN consumer, i.e., <code>com.hazelcast.enterprise.wan.solace.SolaceWanConsumer</code></p>
</li>
<li>
<p><code>persist-wan-replicated-data</code>:  When true, an incoming event over WAN replication can be persisted to a data store, otherwise it will not be persisted. Default value is false.</p>
</li>
<li>
<p><code>host</code>: IP address of the Solace host machine. It can be in the format "IP address:Port number". It is a mandatory property.</p>
</li>
<li>
<p><code>vpn.name</code>: Name of the Solace VPN. It is an optional property.</p>
</li>
<li>
<p><code>username</code>: Username for the Solace host. It is a mandatory property.</p>
</li>
<li>
<p><code>password</code>: Password for the Solace host. It is an optional property.</p>
</li>
<li>
<p><code>queue.name</code>: Name of the queue to be polled by the consumer. It is a mandatory property.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="additional-information"><a class="anchor" href="#additional-information"></a><a class="link" href="#additional-information">22.3.4. Additional Information</a></h4>
<div class="paragraph">
<p>You can find code samples at <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/enterprise/wan-replication/src/main/java/com/hazelcast/wan/solace">hazelcast-code-samples</a> repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can download the white paper <strong>Hazelcast WAN Replication with Solace</strong> from <a href="https://hazelcast.com/resources/hazelcast-wan-replication-solace/">Hazelcast.com</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="osgi"><a class="anchor" href="#osgi"></a><a class="link" href="#osgi">23. OSGI</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how Hazelcast is supported on OSGI (Open Service Gateway Initiatives) environments.</p>
</div>
<div class="sect2">
<h3 id="osgi-support"><a class="anchor" href="#osgi-support"></a><a class="link" href="#osgi-support">23.1. OSGI Support</a></h3>
<div class="paragraph">
<p>Hazelcast bundles provide OSGI services so that Hazelcast users can manage (create, access, shutdown) Hazelcast instances through these services on OSGI environments. When you enable the property <code>hazelcast.osgi.start</code> (default is disabled), when an Hazelcast OSGI service is activated, a default Hazelcast instance is created automatically.</p>
</div>
<div class="paragraph">
<p>Created Hazelcast instances can be served as an OSGI service that the other Hazelcast bundles can access. Registering created Hazelcast instances behavior is enabled by default; you can disable it using the property <code>hazelcast.osgi.register.disabled</code>.</p>
</div>
<div class="paragraph">
<p>Each Hazelcast bundle provides a different OSGI service. Their instances can be grouped (clustered) together to prevent possible compatibility issues between different Hazelcast versions/bundles. This grouping behavior is enabled by default and you disable it using the property <code>hazelcast.osgi.grouping.disabled</code>.</p>
</div>
<div class="paragraph">
<p>Hazelcast OSGI service&#8217;s lifecycle (and the owned/created instances&#8217;s lifecycles) is the same with the owner Hazelcast bundles. When the bundle is stopped (deactivated), the owned service and Hazelcast instances are also deactivated/shutdown and deregistered automatically. When the bundle is re-activated, its service is registered again.</p>
</div>
<div class="paragraph">
<p>The Hazelcast IMDG Enterprise JAR package is also an OSGI bundle like the Hazelcast Open Source JAR package.</p>
</div>
</div>
<div class="sect2">
<h3 id="api"><a class="anchor" href="#api"></a><a class="link" href="#api">23.2. API</a></h3>
<div class="paragraph">
<p><strong><code>HazelcastOSGiService</code>:</strong> Contract point for Hazelcast services on top of OSGI. Registered to <code>org.osgi.framework.BundleContext</code> as the OSGI service so the other bundles can access and use Hazelcast on the OSGI environment through this service.</p>
</div>
<div class="paragraph">
<p><strong><code>HazelcastOSGiInstance</code>:</strong> Contract point for <code>HazelcastInstance</code> implementations based on OSGI service. <code>HazelcastOSGiService</code> provides proxy Hazelcast instances typed <code>HazelcastOSGiInstance</code> which is a subtype of <code>HazelcastInstance</code> and these instances delegate all calls to the underlying <code>HazelcastInstance</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-hazelcast-osgi-support"><a class="anchor" href="#configuring-hazelcast-osgi-support"></a><a class="link" href="#configuring-hazelcast-osgi-support">23.3. Configuring Hazelcast OSGI Support</a></h3>
<div class="paragraph">
<p><code>HazelcastOSGiService</code> uses three configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>hazelcast.osgi.start</code>:</strong> If this property is enabled (it is disabled by default), when an <code>HazelcastOSGiService</code> is activated, a default Hazelcast instance is created automatically.</p>
</li>
<li>
<p><strong><code>hazelcast.osgi.register.disabled</code>:</strong> If this property is disabled (it is disabled by default), when a Hazelcast instance is created by <code>HazelcastOSGiService</code>, the created <code>HazelcastOSGiInstance</code> is registered automatically as OSGI service with type of <code>HazelcastOSGiInstance</code> and it is deregistered automatically when the created <code>HazelcastOSGiInstance</code> is shutdown.</p>
</li>
<li>
<p><strong><code>hazelcast.osgi.grouping.disabled</code>:</strong> If this property is disabled (it is disabled by default), every created <code>HazelcastOSGiInstance</code> is grouped as their owner <code>HazelcastOSGiService</code> and do not join each other unless no group name is specified in the <code>GroupConfig</code> of <code>Config</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="design"><a class="anchor" href="#design"></a><a class="link" href="#design">23.4. Design</a></h3>
<div class="paragraph">
<p><code>HazelcastOSGiService</code> is specific to each Hazelcast bundle. This means that every Hazelcast bundle has its own <code>HazelcastOSGiService</code> instance.</p>
</div>
<div class="paragraph">
<p>Every Hazelcast bundle registers its <code>HazelcastOSGiService</code> instances via Hazelcast Bundle Activator (<code>com.hazelcast.osgi.impl.Activator</code>) while they are being started, and it deregisters its <code>HazelcastOSGiService</code> instances while they are being stopped.</p>
</div>
<div class="paragraph">
<p>Each <code>HazelcastOSGiService</code> instance has a different service ID as the combination of Hazelcast version and artifact type (<code>OSS</code> or <code>EE</code>). Examples are <code>3.6#OSS</code>, <code>3.6#EE</code>, <code>3.7#OSS</code>, <code>3.7#EE</code>, etc.</p>
</div>
<div class="paragraph">
<p><code>HazelcastOSGiService</code> instance lifecycle is the same with the owner Hazelcast bundle. This means that when the owner bundle is deactivated, the owned <code>HazelcastOSGiService</code> instance is deactivated, and all active Hazelcast instances that are created and served by that <code>HazelcastOSGiService</code> instance are also shutdown and deregistered. When the Hazelcast bundle is re-activated, its <code>HazelcastOSGiService</code> instance is registered again as the OSGI service.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Design.png" alt="OSGI Design">
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-hazelcast-osgi-service"><a class="anchor" href="#using-hazelcast-osgi-service"></a><a class="link" href="#using-hazelcast-osgi-service">23.5. Using Hazelcast OSGI Service</a></h3>
<div class="sect3">
<h4 id="getting-hazelcast-osgi-service-instances"><a class="anchor" href="#getting-hazelcast-osgi-service-instances"></a><a class="link" href="#getting-hazelcast-osgi-service-instances">23.5.1. Getting Hazelcast OSGI Service Instances</a></h4>
<div class="paragraph">
<p>You can access all <code>HazelcastOSGiService</code> instances through <code>org.osgi.framework.BundleContext</code> for each Hazelcast bundle as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">for</span> (ServiceReference serviceRef : context.getServiceReferences(HazelcastOSGiService.class.getName(), <span class="predefined-constant">null</span>)) {
    HazelcastOSGiService service = (HazelcastOSGiService) context.getService(serviceRef);
    <span class="predefined-type">String</span> serviceId = service.getId();
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="managing-and-using-hazelcast-instances"><a class="anchor" href="#managing-and-using-hazelcast-instances"></a><a class="link" href="#managing-and-using-hazelcast-instances">23.5.2. Managing and Using Hazelcast instances</a></h4>
<div class="paragraph">
<p>You can use <code>HazelcastOSGiService</code> instance to create and shutdown Hazelcast instances on OSGI environments. The created Hazelcast instances are <code>HazelcastOSGiInstance</code> typed (which is sub-type of <code>HazelcastInstance</code>) and are just proxies to the underlying Hazelcast instance. There are several methods in <code>HazelcastOSGiService</code> to use Hazelcast instances on OSGI environments as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Get the default Hazelcast instance owned by `hazelcastOsgiService`</span>
<span class="comment">// Returns null if `HAZELCAST_OSGI_START` is not enabled</span>
HazelcastOSGiInstance defaultInstance = hazelcastOsgiService.getDefaultHazelcastInstance();


<span class="comment">// Creates a new Hazelcast instance with default configurations as owned by `hazelcastOsgiService`</span>
HazelcastOSGiInstance newInstance1 = hazelcastOsgiService.newHazelcastInstance();


<span class="comment">// Creates a new Hazelcast instance with specified configuration as owned by `hazelcastOsgiService`</span>
Config config = <span class="keyword">new</span> Config();
config.setInstanceName(<span class="string"><span class="delimiter">&quot;</span><span class="content">OSGI-Instance</span><span class="delimiter">&quot;</span></span>);
...
HazelcastOSGiInstance newInstance2 = hazelcastOsgiService.newHazelcastInstance(config);

<span class="comment">// Gets the Hazelcast instance with the name `OSGI-Instance`, which is `newInstance2` created above</span>
HazelcastOSGiInstance instance = hazelcastOsgiService.getHazelcastInstanceByName(<span class="string"><span class="delimiter">&quot;</span><span class="content">OSGI-Instance</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Shuts down the Hazelcast instance with name `OSGI-Instance`, which is `newInstance2`</span>
hazelcastOsgiService.shutdownHazelcastInstance(instance);

<span class="comment">// Print all active Hazelcast instances owned by `hazelcastOsgiService`</span>
<span class="keyword">for</span> (HazelcastOSGiInstance instance : hazelcastOsgiService.getAllHazelcastInstances()) {
    <span class="predefined-type">System</span>.out.println(instance);
}

<span class="comment">// Shuts down all Hazelcast instances owned by `hazelcastOsgiService`</span>
hazelcastOsgiService.shutdownAll();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extending-hazelcast"><a class="anchor" href="#extending-hazelcast"></a><a class="link" href="#extending-hazelcast">24. Extending Hazelcast</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the different possibilities to extend Hazelcast with additional services or features.</p>
</div>
<div class="sect2">
<h3 id="user-defined-services"><a class="anchor" href="#user-defined-services"></a><a class="link" href="#user-defined-services">24.1. User Defined Services</a></h3>
<div class="paragraph">
<p>In the case of special/custom needs, you can use Hazelcast&#8217;s SPI (Service Provider Interface) module to develop your own distributed data structures and services on top of Hazelcast. Hazelcast SPI is an internal, low-level API which is expected to change in each release except for the patch releases. Your structures and services evolve as the SPI changes.</p>
</div>
<div class="paragraph">
<p>Throughout this section, we create an example distributed counter that will be the guide to reveal the Hazelcast Services SPI usage.</p>
</div>
<div class="paragraph">
<p>Here is our counter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Counter</span>{
    <span class="type">int</span> inc(<span class="type">int</span> amount);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This counter will have the following features:
- It will be stored in Hazelcast.
- Different cluster members can call it.
- It will be scalable, meaning that the capacity for the number of counters scales with the number of cluster members.
- It will be highly available, meaning that if a member hosting this counter goes down, a backup will be available on a different member.</p>
</div>
<div class="paragraph">
<p>All these features are done with the steps below. Each step adds a new functionality to this counter.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the class.</p>
</li>
<li>
<p>Enable the class.</p>
</li>
<li>
<p>Add properties.</p>
</li>
<li>
<p>Place a remote call.</p>
</li>
<li>
<p>Create the containers.</p>
</li>
<li>
<p>Enable partition migration.</p>
</li>
<li>
<p>Create the backups.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="creating-the-service-class"><a class="anchor" href="#creating-the-service-class"></a><a class="link" href="#creating-the-service-class">24.1.1. Creating the Service Class</a></h4>
<div class="paragraph">
<p>To have the counter as a functioning distributed object, we need a class. This class (named CounterService in the following example code) is the gateway between Hazelcast internals and the counter, allowing us to add features to the counter. The following example code creates the class <code>CounterService</code>. Its lifecycle is managed by Hazelcast.</p>
</div>
<div class="paragraph">
<p><code>CounterService</code> should implement the interface <code>com.hazelcast.spi.ManagedService</code> as shown below. The <code>com.hazelcast.spi.ManagedService</code> <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/spi/ManagedService.html">source code is here</a>.</p>
</div>
<div class="paragraph">
<p><code>CounterService</code> implements the following methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>init</code>: This is called when <code>CounterService</code> is initialized. <code>NodeEngine</code> enables access to Hazelcast internals such as <code>HazelcastInstance</code> and <code>PartitionService</code>. Also, the object <code>Properties</code> will provide us with the ability to create our own properties.</p>
</li>
<li>
<p><code>shutdown</code>: This is called when <code>CounterService</code> is shutdown. It cleans up the resources.</p>
</li>
<li>
<p><code>reset</code>: This is called when cluster members face the split-brain issue. This occurs when disconnected members that have created their own cluster are merged back into the main cluster. Services can also implement the <code>SplitBrainHandleService</code> to indicate that they can take part in the merge process. For <code>CounterService</code> we are going to implement <code>reset</code> as a no-op.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CounterService</span> <span class="directive">implements</span> ManagedService {

    <span class="directive">private</span> NodeEngine nodeEngine;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(NodeEngine nodeEngine, <span class="predefined-type">Properties</span> properties) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">CounterService.init()</span><span class="delimiter">&quot;</span></span>);
        <span class="local-variable">this</span>.nodeEngine = nodeEngine;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> shutdown(<span class="type">boolean</span> terminate) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">CounterService.shutdown()</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> reset() {
    }

    <span class="directive">public</span> NodeEngine getNodeEngine() {
        <span class="keyword">return</span> nodeEngine;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="enabling-the-service-class"><a class="anchor" href="#enabling-the-service-class"></a><a class="link" href="#enabling-the-service-class">24.1.2. Enabling the Service Class</a></h4>
<div class="paragraph">
<p>Now, we need to enable the class <code>CounterService</code>. The declarative way of doing this is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;network&gt;
   &lt;join&gt;&lt;multicast enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>/&gt; &lt;/join&gt;
&lt;/network&gt;
&lt;services&gt;
   &lt;service enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
      &lt;name&gt;CounterService&lt;/name&gt;
      &lt;<span class="type">class</span>-<span class="class">name</span>&gt;CounterService&lt;/<span class="type">class</span>-<span class="class">name</span>&gt;
   &lt;/service&gt;
&lt;/services&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CounterService</code> is declared within the <code>services</code> configuration element.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the <code>enabled</code> attribute to <code>true</code> to enable the service.</p>
</li>
<li>
<p>Set the <code>name</code> attribute to the name of the service. It should be a unique name (<code>CounterService</code> in our case) since it will be looked up when a remote call is made. Note that the value of this attribute will be sent at each request and a longer <code>name</code> value means more data (de)serialization. A good practice is to give an understandable name with the shortest possible length.</p>
</li>
<li>
<p>Set the <code>class-name</code> attribute to the class name of the service (<code>CounterService</code> in our case). The class should have a <strong>no-arg</strong> constructor. Otherwise, the object cannot be initialized.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that multicast is enabled as the join mechanism. In the later sections for the <code>CounterService</code> example, we will see why.</p>
</div>
</div>
<div class="sect3">
<h4 id="adding-properties-to-the-service"><a class="anchor" href="#adding-properties-to-the-service"></a><a class="link" href="#adding-properties-to-the-service">24.1.3. Adding Properties to the Service</a></h4>
<div class="paragraph">
<p>The <code>init</code> method for <code>CounterService</code> takes the <code>Properties</code> object as an argument. This means we can add properties to the service that are passed to the <code>init</code> method; see <a href="#creating-the-service-class">Creating the Service Class</a>. You can add properties declaratively as shown below. (You likely want to name your properties something other than someproperty.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;service enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
   &lt;name&gt;CounterService&lt;/name&gt;
   &lt;<span class="type">class</span>-<span class="class">name</span>&gt;CounterService&lt;/<span class="type">class</span>-<span class="class">name</span>&gt;
   &lt;properties&gt;
      &lt;someproperty&gt;<span class="integer">10</span>&lt;/someproperty&gt;
   &lt;/properties&gt;
&lt;/service&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to parse a more complex XML, you can use the interface <code>com.hazelcast.spi.ServiceConfigurationParser</code>. It gives you access to the XML DOM tree.</p>
</div>
</div>
<div class="sect3">
<h4 id="starting-the-service"><a class="anchor" href="#starting-the-service"></a><a class="link" href="#starting-the-service">24.1.4. Starting the Service</a></h4>
<div class="paragraph">
<p>Now, let&#8217;s start a <code>HazelcastInstance</code> as shown below, which will start the <code>CounterService</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Member</span> {

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        Hazelcast.newHazelcastInstance();

        Hazelcast.shutdownAll();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once it starts, the <code>CounterService init</code> method prints the following output.</p>
</div>
<div class="paragraph">
<p><code>CounterService.init</code></p>
</div>
<div class="paragraph">
<p>Once the HazelcastInstance is shutdown (for example, with Ctrl+C), the <code>CounterService shutdown</code> method prints the following output.</p>
</div>
<div class="paragraph">
<p><code>CounterService.shutdown</code></p>
</div>
</div>
<div class="sect3">
<h4 id="placing-a-remote-call-via-proxy"><a class="anchor" href="#placing-a-remote-call-via-proxy"></a><a class="link" href="#placing-a-remote-call-via-proxy">24.1.5. Placing a Remote Call via Proxy</a></h4>
<div class="paragraph">
<p>In the previous sections for the <code>CounterService</code> example, we started <code>CounterService</code> as part of a HazelcastInstance startup.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s connect the <code>Counter</code> interface to <code>CounterService</code> and perform a remote call to the cluster member hosting the counter data. Then, we will return a dummy result.</p>
</div>
<div class="paragraph">
<p>Remote calls are performed via a proxy in Hazelcast. Proxies expose the methods at the client side. Once a method is called, proxy creates an operation object, sends this object to the cluster member responsible from executing that operation and then sends the result.</p>
</div>
<div class="sect4">
<h5 id="making-counter-a-distributed-object"><a class="anchor" href="#making-counter-a-distributed-object"></a><a class="link" href="#making-counter-a-distributed-object">Making Counter a Distributed Object</a></h5>
<div class="paragraph">
<p>First, we need to make the <code>Counter</code> interface a distributed object by extending the <code>DistributedObject</code> interface, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Counter</span> <span class="directive">extends</span> DistributedObject {
    <span class="type">int</span> inc(<span class="type">int</span> amount);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="implementing-managedservice-and-remoteservice"><a class="anchor" href="#implementing-managedservice-and-remoteservice"></a><a class="link" href="#implementing-managedservice-and-remoteservice">Implementing ManagedService and RemoteService</a></h5>
<div class="paragraph">
<p>Now, we need to make the <code>CounterService</code> class implement not only the <code>ManagedService</code> interface, but also the interface <code>com.hazelcast.spi.RemoteService</code>. This way, a client will be able to get a handle of a counter proxy. You can check the source code for RemoteService the <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/spi/RemoteService.html">here</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in extending_hazelcast.adoc - include::{javasource}/extendinghazelcast/CounterService.java[tag=csr]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CounterProxy</code> returned by the method <code>createDistributedObject</code> is a local representation to (potentially) remote managed data and logic.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that caching and removing the proxy instance are done outside of this service.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="implementing-counterproxy"><a class="anchor" href="#implementing-counterproxy"></a><a class="link" href="#implementing-counterproxy">Implementing CounterProxy</a></h5>
<div class="paragraph">
<p>Now, it is time to implement the <code>CounterProxy</code> as shown below. <code>CounterProxy</code> extends <code>AbstractDistributedObject</code>, source code is <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/spi/AbstractDistributedObject.html">here</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in extending_hazelcast.adoc - include::{javasource}/extendinghazelcast/CounterProxy.java[tag=cp]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CounterProxy</code> is a local representation of remote data/functionality. It does not include the counter state. Therefore, the method <code>inc</code> should be invoked on the cluster member hosting the real counter. You can invoke it using Hazelcast SPI; then it will send the operations to the correct member and return the results.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s dig deeper into the method <code>inc</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, we create <code>IncOperation</code> with a given <code>name</code> and <code>amount</code>.</p>
</li>
<li>
<p>Then, we get the partition ID based on the <code>name</code>; by this way, all operations for a given name will result in the same partition ID.</p>
</li>
<li>
<p>Then, we create an <code>InvocationBuilder</code> where the connection between operation and partition is made.</p>
</li>
<li>
<p>Finally, we invoke the <code>InvocationBuilder</code> and wait for its result. This waiting is performed with a <code>future.get()</code>. In our case, timeout is not important. However, it is a good practice to use a timeout for a real system since operations should complete in a certain amount of time.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="dealing-with-exceptions"><a class="anchor" href="#dealing-with-exceptions"></a><a class="link" href="#dealing-with-exceptions">Dealing with Exceptions</a></h5>
<div class="paragraph">
<p>Hazelcast&#8217;s <code>ExceptionUtil</code> is a good solution when it comes to dealing with execution exceptions. When the execution of the operation fails with an exception, an <code>ExecutionException</code> is thrown and handled with the method <code>ExceptionUtil.rethrow(Throwable)</code>.</p>
</div>
<div class="paragraph">
<p>If it is an <code>InterruptedException</code>, we have two options: either propagate the exception or just use the <code>ExceptionUtil.rethrow</code> for all exceptions. Please see the example code below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> {
   <span class="directive">final</span> <span class="predefined-type">Future</span>&lt;<span class="predefined-type">Integer</span>&gt; future = invocation.invoke();
   <span class="keyword">return</span> future.get();
} <span class="keyword">catch</span>(<span class="exception">InterruptedException</span> e){
   <span class="keyword">throw</span> e;
} <span class="keyword">catch</span>(<span class="exception">Exception</span> e){
   <span class="keyword">throw</span> ExceptionUtil.rethrow(e);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="implementing-the-partitionawareoperation-interface"><a class="anchor" href="#implementing-the-partitionawareoperation-interface"></a><a class="link" href="#implementing-the-partitionawareoperation-interface">Implementing the PartitionAwareOperation Interface</a></h5>
<div class="paragraph">
<p>Now, let&#8217;s write the <code>IncOperation</code>. It implements the <code>PartitionAwareOperation</code> interface, meaning that it will be executed on the partition that hosts the counter. See the <code>PartitionAwareOperation</code> source code <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/spi/PartitionAwareOperation.html">here</a>.</p>
</div>
<div class="paragraph">
<p>The method <code>run</code> does the actual execution. Since <code>IncOperation</code> will return a response, the method <code>returnsResponse</code> returns <code>true</code>. If your method is asynchronous and does not need to return a response, it is better to return <code>false</code> since it will be faster. The actual response is stored in the field <code>returnValue</code>; retrieve it with the method <code>getResponse</code>.</p>
</div>
<div class="paragraph">
<p>There are two more methods in this code: <code>writeInternal</code> and <code>readInternal</code>. Since <code>IncOperation</code> needs to be serialized, these two methods are overridden, and hence, <code>objectId</code> and <code>amount</code> are serialized and available when those operations are executed.</p>
</div>
<div class="paragraph">
<p>For the deserialization, note that the operation must have a <strong>no-arg</strong> constructor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in extending_hazelcast.adoc - include::{javasource}/extendinghazelcast/IncOperation.java[tag=io]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running-the-code"><a class="anchor" href="#running-the-code"></a><a class="link" href="#running-the-code">Running the Code</a></h5>
<div class="paragraph">
<p>Now, let&#8217;s run our code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in extending_hazelcast.adoc - include::{javasource}/extendinghazelcast/MemberCS.java[tag=mcs]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once run, you will see the output as below.</p>
</div>
<div class="paragraph">
<p><code>Executing 0counter.inc() on: Address[192.168.1.103]:5702</code></p>
</div>
<div class="paragraph">
<p><code>0</code></p>
</div>
<div class="paragraph">
<p><code>Executing 1counter.inc() on: Address[192.168.1.103]:5702</code></p>
</div>
<div class="paragraph">
<p><code>0</code></p>
</div>
<div class="paragraph">
<p><code>Executing 2counter.inc() on: Address[192.168.1.103]:5701</code></p>
</div>
<div class="paragraph">
<p><code>0</code></p>
</div>
<div class="paragraph">
<p><code>Executing 3counter.inc() on: Address[192.168.1.103]:5701</code></p>
</div>
<div class="paragraph">
<p><code>0</code></p>
</div>
<div class="paragraph">
<p><code>Finished</code></p>
</div>
<div class="paragraph">
<p>Note that counters are stored in different cluster members. Also note that increment is not active for now since the value remains as <strong>0</strong>.</p>
</div>
<div class="paragraph">
<p>Until now, we have performed the basics to get this up and running. In the next section, we will make a real counter, cache the proxy instances and deal with proxy instance destruction.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-containers"><a class="anchor" href="#creating-containers"></a><a class="link" href="#creating-containers">24.1.6. Creating Containers</a></h4>
<div class="paragraph">
<p>Let&#8217;s create a Container for every partition in the system. This container will contain all counters and proxies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in extending_hazelcast.adoc - include::{javasource}/extendinghazelcast/<span class="predefined-type">Container</span>.java[tag=container]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hazelcast guarantees that a single thread will be active in a single partition. Therefore, when accessing a container, concurrency control will not be an issue.</p>
</div>
<div class="paragraph">
<p>The code in our example uses a <code>Container</code> instance per partition approach. With this approach, there will not be any mutable shared state between partitions. This approach also makes operations on partitions simpler since you do not need to filter out data that does not belong to a certain partition.</p>
</div>
<div class="paragraph">
<p>The code performs the tasks below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It creates a container for every partition with the method <code>init</code>.</p>
</li>
<li>
<p>It creates the proxy with the method <code>createDistributedObject</code>.</p>
</li>
<li>
<p>It removes the value of the object with the method <code>destroyDistributedObject</code>, otherwise we may get an OutOfMemory exception.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="integrating-the-container-in-the-counterservice"><a class="anchor" href="#integrating-the-container-in-the-counterservice"></a><a class="link" href="#integrating-the-container-in-the-counterservice">Integrating the Container in the CounterService</a></h5>
<div class="paragraph">
<p>Let&#8217;s integrate the <code>Container</code> in the <code>CounterService</code>, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CounterService</span> <span class="directive">implements</span> ManagedService, RemoteService {
    <span class="directive">public</span> <span class="directive">final</span> <span class="directive">static</span> <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">CounterService</span><span class="delimiter">&quot;</span></span>;
    <span class="predefined-type">Container</span><span class="type">[]</span> containers;
    <span class="directive">private</span> NodeEngine nodeEngine;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(NodeEngine nodeEngine, <span class="predefined-type">Properties</span> properties) {
        <span class="local-variable">this</span>.nodeEngine = nodeEngine;
        containers = <span class="keyword">new</span> <span class="predefined-type">Container</span>[nodeEngine.getPartitionService().getPartitionCount()];
        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="integer">0</span>; k &lt; containers.length; k++)
            containers[k] = <span class="keyword">new</span> <span class="predefined-type">Container</span>();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> shutdown(<span class="type">boolean</span> terminate) {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> CounterProxy createDistributedObject(<span class="predefined-type">String</span> objectName) {
        <span class="type">int</span> partitionId = nodeEngine.getPartitionService().getPartitionId(objectName);
        <span class="predefined-type">Container</span> container = containers[partitionId];
        container.init(objectName);
        <span class="keyword">return</span> <span class="keyword">new</span> CounterProxy(objectName, nodeEngine, <span class="local-variable">this</span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> destroyDistributedObject(<span class="predefined-type">String</span> objectName) {
        <span class="type">int</span> partitionId = nodeEngine.getPartitionService().getPartitionId(objectName);
        <span class="predefined-type">Container</span> container = containers[partitionId];
        container.destroy(objectName);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> reset() {
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">Container</span> {
        <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; values = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt;();

        <span class="directive">private</span> <span class="type">void</span> init(<span class="predefined-type">String</span> objectName) {
            values.put(objectName, <span class="integer">0</span>);
        }

        <span class="directive">private</span> <span class="type">void</span> destroy(<span class="predefined-type">String</span> objectName){
            values.remove(objectName);
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="connecting-the-incoperation-run-method-to-the-container"><a class="anchor" href="#connecting-the-incoperation-run-method-to-the-container"></a><a class="link" href="#connecting-the-incoperation-run-method-to-the-container">Connecting the IncOperation.run Method to the Container</a></h5>
<div class="paragraph">
<p>As the last step in creating a Container, we connect the method <code>IncOperation.run</code> to the Container, as shown below.</p>
</div>
<div class="paragraph">
<p><code>partitionId</code> has a range between <strong>0</strong> and <strong>partitionCount</strong> and can be used as an index for the container array. Therefore, you can use <code>partitionId</code> to retrieve the container and once the container has been retrieved, you can access the value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">IncOperation</span> <span class="directive">extends</span> <span class="predefined-type">Operation</span> <span class="directive">implements</span> PartitionAwareOperation {
    <span class="directive">private</span> <span class="predefined-type">String</span> objectId;
    <span class="directive">private</span> <span class="type">int</span> amount, returnValue;

    <span class="directive">public</span> IncOperation() {
    }

    <span class="directive">public</span> IncOperation(<span class="predefined-type">String</span> objectId, <span class="type">int</span> amount) {
        <span class="local-variable">this</span>.amount = amount;
        <span class="local-variable">this</span>.objectId = objectId;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing </span><span class="delimiter">&quot;</span></span> + objectId + <span class="string"><span class="delimiter">&quot;</span><span class="content">.inc() on: </span><span class="delimiter">&quot;</span></span> + getNodeEngine().getThisAddress());
        CounterService service = getService();
        CounterService.Container container = service.containers[getPartitionId()];
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; valuesMap = container.values;

        <span class="predefined-type">Integer</span> counter = valuesMap.get(objectId);
        counter += amount;
        valuesMap.put(objectId, counter);
        returnValue = counter;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> getResponse() {
        <span class="keyword">return</span> returnValue;
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> writeInternal(ObjectDataOutput out) <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="local-variable">super</span>.writeInternal(out);
        out.writeUTF(objectId);
        out.writeInt(amount);
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> readInternal(ObjectDataInput in) <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="local-variable">super</span>.readInternal(in);
        objectId = in.readUTF();
        amount = in.readInt();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running-the-sample-code"><a class="anchor" href="#running-the-sample-code"></a><a class="link" href="#running-the-sample-code">Running the Sample Code</a></h5>
<div class="paragraph">
<p>Let&#8217;s run the following sample code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Member</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        HazelcastInstance<span class="type">[]</span> instances = <span class="keyword">new</span> HazelcastInstance[<span class="integer">2</span>];
        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="integer">0</span>; k &lt; instances.length; k++)
            instances[k] = Hazelcast.newHazelcastInstance();

        Counter<span class="type">[]</span> counters = <span class="keyword">new</span> Counter[<span class="integer">4</span>];
        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="integer">0</span>; k &lt; counters.length; k++)
            counters[k] = instances[<span class="integer">0</span>].getDistributedObject(CounterService.NAME, k+<span class="string"><span class="delimiter">&quot;</span><span class="content">counter</span><span class="delimiter">&quot;</span></span>);

        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Round 1</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> (Counter counter: counters)
            <span class="predefined-type">System</span>.out.println(counter.inc(<span class="integer">1</span>));

        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Round 2</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">for</span> (Counter counter: counters)
            <span class="predefined-type">System</span>.out.println(counter.inc(<span class="integer">1</span>));

        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Finished</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">System</span>.exit(<span class="integer">0</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will be as follows. It indicates that we have now a basic distributed counter up and running.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Round <span class="integer">1</span>
Executing <span class="integer">0</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5702</span>
<span class="integer">1</span>
Executing <span class="integer">1</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5702</span>
<span class="integer">1</span>
Executing <span class="integer">2</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5701</span>
<span class="integer">1</span>
Executing <span class="integer">3</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5701</span>
<span class="integer">1</span>
Round <span class="integer">2</span>
Executing <span class="integer">0</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5702</span>
<span class="integer">2</span>
Executing <span class="integer">1</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5702</span>
<span class="integer">2</span>
Executing <span class="integer">2</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5701</span>
<span class="integer">2</span>
Executing <span class="integer">3</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5701</span>
<span class="integer">2</span>
Finished</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="partition-migration"><a class="anchor" href="#partition-migration"></a><a class="link" href="#partition-migration">24.1.7. Partition Migration</a></h4>
<div class="paragraph">
<p>In the previous section, we created a real distributed counter. Now, we need to make sure that the content of the partition containers is migrated to different cluster members when a member joins or leaves the cluster. To make this happen, first we need to add three new methods (<code>applyMigrationData</code>, <code>toMigrationData</code> and <code>clear</code>) to the <code>Container</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>toMigrationData</code>: This method is called when Hazelcast wants to start the partition migration from the member owning the partition. The result of the <code>toMigrationData</code> method is the partition data in a form that can be serialized to another member.</p>
</li>
<li>
<p><code>applyMigrationData</code>: This method is called when <code>migrationData</code> (created by the method <code>toMigrationData</code>) will be applied to the member that will be the new partition owner.</p>
</li>
<li>
<p><code>clear</code>: This method is called when the partition migration is successfully completed and the old partition owner gets rid of all data in the partition. This method is also called when the partition migration operation fails and the to-be-the-new partition owner needs to roll back its changes.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Container</span> {
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; values = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>();

    <span class="type">int</span> inc(<span class="predefined-type">String</span> id, <span class="type">int</span> amount) {
        <span class="predefined-type">Integer</span> counter = values.get(id);
        <span class="keyword">if</span> (counter == <span class="predefined-constant">null</span>) {
            counter = <span class="integer">0</span>;
        }
        counter += amount;
        values.put(id, counter);
        <span class="keyword">return</span> counter;
    }

    <span class="type">void</span> clear() {
        values.clear();
    }

    <span class="type">void</span> applyMigrationData(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; migrationData) {
        values.putAll(migrationData);
    }

    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; toMigrationData() {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">HashMap</span>(values);
    }

    <span class="directive">public</span> <span class="type">void</span> init(<span class="predefined-type">String</span> objectName) {
        values.put(objectName,<span class="integer">0</span>);
    }

    <span class="directive">public</span> <span class="type">void</span> destroy(<span class="predefined-type">String</span> objectName) {
        values.remove(objectName);
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="transferring-migrationdata"><a class="anchor" href="#transferring-migrationdata"></a><a class="link" href="#transferring-migrationdata">Transferring migrationData</a></h5>
<div class="paragraph">
<p>After you add these three methods to the <code>Container</code>, you need to create a <code>CounterMigrationOperation</code> class that transfers <code>migrationData</code> from one member to another and calls the method <code>applyMigrationData</code> on the correct partition of the new partition owner.</p>
</div>
<div class="paragraph">
<p>An example is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CounterMigrationOperation</span> <span class="directive">extends</span> <span class="predefined-type">Operation</span> {

    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; migrationData;

    <span class="directive">public</span> CounterMigrationOperation() {
    }

    <span class="directive">public</span> CounterMigrationOperation(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; migrationData) {
        <span class="local-variable">this</span>.migrationData = migrationData;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> run() <span class="directive">throws</span> <span class="exception">Exception</span> {
        CounterService service = getService();
        <span class="predefined-type">Container</span> container = service.containers[getPartitionId()];
        container.applyMigrationData(migrationData);
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> writeInternal(ObjectDataOutput out) <span class="directive">throws</span> <span class="exception">IOException</span> {
        out.writeInt(migrationData.size());
        <span class="keyword">for</span> (<span class="predefined-type">Map</span>.Entry&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; entry : migrationData.entrySet()) {
            out.writeUTF(entry.getKey());
            out.writeInt(entry.getValue());
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> readInternal(ObjectDataInput in) <span class="directive">throws</span> <span class="exception">IOException</span> {
        <span class="type">int</span> size = in.readInt();
        migrationData = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt;();
        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; size; i++)
            migrationData.put(in.readUTF(), in.readInt());
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
During a partition migration, no other operations are executed on the related partition.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="letting-hazelcast-know-counterservice-can-do-partition-migrations"><a class="anchor" href="#letting-hazelcast-know-counterservice-can-do-partition-migrations"></a><a class="link" href="#letting-hazelcast-know-counterservice-can-do-partition-migrations">Letting Hazelcast Know CounterService Can Do Partition Migrations</a></h5>
<div class="paragraph">
<p>We need to make our <code>CounterService</code> class implement the <code>MigrationAwareService</code> interface. This will let Hazelcast know that the <code>CounterService</code> can perform partition migration.</p>
</div>
<div class="paragraph">
<p>With the <code>MigrationAwareService</code> interface, some additional methods are exposed. For example, the method <code>prepareMigrationOperation</code> returns all the data of the partition that is going to be moved. You can check the <code>MigrationAwareService</code> source code <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/spi/MigrationAwareService.html">here</a>.</p>
</div>
<div class="paragraph">
<p>The method <code>commitMigration</code> commits the data, meaning that in this case, it clears the partition container of the old owner.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CounterService</span> <span class="directive">implements</span> ManagedService, RemoteService, MigrationAwareService {
    <span class="directive">public</span> <span class="directive">final</span> <span class="directive">static</span> <span class="predefined-type">String</span> NAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">CounterService</span><span class="delimiter">&quot;</span></span>;
    <span class="predefined-type">Container</span><span class="type">[]</span> containers;
    <span class="directive">private</span> NodeEngine nodeEngine;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> init(NodeEngine nodeEngine, <span class="predefined-type">Properties</span> properties) {
        <span class="local-variable">this</span>.nodeEngine = nodeEngine;
        containers = <span class="keyword">new</span> <span class="predefined-type">Container</span>[nodeEngine.getPartitionService().getPartitionCount()];
        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="integer">0</span>; k &lt; containers.length; k++)
            containers[k] = <span class="keyword">new</span> <span class="predefined-type">Container</span>();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> shutdown(<span class="type">boolean</span> terminate) {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> DistributedObject createDistributedObject(<span class="predefined-type">String</span> objectName) {
        <span class="type">int</span> partitionId = nodeEngine.getPartitionService().getPartitionId(objectName);
        <span class="predefined-type">Container</span> container = containers[partitionId];
        container.init(objectName);
        <span class="keyword">return</span> <span class="keyword">new</span> CounterProxy(objectName, nodeEngine,<span class="local-variable">this</span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> destroyDistributedObject(<span class="predefined-type">String</span> objectName) {
        <span class="type">int</span> partitionId = nodeEngine.getPartitionService().getPartitionId(objectName);
        <span class="predefined-type">Container</span> container = containers[partitionId];
        container.destroy(objectName);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeMigration(PartitionMigrationEvent e) {
        <span class="comment">//no-op</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> clearPartitionReplica(<span class="type">int</span> partitionId) {
        <span class="predefined-type">Container</span> container = containers[partitionId];
        container.clear();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Operation</span> prepareReplicationOperation(PartitionReplicationEvent e) {
        <span class="keyword">if</span> (e.getReplicaIndex() &gt; <span class="integer">1</span>) {
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
        }
        <span class="predefined-type">Container</span> container = containers[e.getPartitionId()];
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; data = container.toMigrationData();
        <span class="keyword">return</span> data.isEmpty() ? <span class="predefined-constant">null</span> : <span class="keyword">new</span> CounterMigrationOperation(data);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> commitMigration(PartitionMigrationEvent e) {
        <span class="keyword">if</span> (e.getMigrationEndpoint() == MigrationEndpoint.SOURCE) {
            <span class="predefined-type">Container</span> c = containers[e.getPartitionId()];
            c.clear();
        }

        <span class="comment">//todo</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> rollbackMigration(PartitionMigrationEvent e) {
        <span class="keyword">if</span> (e.getMigrationEndpoint() == MigrationEndpoint.DESTINATION) {
            <span class="predefined-type">Container</span> c = containers[e.getPartitionId()];
            c.clear();
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> reset() {
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="running-the-sample-code-2"><a class="anchor" href="#running-the-sample-code-2"></a><a class="link" href="#running-the-sample-code-2">Running the Sample Code</a></h5>
<div class="paragraph">
<p>We can run the following code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Member</span> {
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
        HazelcastInstance<span class="type">[]</span> instances = <span class="keyword">new</span> HazelcastInstance[<span class="integer">3</span>];
        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="integer">0</span>; k &lt; instances.length; k++)
            instances[k] = Hazelcast.newHazelcastInstance();

        Counter<span class="type">[]</span> counters = <span class="keyword">new</span> Counter[<span class="integer">4</span>];
        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="integer">0</span>; k &lt; counters.length; k++)
            counters[k] = instances[<span class="integer">0</span>].getDistributedObject(CounterService.NAME, k + <span class="string"><span class="delimiter">&quot;</span><span class="content">counter</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">for</span> (Counter counter : counters)
            <span class="predefined-type">System</span>.out.println(counter.inc(<span class="integer">1</span>));

        <span class="predefined-type">Thread</span>.sleep(<span class="integer">10000</span>);

        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Creating new members</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="integer">0</span>; k &lt; <span class="integer">3</span>; k++) {
            Hazelcast.newHazelcastInstance();
        }

        <span class="predefined-type">Thread</span>.sleep(<span class="integer">10000</span>);

        <span class="keyword">for</span> (Counter counter : counters)
            <span class="predefined-type">System</span>.out.println(counter.inc(<span class="integer">1</span>));

        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Finished</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">System</span>.exit(<span class="integer">0</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And we get the following output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Executing <span class="integer">0</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5702</span>
Executing backup <span class="integer">0</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5703</span>
<span class="integer">1</span>
Executing <span class="integer">1</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5703</span>
Executing backup <span class="integer">1</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5701</span>
<span class="integer">1</span>
Executing <span class="integer">2</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5701</span>
Executing backup <span class="integer">2</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5703</span>
<span class="integer">1</span>
Executing <span class="integer">3</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5701</span>
Executing backup <span class="integer">3</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5703</span>
<span class="integer">1</span>
Creating <span class="keyword">new</span> members
Executing <span class="integer">0</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5705</span>
Executing backup <span class="integer">0</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5703</span>
<span class="integer">2</span>
Executing <span class="integer">1</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5703</span>
Executing backup <span class="integer">1</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5704</span>
<span class="integer">2</span>
Executing <span class="integer">2</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5705</span>
Executing backup <span class="integer">2</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5704</span>
<span class="integer">2</span>
Executing <span class="integer">3</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5704</span>
Executing backup <span class="integer">3</span>counter.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5705</span>
<span class="integer">2</span>
Finished</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that the counters have moved. <code>0counter</code> moved from <strong>192.168.1.103:5702</strong> to <strong>192.168.1.103:5705</strong> and it is incremented correctly. Our counters can now move around in the cluster. You will see the counters will be redistributed once you add or remove a cluster member.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-backups"><a class="anchor" href="#creating-backups"></a><a class="link" href="#creating-backups">24.1.8. Creating Backups</a></h4>
<div class="paragraph">
<p>Finally, we make sure that the counter data is available on another member when a member goes down. To do this, have the <code>IncOperation</code> class implement the <code>BackupAwareOperation</code> interface contained in the SPI package. See the following code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">IncOperation</span> <span class="directive">extends</span> <span class="predefined-type">Operation</span>
        <span class="directive">implements</span> PartitionAwareOperation, BackupAwareOperation {
   ...

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">int</span> getAsyncBackupCount() {
      <span class="keyword">return</span> <span class="integer">0</span>;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">int</span> getSyncBackupCount() {
      <span class="keyword">return</span> <span class="integer">1</span>;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">boolean</span> shouldBackup() {
      <span class="keyword">return</span> <span class="predefined-constant">true</span>;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">Operation</span> getBackupOperation() {
      <span class="keyword">return</span> <span class="keyword">new</span> IncBackupOperation(objectId, amount);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The methods <code>getAsyncBackupCount</code> and <code>getSyncBackupCount</code> specify the count for asynchronous and synchronous backups. Our sample has one synchronous backup and no asynchronous backups. In the above code, counts of the backups are hard-coded, but they can also be passed to <code>IncOperation</code> as parameters.</p>
</div>
<div class="paragraph">
<p>The method <code>shouldBackup</code> specifies whether our Operation needs a backup or not. For our sample, it returns <code>true</code>, meaning the Operation will always have a backup even if there are no changes. Of course, in real systems, we want to have backups if there is a change. For <code>IncOperation</code> for example, having a backup when <code>amount</code> is null would be a good practice.</p>
</div>
<div class="paragraph">
<p>The method <code>getBackupOperation</code> returns the operation (<code>IncBackupOperation</code>) that actually performs the backup creation; the backup itself is an operation and will run on the same infrastructure.</p>
</div>
<div class="paragraph">
<p>If a backup should be made and <code>getSyncBackupCount</code> returns <strong>3</strong>, then three <code>IncBackupOperation</code> instances are created and sent to the three machines containing the backup partition. If fewer machines are available, then backups need to be created. Hazelcast will just send a smaller number of operations.</p>
</div>
<div class="sect4">
<h5 id="performing-the-backup-with-incbackupoperation"><a class="anchor" href="#performing-the-backup-with-incbackupoperation"></a><a class="link" href="#performing-the-backup-with-incbackupoperation">Performing the Backup with IncBackupOperation</a></h5>
<div class="paragraph">
<p>Now, let&#8217;s have a look at the <code>IncBackupOperation</code>. It implements <code>BackupOperation</code>, you can see the source code for <code>BackupOperation</code>
<a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/spi/BackupOperation.html">here</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">IncBackupOperation</span>
        <span class="directive">extends</span> <span class="predefined-type">Operation</span> <span class="directive">implements</span> BackupOperation {
   <span class="directive">private</span> <span class="predefined-type">String</span> objectId;
   <span class="directive">private</span> <span class="type">int</span> amount;

   <span class="directive">public</span> IncBackupOperation() {
   }

   <span class="directive">public</span> IncBackupOperation(<span class="predefined-type">String</span> objectId, <span class="type">int</span> amount) {
      <span class="local-variable">this</span>.amount = amount;
      <span class="local-variable">this</span>.objectId = objectId;
   }

   <span class="annotation">@Override</span>
   <span class="directive">protected</span> <span class="type">void</span> writeInternal(ObjectDataOutput out) <span class="directive">throws</span> <span class="exception">IOException</span> {
      <span class="local-variable">super</span>.writeInternal(out);
      out.writeUTF(objectId);
      out.writeInt(amount);
   }

   <span class="annotation">@Override</span>
   <span class="directive">protected</span> <span class="type">void</span> readInternal(ObjectDataInput in) <span class="directive">throws</span> <span class="exception">IOException</span> {
      <span class="local-variable">super</span>.readInternal(in);
      objectId = in.readUTF();
      amount = in.readInt();
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> run() <span class="directive">throws</span> <span class="exception">Exception</span> {
      CounterService service = getService();
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing backup </span><span class="delimiter">&quot;</span></span> + objectId + <span class="string"><span class="delimiter">&quot;</span><span class="content">.inc() on: </span><span class="delimiter">&quot;</span></span>
        + getNodeEngine().getThisAddress());
      <span class="predefined-type">Container</span> c = service.containers[getPartitionId()];
      c.inc(objectId, amount);
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hazelcast will also make sure that a new IncOperation for that particular key will not be executed before the (synchronous) backup operation has completed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="running-the-sample-code-3"><a class="anchor" href="#running-the-sample-code-3"></a><a class="link" href="#running-the-sample-code-3">Running the Sample Code</a></h5>
<div class="paragraph">
<p>Let&#8217;s see the backup functionality in action with the following code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Member</span> {
   <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) <span class="directive">throws</span> <span class="exception">Exception</span> {
      HazelcastInstance<span class="type">[]</span> instances = <span class="keyword">new</span> HazelcastInstance[<span class="integer">2</span>];
      <span class="keyword">for</span> (<span class="type">int</span> k = <span class="integer">0</span>; k &lt; instances.length; k++)
         instances[k] = Hazelcast.newHazelcastInstance();

      Counter counter = instances[<span class="integer">0</span>].getDistributedObject(CounterService.NAME, <span class="string"><span class="delimiter">&quot;</span><span class="content">counter</span><span class="delimiter">&quot;</span></span>);
      counter.inc(<span class="integer">1</span>);
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Finished</span><span class="delimiter">&quot;</span></span>);
      <span class="predefined-type">System</span>.exit(<span class="integer">0</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once it is run, the following output will be seen.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Executing counter0.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5702</span>
Executing backup counter0.inc() on: Address[<span class="float">192.168</span><span class="float">.1</span><span class="float">.103</span>]:<span class="integer">5701</span>
Finished</code></pre>
</div>
</div>
<div class="paragraph">
<p>As it can be seen, both <code>IncOperation</code> and <code>IncBackupOperation</code> are executed. Notice that these operations have been executed on different cluster members to guarantee high availability.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="operationparker"><a class="anchor" href="#operationparker"></a><a class="link" href="#operationparker">24.2. OperationParker</a></h3>
<div class="paragraph">
<p><code>OperationParker</code> is an interface offered by SPI for the objects, such as Lock and Semaphore, to be used when a thread needs to wait for a lock to be released. You can see the <code>OperationParker</code> source code <a href="https://docs.hazelcast.org/docs/latest/javadoc/com/hazelcast/spi/impl/operationparker/OperationParker.html">here</a>.</p>
</div>
<div class="paragraph">
<p><code>OperationParker</code> keeps a list of waiters. For each notify operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it looks for a waiter,</p>
</li>
<li>
<p>it asks the waiter whether it wants to keep waiting,</p>
</li>
<li>
<p>if the waiter responds <strong>no</strong>, the service executes its registered operation (operation itself knows where to send a response),</p>
</li>
<li>
<p>it rinses and repeats until a waiter wants to keep waiting.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each waiter can sit on a wait-notify queue for, at most, its operation&#8217;s call timeout. For example, by default, each waiter can wait here for at most 1 minute. A continuous task scans expired/timed-out waiters and invalidates them with <code>CallTimeoutException</code>. Each waiter on the remote side should retry and keep waiting if it still wants to wait. This is a liveness check for remote waiters.</p>
</div>
<div class="paragraph">
<p>This way, it is possible to distinguish an unresponsive member and a long (~infinite) wait. On the caller side, if the waiting thread does not get a response for either a call timeout or for more than <strong>2 times the call-timeout</strong>, it will exit with <code>OperationTimeoutException</code>.</p>
</div>
<div class="paragraph">
<p>Note that this behavior breaks the fairness. Hazelcast does not support fairness for any of the data structures with blocking operations, such as Lock and Semaphore.</p>
</div>
</div>
<div class="sect2">
<h3 id="discovery-spi"><a class="anchor" href="#discovery-spi"></a><a class="link" href="#discovery-spi">24.3. Discovery SPI</a></h3>
<div class="paragraph">
<p>By default, Hazelcast is bundled with multiple ways to define and find other members in the same network. Commonly used, especially with development, is the Multicast discovery. This sends out a multicast request to a network segment and awaits other members to answer with their IP addresses. In addition, Hazelcast supports fixed IP addresses: <a href="https://jclouds.apache.org/reference/providers/">jclouds</a> or <a href="https://aws.amazon.com/de/ec2/">AWS (Amazon EC2)</a> based discoveries.</p>
</div>
<div class="paragraph">
<p>Since there is an ever growing number of public and private cloud environments, as well as numerous Service Discovery systems in the wild, Hazelcast provides cloud or service discovery vendors with the option to implement their own discovery strategy.</p>
</div>
<div class="paragraph">
<p>Over the course of this section, we will build a simple discovery strategy based on the <code>/etc/hosts</code> file.</p>
</div>
<div class="sect3">
<h4 id="discovery-spi-interfaces-and-classes"><a class="anchor" href="#discovery-spi-interfaces-and-classes"></a><a class="link" href="#discovery-spi-interfaces-and-classes">24.3.1. Discovery SPI Interfaces and Classes</a></h4>
<div class="paragraph">
<p>The Hazelcast Discovery SPI (Member Discovery Extensions) consists of multiple interfaces and abstract classes. In the following subsections, we will have a quick look at all of them and shortly introduce the idea and usage behind them. The example will follow in the next section, <a href="#discovery-strategy">Discovery Strategy</a>.</p>
</div>
<div class="sect4">
<h5 id="discoverystrategy-implement"><a class="anchor" href="#discoverystrategy-implement"></a><a class="link" href="#discoverystrategy-implement">DiscoveryStrategy: Implement</a></h5>
<div class="paragraph">
<p>The <code>com.hazelcast.spi.discovery.DiscoveryStrategy</code> interface is the main entry point for vendors to implement their corresponding member discovery strategies. Its main purpose is to return discovered members on request. The <code>com.hazelcast.spi.discovery.DiscoveryStrategy</code> interface also offers light lifecycle capabilities for setup and teardown logic (for example, opening or closing sockets or REST API clients).</p>
</div>
<div class="paragraph">
<p><code>DiscoveryStrategy`s can also do automatic registration / de-registration on service discovery systems if necessary. You can use the provided `DiscoveryNode</code> that is passed to the factory method to retrieve local addresses and ports, as well as metadata.</p>
</div>
</div>
<div class="sect4">
<h5 id="abstractdiscoverystrategy-abstract-class"><a class="anchor" href="#abstractdiscoverystrategy-abstract-class"></a><a class="link" href="#abstractdiscoverystrategy-abstract-class">AbstractDiscoveryStrategy: Abstract Class</a></h5>
<div class="paragraph">
<p>The <code>com.hazelcast.spi.discovery.AbstractDiscoveryStrategy</code> is a convenience abstract class meant to ease the implementation of strategies. It basically provides additional support for reading / resolving configuration properties and empty implementations of lifecycle methods if unnecessary.</p>
</div>
</div>
<div class="sect4">
<h5 id="discoverystrategyfactory-factory-contract"><a class="anchor" href="#discoverystrategyfactory-factory-contract"></a><a class="link" href="#discoverystrategyfactory-factory-contract">DiscoveryStrategyFactory: Factory Contract</a></h5>
<div class="paragraph">
<p>The <code>com.hazelcast.spi.discovery.DiscoveryStrategyFactory</code> interface describes the factory contract that creates a certain <code>DiscoveryStrategy</code>. <code>DiscoveryStrategyFactory</code> s are registered automatically at startup of a Hazelcast member or client whenever they are found in the classpath. For automatic discovery, factories need to announce themselves as SPI services using a resource file according to the <a href="https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html">Java Service Provider Interface</a>. The service registration file must be part of the JAR file, located under <code>META-INF/services/com.hazelcast.spi.discovery.DiscoveryStrategyFactory</code>, and consist of a line with the full canonical class name of the <code>DiscoveryStrategy</code> per provided strategy implementation.</p>
</div>
</div>
<div class="sect4">
<h5 id="discoverynode-describe-a-member"><a class="anchor" href="#discoverynode-describe-a-member"></a><a class="link" href="#discoverynode-describe-a-member">DiscoveryNode: Describe a Member</a></h5>
<div class="paragraph">
<p>The <code>com.hazelcast.spi.discovery.DiscoveryNode</code> abstract class describes a member in the Discovery SPI. It is used for multiple purposes, since it will be returned from strategies for discovered members. It is also passed to `DiscoveryStrategyFactory`s factory method to define the local member itself if created on a Hazelcast member; on Hazelcast clients, null will be passed.</p>
</div>
</div>
<div class="sect4">
<h5 id="simplediscoverynode-default-discoverynode"><a class="anchor" href="#simplediscoverynode-default-discoverynode"></a><a class="link" href="#simplediscoverynode-default-discoverynode">SimpleDiscoveryNode: Default DiscoveryNode</a></h5>
<div class="paragraph">
<p><code>com.hazelcast.spi.discovery.SimpleDiscoveryNode</code> is a default implementation of the <code>DiscoveryNode</code>. It is meant for convenience use of the Discovery SPI and can be returned from vendor implementations if no special needs are required.</p>
</div>
</div>
<div class="sect4">
<h5 id="nodefilter-filter-members"><a class="anchor" href="#nodefilter-filter-members"></a><a class="link" href="#nodefilter-filter-members">NodeFilter: Filter Members</a></h5>
<div class="paragraph">
<p>You can configure <code>com.hazelcast.spi.discovery.NodeFilter</code> before startup and you can implement logic to do additional filtering of members. This might be necessary if query languages for discovery strategies are not expressive enough to describe members or to overcome inefficiencies of strategy implementations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>DiscoveryStrategy</code> vendor does not need to take possibly configured filters into account as their use is transparent to the strategies.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="discoveryservice-support-in-integrator-systems"><a class="anchor" href="#discoveryservice-support-in-integrator-systems"></a><a class="link" href="#discoveryservice-support-in-integrator-systems">DiscoveryService: Support In Integrator Systems</a></h5>
<div class="paragraph">
<p>A <code>com.hazelcast.spi.discovery.integration.DiscoveryService</code> is part of the integration domain. <code>DiscoveryStrategy</code> vendors do not need to implement <code>DiscoveryService</code> because it is meant to support the Discovery SPI in situations where vendors integrate Hazelcast into their own systems or frameworks. Certain needs might be necessary as part of the classloading or <a href="https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html">Java Service Provider Interface</a> lookup.</p>
</div>
</div>
<div class="sect4">
<h5 id="discoveryserviceprovider-provide-a-discoveryservice"><a class="anchor" href="#discoveryserviceprovider-provide-a-discoveryservice"></a><a class="link" href="#discoveryserviceprovider-provide-a-discoveryservice">DiscoveryServiceProvider: Provide a DiscoveryService</a></h5>
<div class="paragraph">
<p>Use the <code>com.hazelcast.spi.discovery.integration.DiscoveryServiceProvider</code> to provide a <code>DiscoveryService</code> to the Hazelcast discovery subsystem. Configure the provider with the Hazelcast configuration API.</p>
</div>
</div>
<div class="sect4">
<h5 id="discoveryservicesettings-configure-discoveryservice"><a class="anchor" href="#discoveryservicesettings-configure-discoveryservice"></a><a class="link" href="#discoveryservicesettings-configure-discoveryservice">DiscoveryServiceSettings: Configure DiscoveryService</a></h5>
<div class="paragraph">
<p>A <code>com.hazelcast.spi.discovery.integration.DiscoveryServiceSettings</code> instance is passed to the <code>DiscoveryServiceProvider</code> at creation time to configure the <code>DiscoveryService</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="discoverymode-member-or-client"><a class="anchor" href="#discoverymode-member-or-client"></a><a class="link" href="#discoverymode-member-or-client">DiscoveryMode: Member or Client</a></h5>
<div class="paragraph">
<p>The <code>com.hazelcast.spi.discovery.integration.DiscoveryMode</code> enum tells if a created <code>DiscoveryService</code> is running on a Hazelcast member or client to change the behavior accordingly.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discovery-strategy"><a class="anchor" href="#discovery-strategy"></a><a class="link" href="#discovery-strategy">24.3.2. Discovery Strategy</a></h4>
<div class="paragraph">
<p>This subsection will walk through the implementation of a simple <code>DiscoveryStrategy</code> and their necessary setup.</p>
</div>
<div class="sect4">
<h5 id="discovery-strategy-example"><a class="anchor" href="#discovery-strategy-example"></a><a class="link" href="#discovery-strategy-example">Discovery Strategy Example</a></h5>
<div class="paragraph">
<p>The example strategy will use the local <code>/etc/hosts</code> (and on Windows it will use the equivalent to the \*nix hosts file named <code>%SystemRoot%\system32\drivers\etc\hosts</code>) to lookup IP addresses of different hosts. The strategy implementation expects hosts to be configured with hostname sub-groups under the same domain. So far to theory, let&#8217;s get into it.</p>
</div>
<div class="paragraph">
<p>The full example&#8217;s source code can be found in the <a href="https://github.com/hazelcast/hazelcast-code-samples">Hazelcast examples repository</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="configuring-site-domain"><a class="anchor" href="#configuring-site-domain"></a><a class="link" href="#configuring-site-domain">Configuring Site Domain</a></h5>
<div class="paragraph">
<p>As a first step we do some basic configuration setup. We want the user to be able to configure the site domain for the discovery inside the hosts file, therefore we define a configuration property called <code>site-domain</code>. The configuration is not optional: it must be configured before the creation of the <code>HazelcastInstance</code>, either via XML or the Hazelcast Config API.</p>
</div>
<div class="paragraph">
<p>It is recommended that you keep all defined properties in a separate configuration class as public constants (public final static) with sufficient documentation. This allows users to easily look up possible configuration values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in extending_hazelcast.adoc - include::{javasource}/extendinghazelcast/HostsDiscoveryConfiguration.java[tag=hdc]</code></pre>
</div>
</div>
<div class="paragraph">
<p>An additional <code>ValueValidator</code> could be passed to the definition to make sure the configured value looks like a domain or has a special format.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-discovery"><a class="anchor" href="#creating-discovery"></a><a class="link" href="#creating-discovery">Creating Discovery</a></h5>
<div class="paragraph">
<p>As the second step we create the very simple <code>DiscoveryStrategyFactory</code> implementation class. To keep things clear we are going to name the discovery strategy after its purpose: looking into the hosts file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in extending_hazelcast.adoc - include::{javasource}/extendinghazelcast/HostsDiscoveryStrategyFactory.java[tag=hdsf]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This factory now defines properties known to the discovery strategy implementation and provides a clean way to instantiate it. While creating the <code>HostsDiscoveryStrategy</code> we ignore the passed <code>DiscoveryNode</code> since this strategy will not support automatic registration of new nodes. In cases where the strategy does not support registration, the environment has to handle this in some provided way.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember that, when created on a Hazelcast client, the provided <code>DiscoveryNode</code> will be null, as there is no local member in existence.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, we register the <code>DiscoveryStrategyFactory</code> to make Hazelcast pick it up automatically at startup. As described earlier, this is done according to the <a href="https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html">Java Service Provider Interface</a> specification. The filename is the name of the interface itself. Therefore we create a new resource file called <code>com.hazelcast.spi.discovery.DiscoveryStrategyFactory</code> and place it under <code>META-INF/services</code>. The content is the full canonical class name of our factory implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">com.hazelcast.examples.spi.discovery.HostsDiscoveryStrategyFactory</code></pre>
</div>
</div>
<div class="paragraph">
<p>If our JAR file will contain multiple factories, each consecutive line can define another full canonical <code>DiscoveryStrategyFactory</code> implementation class name.</p>
</div>
</div>
<div class="sect4">
<h5 id="implementing-discovery-strategy"><a class="anchor" href="#implementing-discovery-strategy"></a><a class="link" href="#implementing-discovery-strategy">Implementing Discovery Strategy</a></h5>
<div class="paragraph">
<p>Now comes the interesting part. We are going to implement the discovery itself. The previous parts we did are normally pretty similar for all strategies aside from the configuration properties itself. However, implementing the discovery heavily depends on the way the strategy has to come up with IP addresses of other Hazelcast members.</p>
</div>
</div>
<div class="sect4">
<h5 id="extending-the-code-abstractdiscoverystrategy-code"><a class="anchor" href="#extending-the-code-abstractdiscoverystrategy-code"></a><a class="link" href="#extending-the-code-abstractdiscoverystrategy-code">Extending The <code>AbstractDiscoveryStrategy</code></a></h5>
<div class="paragraph">
<p>For ease of implementation, we will back our implementation by extending the <code>AbstractDiscoveryStrategy</code> and only implementing the absolute minimum ourselves.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in extending_hazelcast.adoc - include::{javasource}/extendinghazelcast/HostsDiscoveryStrategy.java[tag=hds]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="overriding-discovery-configuration"><a class="anchor" href="#overriding-discovery-configuration"></a><a class="link" href="#overriding-discovery-configuration">Overriding Discovery Configuration</a></h5>
<div class="paragraph">
<p>So far our implementation will retrieve the configuration property for the <code>site-domain</code>. Our implementation offers the option to override the value from the configuration (XML or Config API) right from the system environment or JVM properties. That can be useful when the <code>hazelcast.xml</code> defines a setup for an developer system (like <code>cluster.local</code>) and operations wants to override it for the real deployment. By providing a prefix (in this case <code>discovery.hosts</code>) we created an external property named <code>discovery.hosts.site-domain</code> which can be set as an environment variable or passed as a JVM property from the startup script.</p>
</div>
<div class="paragraph">
<p>The lookup priority is explained in the following list, priority is from top to bottom:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JVM properties (or <code>hazelcast.xml</code> &lt;properties/&gt; section)</p>
</li>
<li>
<p>System environment</p>
</li>
<li>
<p>Configuration properties</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="implementing-lookup"><a class="anchor" href="#implementing-lookup"></a><a class="link" href="#implementing-lookup">Implementing Lookup</a></h5>
<div class="paragraph">
<p>Since we now have the value for our property we can implement the actual lookup and mapping as already prepared in the <code>discoverNodes</code> method. The following part is very specific to this special discovery strategy, for completeness we&#8217;re showing it anyways.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> HOSTS_NIX = <span class="string"><span class="delimiter">&quot;</span><span class="content">/etc/hosts</span><span class="delimiter">&quot;</span></span>;
<span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> HOSTS_WINDOWS =
                   <span class="string"><span class="delimiter">&quot;</span><span class="content">%SystemRoot%</span><span class="char">\\</span><span class="content">system32</span><span class="char">\\</span><span class="content">drivers</span><span class="char">\\</span><span class="content">etc</span><span class="char">\\</span><span class="content">hosts</span><span class="delimiter">&quot;</span></span>;

<span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; filterHosts() {
    <span class="predefined-type">String</span> os = <span class="predefined-type">System</span>.getProperty( <span class="string"><span class="delimiter">&quot;</span><span class="content">os.name</span><span class="delimiter">&quot;</span></span> );

    <span class="predefined-type">String</span> hostsPath;
    <span class="keyword">if</span> ( os.contains( <span class="string"><span class="delimiter">&quot;</span><span class="content">Windows</span><span class="delimiter">&quot;</span></span> ) ) {
        hostsPath = HOSTS_WINDOWS;
    } <span class="keyword">else</span> {
    hostsPath = HOSTS_NIX;
    }

    <span class="predefined-type">File</span> hosts = <span class="keyword">new</span> <span class="predefined-type">File</span>( hostsPath );

    <span class="comment">// Read all lines</span>
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; lines = readLines( hosts );

    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; assignments = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;();
    <span class="keyword">for</span> ( <span class="predefined-type">String</span> line : lines ) {
        <span class="comment">// Example:</span>
        <span class="comment">// 192.168.0.1   host1.cluster.local</span>
        <span class="keyword">if</span> ( matchesDomain( line ) ) {
            assignments.add( line );
        }
    }
    <span class="keyword">return</span> assignments;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mapping-to-discoverynode-s"><a class="anchor" href="#mapping-to-discoverynode-s"></a><a class="link" href="#mapping-to-discoverynode-s">Mapping to `DiscoveryNode`s</a></h5>
<div class="paragraph">
<p>After we now collected the address assignments configured in the hosts file we can go to the final step and map those to the `DiscoveryNode`s to return them from our strategy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">Iterable</span>&lt;DiscoveryNode&gt; mapToDiscoveryNodes( <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; assignments ) {
  <span class="predefined-type">Collection</span>&lt;DiscoveryNode&gt; discoveredNodes = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;DiscoveryNode&gt;();

    <span class="keyword">for</span> ( <span class="predefined-type">String</span> assignment : assignments ) {
        <span class="predefined-type">String</span> address = sliceAddress( assignment );
        <span class="predefined-type">String</span> hostname = sliceHostname( assignment );

        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; attributes =
          <span class="predefined-type">Collections</span>.singletonMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">hostname</span><span class="delimiter">&quot;</span></span>, hostname );

        <span class="predefined-type">InetAddress</span> inetAddress = mapToInetAddress( address );
        Address addr = <span class="keyword">new</span> Address( inetAddress, NetworkConfig.DEFAULT_PORT );

        discoveredNodes.add( <span class="keyword">new</span> SimpleDiscoveryNode( addr, attributes ) );
    }
    <span class="keyword">return</span> discoveredNodes;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With that mapping we now have a full discovery, executed whenever Hazelcast asks for IPs. So why don&#8217;t we read them in once and cache them? The answer is simple, it might happen that members go down or come up over time. Since we expect the hosts file to be injected into the running container it also might change over time. We want to get the latest available members, therefore we read the file on request.</p>
</div>
</div>
<div class="sect4">
<h5 id="configuring-code-discoverystrategy-code"><a class="anchor" href="#configuring-code-discoverystrategy-code"></a><a class="link" href="#configuring-code-discoverystrategy-code">Configuring <code>DiscoveryStrategy</code></a></h5>
<div class="paragraph">
<p>To actually use the new <code>DiscoveryStrategy</code> implementation we need to configure it like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  &lt;!-- activate Discovery SPI --&gt;
  &lt;properties&gt;
    &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.discovery.enabled</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">true</span>&lt;/property&gt;
  &lt;/properties&gt;

  &lt;network&gt;
    &lt;join&gt;
      &lt;!-- deactivating other discoveries --&gt;
      &lt;multicast enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt;
      &lt;tcp-ip enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> /&gt;
      &lt;aws enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>/&gt;

      &lt;!-- activate our discovery strategy --&gt;
      &lt;discovery-strategies&gt;

        &lt;!-- <span class="type">class</span> <span class="class">equals</span> to the DiscoveryStrategy not the factory! --&gt;
        &lt;discovery-strategy enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
            <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.hazelcast.examples.spi.discovery.HostsDiscoveryStrategy</span><span class="delimiter">&quot;</span></span>&gt;

          &lt;<span class="class">properties</span>&gt;
            &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">site-domain</span><span class="delimiter">&quot;</span></span>&gt;cluster.local&lt;/property&gt;
          &lt;/properties&gt;
        &lt;/discovery-strategy&gt;
      &lt;/discovery-strategies&gt;
    &lt;/join&gt;
  &lt;/network&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To find out further details, please have a look at the Discovery SPI Javadoc.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="discoveryservice-framework-integration"><a class="anchor" href="#discoveryservice-framework-integration"></a><a class="link" href="#discoveryservice-framework-integration">24.3.3. DiscoveryService (Framework integration)</a></h4>
<div class="paragraph">
<p>Since the <code>DiscoveryStrategy</code> is meant for cloud vendors or implementors of service discovery systems, the <code>DiscoveryService</code> is meant for integrators. In this case, integrators means people integrating Hazelcast into their own systems or frameworks. In those situations, there are sometimes special requirements on how to lookup framework services like the discovery strategies or similar services. Integrators can extend or implement their own <code>DiscoveryService</code> and <code>DiscoveryServiceProvider</code> and inject it using the Hazelcast Config API (<code>com.hazelcast.config.DiscoveryConfig</code>) prior to instantiating the <code>HazelcastInstance</code>. In any case, integrators might have to remember that a <code>DiscoveryService</code> might have to change behavior based on the runtime environment (Hazelcast member or client) and then the <code>DiscoveryServiceSettings</code> should provide information about the started <code>HazelcastInstance</code>.</p>
</div>
<div class="paragraph">
<p>Since the implementation heavily depends on one&#8217;s needs, there is no reason to provide an example of how to implement your own <code>DiscoveryService</code>. However, Hazelcast provides a default implementation which can be a good example to get started. This default implementation is <code>com.hazelcast.spi.discovery.impl.DefaultDiscoveryService</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="config-properties-spi"><a class="anchor" href="#config-properties-spi"></a><a class="link" href="#config-properties-spi">24.4. Config Properties SPI</a></h3>
<div class="paragraph">
<p>The Config Properties SPI is an easy way that you can configure SPI plugins using a prebuilt system of automatic conversion and validation.</p>
</div>
<div class="sect3">
<h4 id="config-properties-spi-classes"><a class="anchor" href="#config-properties-spi-classes"></a><a class="link" href="#config-properties-spi-classes">24.4.1. Config Properties SPI Classes</a></h4>
<div class="paragraph">
<p>The Config Properties SPI consists of a small set of classes and provided implementations.</p>
</div>
<div class="sect4">
<h5 id="propertydefinition-define-a-single-property"><a class="anchor" href="#propertydefinition-define-a-single-property"></a><a class="link" href="#propertydefinition-define-a-single-property">PropertyDefinition: Define a Single Property</a></h5>
<div class="paragraph">
<p>The <code>com.hazelcast.config.properties.PropertyDefinition</code> interface defines a single property inside a given configuration. It consists of a key string and type (in form of a <code>com.hazelcast.core.TypeConverter</code>).</p>
</div>
<div class="paragraph">
<p>You can mark properties as optional and you can have an additional validation step to make sure the provided value matches certain rules (like port numbers must be between 0-65535 or similar).</p>
</div>
</div>
<div class="sect4">
<h5 id="simplepropertydefinition-basic-propertydefinition"><a class="anchor" href="#simplepropertydefinition-basic-propertydefinition"></a><a class="link" href="#simplepropertydefinition-basic-propertydefinition">SimplePropertyDefinition: Basic PropertyDefinition</a></h5>
<div class="paragraph">
<p>For convenience, the <code>com.hazelcast.config.properties.SimplePropertyDefinition</code> class is provided. This class is a basic implementation of the <code>PropertyDefinition</code> interface and should be enough for most situations. In case of additional needs, you are free to provide your own implementation of the <code>PropertyDefinition</code> interface.</p>
</div>
</div>
<div class="sect4">
<h5 id="propertytypeconverter-set-of-typeconverters"><a class="anchor" href="#propertytypeconverter-set-of-typeconverters"></a><a class="link" href="#propertytypeconverter-set-of-typeconverters">PropertyTypeConverter: Set of TypeConverters</a></h5>
<div class="paragraph">
<p>The <code>com.hazelcast.config.properties.PropertyTypeConverter</code> enum provides a preset of `TypeConverter`s. Provided are the most common basic types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>Short</p>
</li>
<li>
<p>Integer</p>
</li>
<li>
<p>Long</p>
</li>
<li>
<p>Float</p>
</li>
<li>
<p>Double</p>
</li>
<li>
<p>Boolean</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="valuevalidator-and-validationexception"><a class="anchor" href="#valuevalidator-and-validationexception"></a><a class="link" href="#valuevalidator-and-validationexception">ValueValidator and ValidationException</a></h5>
<div class="paragraph">
<p>The <code>com.hazelcast.config.properties.ValueValidator</code> interface implements additional value validation. The configured value will be validated before it is returned to the requester. If validation fails, a <code>com.hazelcast.config.properties.ValidationException</code> is thrown and the requester has to handle it or throw the exception further.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="config-properties-spi-example"><a class="anchor" href="#config-properties-spi-example"></a><a class="link" href="#config-properties-spi-example">24.4.2. Config Properties SPI Example</a></h4>
<div class="paragraph">
<p>This sub-section will show a quick example of how to setup, configure and use the Config Properties SPI.</p>
</div>
<div class="sect4">
<h5 id="defining-a-config-propertydefinition"><a class="anchor" href="#defining-a-config-propertydefinition"></a><a class="link" href="#defining-a-config-propertydefinition">Defining a Config PropertyDefinition</a></h5>
<div class="paragraph">
<p>Defining a property is as easy as giving it a name and a type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">PropertyDefinition property = <span class="keyword">new</span> SimplePropertyDefinition(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">my-key</span><span class="delimiter">&quot;</span></span>, PropertyTypeConverter.STRING
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>We defined a property named <code>my-key</code> with a type of a string. If none of the predefined `TypeConverter`s matches the need, users are free to provide their own implementation.</p>
</div>
</div>
<div class="sect4">
<h5 id="providing-a-value-in-xml"><a class="anchor" href="#providing-a-value-in-xml"></a><a class="link" href="#providing-a-value-in-xml">Providing a value in XML</a></h5>
<div class="paragraph">
<p>The above property is now configurable in two ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;!-- option <span class="integer">1</span> --&gt;
&lt;my-key&gt;value&lt;/my-key&gt;

&lt;!-- option <span class="integer">2</span> --&gt;
&lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">my-key</span><span class="delimiter">&quot;</span></span>&gt;value&lt;/property&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In any case, both options are useable interchangeably, however the later version is recommended by Hazelcast for schema applicability.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="retrieving-a-propertydefinition-value"><a class="anchor" href="#retrieving-a-propertydefinition-value"></a><a class="link" href="#retrieving-a-propertydefinition-value">Retrieving a PropertyDefinition Value</a></h5>
<div class="paragraph">
<p>To eventually retrieve a value, use the <code>PropertyDefinition</code> to get and convert the value automatically.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> &lt;T&gt; T getConfig( PropertyDefinition property,
                        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Comparable</span>&gt; properties ) {

  <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Comparable</span>&gt; properties = ...;
  TypeConverter typeConverter = property.typeConverter();

  <span class="predefined-type">Comparable</span> value = properties.get( property.key() );
  <span class="keyword">return</span> typeConverter.convert( value );
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hazelcast-plugins"><a class="anchor" href="#hazelcast-plugins"></a><a class="link" href="#hazelcast-plugins">25. Hazelcast Plugins</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the plugins using which you can extend Hazelcast IMDG&#8217;s functionalities.</p>
</div>
<div class="sect2">
<h3 id="cloud-discovery-plugins"><a class="anchor" href="#cloud-discovery-plugins"></a><a class="link" href="#cloud-discovery-plugins">25.1. Cloud Discovery Plugins</a></h3>
<div class="paragraph">
<p>Hazelcast provides the following plugins that allow Hazelcast cluster members to discover each other on the cloud platforms. Cloud discovery plugins are useful when you do not want to provide or you cannot provide the list of possible IP addresses on various cloud providers.</p>
</div>
<div class="sect3">
<h4 id="hazelcast-jclouds"><a class="anchor" href="#hazelcast-jclouds"></a><a class="link" href="#hazelcast-jclouds">25.1.1. Hazelcast jclouds</a></h4>
<div class="paragraph">
<p><a href="https://jclouds.apache.org/">Apache jclouds</a> is an open source multi-cloud library for the Java platform which lets you create applications that are portable across clouds and gives you the full control to use cloud-specific features. Hazelcast members and native clients support Apache jclouds for discovery.</p>
</div>
<div class="paragraph">
<p>You can configure your cluster to use jclouds discovery by adding <code>hazelcast-jclouds.jar</code> dependency to your project and enabling Hazelcast&#8217;s Discovery SPI. Since jclouds depends on various libraries, you also need to configure its dependencies using build automation tools like Maven. Note that you can also define multiple regions in your jclouds configuration; the members can find each other over a different region.</p>
</div>
<div class="paragraph">
<p>See Hazelcast jclouds plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-jclouds/blob/master/README.md">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-aws"><a class="anchor" href="#hazelcast-aws"></a><a class="link" href="#hazelcast-aws">25.1.2. Hazelcast AWS</a></h4>
<div class="paragraph">
<p><a href="https://aws.amazon.com/">AWS</a> is a comprehensive cloud computing platform provided by Amazon. Hazelcast supports discovering members within Amazon EC2 cloud using Hazelcast AWS cloud discovery plugin.</p>
</div>
<div class="paragraph">
<p>You can easily configure your cluster to use EC2 discovery by adding <code>hazelcast-aws.jar</code> dependency to your project and enabling Hazelcast&#8217;s Discovery SPI. This plugin does not depend on any other third party modules. Note that this plugin puts the zone information into the Hazelcast&#8217;s member attributes map during the discovery process; you can use its <code>ZONE_AWARE</code> configuration to create backups in other Availability Zones (AZ). Each zone will be accepted as one partition group. Note that, when using the ZONE_AWARE partition grouping, a Hazelcast cluster spanning multiple AZs should have an equal number of members in each AZ. Otherwise, it will result in uneven partition distribution among the members.</p>
</div>
<div class="paragraph">
<p>See Hazelcast AWS plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-aws/blob/master/README.md">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-gcp"><a class="anchor" href="#hazelcast-gcp"></a><a class="link" href="#hazelcast-gcp">25.1.3. Hazelcast GCP</a></h4>
<div class="paragraph">
<p>Hazelcast supports discovering members in the <a href="https://cloud.google.com/compute/">GCP Compute Engine</a> environment.</p>
</div>
<div class="paragraph">
<p>You can easily configure Hazelcast members discovery, WAN replication and Hazelcast clients to work seamlessly on the native GCP VM Instances. This plugin supports <code>ZONE_AWARE</code> configuration to create backups in separate zones to prevent data loss in the case of a zone outage. This plugin also supports discovering a Hazelcast cluster deployed on GCP by the Hazelcast client running outside of the GCP infrastructure.</p>
</div>
<div class="paragraph">
<p>See Hazelcast GCP plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-gcp/blob/master/README.md">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-azure"><a class="anchor" href="#hazelcast-azure"></a><a class="link" href="#hazelcast-azure">25.1.4. Hazelcast Azure</a></h4>
<div class="paragraph">
<p><a href="https://azure.microsoft.com/en-us/">Microsoft Azure</a> is a cloud computing service provided by Microsoft for managing applications through a global network of Microsoft-managed data centers. Hazelcast Azure plugin provides a discovery strategy for Hazelcast enabled applications running on Microsoft Azure. It provides all Hazelcast instances by returning VMs within your Azure resource group that are tagged with a specified value.</p>
</div>
<div class="paragraph">
<p>To use this plugin in your Java project, simply add the Azure dependency to your Maven or Gradle configurations and enable Hazelcast&#8217;s Discovery SPI. Then you will need to configure a couple of properties at both Hazelcast and Azure sides.</p>
</div>
<div class="paragraph">
<p>See Hazelcast Azure plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-azure/blob/master/README.md">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-consul"><a class="anchor" href="#hazelcast-consul"></a><a class="link" href="#hazelcast-consul">25.1.5. Hazelcast Consul</a></h4>
<div class="paragraph">
<p><a href="https://www.consul.io/">Consul</a> is a distributed service mesh to connect, secure and configure services across any public or private cloud platforms. This plugin provides a Consul based discovery strategy for Hazelcast clusters.</p>
</div>
<div class="paragraph">
<p>You can add the Consul dependency to your Maven or Gradle configurations and enable Hazelcast&#8217;s Discovery SPI to use this plugin. You can then start Consul in your network and set the Consul related properties in your Hazelcast configuration.</p>
</div>
<div class="paragraph">
<p>See Hazelcast Consul plugin&#8217;s <a href="https://github.com/bitsofinfo/hazelcast-consul-discovery-spi/blob/master/README.md">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-etcd"><a class="anchor" href="#hazelcast-etcd"></a><a class="link" href="#hazelcast-etcd">25.1.6. Hazelcast etcd</a></h4>
<div class="paragraph">
<p><a href="https://coreos.com/etcd/">etcd</a> is an open-source distributed key value store that provides shared configuration and service discovery for Container Linux clusters. This plugin enables the Hazelcast members to dynamically discover each other through etcd.</p>
</div>
<div class="paragraph">
<p>Add the etcd dependency to either your Maven or Gradle configurations and enable Hazelcast&#8217;s Discovery SPI. Then start etcd in your network and set the etcd related properties (such username, password and registrator) in your Hazelcast configuration.</p>
</div>
<div class="paragraph">
<p>See Hazelcast etcd plugin&#8217;s <a href="https://github.com/bitsofinfo/hazelcast-etcd-discovery-spi/blob/master/README.md">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-eureka"><a class="anchor" href="#hazelcast-eureka"></a><a class="link" href="#hazelcast-eureka">25.1.7. Hazelcast Eureka</a></h4>
<div class="paragraph">
<p><a href="https://github.com/Netflix/eureka/wiki">Eureka</a> is a REST based service that is primarily used in the AWS cloud to for load balancing and failover of middle-tier servers, and Hazelcast supports Eureka V1 discovery.</p>
</div>
<div class="paragraph">
<p>To use this plugin, add the <code>hazelcast-eureka-one.jar</code> dependency to your project and enable Hazelcast&#8217;s Discovery SPI. You will also need to specify the Eureka properties file.</p>
</div>
<div class="paragraph">
<p>See Hazelcast Eureka plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-eureka/blob/master/README.md">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-imdg-and-jet-for-pcf"><a class="anchor" href="#hazelcast-imdg-and-jet-for-pcf"></a><a class="link" href="#hazelcast-imdg-and-jet-for-pcf">25.1.8. Hazelcast IMDG and Jet for PCF</a></h4>
<div class="paragraph">
<p><a href="https://pivotal.io/platform">Pivotal Cloud Foundry</a>(PCF) is an open source cloud platform on which you can build, deploy, run and scale applications. You can deploy your Hazelcast IMDG Enterprise or Hazelcast Jet clusters on PCF using clickable tiles.</p>
</div>
<div class="paragraph">
<p>After you install and configure Hazelcast IMDG Enterprise or Hazelcast Jet for PCF, you can create services, and configure WAN replications, user code deployments and TLS.</p>
</div>
<div class="paragraph">
<p>See Hazelcast IMDG Enterprise for PCF <a href="https://docs.pivotal.io/partners/hazelcast/index.html">documentation</a> and Hazelcast Jet for PCF <a href="https://docs.pivotal.io/partners/hazelcast-jet/">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-openshift"><a class="anchor" href="#hazelcast-openshift"></a><a class="link" href="#hazelcast-openshift">25.1.9. Hazelcast OpenShift</a></h4>
<div class="paragraph">
<p><a href="https://www.openshift.com/">OpenShift</a> is an open source container application platform by Red Hat based on top of Docker containers and the Kubernetes container cluster manager for application development and deployment. Hazelcast can run inside OpenShift.</p>
</div>
<div class="paragraph">
<p>You can use Kubernetes for discovery of Hazelcast members. By using Hazelcast Docker images, templates and default configuration files, you can deploy Hazelcast IMDG, Hazelcast IMDG Enterprise and Management Center onto OpenShift.</p>
</div>
<div class="paragraph">
<p>See Hazelcast IMDG for OpenShift <a href="https://github.com/hazelcast/hazelcast-openshift">documentation</a> and Hazelcast Management Center for OpenShift <a href="https://github.com/hazelcast/management-center-openshift">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-heroku"><a class="anchor" href="#hazelcast-heroku"></a><a class="link" href="#hazelcast-heroku">25.1.10. Hazelcast Heroku</a></h4>
<div class="paragraph">
<p><a href="https://www.heroku.com/">Heroku</a> is a cloud platform as a service supporting several programming languages so that you can build, run and operate applications entirely in the cloud. This plugin offers a discovery strategy that looks for IP addresses of members by resolving service names against the Heroku DNS Discovery in Heroku Private Spaces.</p>
</div>
<div class="paragraph">
<p>You can use this plugin by adding the <code>hazelcast-heroku-dependency</code> to your Maven or Gradle configurations and enabling Hazelcast&#8217;s Discovery SPI. By default there is no configuration needed, but you can configure the service names or initial run delay for the merge after a Split-Brain.</p>
</div>
<div class="paragraph">
<p>See Hazelcast Heroku plugin&#8217;s <a href="https://github.com/jkutner/hazelcast-heroku-discovery">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-kubernetes"><a class="anchor" href="#hazelcast-kubernetes"></a><a class="link" href="#hazelcast-kubernetes">25.1.11. Hazelcast Kubernetes</a></h4>
<div class="paragraph">
<p><a href="https://github.com/kubernetes/kubernetes">Kubernetes</a> is an open source container orchestration system to automate deployment, scaling and management of containerized applications. This plugin looks up the IP addresses of Hazelcast members by resolving the requests against a Kubernetes Service Discovery system. It supports two different options of resolving against the discovery registry: a request to the REST API and DNS lookup against a given DNS service name.</p>
</div>
<div class="paragraph">
<p>To use this plugin, add the <code>hazelcast-kubernetes</code> dependency to your Maven or Gradle configurations and enable Hazelcast&#8217;s Discovery SPI. You will need to configure Hazelcast according to the option you want the plugin to use, i.e., REST API or DNS lookup.</p>
</div>
<div class="paragraph">
<p>See Hazelcast Kubernetes plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-kubernetes">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-zookeeper"><a class="anchor" href="#hazelcast-zookeeper"></a><a class="link" href="#hazelcast-zookeeper">25.1.12. Hazelcast Zookeeper</a></h4>
<div class="paragraph">
<p><a href="https://zookeeper.apache.org/">Zookeeper</a> by Apache is a centralized service to maintain configuration information, naming, and to provide distributed synchronization and group services. This plugin provides a service based discovery strategy for your Hazelcast applications by using Apache Curator to communicate with your Zookeeper server.</p>
</div>
<div class="paragraph">
<p>To use this plugin, add the Curator dependencies to your Maven or Gradle configurations and enable Hazelcast&#8217;s Discovery SPI. Thereafter, you will need to configure properties such as the URL of Zookeeper server and cluster ID.</p>
</div>
<div class="paragraph">
<p>See Hazelcast Zookeeper plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-zookeeper/blob/master/README.md">documentation</a> for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="integration-plugins"><a class="anchor" href="#integration-plugins"></a><a class="link" href="#integration-plugins">25.2. Integration Plugins</a></h3>
<div class="paragraph">
<p>Hazelcast provides the following integration plugins that allow Hazelcast to integrate with other frameworks and applications smoothly.</p>
</div>
<div class="sect3">
<h4 id="spring-data-hazelcast"><a class="anchor" href="#spring-data-hazelcast"></a><a class="link" href="#spring-data-hazelcast">25.2.1. Spring Data Hazelcast</a></h4>
<div class="paragraph">
<p><a href="http://projects.spring.io/spring-data/">Spring Data</a> provides a consistent, Spring-based programming model for data access while preserving the features of the underlying data store. This plugin provides Spring Data repository support for Hazelcast IMDG. This integration enables the Spring Data paradigm to gain the power of a distributed data repository.</p>
</div>
<div class="paragraph">
<p>To use this plugin, add the Spring Data dependency to your Maven or Gradle configurations and specify the base packages and repositories.</p>
</div>
<div class="paragraph">
<p>See Spring Data Hazelcast plugin&#8217;s <a href="https://github.com/hazelcast/spring-data-hazelcast">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="spring-integration-extension-for-hazelcast"><a class="anchor" href="#spring-integration-extension-for-hazelcast"></a><a class="link" href="#spring-integration-extension-for-hazelcast">25.2.2. Spring Integration Extension for Hazelcast</a></h4>
<div class="paragraph">
<p>This plugin provides <a href="https://github.com/spring-projects/spring-integration">Spring Integration</a> extensions for Hazelcast. These extensions are included but limited to the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Event-driven inbound channel adapter: Listens related Hazelcast data structure events and sends event messages to the defined channel.</p>
</li>
<li>
<p>Continuous query inbound channel adapter: Listens the modifications performed on specific map entries.</p>
</li>
<li>
<p>Cluster monitor inbound channel adapter:  Listen the modifications performed on the cluster.</p>
</li>
<li>
<p>Distributed SQL inbound channel adapter: Runs the defined distributed SQL and returns the results in the light of iteration type.</p>
</li>
<li>
<p>Outbound channel adapter: Listens the defined channel and writes the incoming messages to the related distributed data structure.</p>
</li>
<li>
<p>Leader election: Elects a cluster member, for example, for highly available message consumer where only one member should receive messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See Spring Integration Extension for Hazelcast <a href="https://github.com/spring-projects/spring-integration-extensions/tree/master/spring-integration-hazelcast">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-jca-resource-adapter"><a class="anchor" href="#hazelcast-jca-resource-adapter"></a><a class="link" href="#hazelcast-jca-resource-adapter">25.2.3. Hazelcast JCA Resource Adapter</a></h4>
<div class="paragraph">
<p>Hazelcast JCA Resource Adapter is a system-level software driver which can be used by a Java application to connect to an Hazelcast cluster. Using this adapter, you can integrate Hazelcast into Java EE containers. After a proper configuration, Hazelcast can participate in standard Java EE transactions.</p>
</div>
<div class="paragraph">
<p>Deploying and configuring the Hazelcast JCA Resource Adapter is not different than configuring any other resource adapters since it is a standard JCA one. However, resource adapter installation and configuration is container-specific, so you will need to consult with your Java EE vendor documentation for details.</p>
</div>
<div class="paragraph">
<p>See Hazelcast JCA Resource Adapter <a href="https://github.com/hazelcast/hazelcast-ra">documentation</a> for information on configuring the resource adapter, Glassfish applications and JBoss web applications.</p>
</div>
<div class="sect4">
<h5 id="integrating-with-mulesoft"><a class="anchor" href="#integrating-with-mulesoft"></a><a class="link" href="#integrating-with-mulesoft">Integrating with MuleSoft</a></h5>
<div class="paragraph">
<p>Hazelcast is embedded within a MuleSoft container as an out-of-the-box offering. For a proper integration you should edit the <code>mule-deploy.properties</code> file to have the following entry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">loader.override=com.hazelcast</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-grails"><a class="anchor" href="#hazelcast-grails"></a><a class="link" href="#hazelcast-grails">25.2.4. Hazelcast Grails</a></h4>
<div class="paragraph">
<p><a href="https://grails.org/">Grails</a> is an open source web application framework that uses the Apache Groovy programming language. This plugin integrates Hazelcast data distribution framework into your Grails application. You can reach the distributed data structures by injecting the <a href="https://github.com/hazelcast/hazelcast-grails/blob/master/grails-app/services/hazelgrails/HazelService.groovy">HazelService</a>. Also you can cache your domain class into Hazelcast distributed cache.</p>
</div>
<div class="paragraph">
<p>See Hazelcast Grails plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-grails">documentation</a> and <a href="https://blog.hazelcast.com/distribute-grails-with-hazelcast/">this blogpost</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-hibernate-2lc"><a class="anchor" href="#hazelcast-hibernate-2lc"></a><a class="link" href="#hazelcast-hibernate-2lc">25.2.5. Hazelcast Hibernate 2LC</a></h4>
<div class="paragraph">
<p><a href="http://hibernate.org/">Hibernate</a> is an object-relational mapping tool for the Java programming language. It provides a framework for mapping an object-oriented domain model to a relational database and enables developers to more easily write applications whose data outlives the application process. This plugin provides Hazelcast&#8217;s own distributed second level cache implementation for your Hibernate (versions 3, 4 and 5) entities, collections and queries.</p>
</div>
<div class="paragraph">
<p>To use this plugin, add the Hazelcast Hibernate dependency into your classpath depending on your Hibernate version. Then you will need to specify various properties in your Hibernate configuration such as the <code>RegionFactory</code> and query cache properties.</p>
</div>
<div class="paragraph">
<p>See the documentation of this plugin for <a href="https://github.com/hazelcast/hazelcast-hibernate/blob/master/README.md">Hibernate 3.x, 4.x</a> and for <a href="https://github.com/hazelcast/hazelcast-hibernate5/blob/master/README.md">Hibernate 5.x</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-dynacache"><a class="anchor" href="#hazelcast-dynacache"></a><a class="link" href="#hazelcast-dynacache">25.2.6. Hazelcast DynaCache</a></h4>
<div class="paragraph">
<p><a href="https://www.ibm.com/support/knowledgecenter/en/linuxonibm/liaag/cache/pubwasdynacachoverview.htm">DynaCache</a> by IBM is used to store objects, and later, based on some data matching rules, to retrieve those objects and serve them from its cache.  This plugin is for Liberty Profile which is a lightweight profile of IBM WebSphere Application Server.</p>
</div>
<div class="paragraph">
<p>In the Liberty Profile, you can use a dynamic cache engine in order to cache your data. With this plugin, you can use Hazelcast as a cache provider.</p>
</div>
<div class="paragraph">
<p>See Hazelcast DynaCache plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-dynacache/blob/master/README.md">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="hazelcast-connector-for-kafka"><a class="anchor" href="#hazelcast-connector-for-kafka"></a><a class="link" href="#hazelcast-connector-for-kafka">25.2.7. Hazelcast Connector for Kafka</a></h4>
<div class="paragraph">
<p>This plugin allows you to write events from <a href="https://kafka.apache.org/">Kafka</a> to HazelCast. It takes the value from the Kafka Connect SinkRecords and inserts/updates an entry in Hazelcast. It supports writing to Hazelcast distributed data structures including Reliable Topic, Ringbuffer, Queue, Set, List, Map, MultiMap and ICache (Hazelcast&#8217;s JCache extension).</p>
</div>
<div class="paragraph">
<p>See the plugin&#8217;s <a href="https://lenses.stream/connectors/sink/hazelcast.html">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="openfire"><a class="anchor" href="#openfire"></a><a class="link" href="#openfire">25.2.8. Openfire</a></h4>
<div class="paragraph">
<p><a href="https://www.igniterealtime.org/projects/openfire/">Openfire</a> is an open source real time collaboration server. It uses XMPP which is an open protocol for instant messaging.  This plugin adds support for running multiple redundant Openfire servers together in a cluster.</p>
</div>
<div class="paragraph">
<p>By running Openfire as a cluster, you can distribute the connection load among several servers, while also providing failover in the event of failures.</p>
</div>
<div class="paragraph">
<p>See the plugin&#8217;s <a href="https://www.igniterealtime.org/projects/openfire/plugins/hazelcast/readme.html">documentation</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="subzero"><a class="anchor" href="#subzero"></a><a class="link" href="#subzero">25.2.9. SubZero</a></h4>
<div class="paragraph">
<p><a href="https://github.com/EsotericSoftware/kryo">Kryo</a> is a popular serialization library. It is fast, easy to use, and it does not pollute your domain model. It can even serialize classes which are not marked as Serializable.</p>
</div>
<div class="paragraph">
<p>Hazelcast has no out-of-the box support for Kryo. Although it is rather easy to integrate it, everyone has to write the same code and face the same bugs. This plugin, SubZero, simplifies the integration of Hazelcast and Kryo. Simply add SubZero dependency to your Maven or Gradle configurations, and add the SubZero plugin as a global serializer (if you want to use it for all classes in your project) or as a serializer (to have the option of selecting the classes in your project).</p>
</div>
<div class="paragraph">
<p>See the plugin&#8217;s <a href="https://github.com/jerrinot/subzero/blob/master/README.md">documentation</a> for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="web-sessions-clustering-plugins"><a class="anchor" href="#web-sessions-clustering-plugins"></a><a class="link" href="#web-sessions-clustering-plugins">25.3. Web Sessions Clustering Plugins</a></h3>
<div class="paragraph">
<p>Hazelcast offers the following plugins to allow you cluster your web sessions using Servlet Filter, Tomcat and Jetty based solutions.</p>
</div>
<div class="sect3">
<h4 id="filter-based-web-session-replication"><a class="anchor" href="#filter-based-web-session-replication"></a><a class="link" href="#filter-based-web-session-replication">25.3.1. Filter Based Web Session Replication</a></h4>
<div class="paragraph">
<p>This plugin (a.k.a. Generic Web Session Replication) provides HTTP session replication capabilities across a Hazelcast cluster in order to handle failover cases. Assuming you have multiple web servers with load balancers; if one server goes down, your users on that server will be directed to one of the other live servers, but their sessions will be lost. Using this plugin backs up these HTTP sessions; it clusters them automatically. To use it, put the <code>hazelcast-wm</code> JAR file into your <code>WEB-INF/lib</code> folder and configure your <code>web.xml</code> file according to your needs.</p>
</div>
<div class="paragraph">
<p>See the plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-wm/blob/master/README.md">documentation</a> for information on configuring and using it.</p>
</div>
<div class="paragraph">
<p>You can also see the <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/hazelcast-integration/filter-based-session-replication">sample application</a> which uses filter based web session replication.</p>
</div>
<div class="paragraph">
<p>Note that filter based web session replication has the option to use a map with High-Density Memory Store, is available in <strong class="navy">Hazelcast IMDG Enterprise HD</strong>, to keep your session objects. Please refer to the <a href="#high-density-memory-store">High-Density Memory Store section</a> for details on this feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="tomcat-based-web-session-replication"><a class="anchor" href="#tomcat-based-web-session-replication"></a><a class="link" href="#tomcat-based-web-session-replication">25.3.2. Tomcat Based Web Session Replication</a></h4>
<div class="paragraph">
<p>Tomcat based web session replication is offered through Hazelcast Tomcat Session Manager. It is a container specific module that enables session replication for JEE Web Applications without requiring changes to the application.</p>
</div>
<div class="paragraph">
<p>See the plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-tomcat-sessionmanager/blob/master/README.md">documentation</a> for information on configuring and using it.</p>
</div>
<div class="paragraph">
<p>You can also see the <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/hazelcast-integration/manager-based-session-replication">sample application</a> which uses Tomcat based web session replication.</p>
</div>
</div>
<div class="sect3">
<h4 id="jetty-based-web-session-replication"><a class="anchor" href="#jetty-based-web-session-replication"></a><a class="link" href="#jetty-based-web-session-replication">25.3.3. Jetty Based Web Session Replication</a></h4>
<div class="paragraph">
<p>Jetty based web session replication is offered through Hazelcast Jetty Session Manager. It is a container specific module that enables session replication for JEE Web Applications without requiring changes to the application.</p>
</div>
<div class="paragraph">
<p>See the plugin&#8217;s <a href="https://github.com/hazelcast/hazelcast-jetty-sessionmanager">documentation</a> for information on configuring and using it.</p>
</div>
<div class="paragraph">
<p>You can also see the <a href="https://github.com/hazelcast/hazelcast-code-samples/tree/master/hazelcast-integration/manager-based-session-replication">sample application</a> which uses Jetty based web session replication.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="big-data-plugins"><a class="anchor" href="#big-data-plugins"></a><a class="link" href="#big-data-plugins">25.4. Big Data Plugins</a></h3>
<div class="paragraph">
<p>Hazelcast offers integrations with <a href="https://spark.apache.org/">Apache Spark</a> and <a href="https://mesos.apache.org/">Apache Mesos</a>.</p>
</div>
<div class="paragraph">
<p>Apache Spark is an open source cluster-computing platform which has become one of the key big data distributed processing frameworks. There is a Spark connector for Hazelcast which allows your Spark applications to connect to a Hazelcast cluster with the Spark RDD API. See this integration&#8217;s <a href="https://github.com/hazelcast/hazelcast-spark/blob/master/README.md">documentation</a> for information on  configuring and using it.</p>
</div>
<div class="paragraph">
<p>Apache Mesos is an open source cluster manager that handles workloads efficiently in a distributed environment through dynamic resource sharing and isolation; you can run any distributed application that requires clustered resources. It is widely used to manage big data infrastructures. Hazelcast Mesos integration gives you the ability to deploy Hazelcast on the Mesos cluster. See this integration&#8217;s <a href="https://github.com/hazelcast/hazelcast-mesos/blob/master/README.md">documentation</a> for information on configuring and using it.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="consistency-and-replication-model"><a class="anchor" href="#consistency-and-replication-model"></a><a class="link" href="#consistency-and-replication-model">26. Consistency and Replication Model</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="a-brief-overview-of-consistency-and-replication-in-distributed-systems"><a class="anchor" href="#a-brief-overview-of-consistency-and-replication-in-distributed-systems"></a><a class="link" href="#a-brief-overview-of-consistency-and-replication-in-distributed-systems">26.1. A Brief Overview of Consistency and Replication in Distributed Systems</a></h3>
<div class="paragraph">
<p>Partitioning and replication are the two common techniques used together in distributed databases to achieve scalable, available and transparent data distribution. The data space is divided into partitions, each of which contains a distinct portion of the overall data set. For these partitions, multiple copies called replicas are created. Partition replicas are distributed among the cluster members. Each member is assigned to at most a single replica for a partition. In this setting, different replication techniques can be used to access the data and keep the replicas in sync on updates. The technique being used directly affects the guarantees and properties a distributed data store provides, due to the CAP (<strong>C</strong>onsistency, <strong>A</strong>vailability and <strong>P</strong>artition Tolerance) principle.</p>
</div>
<div class="paragraph">
<p>One aspect of replication techniques is about where a replicated data set is accessed and updated. For instance, primary-copy systems first elect a replica, which can be called as primary, master, etc., and use that replica to access the data. Changes in the data on the primary replica are propagated to other replicas. This approach has different namings, such as <em>primary-copy</em>, <em>single-master</em>, <em>passive replication</em>. The primary-copy technique is a powerful model as it prevents conflicts, deadlocks among the replicas. However, primary replicas can become bottlenecks. On the other hand, we can have a different technique by eliminating the primary-copy and treating each replica as equal. These systems can achieve a higher level of availability as a data entry can be accessed and updated using any replica. However, it can become more difficult to keep the replicas in sync with each other.</p>
</div>
<div class="paragraph">
<p>Replication techniques also differ in how updates are propagated among replicas.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One option is to update each replica as part of a single atomic transaction, called as <em>eager replication</em> or <em>synchronous replication</em>. Consensus algorithms apply this approach to achieve strong consistency on a replicated data set. The main drawback is the amount of coordination and communication required while running the replication algorithm. CP systems implement consensus algorithms under the hood.</p>
</li>
<li>
<p>Another option is the <em>lazy replication</em> technique, which is also called as <em>asynchronous replication</em>. Lazy replication algorithms execute updates on replicas with separate transactions. They generally work with best-effort. By this way, the amount of coordination among the replicas are degraded and data can be accessed in a more performant manner. Yet, it can happen that a particular update is executed on some replicas but not on others, which will lead replicas to diverge. Such problems can be resolved with different approaches, such as <em>read-repair</em>, <em>write-repair</em>, <em>anti-entropy</em>. Lazy replication techniques are popular among AP systems.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hazelcast-s-replication-algorithm"><a class="anchor" href="#hazelcast-s-replication-algorithm"></a><a class="link" href="#hazelcast-s-replication-algorithm">26.2. Hazelcast&#8217;s Replication Algorithm</a></h3>
<div class="paragraph">
<p>The discussion here generally applies to any system that maintains multiple copies of a data set. It applies to Hazelcast as well. In the context of CAP principle, <strong>Hazelcast is an AP product</strong>, which employs the combination of primary-copy and lazy replication techniques. As briefly described in the <a href="#data-partitioning">Data Partitioning section</a>, each data entry is mapped to a single Hazelcast partition and put into replicas of that partition. One of the replicas is elected as the primary replica, which is responsible for performing operations on that partition. When you read or write a map entry, you transparently talk to the Hazelcast member to which primary replica of the corresponding partition is assigned. By this way, each request hits the most up-to-date version of a particular data entry in a stable cluster. Backup replicas stay in standby mode until the primary replica fails. Upon failure of the primary replica, one of the backup replicas are promoted to the primary role.</p>
</div>
<div class="paragraph">
<p>With <em>lazy replication</em>, when the primary replica receives an update operation for a key, it executes the update locally and propagates it to backup replicas. It marks each update with a logical timestamp so that backups apply them in the correct order and converge to the same state with the primary. Backup replicas can be used to scale reads (see the <a href="#enabling-backup-reads">Enabling Backup Reads section</a>) with no strong consistency but monotonic reads guarantee.</p>
</div>
<div class="paragraph">
<p>Hazelcast offers features such as <em>Quorum</em>, <em>ILock</em>, <em>AtomicLong</em>, etc. In the journey of being a highly elastic, dynamic and easy to use product, Hazelcast tries to provide best-effort consistency guarantees without being a complete CP solution. Therefore, we recommend these features to be used for efficiency purposes in general, instead of correctness. For instance, they can be used to prevent to run a resource-extensive computation multiple times, which would not create any correctness problem if runs more than once. Please refer to <a href="#best-effort-consistency">Best-Effort Consistency</a> and <a href="#split-brain-syndrome">Network Partitioning</a> sections for more information.</p>
</div>
<div class="sect3">
<h4 id="best-effort-consistency"><a class="anchor" href="#best-effort-consistency"></a><a class="link" href="#best-effort-consistency">26.2.1. Best-Effort Consistency</a></h4>
<div class="paragraph">
<p>Hazelcast&#8217;s replication technique enables Hazelcast clusters to offer high throughput. However, due to temporary situations in the system, such as network interruption, backup replicas can miss some updates and diverge from the primary. Backup replicas can also hit VM or long GC pauses, and fall behind the primary, which is a situation called as <em>replication lag</em>. If a Hazelcast partition primary replica member crashes while there is a replication lag between itself and the backups, strong consistency of the data can be lost.</p>
</div>
<div class="paragraph">
<p>Please note that CP systems can have similar problems as well. However, in a CP system, once a replica performs an update locally (i.e., <em>commits</em> the update), the underlying consensus algorithm guarantees durability of the update for the rest of the execution.</p>
</div>
<div class="paragraph">
<p>On the other hand, in AP systems like Hazelcast, a replica can perform an update locally, even if the update is not to be performed on other replicas. This is a fair trade-off to reduce amount of coordination among replicas and maintain high throughput &amp; high availability of the system. These systems employ additional measurements to maintain consistency in a best-effort manner. In this regard, Hazelcast tries to minimize effect of such scenarios using an active anti-entropy solution as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each Hazelcast member runs a periodic task in the background.</p>
</li>
<li>
<p>For each primary replica it is assigned, it creates a summary information and sends it to the backups.</p>
</li>
<li>
<p>Then, each backup member compares the summary information with its own data to see if it is up-to-date with the primary.</p>
</li>
<li>
<p>If a backup member detects a missing update, it triggers the synchronization process with the primary.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="invocation-lifecycle"><a class="anchor" href="#invocation-lifecycle"></a><a class="link" href="#invocation-lifecycle">26.3. Invocation Lifecycle</a></h3>
<div class="paragraph">
<p>When a write is requested with the methods, such as <code>map.put()</code> or <code>queue.offer()</code>, a write operation is submitted to the Hazelcast member that owns the primary replica of the specific partition. Partition of an operation is determined based on a parameter (key of an entry or name of the data structure, etc.) related to that operation depending on the data structure. Target Hazelcast member is figured out by looking up a local partition assignment/ownership table, which is updated on each partition migration and broadcasted to all cluster eventually.</p>
</div>
<div class="paragraph">
<p>When a Hazelcast member receives a partition specific operation, it executes the operation and propagates it to backup replica(s) with a logical timestamp. Number of backups for each operation depends on the data structure and its configuration. See <a href="#operation-threading">Threading Model - Operation Threading</a> for threading details.</p>
</div>
<div class="paragraph">
<p>Two types of backup replication are available: <em>sync</em> and <em>async</em>. Despite what their names imply, both types are still implementations of the lazy (async) replication model. The only difference between <em>sync</em> and <em>async</em> is that, the former makes the caller block until backup updates are applied by backup replicas and acknowledgments are sent back to the caller, but the latter is just fire &amp; forget. Number of sync and async backups are defined in the data structure configurations, and you can use a combination of sync and async backups.</p>
</div>
<div class="paragraph">
<p>When backup updates are propagated, response of the execution including number of sync backup updates is sent to the caller and after receiving the response, caller waits to receive the specified number of sync backup acknowledgements for a predefined timeout. This timeout is 5 seconds by default and defined by the system property <code>hazelcast.operation.backup.timeout.millis</code> (see <a href="#system-properties">System Properties appendix</a>).</p>
</div>
<div class="paragraph">
<p>A backup update can be missed because of a few reasons, such as a stale partition table information on a backup replica member, network interruption, or a member crash. That&#8217;s why sync backup acks require a timeout to give up. Regardless of being a sync or async backup, if a backup update is missed, the periodically running anti-entropy mechanism detects the inconsistency and synchronizes backup replicas with the primary. Also the graceful shutdown procedure ensures that all backup replicas for partitions whose primary replicas are assigned to the shutting down member will be consistent.</p>
</div>
<div class="paragraph">
<p>In some cases, although the target member of an invocation is assumed to be alive by the failure detector, the target may not execute the operation or send the response back in time. Network splits, long pauses caused by high load, GC or IO (disk, network) can be listed as a few possible reasons. When an invocation doesn&#8217;t receive any response from the member that owns primary replica, then invocation fails with an <code>OperationTimeoutException</code>. This timeout is 2 minutes by default and defined by the system property <code>hazelcast.operation.call.timeout.millis</code> (see <a href="#system-properties">System Properties appendix</a>). When timeout is passed, result of the invocation will be indeterminate.</p>
</div>
</div>
<div class="sect2">
<h3 id="exactly-once-at-least-once-or-at-most-once-execution"><a class="anchor" href="#exactly-once-at-least-once-or-at-most-once-execution"></a><a class="link" href="#exactly-once-at-least-once-or-at-most-once-execution">26.4. Exactly-once, At-least-once or At-most-once Execution</a></h3>
<div class="paragraph">
<p>Hazelcast, as an AP product, does not provide the exactly-once guarantee. In general, Hazelcast tends to be an at-least-once solution.</p>
</div>
<div class="paragraph">
<p>In the following failure case, exactly-once guarantee can be broken:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the target member of a pending invocation leaves the cluster while the invocation is waiting for a response, that invocation is re-submitted to its new target due to the new partition table. It can be that, it has already been executed on the leaving member and backup updates are propagated to the backup replicas, but the response is not received by the caller. If that happens, the operation will be executed twice.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following failure case, invocation state will become indeterminate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As explained above, when an invocation does not receive a response in time, invocation will fail with an <code>OperationTimeoutException</code>. This exception does not say anything about outcome of the operation, that means operation may not be executed at all, it may be executed once or twice (due to member left case explained above).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="indeterminateoperationstateexception"><a class="anchor" href="#indeterminateoperationstateexception"></a><a class="link" href="#indeterminateoperationstateexception">26.5. IndeterminateOperationStateException</a></h3>
<div class="paragraph">
<p>As described in <a href="#invocation-lifecycle">Invocation Lifecycle</a> section, for partition-based <strong>mutating</strong> invocations, such as <code>map.put()</code>, a caller waits with a timeout for the operation that is executed on corresponding partition&#8217;s primary replica and backup replicas, based on the sync backup configuration of the distributed data structure. Hazelcast 3.9 introduces a new mechanism to detect indeterminate situations while making such invocations. If <code>hazelcast.operation.fail.on.indeterminate.state</code> system property is enabled, a <strong>mutating</strong> invocation throws <code>IndeterminateOperationStateException</code> when it encounters the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The operation fails on partition primary replica member with <code>MemberLeftException</code>. In this case, the caller may not determine the status of the operation. It could happen that the primary replica executes the operation, but fails before replicating it to all the required backup replicas. Even if the caller receives backup acks from some backup replicas, it cannot decide if it has received all required ack responses, since it does not know how many acks it should wait for.</p>
</li>
<li>
<p>There is at least one missing ack from the backup replicas for the given timeout duration. In this case, the caller knows that the operation is executed on the primary replica, but some backup may have missed it. It could be also a false-positive, if the backup timeout duration is configured with a very small value. However, Hazelcast&#8217;s active anti-entropy mechanism eventually kicks in and resolves durability of the write on all available backup replicas as long as the primary replica member is alive.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When an invocation fails with <code>IndeterminateOperationStateException</code>, the system does not try to rollback the changes which are executed on healthy replicas. Effect of a failed invocation may be even observed by another caller, if the invocation has succeeded on the primary replica. Hence, this new behavior does not guarantee linearizability. However, if an invocation completes without <code>IndeterminateOperationStateException</code> when the configuration is enabled, it is guaranteed that the operation has been executed exactly-once on the primary replica and specified number of backup replicas of the partition.</p>
</div>
<div class="paragraph">
<p>Please note that <code>IndeterminateOperationStateException</code> does not apply to read-only operations, such as <code>map.get()</code>. If a partition primary replica node crashes before replying to a read-only operation, the operation is retried on the new owner of the primary replica.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="network-partitioning"><a class="anchor" href="#network-partitioning"></a><a class="link" href="#network-partitioning">27. Network Partitioning</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="split-brain-syndrome"><a class="anchor" href="#split-brain-syndrome"></a><a class="link" href="#split-brain-syndrome">27.1. Split-Brain Syndrome</a></h3>
<div class="paragraph">
<p>In general, network partitioning is a network failure that causes the members to split into multiple groups such that a member in a group cannot communicate with members in other groups. In a partition scenario, all sides of the original cluster will operate independently assuming members in other sides are failed. Network partitioning is also called as <em>Split-Brain Syndrome</em>.</p>
</div>
<div class="paragraph">
<p>Even though this communication failure is called as <em>network partitioning</em>, in practice a process or an entire OS that&#8217;s suspending/pausing very long can cause communication interruptions. If these interruptions take long enough time to assume that the other side is crashed, the cluster splits into multiple partitions and they start operating independently. That&#8217;s why any communication failure/interruption long enough can be classified as network partitioning.</p>
</div>
<div class="paragraph">
<p>Moreover, communication failures don&#8217;t have to be symmetrical. A network failure can interrupt only one side of the channel or a suspended process/member may not even observe the rest as crashed. That kind of network partitioning can be called as <em>partial network partitioning</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="dealing-with-network-partitions"><a class="anchor" href="#dealing-with-network-partitions"></a><a class="link" href="#dealing-with-network-partitions">27.2. Dealing with Network Partitions</a></h3>
<div class="paragraph">
<p>Hazelcast handles network partitions using the following solutions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Split-Brain Protection (Quorums): Split-Brain Protection could be used when consistency is the major concern on a network partitioning. It requires a minimum cluster size to keep a particular data structure available. When cluster size is below the defined quorum size, then subsequent operations will be rejected with a <code>QuorumException</code>. See <a href="#split-brain-protection">Split-Brain Protection section</a>.</p>
</li>
<li>
<p>Split-Brain Recovery (Merge Policies): Split-Brain Recovery is to make data structures available and operational on both sides of a network partition, and merge their data once the network partitioning problem is resolved. See <a href="#split-brain-recovery">Split-Brain Recovery section</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Starting with Hazelcast 3.10, Split-Brain Recovery is supported for the data structures whose in-memory format is <code>NATIVE</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="split-brain-protection"><a class="anchor" href="#split-brain-protection"></a><a class="link" href="#split-brain-protection">27.3. Split-Brain Protection</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The term "quorum" used in this section simply refers to the count of members in the cluster. It does NOT refer to an implementation of Paxos or Raft protocols as used in some NoSQL systems. The mechanism provided in Hazelcast protects the user in case the number of members in a cluster drops below the specified one.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>How to respond to a split-brain scenario depends on whether consistency of data or availability of your application is of primary concern. In either case, because a split-brain scenario is caused by a network failure, you must initiate an effort to identify and correct the network failure. Your cluster cannot be brought back to steady state operation until the underlying network failure is fixed. If consistency is your primary concern, you can use Hazelcast&#8217;s  Split-Brain Protection feature.</p>
</div>
<div class="paragraph">
<p>Hazelcast&#8217;s Split-Brain Protection enables you to specify the minimum cluster size required for operations to occur. This is achieved by defining and configuring a Split-Brain Protection Cluster Quorum. If the cluster size is below the defined quorum, the operations are rejected and the rejected operations return a <code>QuorumException</code> to their callers. Additionally, it is possible to configure a quorum with a user-defined <code>QuorumFunction</code> which will be consulted to determine presence of quorum on each cluster membership change.</p>
</div>
<div class="paragraph">
<p>Your application continues its operations on the remaining operating cluster. Any application instances connected to the cluster with sizes below the defined quorum will be receiving exceptions which, depending on the programming and monitoring setup, should generate alerts. The key point is that rather than applications continuing in error with stale data, they are prevented from doing so.</p>
</div>
<div class="paragraph">
<p>Split-Brain Protection is supported for the following Hazelcast data structures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IMap (for Hazelcast 3.5 and higher versions)</p>
</li>
<li>
<p>Transactional Map (for Hazelcast 3.5 and higher versions)</p>
</li>
<li>
<p>ICache (for Hazelcast 3.5 and higher versions)</p>
</li>
<li>
<p>ILock (for Hazelcast 3.8 and higher versions)</p>
</li>
<li>
<p>IQueue (for Hazelcast 3.8 and higher versions)</p>
</li>
<li>
<p>IExecutorService, DurableExecutorService, IScheduledExecutorService, MultiMap, ISet, IList, Ringbuffer, Replicated Map, Cardinality Estimator, IAtomicLong, IAtomicReference, ISemaphore, ICountdownLatch (for Hazelcast 3.10 and higher versions)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each data structure to be protected should have the configuration added to it as explained in the <a href="#configuring-split-brain-protection">Configuring Split-Brain Protection section</a>.</p>
</div>
<div class="sect3">
<h4 id="time-window-for-split-brain-protection"><a class="anchor" href="#time-window-for-split-brain-protection"></a><a class="link" href="#time-window-for-split-brain-protection">27.3.1. Time Window for Split-Brain Protection</a></h4>
<div class="paragraph">
<p>Cluster Membership is established and maintained by heartbeats. A network partitioning will present some members as being unreachable. While configurable, it is normally seconds or tens of seconds before the cluster is adjusted to exclude unreachable members. The cluster size is based on the currently understood number of members.</p>
</div>
<div class="paragraph">
<p>For this reason, there will be a time window between the network partitioning and the application of Split-Brain Protection, a time window to detect quorum is not satisfied anymore. Length of this window depends on the failure detector. Given guarantee is, every member will eventually detect the failed members and will reject the operation on the data structure which requires the quorum.</p>
</div>
<div class="paragraph">
<p>Starting with Hazelcast 3.10, Split-Brain Protection can be configured with new out-of-the-box `QuorumFunction`s which determine presence of quorum independently of the cluster membership manager, taking advantage of heartbeat and other failure-detector information configured on Hazelcast members.</p>
</div>
<div class="paragraph">
<p>For more information, please see the <a href="#consistency-and-replication-model">Consistency and Replication Model chapter</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-split-brain-protection"><a class="anchor" href="#configuring-split-brain-protection"></a><a class="link" href="#configuring-split-brain-protection">27.3.2. Configuring Split-Brain Protection</a></h4>
<div class="paragraph">
<p>You can set up Split-Brain Protection Cluster Quorum using either declarative or programmatic configuration.</p>
</div>
<div class="paragraph">
<p>Assume that you have a 7-member Hazelcast Cluster and you want to set the minimum number of four members for the cluster to continue operating. In this case, if a split-brain happens, the sub-clusters of sizes 1, 2 and 3 will be prevented from being used. Only the sub-cluster of four members will be allowed to be used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is preferable to have an odd-sized initial cluster size to prevent a single network partitioning (split-brain) from creating two equal sized clusters.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="member-count-quorum"><a class="anchor" href="#member-count-quorum"></a><a class="link" href="#member-count-quorum">Member Count Quorum</a></h5>
<div class="paragraph">
<p>This type of quorum function determines the presence of quorum based on the count of members in the cluster, as observed by the local member&#8217;s cluster membership manager and is available since Hazelcast 3.5. The following are map configurations for the example 7-member cluster scenario described above:</p>
</div>
<div class="paragraph">
<p><strong>Declarative configuration:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
....
&lt;quorum name=<span class="string"><span class="delimiter">&quot;</span><span class="content">quorumRuleWithFourMembers</span><span class="delimiter">&quot;</span></span> enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;quorum-size&gt;<span class="integer">4</span>&lt;/quorum-size&gt;
&lt;/quorum&gt;

&lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;quorum-ref&gt;quorumRuleWithFourMembers&lt;/quorum-ref&gt;
&lt;/map&gt;
....
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic configuration:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/MemberCountQuorum.java[tag=mcq]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="probabilistic-quorum-function"><a class="anchor" href="#probabilistic-quorum-function"></a><a class="link" href="#probabilistic-quorum-function">Probabilistic Quorum Function</a></h5>
<div class="paragraph">
<p>The probabilistic quorum function uses a private instance of <a href="#phi-accrual-failure-detector">Phi Accrual Cluster Failure Detector</a> which is updated with member heartbeats and its parameters can be fine-tuned to determine the count of live members in the cluster, independently of the cluster&#8217;s membership manager.</p>
</div>
<div class="paragraph">
<p>The probabilistic quorum function can be configured with the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>acceptable-heartbeat-pause-millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration in milliseconds corresponding to number of potentially lost/delayed heartbeats that will be accepted before considering it to be an anomaly. This margin is important to be able to survive sudden, occasional, pauses in heartbeat arrivals, due to for example garbage collection or network drops. Value must be in range \[heartbeat interval , maximum no heartbeat interval\], otherwise Hazelcast will not start.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>suspicion-threshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Threshold for suspicion () level. A low threshold is prone to generate many wrong suspicions but ensures a quick detection in the event of a real crash. Conversely, a high threshold generates fewer mistakes but needs more time to detect actual crashes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-sample-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of samples to use for calculation of mean and standard deviation of inter-arrival times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>heartbeat-interval-millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bootstrap the stats with heartbeats that corresponds to this duration in milliseconds, with a rather high standard deviation (since environment is unknown in the beginning).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min-std-deviation-millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum standard deviation (in milliseconds) to use for the normal distribution used when calculating phi. Too low standard deviation might result in too much sensitivity for sudden, but normal, deviations in heartbeat inter arrival times.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Declarative configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  ...
  &lt;quorum enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">probabilistic-quorum</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;quorum-size&gt;<span class="integer">3</span>&lt;/quorum-size&gt;
    &lt;quorum-type&gt;READ_WRITE&lt;/quorum-type&gt;
    &lt;probabilistic-quorum acceptable-heartbeat-pause-millis=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span>
                max-sample-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span> suspicion-threshold=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;/quorum&gt;
  &lt;set name=<span class="string"><span class="delimiter">&quot;</span><span class="content">split-brain-protected-set</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;quorum-ref&gt;probabilistic-quorum&lt;/quorum-ref&gt;
  &lt;/set&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/ProbabilisticQuorum.java[tag=pq]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="recently-active-quorum-function"><a class="anchor" href="#recently-active-quorum-function"></a><a class="link" href="#recently-active-quorum-function">Recently-Active Quorum Function</a></h5>
<div class="paragraph">
<p>A quorum with a recently-active quorum function can be used to implement more conservative split-brain protection by requiring that a heartbeat has been received from each member within a configurable time window since now.</p>
</div>
<div class="paragraph">
<p><strong>Declarative configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  ...
  &lt;quorum enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">recently-active-quorum</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;quorum-size&gt;<span class="integer">4</span>&lt;/quorum-size&gt;
    &lt;quorum-type&gt;READ_WRITE&lt;/quorum-type&gt;
    &lt;recently-active-quorum heartbeat-tolerance-millis=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;/quorum&gt;
  &lt;set name=<span class="string"><span class="delimiter">&quot;</span><span class="content">split-brain-protected-set</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;quorum-ref&gt;recently-active-quorum&lt;/quorum-ref&gt;
  &lt;/set&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/RecentlyActiveQuorum.java[tag=raq]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="quorum-configuration-reference"><a class="anchor" href="#quorum-configuration-reference"></a><a class="link" href="#quorum-configuration-reference">Quorum Configuration Reference</a></h5>
<div class="paragraph">
<p>Quorum configuration has the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quorum-size</code>: Minimum number of members required in a cluster for the cluster to remain in an operational state. If the number of members is below the defined minimum at any time, the operations are rejected and the rejected operations return a <code>QuorumException</code> to their callers.</p>
</li>
<li>
<p><code>quorum-type</code>: Type of the cluster quorum. Available values are READ, WRITE and READ_WRITE.</p>
</li>
<li>
<p><code>quorum-function-class-name</code>: Class name of a <code>QuorumFunction</code> implementation, allows to configure Split-Brain Protection with a custom quorum function. It cannot be used in conjunction with <code>probabilistic-quorum</code> or <code>recently-active-quorum</code>.</p>
</li>
<li>
<p><code>quorum-listeners</code>: Declaration of quorum listeners which are notified on quorum status changes.
8 <code>probabilistic-quorum</code>: Configures the quorum with a probabilistic quorum function. It cannot be used in conjunction with <code>quorum-function-class-name</code> or <code>recently-active-quorum</code>.</p>
</li>
<li>
<p><code>recently-active-quorum</code>: Configures the quorum with a recently-active quorum function. It cannot be used in conjunction with <code>quorum-function-class-name</code> or <code>probabilistic-quorum</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Sample configuration with custom QuorumFunction implementation</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">my.domain</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomQuorumFunction</span> <span class="directive">implements</span> QuorumFunction {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> apply(<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Member</span>&gt; members) {
            <span class="comment">// implement quorum detection logic here</span>
        }
    }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;quorum</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">member-count-quorum</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;quorum-type&gt;</span>READ_WRITE<span class="tag">&lt;/quorum-type&gt;</span>
   <span class="tag">&lt;quorum-size&gt;</span>3<span class="tag">&lt;/quorum-size&gt;</span>
   <span class="tag">&lt;quorum-function-class-name&gt;</span>my.domain.CustomQuorumFunction<span class="tag">&lt;/quorum-function-class-name&gt;</span>
<span class="tag">&lt;/quorum&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="configuring-quorum-listeners"><a class="anchor" href="#configuring-quorum-listeners"></a><a class="link" href="#configuring-quorum-listeners">27.3.3. Configuring Quorum Listeners</a></h4>
<div class="paragraph">
<p>You can register quorum listeners to be notified about quorum results. Quorum listeners are local to the member where they are registered, so they receive only events that occurred on that local member.</p>
</div>
<div class="paragraph">
<p>Quorum listeners can be configured via declarative or programmatic configuration. The following examples are such configurations.</p>
</div>
<div class="paragraph">
<p><strong>Declarative:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
....
&lt;quorum name=<span class="string"><span class="delimiter">&quot;</span><span class="content">quorumRuleWithFourMembers</span><span class="delimiter">&quot;</span></span> enabled=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;quorum-size&gt;<span class="integer">4</span>&lt;/quorum-size&gt;
  &lt;quorum-listeners&gt;
    &lt;quorum-listener&gt;com.company.quorum.FourMemberQuorumListener&lt;/quorum-listener&gt;
  &lt;/quorum-listeners&gt;
&lt;/quorum&gt;

&lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;quorum-ref&gt;quorumRuleWithFourMembers&lt;/quorum-ref&gt;
&lt;/map&gt;
....
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Programmatic:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/QuorumListenerConfiguration.java[tag=qlc]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="querying-quorum-results"><a class="anchor" href="#querying-quorum-results"></a><a class="link" href="#querying-quorum-results">27.3.4. Querying Quorum Results</a></h4>
<div class="paragraph">
<p>Split-Brain Protection Quorum service gives you the ability to query quorum results over the <code>Quorum</code> instances. Quorum instances let you query the result of a particular quorum.</p>
</div>
<div class="paragraph">
<p>Here is a Quorum interface that you can interact with.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * {@link Quorum} provides access to the current status of a quorum.
 */</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">Quorum</span> {
    <span class="comment">/**
     * Returns true if quorum is present, false if absent.
     *
     * @return boolean presence of the quorum
     */</span>
    <span class="type">boolean</span> isPresent();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can retrieve the quorum instance for a particular quorum over the quorum service, as in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/QuorumQuery.java[tag=qq]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="split-brain-recovery"><a class="anchor" href="#split-brain-recovery"></a><a class="link" href="#split-brain-recovery">27.4. Split-Brain Recovery</a></h3>
<div class="paragraph">
<p>Hazelcast deploys a background task that periodically searches for split clusters. When a split is detected, the side that will going to initiate the merge process is decided. This decision is based on the cluster size; the smaller cluster will merge into the bigger one. If they have an equal number of members, then a hashing algorithm determines the merging cluster. When deciding the merging side, both sides ensure that there&#8217;s no intersection in their member lists.</p>
</div>
<div class="paragraph">
<p>After the merging side is decided, the master member (the eldest one) of the merging cluster initiates the cluster merge process by sending merge instructions to the members in its cluster.</p>
</div>
<div class="paragraph">
<p>While recovering from partitioning, Hazelcast uses merge policies for supported data structures to resolve data conflicts between split clusters. A merge policy is a callback function to resolve conflicts between the existing and merging data. Hazelcast provides an interface to be implemented and also a couple of out-of-the-box policies. Data structures without split-brain support discard the data from merging side.</p>
</div>
<div class="paragraph">
<p>Each member of the merging cluster will do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Close all of its network connections (detach from its cluster).</p>
</li>
<li>
<p>Take a snapshot of local data structures which support split-brain recovery.</p>
</li>
<li>
<p>Discard all data structure data.</p>
</li>
<li>
<p>Join to the new cluster as lite member.</p>
</li>
<li>
<p>Send merge operations to the new cluster from local snapshots.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, please see the <a href="#consistency-and-replication-model">Consistency and Replication Model chapter</a>.</p>
</div>
<div class="sect3">
<h4 id="merge-policies"><a class="anchor" href="#merge-policies"></a><a class="link" href="#merge-policies">27.4.1. Merge Policies</a></h4>
<div class="paragraph">
<p>Since Hazelcast 3.10 all merge policies are implementing the unified interface <code>com.hazelcast.spi.SplitBrainMergePolicy</code>. We provide the following out-of-the-box implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DiscardMergePolicy</code>: the entry from the smaller cluster will be discarded.</p>
</li>
<li>
<p><code>ExpirationTimeMergePolicy</code>: the entry with the higher expiration time wins.</p>
</li>
<li>
<p><code>HigherHitsMergePolicy</code>: the entry with the higher number of hits wins.</p>
</li>
<li>
<p><code>HyperLogLogMergePolicy</code>: specialized merge policy for the <code>CardinalityEstimator</code>, which uses the default merge algorithm from HyperLogLog research, keeping the max register value of the two given instances.</p>
</li>
<li>
<p><code>LatestAccessMergePolicy</code>: the entry with the latest access wins.</p>
</li>
<li>
<p><code>LatestUpdateMergePolicy</code>: the entry with the latest update wins.</p>
</li>
<li>
<p><code>PassThroughMergePolicy</code>: the entry from the smaller cluster wins.</p>
</li>
<li>
<p><code>PutIfAbsentMergePolicy</code>: the entry from the smaller cluster wins if it doesn&#8217;t exist in the cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally you can develop a custom merge policy by implementing the <code>SplitBrainMergePolicy</code> interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="supported-data-structures"><a class="anchor" href="#supported-data-structures"></a><a class="link" href="#supported-data-structures">27.4.2. Supported Data Structures</a></h4>
<div class="paragraph">
<p>The following data structures support split-brain recovery:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>IMap</code> (including also High-Density Memory Store backed IMap)</p>
</li>
<li>
<p><code>ICache</code> (including also High-Density Memory Store backed IMap)</p>
</li>
<li>
<p><code>ReplicatedMap</code></p>
</li>
<li>
<p><code>MultiMap</code></p>
</li>
<li>
<p><code>IAtomicLong</code></p>
</li>
<li>
<p><code>IAtomicReference</code></p>
</li>
<li>
<p><code>IQueue</code></p>
</li>
<li>
<p><code>IList</code></p>
</li>
<li>
<p><code>ISet</code></p>
</li>
<li>
<p><code>Ringbuffer</code></p>
</li>
<li>
<p><code>CardinalityEstimator</code></p>
</li>
<li>
<p><code>ScheduledExecutorService</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The statistic based out-of-the-box merge policies are just supported by <code>IMap</code>, <code>ICache</code>, <code>ReplicatedMap</code> and <code>MultiMap</code>. The <code>HyperLogLogMergePolicy</code> is just supported by the <code>CardinalityEstimator</code>.</p>
</div>
<div class="paragraph">
<p>Please have a look at <code>com.hazelcast.spi.merge.SplitBrainMergeTypes</code> for a complete overview of supported merge types of each data structure. There is a config validation which checks these constraints to provide fail-fast behavior for invalid configurations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For the other data structures, e.g., <code>ISemaphore</code>, <code>ICountdownLatch</code> and <code>ILock</code>, the instance from the smaller cluster is discarded during the split-brain recovery.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuring-merge-policies"><a class="anchor" href="#configuring-merge-policies"></a><a class="link" href="#configuring-merge-policies">27.4.3. Configuring Merge Policies</a></h4>
<div class="paragraph">
<p>The merge policies are configured via a <code>MergePolicyConfig</code>, which can be set for all supported data structures. The only exception is <code>ICache</code>, which just accepts the merge policy classname (due to compatibility reasons with older Hazelcast clients). For <code>ICache</code>, all other configurable merge parameters are the default values from <code>MergePolicyConfig</code>.</p>
</div>
<div class="paragraph">
<p>For your custom merge policy you should set the full class name of your implementation to the <code>merge-policy</code> configuration. For the out-of-the-box merge policies the simple classname is enough.</p>
</div>
<div class="sect4">
<h5 id="declarative-configuration"><a class="anchor" href="#declarative-configuration"></a><a class="link" href="#declarative-configuration">Declarative Configuration</a></h5>
<div class="paragraph">
<p>Here are examples how merge policies can be specified for various data structures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
  ...
  &lt;map name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>&gt;
     ...
     &lt;merge-policy batch-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span>&gt;LatestUpdateMergePolicy&lt;/merge-policy&gt;
  &lt;/map&gt;

  &lt;replicatedmap name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>&gt;
    ...
    &lt;merge-policy batch-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span>&gt;org.example.merge.MyMergePolicy&lt;/merge-policy&gt;
  &lt;/replicatedmap&gt;

  &lt;multimap name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>&gt;
    ...
    &lt;merge-policy batch-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span>&gt;HigherHitsMergePolicy&lt;/merge-policy&gt;
  &lt;/multimap&gt;

  &lt;list name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>&gt;
    ...
    &lt;merge-policy batch-size=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>&gt;org.example.merge.MyMergePolicy&lt;/merge-policy&gt;
  &lt;/list&gt;

  &lt;atomic-<span class="type">long</span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>&gt;
    ...
    &lt;merge-policy&gt;PutIfAbsentMergePolicy&lt;/merge-policy&gt;
  &lt;/atomic-<span class="type">long</span>&gt;
  ...
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how merge policies are specified for <code>ICache</code> (it is the same configuration tag, but lacks the support for additional attributes like <code>batch-size</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;hazelcast&gt;
   ...
   &lt;cache name=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>&gt;
      ...
      &lt;merge-policy&gt;org.example.merge.MyMergePolicy&lt;/merge-policy&gt;
   &lt;/cache&gt;
&lt;/hazelcast&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="programmatic-configuration"><a class="anchor" href="#programmatic-configuration"></a><a class="link" href="#programmatic-configuration">Programmatic Configuration</a></h5>
<div class="paragraph">
<p>Here are examples how merge policies can be specified for various data structures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/MergePolicy.java[tag=mp]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how merge policies are specified for <code>ICache</code> (you can only set the merge policy classname):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">CacheConfig mapConfig = <span class="keyword">new</span> CacheConfig()
  .setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>)
  .setMergePolicy(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example.merge.MyMergePolicy</span><span class="delimiter">&quot;</span></span>);

Config config = <span class="keyword">new</span> Config()
  .addMapConfig(mapConfig);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="custom-merge-policies"><a class="anchor" href="#custom-merge-policies"></a><a class="link" href="#custom-merge-policies">27.4.4. Custom Merge Policies</a></h4>
<div class="paragraph">
<p>To implement a custom merge policy you have to implement <code>com.hazelcast.spi.SplitBrainMergePolicy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SplitBrainMergePolicy</span>&lt;V, T <span class="directive">extends</span> MergingValue&lt;V&gt;&gt;
    <span class="directive">extends</span> DataSerializable {

  V merge(T mergingValue, T existingValue);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>MergingValue</code> is an interface which describes a merge type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please have in mind that <code>existingValue</code> can be <code>null</code>. This happens when a data structure or key-based entry was just created in the smaller cluster.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="merge-types"><a class="anchor" href="#merge-types"></a><a class="link" href="#merge-types">Merge Types</a></h5>
<div class="paragraph">
<p>A merge type defines an attribute which is required by a merge policy and provided by a data structure.</p>
</div>
<div class="paragraph">
<p><code>MergingValue</code> is the base type, which is required by all merge policies and provided by all data structures. It contains the value of the merged data in raw and deserialized format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MergingValue</span>&lt;V&gt; {

  V getValue();

  &lt;DV&gt; DV getDeserializedValue();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most common extension is <code>MergingEntry</code>, which additionally provides the key in raw and deserialized format (used by all key-based data structures like <code>IMap</code> or <code>ICache</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MergingEntry</span>&lt;K, V&gt; <span class="directive">extends</span> MergingValue&lt;V&gt; {

  K getKey();

  &lt;DK&gt; DK getDeserializedKey();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition we have a bunch of specialized merge types, e.g. for provided statistics. An example is <code>MergingHits</code>, which provides the hit counter of the merge data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MergingHits</span>&lt;V&gt; <span class="directive">extends</span> MergingValue&lt;V&gt; {

  <span class="type">long</span> getHits();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class <code>com.hazelcast.spi.merge.SplitBrainMergeTypes</code> contains composed interfaces, which show the provided merge types and required merge policy return type for each data structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ReplicatedMapMergeTypes</span> <span class="directive">extends</span> MergingEntry&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt;,
    MergingCreationTime&lt;<span class="predefined-type">Object</span>&gt;, MergingHits&lt;<span class="predefined-type">Object</span>&gt;, MergingLastAccessTime&lt;<span class="predefined-type">Object</span>&gt;,
    MergingLastUpdateTime&lt;<span class="predefined-type">Object</span>&gt;, MergingTTL&lt;<span class="predefined-type">Object</span>&gt; {
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">QueueMergeTypes</span> <span class="directive">extends</span> MergingValue&lt;<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Object</span>&gt;&gt; {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ReplicatedMap</code> provides key/value merge data, with the creation time, access hits, last access time, last update time and TTL. The return type of the merge policy is <code>Object</code>.</p>
</div>
<div class="paragraph">
<p>The <code>IQueue</code> just provides a collection of values. The return type is also a <code>Collection&lt;Object&gt;</code>.</p>
</div>
<div class="paragraph">
<p>The following sections will show various examples how to implement this interface for all data structures, specific merge types or a specific data structure.</p>
</div>
</div>
<div class="sect4">
<h5 id="accessing-deserialized-values"><a class="anchor" href="#accessing-deserialized-values"></a><a class="link" href="#accessing-deserialized-values">Accessing Deserialized Values</a></h5>
<div class="paragraph">
<p><code>MergingValue.getValue()</code> and <code>MergingEntry.getKey()</code> always return the data in the in-memory format of the data structure. For some data structure like <code>IMap</code> this depends on your configuration. Other data structure like <code>ISet</code> or <code>IList</code> always use the <code>BINARY</code> in-memory format. So it is very likely, that you will receive a <code>Data</code> instance as key or value from those methods.</p>
</div>
<div class="paragraph">
<p>If you need the deserialized key or value, you have to call <code>MergingValue.getDeserializedValue()</code> or <code>MergingEntry.getDeserializedKey()</code>. The deserialization is done lazily on that method call, since it&#8217;s quite expensive and should be avoided if the result is not needed. This will also require the deserialized classes to be on the classpath of the server. Otherwise a <code>ClassNotFoundException</code> will be thrown.</p>
</div>
<div class="paragraph">
<p>This is an example which checks if the (deserialized) value of the <code>mergingValue</code> or <code>existingValue</code> is an <code>Integer</code>. If so it will be merged, otherwise <code>null</code> is returned (which will remove the entry):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/MergeIntegerValuesMergePolicy.java[tag=mivmp]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For data structures like <code>ISet</code> or <code>ICollection</code> you need a merge policy, which supports collections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/MergeCollectionOfIntegerValuesMergePolicy.java[tag=mc]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also combine both merge policies to support single values and collections. This merge policy is a bit more complex and less type safe, but can be configured on all data structures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/MergeIntegerValuesMergePolicy2.java[tag=mivmp2]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please have in mind that <code>existingValue</code> can be <code>null</code>, so a <code>null</code> check is mandatory before calling <code>existingValue.getValue()</code> or <code>existingValue.getDeserializedValue()</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you return <code>null</code> on a collection based data structure, the whole data structure will be removed. An empty collection works in the same way, so you don&#8217;t have to check <code>Collection.isEmpty()</code> in your merge policy.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="accessing-hazelcast-usercontext"><a class="anchor" href="#accessing-hazelcast-usercontext"></a><a class="link" href="#accessing-hazelcast-usercontext">Accessing Hazelcast UserContext</a></h5>
<div class="paragraph">
<p>If you need access to external references in your merge policy, you can use the Hazelcast <code>UserContext</code> to get them injected. An example would be a database connection to check which value is stored in your database. To achieve this your merge policy needs to implement <code>HazelcastInstanceAware</code> and call <code>HazelcastInstance.getUserContext()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/UserContextMergePolicy.java[tag=ucmp]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>UserContext</code> can be setup like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">MergePolicyConfig mergePolicyConfig = <span class="keyword">new</span> MergePolicyConfig()
  .setPolicy(UserContextMergePolicy.class.getName());

MapConfig mapConfig = <span class="keyword">new</span> MapConfig(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>)
  .setMergePolicyConfig(mergePolicyConfig);

<span class="predefined-type">ConcurrentMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; userContext = <span class="keyword">new</span> <span class="predefined-type">ConcurrentHashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;();
userContext.put(TruthProvider.TRUTH_PROVIDER_ID, <span class="keyword">new</span> ExampleTruthProvider());

Config config = <span class="keyword">new</span> Config()
  .addMapConfig(mapConfig)
  .setUserContext(userContext);

Hazelcast.newHazelcastInstance(config);</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The merge operations are executed on the partition threads. Database accesses are slow compared to in-memory operations. The <code>SplitBrainMergePolicy.merge()</code> method will be called for every key-value pair or every collection from your smaller cluster, which has a merge policy defined. So there can be millions of database accesses due to a merge policy, which implements this. Be aware that this can block your cluster for a long time or overload your database due to the high amount of queries.</p>
</div>
<div class="paragraph">
<p>Also the <code>com.hazelcast.core.LifeCycleEvent.MERGED</code> will be thrown after a timeout (we don&#8217;t wait forever for merge operations to continue). At the moment this timeout is 500 milliseconds per merged item or entry, but at least 5 seconds. If your database is slow, you might get the <code>LifeCycleEvent</code> while there are still merge operations in progress.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="merge-policies-with-multiple-merge-types"><a class="anchor" href="#merge-policies-with-multiple-merge-types"></a><a class="link" href="#merge-policies-with-multiple-merge-types">Merge Policies With Multiple Merge Types</a></h5>
<div class="paragraph">
<p>You can also write a merge policy, which requires multiple merge types. This merge policy is supported by all data structures, which provide <code>MergingHits</code> and <code>MergingCreationTime</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/ComposedHitsAndCreationTimeMergePolicy.java[tag=ch]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you configure this merge policy on a data structures, which does not provide these merge types, you will get an <code>InvalidConfigurationException</code> with a message like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">The merge policy org.example.merge.ComposedHitsAndCreationTimeMergePolicy
can just be configured on data structures which provide the merging type
com.hazelcast.spi.merge.MergingHits.
See SplitBrainMergingTypes <span class="keyword">for</span> supported merging types.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="merge-policies-for-specific-data-structures"><a class="anchor" href="#merge-policies-for-specific-data-structures"></a><a class="link" href="#merge-policies-for-specific-data-structures">Merge Policies For Specific Data Structures</a></h5>
<div class="paragraph">
<p>It&#8217;s also possible to restrict a merge policy to a specific data structure. This merge policy will only work on <code>IMap</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/MapEntryCostsMergePolicy.java[tag=me]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you configure it on other data structures, you will get an <code>InvalidConfigurationException</code> with a message like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">The merge policy org.example.merge.MapEntryCostsMergePolicy
can just be configured on data structures which provide the merging type
com.hazelcast.spi.merge.SplitBrainMergeTypes<span class="error">$</span>MapMergeTypes.
See SplitBrainMergingTypes <span class="keyword">for</span> supported merging types.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is another example for a merge policy, which will only work on the <code>IAtomicReference</code> and uses a named type parameter <code>T</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Unresolved directive in network_partitioning.adoc - include::{javasource}/networkpartitioning/AtomicReferenceMergeIntegerValuesMergePolicy.java[tag=ar]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although every data structure supports <code>MergingValue</code>, which is the only merge type of <code>AtomicReferenceMergeTypes</code>, this merge policy is restricted to <code>IAtomicReference</code> data structures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">The merge policy org.example.merge.AtomicReferenceMergeIntegerValuesMergePolicy
can just be configured on data structures which provide the merging type
com.hazelcast.spi.merge.SplitBrainMergeTypes<span class="error">$</span>AtomicReferenceMergeTypes.
See SplitBrainMergingTypes <span class="keyword">for</span> supported merging types.</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="best-practices-2"><a class="anchor" href="#best-practices-2"></a><a class="link" href="#best-practices-2">Best Practices</a></h5>
<div class="paragraph">
<p>Here are some best practices when implementing your own merge policy</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only call <code>MergingValue.getDeserializedValue()</code> and <code>MergingEntry.getDeserializedKey()</code> when you really need the deserialized value to save costs (CPU and memory) and avoid <code>ClassNotFoundException</code>.</p>
</li>
<li>
<p>If you want to return one of the given values (merging or existing), it&#8217;s best to return <code>mergingValue.getValue()</code> or <code>existingValue.getValue()</code>, since they are already in the correct in-memory format of the data structure. If you return a deserialized value, it might need to be serialized again, which are avoidable costs.</p>
</li>
<li>
<p>Be careful with slow operations in the merge policy (like database accesses), since they will block your partition threads. Also the <code>LifeCycleEvent.MERGED</code> or <code>LifeCycleEvent.MERGE_FAILED</code> may be thrown too early, if the merge operations take too long to finish.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="system-properties"><a class="anchor" href="#system-properties"></a><a class="link" href="#system-properties">Appendix A: System Properties</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The table below lists the system properties with their descriptions in alphabetical order.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you want to reconfigure a system property, you need to restart the members for which the property is modified.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. System Properties</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Property Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.application.validation.token</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property can be used to verify that Hazelcast members only join when their application level configuration is the same.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.backpressure.backoff.timeout.millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls the maximum timeout in milliseconds to wait for an invocation space to be available. The value needs to be equal to or larger than 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.backpressure.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable back pressure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.backpressure.max.concurrent.invocations.per.partition</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of concurrent invocations per partition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.backpressure.syncwindow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used when back pressure is enabled. The larger the sync window value, the less frequent a asynchronous backup is converted to a sync backup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.cache.invalidation.batch.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the cache invalidation event batch sending is enabled or not.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.cache.invalidation.batch.size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the maximum number of cache invalidation events to be drained and sent to the event listeners in a batch.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.cache.invalidation.batchfrequency.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines cache invalidation event batch sending frequency in seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.clientengine.query.thread.count</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads to process query requests coming from the clients. Default count is the number of cores multiplied by 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.clientengine.thread.count</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of threads to process non-partition-aware client requests, like <code>map.size()</code>, executor tasks, etc. Default count is the number of cores multiplied by 20.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.directory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>user.dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output directory of the diagnostic log files.</p>
<p class="tableblock">NOTE: For detailed information on the diagnostic tool, along with this and the following diagnostic related system properties, please refer to the <a href="#diagnostics ">Diagnostics section</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether diagnostics tool is enabled or not for the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.filename.prefix</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional prefix for the diagnostics log file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.invocation.sample.period.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frequency of scanning all the pending invocations in seconds. 0 means the <code>Invocations</code> plugin for diagnostics tool is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.invocation.slow.threshold.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Threshold period, in seconds, that makes an invocation to be considered as slow.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.max.rolled.file.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allowed count of diagnostic files within each roll.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.max.rolled.file.size.mb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of each diagnostic file to be rolled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.member-heartbeat.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period for which the MemberHeartbeats plugin of the diagnostics tool runs. 0 means this plugin is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.member-heartbeat.max-deviation-percentage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum allowed deviation for a member-to-member heartbeats.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.memberinfo.period.second</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frequency, in seconds, at which the cluster information is dumped to the diagnostics log file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.metric.level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Level of detail for the diagnostic tool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.metrics.period.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Frequency, in seconds, at which the Metrics plugin dumps information to the diagnostics log file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.metrics.level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Level of detail for the Metrics plugin of the diagnostic tool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.operation-heartbeat.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period, in seconds, for which the OperationHeartbeats plugin of the diagnostics tool runs. 0 means this plugin is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.operation-heartbeat.max-deviation-percentage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum allowed deviation for a member-to-member operation heartbeats.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.pending.invocations.period.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period, in seconds, for which the PendingInvocations plugin of the diagnostics tool runs. 0 means this plugin is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.slowoperations.period.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period, in seconds, for which the SlowOperations plugin of the diagnostics tool runs. 0 means this plugin is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.storeLatency.period.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period, in seconds, for which the StoreLatency plugin of the diagnostics tool runs. 0 means this plugin is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.storeLatency.reset.period.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period, in seconds, for resetting the statistics for the StoreLatency plugin of the diagnostics tool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.systemlog.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the SystemLog plugin of the diagnostics tool is enabled or not.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.diagnostics.systemlog.partitions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the SystemLog plugin collects information about partition migrations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.executionservice.taskscheduler.remove.oncancel</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls whether the task scheduler removes tasks immediately upon cancellation. This is disabled by default, because it can cause severe delays on the other operations. By default all cancelled tasks will eventually get removed by the scheduler workers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="client-max-no"></a><code>hazelcast.client.max.no.heartbeat.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time after which the member assumes the client is dead and closes its connections to the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.compatibility.3.6.client</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When this property is true, if the server cannot determine the connected client version, it will assume that it has the version 3.6.x. This property is especially needed if you are using ICache (or JCache).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.connect.all.wait.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout to connect all other cluster members when a member is joining to a cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.connection.monitor.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum interval in milliseconds to consider a connection error as critical.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.connection.monitor.max.faults</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum IO error count before disconnecting from a member.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.discovery.public.ip.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable use of public IP address in member discovery with Discovery SPI. If you set this property to true in your source cluster, please make sure you have set the public addresses for your target members since they will be discovered using their public addresses. Otherwise, they cannot be discovered. Please see the <a href="#public-address">Public Address section</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.enterprise.license.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.hazelcast.com/products.jsp">Hazelcast IMDG Enterprise</a> license key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.event.queue.capacity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Capacity of internal event queue.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.event.queue.timeout.millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout to enqueue events to event queue.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.event.thread.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of event handler threads.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.graceful.shutdown.max.wait</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">600</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum wait in seconds during graceful shutdown.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.http.healthcheck.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable/disable Hazelcast&#8217;s HTTP based health check implementation.  When it is enabled, you can retrieve information about your cluster&#8217;s health status (member state, cluster state, cluster size, etc.) by launching <code><a href="http://&lt;your" class="bare">http://&lt;your</a> member&#8217;s host IP&gt;:5701/hazelcast/health</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.health.monitoring.delay.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Health monitoring logging interval in seconds. NOTE: For detailed information on the health monitoring tool, along with this and the following health monitoring related system properties, please refer to the <a href="#health-check-and-monitoring">Health Check and Monitoring section</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.health.monitoring.level</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SILENT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Health monitoring log level. When <strong>SILENT</strong>, logs are printed only when values exceed some predefined threshold. When <strong>NOISY</strong>, logs are always printed periodically. Set <strong>OFF</strong> to turn off completely.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.health.monitoring.threshold.cpu.percentage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">70</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the health monitoring level is <strong>SILENT</strong>, logs are printed only when the CPU usage exceeds this threshold.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.health.monitoring.threshold.memory.percentage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">70</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the health monitoring level is <strong>SILENT</strong>, logs are printed only when the memory usage exceeds this threshold.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.heartbeat.interval.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Heartbeat send interval in seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.hidensity.check.freememory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled and is able to fetch memory statistics via Java&#8217;s <code>OperatingSystemMXBean</code>, it checks whether there is enough free physical memory for the requested number of bytes. If the free memory checker is disabled (false), acts as if the check is succeeded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.icmp.echo.fail.fast.on.startup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether ICMP Echo Request mode for ping detector is enforced. If OS is not supported, or not configured correctly, as explained in <a href="#requirements-and-linuxunix-configuration">Requirements and Linux/Unix Configuration</a>, Hazelcast will fail to start.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.icmp.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether ICMP ping is enabled or not.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.icmp.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval between ping attempts in milliseconds. Default and minimum allowed value is 1 second.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.icmp.max.attempts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum ping attempts before suspecting a member.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.icmp.parallel.mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether <a href="#ping-failure-detector">Ping Failure Detector</a> will work in parallel with the other detectors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.icmp.timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ICMP timeout in milliseconds. This cannot be more than the value of <code>hazelcast.icmp.interval</code> property; it should always be smaller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.icmp.ttl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ICMP TTL (maximum numbers of hops to try).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.index.copy.behavior</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COPY_ON_READ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the behavior for index copying on index read/write. Please refer to the <a href="#copying-indexes">Copying Indexes section</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.initial.min.cluster.size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial expected cluster size to wait before member to start completely.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.initial.wait.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial time in seconds to wait before member to start completely.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.internal.map.expiration.cleanup.operation.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a property which is used internally and subject to change in the future releases.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.internal.map.expiration.cleanup.percentage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a property which is used internally and subject to change in the future releases.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.internal.map.expiration.task.period.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a property which is used internally and subject to change in the future releases.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.invalidation.max.tolerated.miss.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If missed invalidation count is bigger than this value, relevant cached data will be made unreachable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.invalidation.reconciliation.interval.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Period for which the cluster members are scanned to compare generated invalidation events with the received ones from Near Cache.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.io.balancer.interval.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval in seconds between IOBalancer executions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.io.input.thread.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of socket input threads.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.io.output.thread.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of socket output threads.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.io.thread.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads performing socket input and socket output. If, for example, the default value (3) is used, it means there are 3 threads performing input and 3 threads performing output (6 threads in total).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.jcache.provider.type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the JCache provider. Values can be <code>client</code> or <code>server</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.jmx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#monitoring-with-jmx">JMX</a> agent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.legacy.memberlist.format.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the legacy (for the releases before Hazelcast 3.9) member list format which is printed in the logs. The new format is introduced starting with Hazelcast 3.9 and includes member list version. Any change in the cluster, such as a member leaving or joining, will increment the member list version.&lt;br&gt;Please see the <a href="#starting-the-member-and-client">Starting the Member and Client section</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.local.localAddress</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is an overrider property for the default server socket listener&#8217;s IP address. If this property is set, then this is the address where the server socket is bound to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.local.publicAddress</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is an overrider property for the default public address to be advertised to other cluster members and clients.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.lock.max.lease.time.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long.MAX_VALUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All locks which are acquired without an explicit lease time use this value (in seconds) as the lease time. When you want to set an explicit lease time for your locks, you cannot set it to a longer time than this value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.logging.type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of <a href="#logging-configuration">logging</a> framework type to send logging events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.mancenter.home</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mancenter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Folder where Management Center data files are stored (license information, time travel information, etc.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.map.entry.filtering.natural.event.types</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notify <a href="#listening-to-map-entries-with-predicates">entry listeners with predicates</a> on map entry updates with events that match entry, update or exit from predicate value space.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.map.expiry.delay.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Useful to deal with some possible edge cases. For example, when using EntryProcessor, without this delay, you may see an EntryProcessor running on owner partition found a key but EntryBackupProcessor did not find it on backup. As a result of this, when backup promotes to owner, you will end up an unprocessed key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.map.invalidation.batchfrequency.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the collected invalidations do not reach the configured batch size, a background process sends them at this interval.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.map.invalidation.batch.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable or disable batching. When it is set to <code>false</code>, all invalidations are sent immediately.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.map.invalidation.batch.size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of invalidations in a batch.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.map.load.chunk.size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum size of the key batch sent to the partition owners for value loading and the maximum size of a key batch for which values are loaded in a single partition.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.map.replica.wait.seconds.for.scheduled.tasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scheduler delay for map tasks those will be executed on backup members.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.map.write.behind.queue.capacity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum write-behind queue capacity per member. It is the total of all write-behind queue sizes in a member including backups. Its maximum value is <code>Integer.MAX_VALUE</code>. The value of this property is taken into account only if the <code>write-coalescing</code> element of the Map Store configuration is <code>false</code>. Please refer to <a href="#setting-write-behind-persistence">here</a> for the description of the <code>write-coalescing</code> element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.master.confirmation.interval.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval at which members send master confirmation. This property is deprecated as of this (3.10) release.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.mastership.claim.member.list.version.increment</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hazelcast master member (oldewst in the cluster) increments the member list version for each joining member. Then, these member list versions are used to identify the joined members with unique integers. For this algorithm to work under network partitioning scenarios, without generating duplicate member list join versions for different members, a mastership-claiming member increments the member list version as specified by this parameter, multiplied by its position in the member list. The value of the parameter must be bigger than the cluster size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.mastership.claim.timeout.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout which defines when master candidate gives up waiting for response to its mastership claim. After timeout happens, non-responding member will be removed from the member list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.max.join.merge.target.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Split-brain merge timeout for a specific target.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.max.join.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Join timeout, maximum time to try to join before giving.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.max.no.heartbeat.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum timeout of heartbeat in seconds for a member to assume it is dead.</p>
<p class="tableblock">CAUTION: Setting this value too low may cause members to be evicted from the cluster when they are under heavy load: they will be unable to send heartbeat operations in time, so other members will assume that it is dead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.max.no.master.confirmation.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">150</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max timeout of master confirmation from other members. This property is deprecated as of this (3.10) release.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.max.wait.seconds.before.join</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum wait time before join operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.mc.max.visible.instance.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer.MAX_VALUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management Center maximum visible instance count. This property is deprecated as of this (3.10) release.</p>
<p class="tableblock">CAUTION: Setting this value to a lower number might prevent some instances from being monitored in Management Center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.mc.max.visible.slow.operations.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management Center maximum visible slow operations count.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.mc.url.change.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management Center changing server url is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.member.list.publish.interval.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval at which master member publishes a member list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.memcache.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#memcache-client">Memcache</a> client request listener service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.merge.first.run.delay.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial run delay of <a href="#split-brain-syndrome">split-brain/merge process</a> in seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.merge.next.run.delay.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run interval of <a href="#split-brain-syndrome">split-brain/merge process</a> in seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.migration.min.delay.on.member.removed.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum delay (in seconds) between detection of a member that has left and start of the rebalancing process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.multicast.group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.2.2.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP address of a multicast group. If not set, configuration is read from the default Hazelcast configuration, which has the value 224.2.2.3.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.nio.tcp.spoofing.checks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls whether more strict checks upon BIND requests towards a cluster member are applied. The checks mainly validate the remote BIND request against the remote address as found in the socket. By default they are disabled, to avoid connectivity issues when deployed under NAT&#8217;ed infrastructure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.operation.backup.timeout.millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum time a caller to wait for backup responses of an operation. After this timeout, operation response will be returned to the caller even no backup response is received.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.operation.fail.on.indeterminate.state</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When enabled, an operation fails with <code>IndeterminateOperationStateException</code>, if it does not receive backup acks in time with respect to backup configuration of its data structure, or the member which owns primary replica of the target partition leaves the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.operation.call.timeout.millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout to wait for a response when a remote call is sent, in milliseconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.operation.generic.thread.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of generic operation handler threads. <code>-1</code> means CPU core count / 2.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.operation.responsequeue.idlestrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the response thread for internal operations at the member side will be blocked or not. If you use <code>block</code> (the default value) the thread will be blocked and need to be notified which can cause a reduction in the performance. If you use <code>backoff</code> there will be no blocking. By enabling the backoff mode and depending on your use case, you can get a 5-10% performance improvement. However, keep in mind that this will increase CPU utilization. We recommend you to use backoff with care and if you have a tool for measuring your cluster&#8217;s performance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.operation.thread.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of partition based operation handler threads. <code>-1</code> means CPU core count.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.partition.backup.sync.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval for syncing backup replicas in seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.partition.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">271</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total partition count.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.partition.max.parallel.replications</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of parallel partition backup replication operations per member. When a partition backup ownership changes or a backup inconsistency is detected, the members start to sync their backup partitions. This parameter limits the maximum running replication operations in parallel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.partition.migration.fragments.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When enabled, which is the default behavior, partitions are migrated/replicated in small fragments instead of one big chunk. Migrating partitions in fragments reduces pressure on the memory and network, since smaller packets are created in the memory and sent through the network. Note that it can increase the migration time to complete.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.partition.migration.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval to run partition migration tasks in seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.partition.migration.stale.read.disabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hazelcast allows read operations to be performed while a partition is being migrated. This can lead to stale reads for some scenarios. You can disable stale read operations by setting this system property&#8217;s value to "true". Its default value is "false", meaning that stale reads are allowed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.partition.migration.timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout for partition migration tasks in seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.partition.table.send.interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval for publishing partition table periodically to all cluster members in seconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.partitioning.strategy.class</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class name implementing <code>com.hazelcast.core.PartitioningStrategy</code>, which defines key to partition mapping.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.performance.monitor.max.rolled.file.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The PerformanceMonitor uses a rolling file approach to prevent eating too much disk space. This property sets the maximum number of rolling files to keep on disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.performance.monitor.max.rolled.file.size.mb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The performance monitor uses a rolling file approach to prevent eating too much disk space. This property sets the maximum size in MB for a single file. Every HazelcastInstance gets its own history of log files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.performance.monitoring.enabled</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable the performance monitor, a tool which allows you to see internal performance metrics. These metrics are written to a dedicated log file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.performance.monitor.delay.seconds</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The period between successive entries in the performance monitor&#8217;s log file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.prefer.ipv4.stack</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prefer IPv4 network interface when picking a local address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.query.max.local.partition.limit.for.precheck</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum value of local partitions to trigger local pre-check for TruePredicate query operations on maps.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.query.optimizer.type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RULES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the query optimizer. For optimizations based on static rules, set the value to <code>RULES</code>. To disable the optimization, set the value to <code>NONE</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.query.predicate.parallel.evaluation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each Hazelcast member evaluates query predicates using a single thread by default. In most cases, the overhead of inter-thread communications overweight can benefit from parallel execution. When you have a large dataset and/or slow predicate, you may benefit from parallel predicate evaluations. Set to <code>true</code> if you are using slow predicates or have &gt; 100,000s entries per member.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.query.result.size.limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Result size limit for query operations on maps. This value defines the maximum number of returned elements for a single query result. If a query exceeds this number of elements, a QueryResultSizeExceededException is thrown. Its default value is -1, meaning it is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.rest.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="#rest-client">REST</a> client request listener service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.shutdownhook.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Hazelcast shutdownhook thread. When this is enabled, this thread terminates the Hazelcast instance without waiting to shutdown gracefully.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.shutdownhook.policy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TERMINATE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the behavior when JVM is exiting while the Hazelcast instance is still running. It has two values: TERMINATE and GRACEFUL. The former one terminates the Hazelcast instance immediately. The latter, GRACEFUL, initiates the graceful shutdown which can significantly slow down the JVM exit process, but it tries to retain data safety. Note that you should always shutdown Hazelcast explicitly via using the method <code>HazelcastInstance.shutdown()</code>. It&#8217;s not recommended to rely on the shutdown hook, this is a last-effort measure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.slow.operation.detector.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables/disables the <a href="#slowoperationdetector">SlowOperationDetector</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.slow.operation.detector.log.purge.interval.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purge interval for slow operation logs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.slow.operation.detector.log.retention.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3600</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the retention time of invocations in slow operation logs. If an invocation is older than this value, it will be purged from the log to prevent unlimited memory usage. When all invocations are purged from a log, the log itself will be deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.slow.operation.detector.stacktrace.logging.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines if the stacktraces of slow operations are logged in the log file. Stack traces are always reported to the Management Center, but by default, they are not printed to keep the log size small.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.slow.operation.detector.threshold.millis</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines a threshold above which a running operation in <code>OperationService</code> is considered to be slow. These operations log a warning and are shown in the Management Center with detailed information, e.g., stacktrace.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.bind.any</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind both server-socket and client-sockets to any local interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.buffer.direct</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the byte buffers used in the socket should be a direct byte buffer (<code>true</code>) or a regular one (<code>false</code>). When it is set to <code>true</code>, Hazelcast internally uses the method <code>ByteBuffer.allocateDirect</code> (instead of <code>ByteBuffer.allocate</code>) which makes use of the off-heap and may skip the memory copying when performing socket I/O operations. See <a href="https://docs.oracle.com/javase/7/docs/api/java/nio/ByteBuffer.html">here</a> for more information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.client.bind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind client socket to an interface when connecting to a remote server socket. When set to <code>false</code>, client socket is not bound to any interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.client.bind.any</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind client-sockets to any local interface. If not set, <code>hazelcast.socket.bind.any</code> will be used as default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.client.receive.buffer.size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hazelcast creates all connections with receive buffer size set according to the <code>hazelcast.socket.receive.buffer.size</code>. When it detects a connection opened by a client, then it adjusts the receive buffer size according to this property. It is in kilobytes and its default value is -1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.client.send.buffer.size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hazelcast creates all connections with send buffer size set according to the <code>hazelcast.socket.send.buffer.size</code>. When it detects a connection opened by a client, then it adjusts the send buffer size according to this property. It is in kilobytes and its  default value is -1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.connect.timeout.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Socket connection timeout in seconds. <code>Socket.connect()</code> will be blocked until either connection is established or connection is refused or this timeout passes. Default is 0, means infinite.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.keep.alive</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Socket set keep alive (<code>SO_KEEPALIVE</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.linger.seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set socket <code>SO_LINGER</code> option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.no.delay</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Socket set TCP no delay.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.receive.buffer.size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Socket receive buffer (<code>SO_RCVBUF</code>) size in KB. If you have a very fast network, e.g., 10gbit) and/or you have large entries, then you may benefit from increasing sender/receiver buffer sizes. Use this property and the next one below tune the size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.send.buffer.size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Socket send buffer (<code>SO_SNDBUF</code>) size in KB.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.socket.server.bind.any</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind server-socket to any local interface. If not set, <code>hazelcast.socket.bind.any</code> will be used as default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.tcp.join.port.try.count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of incremental ports, starting with the port number defined in the network configuration, that will be used to connect to a host (which is defined without a port in TCP/IP member list while a member is searching for a cluster).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.unsafe.mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">auto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"auto" (the default value) automatically detects whether the usage of <code>Unsafe</code> is suitable for a given platform. "disabled" explicitly disables the <code>Unsafe</code> usage in your platform. "enforced" enforces the usage of <code>Unsafe</code> even if your platform does not support it. This property can only be set by passing a JVM-wide system property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.phone.home.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable or disable the sending of phone home data to Hazelcast&#8217;s phone home server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.wait.seconds.before.join</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wait time before join operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hazelcast.wan.map.useDeleteWhenProcessingRemoveEvents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures WAN replication for <code>IMap</code> on the PASSIVE cluster to remove entries using delete instead of remove and when using <code>com.hazelcast.enterprise.wan.replication.WanBatchReplication</code> as an endpoint implementation. The member which receives the event batch in the PASSIVE cluster dispatches WAN events to the partition owners as map merge and remove operations. When using remove operations, the old entry value is sent from the partition owner to the caller even though the caller does not use the old value. This can also lead to issues if the PASSIVE cluster does not contain the class definition for the entry value as the value will try to get deserialized, causing `ClassNotFoundException`s. You can switch to using map remove instead on the PASSIVE cluster with this property. This will both save bandwidth and avoid the exception.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="common-exception-types"><a class="anchor" href="#common-exception-types"></a><a class="link" href="#common-exception-types">Appendix B: Common Exception Types</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may see the following exceptions in any Hazelcast operation when the following situations occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HazelcastInstanceNotActiveException</code>: Thrown when <code>HazelcastInstance</code> is not active (already shutdown or being shutdown) during an invocation.</p>
</li>
<li>
<p><code>HazelcastOverloadException</code>: Thrown when the system will not handle any more load due to an overload. This exception is thrown when back pressure is enabled.</p>
</li>
<li>
<p><code>DistributedObjectDestroyedException</code>: Thrown when an already destroyed <code>DistributedObject</code> (IMap, IQueue, etc.) is accessed or when a method is called over a destroyed <code>DistributedObject</code>.</p>
</li>
<li>
<p><code>MemberLeftException</code>: Thrown when a member leaves during an invocation or execution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hazelcast also throws the following exceptions in the cases of overall system problems such as networking issues and long pauses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PartitionMigratingException</code>: Thrown when an operation is executed on a partition, but that partition is currently being moved.</p>
</li>
<li>
<p><code>TargetNotMemberException</code>: Thrown when an operation is sent to a machine that is not a member of the cluster.</p>
</li>
<li>
<p><code>CallerNotMemberException</code>: Thrown when an operation was sent by a machine which is not a member in the cluster when the operation is executed.</p>
</li>
<li>
<p><code>WrongTargetException</code>: Thrown when an operation is executed on the wrong machine, usually because the partition that operation belongs to has been moved to some other member.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="license-questions"><a class="anchor" href="#license-questions"></a><a class="link" href="#license-questions">Appendix C: License Questions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hazelcast is distributed using the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2</a>, therefore permissions are granted
to use, reproduce and distribute it along with any kind of open source and closed source applications.</p>
</div>
<div class="paragraph">
<p>Hazelcast IMDG Enterprise is a commercial product of Hazelcast, Inc. and is distributed under a commercial license that must be acquired
before using it in any type of released software. Feel free to contact <a href="http://hazelcast.com/contact/">Hazelcast sales department</a>
for more information on commercial offers.</p>
</div>
<div class="paragraph">
<p>Depending on the used feature-set, Hazelcast has certain runtime dependencies which might have different licenses. Following are dependencies and their respective licenses.</p>
</div>
<div class="sect2">
<h3 id="embedded-dependencies"><a class="anchor" href="#embedded-dependencies"></a><a class="link" href="#embedded-dependencies">C.1. Embedded Dependencies</a></h3>
<div class="paragraph">
<p>Embedded dependencies are merged (shaded) with the Hazelcast codebase at compile-time. These dependencies become an integral part
of the Hazelcast distribution.</p>
</div>
<div class="paragraph">
<p>For license files of embedded dependencies, please see the <code>license</code> directory of the Hazelcast distribution, available at our
<a href="https://hazelcast.org/download/">download page</a>.</p>
</div>
<div class="paragraph">
<p><strong>minimal-json</strong>:</p>
</div>
<div class="paragraph">
<p>minimal-json is a JSON parsing and generation library which is a part of the Hazelcast distribution. It is used for communication
between the Hazelcast cluster and the Management Center.</p>
</div>
<div class="paragraph">
<p>minimal-json is distributed under the <a href="http://opensource.org/licenses/MIT">MIT license</a> and offers the same rights to add, use,
modify and distribute the source code as the Apache License 2.0 that Hazelcast uses. However, some other restrictions might apply.</p>
</div>
</div>
<div class="sect2">
<h3 id="runtime-dependencies"><a class="anchor" href="#runtime-dependencies"></a><a class="link" href="#runtime-dependencies">C.2. Runtime Dependencies</a></h3>
<div class="paragraph">
<p>Depending on the used features, additional dependencies might be added to the dependency set. Those runtime dependencies might have
other licenses. See the following list of additional runtime dependencies.</p>
</div>
<div class="paragraph">
<p><strong>Spring Framework</strong>:</p>
</div>
<div class="paragraph">
<p>Hazelcast offers a tight integration into the Spring Framework. Hazelcast can be configured and controlled using Spring.</p>
</div>
<div class="paragraph">
<p>The Spring Framework is distributed under the terms of the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2</a> and therefore it is
fully compatible with Hazelcast.</p>
</div>
<div class="paragraph">
<p><strong>Hibernate</strong>:</p>
</div>
<div class="paragraph">
<p>Hazelcast integrates itself into Hibernate as a second-level cache provider.</p>
</div>
<div class="paragraph">
<p>Hibernate is distributed under the terms of the <a href="https://www.gnu.org/licenses/lgpl-2.1.html">Lesser General Public License 2.1</a>,
also known as LGPL. Please read carefully the terms of the LGPL since restrictions might apply.</p>
</div>
<div class="paragraph">
<p><strong>Apache Tomcat</strong>:</p>
</div>
<div class="paragraph">
<p>Hazelcast IMDG Enterprise offers native integration into Apache Tomcat for web session clustering.</p>
</div>
<div class="paragraph">
<p>Apache Tomcat is distributed under the terms of the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2</a> and therefore
fully compatible with Hazelcast.</p>
</div>
<div class="paragraph">
<p><strong>Eclipse Jetty</strong>:</p>
</div>
<div class="paragraph">
<p>Hazelcast IMDG Enterprise offers native integration into Jetty for web session clustering.</p>
</div>
<div class="paragraph">
<p>Jetty is distributed with a dual licensing strategy. It is licensed under the terms of the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2</a>
and under the <a href="https://www.eclipse.org/legal/epl-v10.html">Eclipse Public License v1.0</a>, also known as EPL. Due to the Apache License,
it is fully compatible with Hazelcast.</p>
</div>
<div class="paragraph">
<p><strong>JCache API (JSR 107)</strong>:</p>
</div>
<div class="paragraph">
<p>Hazelcast offers a native implementation for JCache (JSR 107), which has a runtime dependency to the JCache API.</p>
</div>
<div class="paragraph">
<p>The JCache API is distributed under the terms of the so called <a href="https://jcp.org/aboutJava/communityprocess/licenses/jsr107/Spec-License-JSR-107-10_22_12.pdf">Specification License</a>.
Please read carefully the terms of this license since restrictions might apply.</p>
</div>
<div class="paragraph">
<p><strong>Boost C++ Libraries</strong>:</p>
</div>
<div class="paragraph">
<p>Hazelcast IMDG Enterprise offers a native C++ client, which has a link-time dependency to the Boost C++ Libraries.</p>
</div>
<div class="paragraph">
<p>The Boost Libraries are distributed under the terms of the <a href="http://www.boost.org/LICENSE_1_0.txt">Boost Software License</a>), which is
very similar to the MIT or BSD license. Please read carefully the terms of this license since restrictions might apply.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="frequently-asked-questions"><a class="anchor" href="#frequently-asked-questions"></a><a class="link" href="#frequently-asked-questions">Appendix D: Frequently Asked Questions</a></h2>
<div class="sectionbody">
<hr>
<div class="paragraph">
<p><strong>Why 271 as the default partition count?</strong></p>
</div>
<div class="paragraph">
<p>The partition count of 271, being a prime number, is a good choice because it will be distributed to the members almost evenly. For a small to medium sized cluster, the count of 271 gives an almost even partition distribution and optimal-sized partitions.  As your cluster becomes bigger, you should make this count bigger to have evenly distributed partitions.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Is Hazelcast thread safe?</strong></p>
</div>
<div class="paragraph">
<p>Yes. All Hazelcast data structures are thread safe.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>How do members discover each other?</strong></p>
</div>
<div class="paragraph">
<p>When a member is started in a cluster, it will dynamically and automatically be discovered. The following are the types of discovery:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Discovery by TCP/IP: the first member created in the cluster (leader) will form a list of IP addresses of other joining members and will send this list to these members so the members will know each other.</p>
</li>
<li>
<p>Discovery at clouds: Hazelcast supports discovery at cloud platforms such as jclouds based environments, Azure, Consul and PCF.</p>
</li>
<li>
<p>Multicast discovery: members in a cluster discover each other by multicast, by default. It is not recommended for production since UDP is often blocked in production environments and other discovery mechanisms are more definite</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once members are discovered, all the communication between them will be via TCP/IP.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to the <a href="#discovery-mechanisms">Discovery Mechanisms section</a> for detailed information.
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p><strong>What happens when a member goes down?</strong></p>
</div>
<div class="paragraph">
<p>Once a member is gone (crashes), the following happens since data in each member has a backup in other members.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, the backups in other members are restored.</p>
</li>
<li>
<p>Then, data from these restored backups are recovered.</p>
</li>
<li>
<p>And finally, new backups for these recovered data are formed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So eventually, availability of the data is maintained.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>How do I test the connectivity?</strong></p>
</div>
<div class="paragraph">
<p>If you notice that there is a problem with a member joining a cluster, you may want to perform a connectivity test between the member to be joined and a member from the cluster. You can use the <code>iperf</code> tool for this purpose. For example, you can execute the below command on one member (i.e. listening on port 5701).</p>
</div>
<div class="paragraph">
<p><code>iperf -s -p 5701</code></p>
</div>
<div class="paragraph">
<p>And you can execute the below command on the other member.</p>
</div>
<div class="paragraph">
<p><code>iperf -c</code> <strong><code>&lt;IP address&gt;</code></strong> <code>-d -p 5701</code></p>
</div>
<div class="paragraph">
<p>The output should include connection information, such as the IP addresses, transfer speed and bandwidth. Otherwise, if the output says <code>No route to host</code>, it means a network connection problem exists.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>How do I choose keys properly?</strong></p>
</div>
<div class="paragraph">
<p>When you store a key and value in a distributed Map, Hazelcast serializes the key and value and stores the byte array version of them in local ConcurrentHashMaps. These ConcurrentHashMaps use <code>equals</code> and <code>hashCode</code> methods of byte array version of your key. It does not take into account the actual <code>equals</code> and <code>hashCode</code> implementations of your objects. So it is important that you choose your keys in a proper way.</p>
</div>
<div class="paragraph">
<p>Implementing <code>equals</code> and <code>hashCode</code> is not enough, it is also important that the object is always serialized into the same byte array. All primitive types like String, Long, Integer, etc. are good candidates for keys to be used in Hazelcast. An unsorted Set is an example of a very bad candidate because Java Serialization may serialize the same unsorted set in two different byte arrays.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>How do I reflect value modifications?</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast always return a clone copy of a value. Modifying the returned value does not change the actual value in the map (or multimap, list, set). You should put the modified value back to make changes visible to all members.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">V value = map.get( key );
value.updateSomeProperty();
map.put( key, value );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Collections which return values of methods (such as <code>IMap.keySet</code>, <code>IMap.values</code>, <code>IMap.entrySet</code>, <code>MultiMap.get</code>, <code>MultiMap.remove</code>, <code>IMap.keySet</code>, <code>IMap.values</code>) contain cloned values. These collections are NOT backed up by related Hazelcast objects. Therefore, changes to them are <strong>NOT</strong> reflected in the originals and vice-versa.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>How do I test my Hazelcast cluster?</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast allows you to create more than one instance on the same JVM. Each member is called <code>HazelcastInstance</code> and each will have its own configuration, socket and threads, so you can treat them as totally separate instances.</p>
</div>
<div class="paragraph">
<p>This enables you to write and to run cluster unit tests on a single JVM. Because you can use this feature for creating separate members different applications running on the same JVM (imagine running multiple web applications on the same JVM), you can also use this feature for testing your Hazelcast cluster.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say you want to test if two members have the same size of a map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testTwoMemberMapSizes() {
  <span class="comment">// start the first member</span>
  HazelcastInstance h1 = Hazelcast.newHazelcastInstance();
  <span class="comment">// get the map and put 1000 entries</span>
  <span class="predefined-type">Map</span> map1 = h1.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">testmap</span><span class="delimiter">&quot;</span></span> );
  <span class="keyword">for</span> ( <span class="type">int</span> i = <span class="integer">0</span>; i &lt; <span class="integer">1000</span>; i++ ) {
    map1.put( i, <span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span> + i );
  }
  <span class="comment">// check the map size</span>
  assertEquals( <span class="integer">1000</span>, map1.size() );
  <span class="comment">// start the second member</span>
  HazelcastInstance h2 = Hazelcast.newHazelcastInstance();
  <span class="comment">// get the same map from the second member</span>
  <span class="predefined-type">Map</span> map2 = h2.getMap( <span class="string"><span class="delimiter">&quot;</span><span class="content">testmap</span><span class="delimiter">&quot;</span></span> );
  <span class="comment">// check the size of map2</span>
  assertEquals( <span class="integer">1000</span>, map2.size() );
  <span class="comment">// check the size of map1 again</span>
  assertEquals( <span class="integer">1000</span>, map1.size() );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the test above, everything happens in the same thread. When developing a multi-threaded test, you need to carefully handle coordination of the thread executions. it is highly recommended that you use <code>CountDownLatch</code> for thread coordination (you can certainly use other ways). Here is an example where we need to listen for messages and make sure that we got these messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testTopic() {
  <span class="comment">// start two member cluster</span>
  HazelcastInstance h1 = Hazelcast.newHazelcastInstance();
  HazelcastInstance h2 = Hazelcast.newHazelcastInstance();
  <span class="predefined-type">String</span> topicName = <span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessages</span><span class="delimiter">&quot;</span></span>;
  <span class="comment">// get a topic from the first member and add a messageListener</span>
  ITopic&lt;<span class="predefined-type">String</span>&gt; topic1 = h1.getTopic( topicName );
  <span class="directive">final</span> <span class="predefined-type">CountDownLatch</span> latch1 = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>( <span class="integer">1</span> );
  topic1.addMessageListener( <span class="keyword">new</span> MessageListener() {
    <span class="directive">public</span> <span class="type">void</span> onMessage( <span class="predefined-type">Object</span> msg ) {
      assertEquals( <span class="string"><span class="delimiter">&quot;</span><span class="content">Test1</span><span class="delimiter">&quot;</span></span>, msg );
      latch1.countDown();
    }
  });
  <span class="comment">// get a topic from the second member and add a messageListener</span>
  ITopic&lt;<span class="predefined-type">String</span>&gt; topic2 = h2.getTopic(topicName);
  <span class="directive">final</span> <span class="predefined-type">CountDownLatch</span> latch2 = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>( <span class="integer">2</span> );
  topic2.addMessageListener( <span class="keyword">new</span> MessageListener() {
    <span class="directive">public</span> <span class="type">void</span> onMessage( <span class="predefined-type">Object</span> msg ) {
      assertEquals( <span class="string"><span class="delimiter">&quot;</span><span class="content">Test1</span><span class="delimiter">&quot;</span></span>, msg );
      latch2.countDown();
    }
  } );
  <span class="comment">// publish the first message, both should receive this</span>
  topic1.publish( <span class="string"><span class="delimiter">&quot;</span><span class="content">Test1</span><span class="delimiter">&quot;</span></span> );
  <span class="comment">// shutdown the first member</span>
  h1.shutdown();
  <span class="comment">// publish the second message, second member's topic should receive this</span>
  topic2.publish( <span class="string"><span class="delimiter">&quot;</span><span class="content">Test1</span><span class="delimiter">&quot;</span></span> );
  <span class="keyword">try</span> {
    <span class="comment">// assert that the first member's topic got the message</span>
    assertTrue( latch1.await( <span class="integer">5</span>, <span class="predefined-type">TimeUnit</span>.SECONDS ) );
    <span class="comment">// assert that the second members' topic got two messages</span>
    assertTrue( latch2.await( <span class="integer">5</span>, <span class="predefined-type">TimeUnit</span>.SECONDS ) );
  } <span class="keyword">catch</span> ( <span class="exception">InterruptedException</span> ignored ) {
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can start Hazelcast members with different configurations. Remember to call <code>Hazelcast.shutdownAll()</code> after each test case to make sure that there is no other running member left from the previous tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@After</span>
<span class="directive">public</span> <span class="type">void</span> cleanup() <span class="directive">throws</span> <span class="exception">Exception</span> {
  Hazelcast.shutdownAll();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information please <a href="https://github.com/hazelcast/hazelcast/tree/master/hazelcast/src/test/java/com/hazelcast/cluster">check our existing tests</a>.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Does Hazelcast support hundreds of members?</strong></p>
</div>
<div class="paragraph">
<p>Yes. Hazelcast performed a successful test on Amazon EC2 with 200 members.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Does Hazelcast support thousands of clients?</strong></p>
</div>
<div class="paragraph">
<p>Yes. However, there are some points you should consider. The environment should be LAN with a high stability and the network speed should be 10 Gbps or higher. If the number of members is high, the client type should be selected as Dummy, not Smart Client. In the case of Smart Clients, since each client will open a connection to the members, these members should be powerful enough (for example, more cores) to handle hundreds or thousands of connections and client requests. Also, you should consider using Near Caches in clients to lower the network traffic. And you should use the Hazelcast releases with the NIO implementation (which starts with Hazelcast 3.2).</p>
</div>
<div class="paragraph">
<p>Also, you should configure the clients attentively. Please refer to the <a href="#hazelcast-clients">Clients section</a> section for configuration notes.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Difference between Lite Member and Smart Client?</strong></p>
</div>
<div class="paragraph">
<p>Lite member supports task execution (distributed executor service), smart client does not. Also, Lite Member is highly coupled with cluster, smart client is not.
Starting with Hazelcast 3.9, you can also promote lite members to data members. Please refer to the <a href="#enabling-lite-members">Lite Members section</a> for more information.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>How do you give support?</strong></p>
</div>
<div class="paragraph">
<p>We have two support services: community and commercial support. Community support is provided through our <a href="https://groups.google.com/forum/#!forum/hazelcast">Mail Group</a> and <a href="http://stackoverflow.com/">StackOverflow</a> web site. For information on support subscriptions, please see <a href="https://hazelcast.com/pricing/">Hazelcast.com</a>.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Does Hazelcast persist?</strong></p>
</div>
<div class="paragraph">
<p>No. However, Hazelcast provides <code>MapStore</code> and <code>MapLoader</code> interfaces. For example, when you implement the <code>MapStore</code> interface, Hazelcast calls your store and load methods whenever needed.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Can I use Hazelcast in a single server?</strong></p>
</div>
<div class="paragraph">
<p>Yes. But please note that Hazelcast&#8217;s main design focus is multi-member clusters to be used as a distribution platform.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>How can I monitor Hazelcast?</strong></p>
</div>
<div class="paragraph">
<p><a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html">Hazelcast Management Center</a> is what you use to monitor and manage the members running Hazelcast. In addition to monitoring the overall state of a cluster, you can analyze and browse data structures in detail, you can update map configurations and you can take thread dumps from members.</p>
</div>
<div class="paragraph">
<p>You can also use Hazelcast&#8217;s HTTP based health check implementation and health monitoring utility. Please see the <a href="#health-check-and-monitoring">Health Check and Monitoring section</a>. There is also a <a href="#diagnostics">diagnostocs tool</a> where you can see detailed logs enhanced with diagnostic plugins.</p>
</div>
<div class="paragraph">
<p>Moreover, JMX monitoring is also provided. Please see the <a href="#monitoring-with-jmx">Monitoring with JMX section</a> for details.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>How can I see debug level logs?</strong></p>
</div>
<div class="paragraph">
<p>By changing the log level to "Debug". Below are sample lines for <strong>log4j</strong> logging framework. Please see the <a href="#logging-configuration">Logging Configuration section</a> to learn how to set logging types.</p>
</div>
<div class="paragraph">
<p>First, set the logging type as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> location = <span class="string"><span class="delimiter">&quot;</span><span class="content">log4j.configuration</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">String</span> logging = <span class="string"><span class="delimiter">&quot;</span><span class="content">hazelcast.logging.type</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">System</span>.setProperty( logging, <span class="string"><span class="delimiter">&quot;</span><span class="content">log4j</span><span class="delimiter">&quot;</span></span> );
<span class="comment">/**if you want to give a new location. **/</span>
<span class="predefined-type">System</span>.setProperty( location, <span class="string"><span class="delimiter">&quot;</span><span class="content">file:/path/mylog4j.properties</span><span class="delimiter">&quot;</span></span> );</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then set the log level to "Debug" in the properties file. Below is example content.</p>
</div>
<div class="paragraph">
<p><code># direct log messages to stdout #</code></p>
</div>
<div class="paragraph">
<p><code>log4j.appender.stdout=org.apache.log4j.ConsoleAppender</code></p>
</div>
<div class="paragraph">
<p><code>log4j.appender.stdout.Target=System.out</code></p>
</div>
<div class="paragraph">
<p><code>log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</code></p>
</div>
<div class="paragraph">
<p><code>log4j.appender.stdout.layout.ConversionPattern=%d{ABSOLUTE} %5p [%c{1}] - %m%n</code></p>
</div>
<div class="paragraph">
<p><code>log4j.logger.com.hazelcast=debug</code></p>
</div>
<div class="paragraph">
<p><code>#log4j.logger.com.hazelcast.cluster=debug</code></p>
</div>
<div class="paragraph">
<p><code>#log4j.logger.com.hazelcast.partition=debug</code></p>
</div>
<div class="paragraph">
<p><code>#log4j.logger.com.hazelcast.partition.InternalPartitionService=debug</code></p>
</div>
<div class="paragraph">
<p><code>#log4j.logger.com.hazelcast.nio=debug</code></p>
</div>
<div class="paragraph">
<p><code>#log4j.logger.com.hazelcast.hibernate=debug</code></p>
</div>
<div class="paragraph">
<p>The line <code>log4j.logger.com.hazelcast=debug</code> is used to see debug logs for all Hazelcast operations. Below this line, you can select to see specific logs (cluster, partition, hibernate, etc.).</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Client-server vs. embedded topologies?</strong></p>
</div>
<div class="paragraph">
<p>In the embedded topology, members include both the data and application. This type of topology is the most useful if your application focuses on high performance computing and many task executions. Since application is close to data, this topology supports data locality.</p>
</div>
<div class="paragraph">
<p>In the client-server topology, you create a cluster of members and scale the cluster independently. Your applications are hosted on the clients and the clients communicate with the members in the cluster to reach data.</p>
</div>
<div class="paragraph">
<p>Client-server topology fits better if there are multiple applications sharing the same data or if application deployment is significantly greater than the cluster size (for example, 500 application servers vs. 10 member cluster).</p>
</div>
<hr>
<div class="paragraph">
<p><strong>How can I shutdown a Hazelcast member?</strong></p>
</div>
<div class="paragraph">
<p>Ways of shutting down a Hazelcast member:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can call <code>kill -9 &lt;PID&gt;</code> in the terminal (which sends a SIGKILL signal). This will result in the immediate shutdown which is not recommended for production systems. If you set the property <code>hazelcast.shutdownhook.enabled</code> to <code>false</code> and then kill the process using <code>kill -15 &lt;PID&gt;</code>, its result is the same (immediate shutdown).</p>
</li>
<li>
<p>You can call <code>kill -15 &lt;PID&gt;</code> in the terminal (which sends a SIGTERM signal), or you can call the method <code>HazelcastInstance.getLifecycleService().terminate()</code> programmatically, or you can use the script <code>stop.sh</code> located in your Hazelcast&#8217;s <code>/bin</code> directory. All three of them will terminate your member ungracefully. They do not wait for migration operations, they force the shutdown. But this is much better than <code>kill -9 &lt;PID&gt;</code> since it releases most of the used resources.</p>
</li>
<li>
<p>In order to gracefully shutdown a Hazelcast member (so that it waits the migration operations to be completed), you have four options:</p>
<div class="ulist">
<ul>
<li>
<p>You can call the method <code>HazelcastInstance.shutdown()</code> programatically.</p>
</li>
<li>
<p>You can use JMX API&#8217;s shutdown method. You can do this by implementing a JMX client application or using a JMX monitoring tool (like JConsole).</p>
</li>
<li>
<p>You can set the property <code>hazelcast.shutdownhook.policy</code> to <code>GRACEFUL</code> and then shutdown by using <code>kill -15 &lt;PID&gt;</code>. Your member will be gracefully shutdown.</p>
</li>
<li>
<p>You can use the "Shutdown Member" button in the member view of <a href="https://docs.hazelcast.org/docs/management-center/latest/manual/html/index.html#monitoring-members">Hazelcast Management Center</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you use systemd&#8217;s <code>systemctl</code> utility, i.e., <code>systemctl stop service_name</code>, a SIGTERM signal is sent. After 90 seconds of waiting it is followed by a SIGKILL signal by default. Thus, it will call terminate at first and kill the member directly after 90 seconds. We do not recommend to use it with its defaults. But <a href="https://www.linux.com/learn/understanding-and-using-systemd">systemd</a> is very customizable and well-documented, you can see its details using the command  <code>man systemd.kill</code>. If you can customize it to shutdown your Hazelcast member gracefully (by using the methods above), then you can use it.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>How do I know it is safe to kill the second member?</strong></p>
</div>
<div class="paragraph">
<p>Starting with Hazelcast 3.7, graceful shutdown of a Hazelcast member can be initiated any time as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">hazelcastInstance.shutdown();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once a Hazelcast member initiates a graceful shutdown, data of the shutting down member is migrated to the other nodes automatically.</p>
</div>
<div class="paragraph">
<p>However, there is no such guarantee for termination.</p>
</div>
<div class="paragraph">
<p>Below code snippet terminates a member if the cluster is safe, which means that there are no partitions being migrated and all backups are in sync when this method is called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">PartitionService partitionService = hazelcastInstance.getPartitionService();
<span class="keyword">if</span> (partitionService.isClusterSafe()) {
  hazelcastInstance.getLifecycleService().terminate();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Below code snippet terminates the local member if the member is safe to terminate, which means that all backups of partitions currently owned by local member are in sync when this method is called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">PartitionService partitionService = hazelcastInstance.getPartitionService();
<span class="keyword">if</span> (partitionService.isLocalMemberSafe()) {
  hazelcastInstance.getLifecycleService().terminate();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please keep in mind that two code snippets shown above are inherently racy. If member failures occur in the cluster after the safety condition check passes, termination of the local member can lead to data loss. For safety of the data, graceful shutdown API is highly recommended.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please refer to <a href="#safety-checking-cluster-members">Safety Checking Cluster Members</a> for more information.
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p><strong>When do I need Native Memory solutions?</strong></p>
</div>
<div class="paragraph">
<p>Native Memory solutions can be preferred:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when the amount of data per member is large enough to create significant garbage collection pauses.</p>
</li>
<li>
<p>when your application requires predictable latency.</p>
</li>
</ul>
</div>
<hr>
<div class="paragraph">
<p><strong>Is there any disadvantage of using near-cache?</strong></p>
</div>
<div class="paragraph">
<p>The only disadvantage when using Near Cache is that it may cause stale reads.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Is Hazelcast secure?</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast supports symmetric encryption, transport layer security/secure sockets layer (TLS/SSL) and Java Authentication and Authorization Service (JAAS). Please see the <a href="#security">Security chapter</a> for more information.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>How can I set socket options?</strong></p>
</div>
<div class="paragraph">
<p>Hazelcast allows you to set some socket options such as <code>SO_KEEPALIVE</code>, <code>SO_SNDBUF</code> and <code>SO_RCVBUF</code> using Hazelcast configuration properties. Please see <code>hazelcast.socket.*</code> properties explained in the <a href="#system-properties">System Properties appendix</a>.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Client disconnections during idle time?</strong></p>
</div>
<div class="paragraph">
<p>In Hazelcast, socket connections are created with the <code>SO_KEEPALIVE</code> option enabled by default. In most operating systems, default keep-alive time is 2 hours. If you have a firewall between clients and servers which is configured to reset idle connections/sessions, make sure that the firewall&#8217;s idle timeout is greater than the TCP keep-alive defined in the OS.</p>
</div>
<div class="paragraph">
<p>For additional information please see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://tldp.org/HOWTO/TCP-Keepalive-HOWTO/usingkeepalive.html">Using TCP keepalive under Linux</a></p>
</li>
<li>
<p><a href="http://technet.microsoft.com/en-us/library/cc957549.aspx">Microsoft TechNet</a></p>
</li>
</ul>
</div>
<hr>
<div class="paragraph">
<p><strong>OOME: Unable to create new native thread?</strong></p>
</div>
<div class="paragraph">
<p>If you encounter an error of <code>java.lang.OutOfMemoryError: unable to create new native thread</code>, it may be caused by exceeding the available file descriptors on your operating system, especially if it is Linux. This exception is usually thrown on a running member, after a period of time when the thread count exhausts the file descriptor availability.</p>
</div>
<div class="paragraph">
<p>The JVM on Linux consumes a file descriptor for each thread created.  The default number of file descriptors available in Linux is usually 1024. If you have many JVMs running on a single machine, it is possible to exceed this default number.</p>
</div>
<div class="paragraph">
<p>You can view the limit using the following command.</p>
</div>
<div class="paragraph">
<p><code># ulimit -a</code></p>
</div>
<div class="paragraph">
<p>At the operating system level, Linux users can control the amount of resources (and in particular, file descriptors) used via one of the following options.</p>
</div>
<div class="paragraph">
<p>1 - Editing the <code>limits.conf</code> file:</p>
</div>
<div class="paragraph">
<p><code># vi /etc/security/limits.conf</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">testuser soft nofile <span class="integer">4096</span>&lt;br&gt;
testuser hard nofile <span class="integer">10240</span>&lt;br&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>2 - Or using the <code>ulimit</code> command:</p>
</div>
<div class="paragraph">
<p><code># ulimit -Hn</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="integer">10240</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default number of process per users is 1024. Adding the following to your <code>$HOME/.profile</code> could solve the issue:</p>
</div>
<div class="paragraph">
<p><code># ulimit -u 4096</code></p>
</div>
<hr>
<div class="paragraph">
<p><strong>Does repartitioning wait for Entry Processor?</strong></p>
</div>
<div class="paragraph">
<p>Repartitioning is the process of redistributing the partition ownerships. Hazelcast performs the repartitioning in the cases where a member leaves the cluster or joins the cluster. If a repartitioning will happen while an entry processor is active in a member processing on an entry object, the repartitioning waits for the entry processor to complete its job.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>Instances on different machines cannot see each other?</strong></p>
</div>
<div class="paragraph">
<p>Assume you have two instances on two different machines and you develop a configuration as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Config config = <span class="keyword">new</span> Config();
NetworkConfig network = config.getNetworkConfig();

JoinConfig join = network.getJoin();
join.getMulticastConfig().setEnabled(<span class="predefined-constant">false</span>);
join.getTcpIpConfig().addMember(<span class="string"><span class="delimiter">&quot;</span><span class="content">IP1</span><span class="delimiter">&quot;</span></span>)
    .addMember(<span class="string"><span class="delimiter">&quot;</span><span class="content">IP2</span><span class="delimiter">&quot;</span></span>).setEnabled(<span class="predefined-constant">true</span>);
network.getInterfaces().setEnabled(<span class="predefined-constant">true</span>)
    .addInterface(<span class="string"><span class="delimiter">&quot;</span><span class="content">IP1</span><span class="delimiter">&quot;</span></span>).addInterface(<span class="string"><span class="delimiter">&quot;</span><span class="content">IP2</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you create the Hazelcast instance, you have to pass the configuration to the instance. If you create the instances without passing the configuration, each instance starts but cannot see each other. Therefore, a correct way to create the instance is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance instance = Hazelcast.newHazelcastInstance(config);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following is an incorrect way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HazelcastInstance instance = Hazelcast.newHazelcastInstance();</code></pre>
</div>
</div>
<hr>
<div class="paragraph">
<p><strong>What Does "Replica: 1 has no owner" Mean?</strong></p>
</div>
<div class="paragraph">
<p>When you start more members after the first one is started, you will see <code>replica: 1 has no owner</code> entry in the newly started member&#8217;s log. There is no need to worry about it since it refers to a transitory state. It only means the replica partition is not ready/assigned yet and eventually it will be.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="glossary"><a class="anchor" href="#glossary"></a><a class="link" href="#glossary">Glossary</a></h2>
<div class="sectionbody">
<div class="dlist glossary">
<dl>
<dt>2-phase Commit</dt>
<dd>
<p>2-phase commit protocol is an atomic commitment protocol for distributed systems. It consists of two phases: commit-request and commit. In commit-request phase, transaction manager coordinates all of the transaction resources to commit or abort. In commit-phase, transaction manager decides to finalize operation by committing or aborting according to the votes of the each transaction resource.</p>
</dd>
<dt>ACID</dt>
<dd>
<p>A set of properties (Atomicity, Consistency, Isolation, Durability) guaranteeing that transactions are processed reliably. Atomicity requires that each transaction be all or nothing (i.e. if one part of the transaction fails, the entire transaction will fail). Consistency ensures that only valid data following all rules and constraints is written. Isolation ensures that transactions are securely and independently processed at the same time without interference (and without transaction ordering). Durability means that once a transaction has been committed, it will remain so, no matter if there is a power loss, crash, or error.</p>
</dd>
<dt>Cache</dt>
<dd>
<p>A high-speed access area that can be either a reserved section of main memory or storage device.</p>
</dd>
<dt>Client Server Topology</dt>
<dd>
<p>Hazelcast topology where members run outside the user application and are connected to clients using client libraries. The client library is installed in the user application.</p>
</dd>
<dt>Embedded Topology</dt>
<dd>
<p>|Hazelcast topology where the members are in-process with the user application and act as both client and server.</p>
</dd>
<dt>Garbage Collection</dt>
<dd>
<p>Garbage collection is the recovery of storage that is being used by an application when that application no longer needs the storage. This frees the storage for use by other applications (or processes within an application). It also ensures that an application using increasing amounts of storage does not reach its quota. Programming languages that use garbage collection are often interpreted within virtual machines like the JVM. The environment that runs the code is also responsible for garbage collection.</p>
</dd>
<dt>Hazelcast Cluster</dt>
<dd>
<p>A virtual environment formed by Hazelcast members communicating with each other in the cluster.</p>
</dd>
<dt>Hazelcast Partitions</dt>
<dd>
<p>Memory segments containing the data. Hazelcast is built-on the partition concept, it uses partitions to store and process data. Each partition can have hundreds or thousands of data entries depending on your memory capacity. You can think of a partition as a block of data. In general and optimally, a partition should have a maximum size of 50-100 Megabytes.</p>
</dd>
<dt>IMDG</dt>
<dd>
<p>An in-memory data grid (IMDG) is a data structure that resides entirely in memory and is distributed among many members in a single location or across multiple locations. IMDGs can support thousands of in-memory data updates per second and they can be clustered and scaled in ways that support large quantities of data.</p>
</dd>
<dt>Invalidation</dt>
<dd>
<p>The process of marking an object as being invalid across the distributed cache.</p>
</dd>
<dt>Java heap</dt>
<dd>
<p>Java heap is the space that Java can reserve and use in memory for dynamic memory allocation. All runtime objects created by a Java application are stored in heap. By default, the heap size is 128 MB, but this limit is reached easily for business applications. Once the heap is full, new objects cannot be created and the Java application shows errors.</p>
</dd>
<dt>LRU, LFU</dt>
<dd>
<p>LRU and LFU are two of eviction algorithms. LRU is the abbreviation for Least Recently Used. It refers to entries eligible for eviction due to lack of interest by applications. LFU is the abbreviation for Least Frequently Used. It refers to the entries eligible for eviction due to having the lowest usage frequency.</p>
</dd>
<dt>Member</dt>
<dd>
<p>A Hazelcast instance. Depending on your Hazelcast usage, it can refer to a server or a Java virtual machine (JVM). Members belong to a Hazelcast cluster. Members are also referred as member nodes, cluster members, or Hazelcast members.</p>
</dd>
<dt>Multicast</dt>
<dd>
<p>A type of communication where data is addressed to a group of destination members simultaneously.</p>
</dd>
<dt>Near Cache</dt>
<dd>
<p>A caching model. When Near Cache is enabled, an object retrieved from a remote member is put into the local cache and the future requests made to this object will be handled by this local member. For example, if you have a map with data that is mostly read, then using Near Cache is a good idea.</p>
</dd>
<dt>NoSQL</dt>
<dd>
<p>"Not Only SQL". A database model that provides a mechanism for storage and retrieval of data that is tailored in means other than the tabular relations used in relational databases. It is a type of database which does not adhering to the traditional relational database management system (RDMS) structure. It is not built on tables and does not employ SQL to manipulate data. It also may not provide full ACID guarantees, but still has a distributed and fault tolerant architecture.</p>
</dd>
<dt>OSGI</dt>
<dd>
<p>Formerly known as the Open Services Gateway initiative, it describes a modular system and a service platform for the Java programming language that implements a complete and dynamic component model.</p>
</dd>
<dt>Partition Table</dt>
<dd>
<p>Table containing all members in the cluster, mappings of partitions to members and further metadata.</p>
</dd>
<dt>Race Condition</dt>
<dd>
<p>This condition occurs when two or more threads can access shared data and they try to change it at the same time.</p>
</dd>
<dt>RSA</dt>
<dd>
<p>An algorithm developed by Rivest, Shamir and Adleman to generate, encrypt and decrypt keys for secure data transmissions.</p>
</dd>
<dt>Serialization</dt>
<dd>
<p>Process of converting an object into a stream of bytes in order to store the object or transmit it to memory, a database, or a file. Its main purpose is to save the state of an object in order to be able to recreate it when needed. The reverse process is called deserialization.</p>
</dd>
<dt>Split-brain</dt>
<dd>
<p>Split-brain syndrome, in a clustering context, is a state in which a cluster of members gets divided (or partitioned) into smaller clusters of members, each of which believes it is the only active cluster.</p>
</dd>
<dt>Transaction</dt>
<dd>
<p>Means a sequence of information exchange and related work (such as data store updating) that is treated as a unit for the purposes of satisfying a request and for ensuring data store integrity.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-10-23 13:55:33 UTC
</div>
</div>
</body>
</html>